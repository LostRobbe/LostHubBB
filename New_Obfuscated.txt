
local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'

function dec(data)
    data = string.gsub(data, '[^'..b..'=]', '')
    return (data:gsub('.', function(x)
        if (x == '=') then return '' end
        local r,f='',(b:find(x)-1)
        for i=6,1,-1 do r=r..(f%2^i - f%2^(i-1) > 0 and '1' or '0') end
        return r;
    end):gsub('%d%d%d?%d?%d?%d?%d?%d?', function(x)
        if (#x ~= 8) then return '' end
        local c=0
        for i=1,8 do c=c + (x:sub(i,i)=='1' and 2^(8-i) or 0) end
        return string.char(c)
    end))
end

loadstring(dec([[
Z2V0Z2VudigpLkdHID0gewogICAgTGFuZ3VhZ2UgPSB7CiAgICAgICAgQ2hlY2tib3hFbmFibGVkID0gIkVuYWJsZWQiLAogICAgICAgIENoZWNrYm94RGlzYWJsZWQgPSAiRGlzYWJsZWQiLAogICAgICAgIFNsaWRlclZhbHVlID0gIlZhbHVlIiwKICAgICAgICBEcm9wZG93blNlbGVjdCA9ICJTZWxlY3QiLAogICAgICAgIERyb3Bkb3duTm9uZSA9ICJOb25lIiwKICAgICAgICBEcm9wZG93blNlbGVjdGVkID0gIlNlbGVjdGVkIiwKICAgICAgICBCdXR0b25DbGljayA9ICJDbGljayIsCiAgICAgICAgVGV4dGJveEVudGVyID0gIkVudGVyIiwKICAgICAgICBNb2R1bGVFbmFibGVkID0gIkVuYWJsZWQiLAogICAgICAgIE1vZHVsZURpc2FibGVkID0gIkRpc2FibGVkIiwKICAgICAgICBUYWJHZW5lcmFsID0gIkdlbmVyYWwiLAogICAgICAgIFRhYlNldHRpbmdzID0gIlNldHRpbmdzIiwKICAgICAgICBMb2FkaW5nID0gIkxvYWRpbmcuLi4iLAogICAgICAgIEVycm9yID0gIkVycm9yIiwKICAgICAgICBTdWNjZXNzID0gIlN1Y2Nlc3MiCiAgICB9Cn0KCi0tIFJlcGxhY2UgdGhlIFNlbGVjdGVkTGFuZ3VhZ2Ugd2l0aCBhIHJlZmVyZW5jZSB0byBHRy5MYW5ndWFnZQpsb2NhbCBTZWxlY3RlZExhbmd1YWdlID0gR0cuTGFuZ3VhZ2UKCmZ1bmN0aW9uIGNvbnZlcnRTdHJpbmdUb1RhYmxlKGlucHV0U3RyaW5nKQogICAgbG9jYWwgcmVzdWx0ID0ge30KICAgIGZvciB2YWx1ZSBpbiBzdHJpbmcuZ21hdGNoKGlucHV0U3RyaW5nLCAiKFteLF0rKSIpIGRvCiAgICAgICAgbG9jYWwgdHJpbW1lZFZhbHVlID0gdmFsdWU6bWF0Y2goIl4lcyooLi0pJXMqJCIpCiAgICAgICAgdGFibGVpbihyZXN1bHQsIHRyaW1tZWRWYWx1ZSkKICAgIGVuZAoKICAgIHJldHVybiByZXN1bHQKZW5kCgpmdW5jdGlvbiBjb252ZXJ0VGFibGVUb1N0cmluZyhpbnB1dFRhYmxlKQogICAgcmV0dXJuIHRhYmxlLmNvbmNhdChpbnB1dFRhYmxlLCAiLCAiKQplbmQKCmxvY2FsIFVzZXJJbnB1dFNlcnZpY2UgPSBjbG9uZXJlZihnYW1lOkdldFNlcnZpY2UoJ1VzZXJJbnB1dFNlcnZpY2UnKSkKbG9jYWwgQ29udGVudFByb3ZpZGVyID0gY2xvbmVyZWYoZ2FtZTpHZXRTZXJ2aWNlKCdDb250ZW50UHJvdmlkZXInKSkKbG9jYWwgVHdlZW5TZXJ2aWNlID0gY2xvbmVyZWYoZ2FtZTpHZXRTZXJ2aWNlKCdUd2VlblNlcnZpY2UnKSkKbG9jYWwgSHR0cFNlcnZpY2UgPSBjbG9uZXJlZihnYW1lOkdldFNlcnZpY2UoJ0h0dHBTZXJ2aWNlJykpCmxvY2FsIFRleHRTZXJ2aWNlID0gY2xvbmVyZWYoZ2FtZTpHZXRTZXJ2aWNlKCdUZXh0U2VydmljZScpKQpsb2NhbCBSdW5TZXJ2aWNlID0gY2xvbmVyZWYoZ2FtZTpHZXRTZXJ2aWNlKCdSdW5TZXJ2aWNlJykpCmxvY2FsIExpZ2h0aW5nID0gY2xvbmVyZWYoZ2FtZTpHZXRTZXJ2aWNlKCdMaWdodGluZycpKQpsb2NhbCBQbGF5ZXJzID0gY2xvbmVyZWYoZ2FtZTpHZXRTZXJ2aWNlKCdQbGF5ZXJzJykpCmxvY2FsIENvcmVHdWkgPSBjbG9uZXJlZihnYW1lOkdldFNlcnZpY2UoJ0NvcmVHdWknKSkKbG9jYWwgRGVicmlzID0gY2xvbmVyZWYoZ2FtZTpHZXRTZXJ2aWNlKCdEZWJyaXMnKSkKCmxvY2FsIG1vdXNlID0gUGxheWVycy5Mb2NhbFBsYXllcjpHZXRNb3VzZSgpCmxvY2FsIG9sZF9Mb3N0SHViID0gQ29yZUd1aTpGaW5kRmlyc3RDaGlsZCgnTG9zdEh1YicpCgppZiBvbGRfTG9zdEh1YiB0aGVuCiAgICBEZWJyaXM6QWRkSXRlbShvbGRfTG9zdEh1YiwgMCkKZW5kCgppZiBub3QgaXNmb2xkZXIoIkxvc3RIdWIiKSB0aGVuCiAgICBtYWtlZm9sZGVyKCJMb3N0SHViIikKZW5kCgoKbG9jYWwgQ29ubmVjdGlvbnMgPSBzZXRtZXRhdGFibGUoewogICAgZGlzY29ubmVjdCA9IGZ1bmN0aW9uKHNlbGYsIGNvbm5lY3Rpb24pCiAgICAgICAgaWYgbm90IHNlbGZbY29ubmVjdGlvbl0gdGhlbgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgIAogICAgICAgIHNlbGZbY29ubmVjdGlvbl06RGlzY29ubmVjdCgpCiAgICAgICAgc2VsZltjb25uZWN0aW9uXSA9IG5pbAogICAgZW5kLAogICAgZGlzY29ubmVjdF9hbGwgPSBmdW5jdGlvbihzZWxmKQogICAgICAgIGZvciBfLCB2YWx1ZSBpbiBzZWxmIGRvCiAgICAgICAgICAgIGlmIHR5cGVvZih2YWx1ZSkgPT0gJ2Z1bmN0aW9uJyB0aGVuCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICB2YWx1ZTpEaXNjb25uZWN0KCkKICAgICAgICBlbmQKICAgIGVuZAp9LCBDb25uZWN0aW9ucykKCgpsb2NhbCBVdGlsID0gc2V0bWV0YXRhYmxlKHsKICAgIG1hcCA9IGZ1bmN0aW9uKHNlbGY6IGFueSwgdmFsdWU6IG51bWJlciwgaW5fbWluaW11bTogbnVtYmVyLCBpbl9tYXhpbXVtOiBudW1iZXIsIG91dF9taW5pbXVtOiBudW1iZXIsIG91dF9tYXhpbXVtOiBudW1iZXIpCiAgICAgICAgcmV0dXJuICh2YWx1ZSAtIGluX21pbmltdW0pICogKG91dF9tYXhpbXVtIC0gb3V0X21pbmltdW0pIC8gKGluX21heGltdW0gLSBpbl9taW5pbXVtKSArIG91dF9taW5pbXVtCiAgICBlbmQsCiAgICB2aWV3cG9ydF9wb2ludF90b193b3JsZCA9IGZ1bmN0aW9uKHNlbGY6IGFueSwgbG9jYXRpb246IGFueSwgZGlzdGFuY2U6IG51bWJlcikKICAgICAgICBsb2NhbCB1bml0X3JheSA9IHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhOlNjcmVlblBvaW50VG9SYXkobG9jYXRpb24uWCwgbG9jYXRpb24uWSkKCiAgICAgICAgcmV0dXJuIHVuaXRfcmF5Lk9yaWdpbiArIHVuaXRfcmF5LkRpcmVjdGlvbiAqIGRpc3RhbmNlCiAgICBlbmQsCiAgICBnZXRfb2Zmc2V0ID0gZnVuY3Rpb24oc2VsZjogYW55KQogICAgICAgIGxvY2FsIHZpZXdwb3J0X3NpemVfWSA9IHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLlZpZXdwb3J0U2l6ZS5ZCgogICAgICAgIHJldHVybiBzZWxmOm1hcCh2aWV3cG9ydF9zaXplX1ksIDAsIDI1NjAsIDgsIDU2KQogICAgZW5kCn0sIFV0aWwpCgoKbG9jYWwgQWNyeWxpY0JsdXIgPSB7fQpBY3J5bGljQmx1ci5fX2luZGV4ID0gQWNyeWxpY0JsdXIKCgpmdW5jdGlvbiBBY3J5bGljQmx1ci5uZXcob2JqZWN0OiBHdWlPYmplY3QpCiAgICBsb2NhbCBzZWxmID0gc2V0bWV0YXRhYmxlKHsKICAgICAgICBfb2JqZWN0ID0gb2JqZWN0LAogICAgICAgIF9mb2xkZXIgPSBuaWwsCiAgICAgICAgX2ZyYW1lID0gbmlsLAogICAgICAgIF9yb290ID0gbmlsCiAgICB9LCBBY3J5bGljQmx1cikKCiAgICBzZWxmOnNldHVwKCkKCiAgICByZXR1cm4gc2VsZgplbmQKCgpmdW5jdGlvbiBBY3J5bGljQmx1cjpjcmVhdGVfZm9sZGVyKCkKICAgIGxvY2FsIG9sZF9mb2xkZXIgPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYTpGaW5kRmlyc3RDaGlsZCgnQWNyeWxpY0JsdXInKQoKICAgIGlmIG9sZF9mb2xkZXIgdGhlbgogICAgICAgIERlYnJpczpBZGRJdGVtKG9sZF9mb2xkZXIsIDApCiAgICBlbmQKCiAgICBsb2NhbCBmb2xkZXIgPSBJbnN0YW5jZS5uZXcoJ0ZvbGRlcicpCiAgICBmb2xkZXIuTmFtZSA9ICdBY3J5bGljQmx1cicKICAgIGZvbGRlci5QYXJlbnQgPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYQoKICAgIHNlbGYuX2ZvbGRlciA9IGZvbGRlcgplbmQKCgpmdW5jdGlvbiBBY3J5bGljQmx1cjpjcmVhdGVfZGVwdGhfb2ZfZmllbGRzKCkKICAgIGxvY2FsIGRlcHRoX29mX2ZpZWxkcyA9IExpZ2h0aW5nOkZpbmRGaXJzdENoaWxkKCdBY3J5bGljQmx1cicpIG9yIEluc3RhbmNlLm5ldygnRGVwdGhPZkZpZWxkRWZmZWN0JykKICAgIGRlcHRoX29mX2ZpZWxkcy5GYXJJbnRlbnNpdHkgPSAwCiAgICBkZXB0aF9vZl9maWVsZHMuRm9jdXNEaXN0YW5jZSA9IDAuMDUKICAgIGRlcHRoX29mX2ZpZWxkcy5JbkZvY3VzUmFkaXVzID0gMC4xCiAgICBkZXB0aF9vZl9maWVsZHMuTmVhckludGVuc2l0eSA9IDEKICAgIGRlcHRoX29mX2ZpZWxkcy5OYW1lID0gJ0FjcnlsaWNCbHVyJwogICAgZGVwdGhfb2ZfZmllbGRzLlBhcmVudCA9IExpZ2h0aW5nCgogICAgZm9yIF8sIG9iamVjdCBpbiBMaWdodGluZzpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgaWYgbm90IG9iamVjdDpJc0EoJ0RlcHRoT2ZGaWVsZEVmZmVjdCcpIHRoZW4KICAgICAgICAgICAgY29udGludWUKICAgICAgICBlbmQKCiAgICAgICAgaWYgb2JqZWN0ID09IGRlcHRoX29mX2ZpZWxkcyB0aGVuCiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZW5kCgogICAgICAgIENvbm5lY3Rpb25zW29iamVjdF0gPSBvYmplY3Q6R2V0UHJvcGVydHlDaGFuZ2VkU2lnbmFsKCdGYXJJbnRlbnNpdHknKTpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgb2JqZWN0LkZhckludGVuc2l0eSA9IDAKICAgICAgICBlbmQpCgogICAgICAgIG9iamVjdC5GYXJJbnRlbnNpdHkgPSAwCiAgICBlbmQKZW5kCgoKZnVuY3Rpb24gQWNyeWxpY0JsdXI6Y3JlYXRlX2ZyYW1lKCkKICAgIGxvY2FsIGZyYW1lID0gSW5zdGFuY2UubmV3KCdGcmFtZScpCiAgICBmcmFtZS5TaXplID0gVURpbTIubmV3KDEsIDAsIDEsIDApCiAgICBmcmFtZS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIDAuNSwgMCkKICAgIGZyYW1lLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAwLjUpCiAgICBmcmFtZS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgZnJhbWUuUGFyZW50ID0gc2VsZi5fb2JqZWN0CgogICAgc2VsZi5fZnJhbWUgPSBmcmFtZQplbmQKCgpmdW5jdGlvbiBBY3J5bGljQmx1cjpjcmVhdGVfcm9vdCgpCiAgICBsb2NhbCBwYXJ0ID0gSW5zdGFuY2UubmV3KCdQYXJ0JykKICAgIHBhcnQuTmFtZSA9ICdSb290JwogICAgcGFydC5Db2xvciA9IENvbG9yMy5uZXcoMCwgMCwgMCkKICAgIHBhcnQuTWF0ZXJpYWwgPSBFbnVtLk1hdGVyaWFsLkdsYXNzCiAgICBwYXJ0LlNpemUgPSBWZWN0b3IzLm5ldygxLCAxLCAwKSAgLS0gVXNlIGEgdGhpbiBwYXJ0CiAgICBwYXJ0LkFuY2hvcmVkID0gdHJ1ZQogICAgcGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgIHBhcnQuQ2FuUXVlcnkgPSBmYWxzZQogICAgcGFydC5Mb2NrZWQgPSB0cnVlCiAgICBwYXJ0LkNhc3RTaGFkb3cgPSBmYWxzZQogICAgcGFydC5UcmFuc3BhcmVuY3kgPSAwLjk4CiAgICBwYXJ0LlBhcmVudCA9IHNlbGYuX2ZvbGRlcgoKICAgIC0tIENyZWF0ZSBhIFNwZWNpYWxNZXNoIHRvIHNpbXVsYXRlIHRoZSBhY3J5bGljIGJsdXIgZWZmZWN0CiAgICBsb2NhbCBzcGVjaWFsTWVzaCA9IEluc3RhbmNlLm5ldygnU3BlY2lhbE1lc2gnKQogICAgc3BlY2lhbE1lc2guTWVzaFR5cGUgPSBFbnVtLk1lc2hUeXBlLkJyaWNrICAtLSBVc2UgQnJpY2sgbWVzaCBvciBhbm90aGVyIHR5cGUgc3VpdGFibGUgZm9yIHRoZSBlZmZlY3QKICAgIHNwZWNpYWxNZXNoLk9mZnNldCA9IFZlY3RvcjMubmV3KDAsIDAsIC0wLjAwMDAwMSkgIC0tIFNtYWxsIG9mZnNldCB0byBwcmV2ZW50IHotZmlnaHRpbmcKICAgIHNwZWNpYWxNZXNoLlBhcmVudCA9IHBhcnQKCiAgICBzZWxmLl9yb290ID0gcGFydCAgLS0gU3RvcmUgdGhlIHBhcnQgYXMgcm9vdAplbmQKCgpmdW5jdGlvbiBBY3J5bGljQmx1cjpzZXR1cCgpCiAgICBzZWxmOmNyZWF0ZV9kZXB0aF9vZl9maWVsZHMoKQogICAgc2VsZjpjcmVhdGVfZm9sZGVyKCkKICAgIHNlbGY6Y3JlYXRlX3Jvb3QoKQogICAgCiAgICBzZWxmOmNyZWF0ZV9mcmFtZSgpCiAgICBzZWxmOnJlbmRlcigwLjAwMSkKCiAgICBzZWxmOmNoZWNrX3F1YWxpdHlfbGV2ZWwoKQplbmQKCgpmdW5jdGlvbiBBY3J5bGljQmx1cjpyZW5kZXIoZGlzdGFuY2U6IG51bWJlcikKICAgIGxvY2FsIHBvc2l0aW9ucyA9IHsKICAgICAgICB0b3BfbGVmdCA9IFZlY3RvcjIubmV3KCksCiAgICAgICAgdG9wX3JpZ2h0ID0gVmVjdG9yMi5uZXcoKSwKICAgICAgICBib3R0b21fcmlnaHQgPSBWZWN0b3IyLm5ldygpLAogICAgfQoKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZV9wb3NpdGlvbnMoc2l6ZTogYW55LCBwb3NpdGlvbjogYW55KQogICAgICAgIHBvc2l0aW9ucy50b3BfbGVmdCA9IHBvc2l0aW9uCiAgICAgICAgcG9zaXRpb25zLnRvcF9yaWdodCA9IHBvc2l0aW9uICsgVmVjdG9yMi5uZXcoc2l6ZS5YLCAwKQogICAgICAgIHBvc2l0aW9ucy5ib3R0b21fcmlnaHQgPSBwb3NpdGlvbiArIHNpemUKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZSgpCiAgICAgICAgbG9jYWwgdG9wX2xlZnQgPSBwb3NpdGlvbnMudG9wX2xlZnQKICAgICAgICBsb2NhbCB0b3BfcmlnaHQgPSBwb3NpdGlvbnMudG9wX3JpZ2h0CiAgICAgICAgbG9jYWwgYm90dG9tX3JpZ2h0ID0gcG9zaXRpb25zLmJvdHRvbV9yaWdodAoKICAgICAgICBsb2NhbCB0b3BfbGVmdDNEID0gVXRpbDp2aWV3cG9ydF9wb2ludF90b193b3JsZCh0b3BfbGVmdCwgZGlzdGFuY2UpCiAgICAgICAgbG9jYWwgdG9wX3JpZ2h0M0QgPSBVdGlsOnZpZXdwb3J0X3BvaW50X3RvX3dvcmxkKHRvcF9yaWdodCwgZGlzdGFuY2UpCiAgICAgICAgbG9jYWwgYm90dG9tX3JpZ2h0M0QgPSBVdGlsOnZpZXdwb3J0X3BvaW50X3RvX3dvcmxkKGJvdHRvbV9yaWdodCwgZGlzdGFuY2UpCgogICAgICAgIGxvY2FsIHdpZHRoID0gKHRvcF9yaWdodDNEIC0gdG9wX2xlZnQzRCkuTWFnbml0dWRlCiAgICAgICAgbG9jYWwgaGVpZ2h0ID0gKHRvcF9yaWdodDNEIC0gYm90dG9tX3JpZ2h0M0QpLk1hZ25pdHVkZQoKICAgICAgICBpZiBub3Qgc2VsZi5fcm9vdCB0aGVuCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAoKICAgICAgICBzZWxmLl9yb290LkNGcmFtZSA9IENGcmFtZS5mcm9tTWF0cml4KCh0b3BfbGVmdDNEICsgYm90dG9tX3JpZ2h0M0QpIC8gMiwgd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ0ZyYW1lLlhWZWN0b3IsIHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZS5ZVmVjdG9yLCB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DRnJhbWUuWlZlY3RvcikKICAgICAgICBzZWxmLl9yb290Lk1lc2guU2NhbGUgPSBWZWN0b3IzLm5ldyh3aWR0aCwgaGVpZ2h0LCAwKQogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gb25fY2hhbmdlKCkKICAgICAgICBsb2NhbCBvZmZzZXQgPSBVdGlsOmdldF9vZmZzZXQoKQogICAgICAgIGxvY2FsIHNpemUgPSBzZWxmLl9mcmFtZS5BYnNvbHV0ZVNpemUgLSBWZWN0b3IyLm5ldyhvZmZzZXQsIG9mZnNldCkKICAgICAgICBsb2NhbCBwb3NpdGlvbiA9IHNlbGYuX2ZyYW1lLkFic29sdXRlUG9zaXRpb24gKyBWZWN0b3IyLm5ldyhvZmZzZXQgLyAyLCBvZmZzZXQgLyAyKQoKICAgICAgICB1cGRhdGVfcG9zaXRpb25zKHNpemUsIHBvc2l0aW9uKQogICAgICAgIHRhc2suc3Bhd24odXBkYXRlKQogICAgZW5kCgogICAgQ29ubmVjdGlvbnNbJ2NmcmFtZV91cGRhdGUnXSA9IHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhOkdldFByb3BlcnR5Q2hhbmdlZFNpZ25hbCgnQ0ZyYW1lJyk6Q29ubmVjdCh1cGRhdGUpCiAgICBDb25uZWN0aW9uc1sndmlld3BvcnRfc2l6ZV91cGRhdGUnXSA9IHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhOkdldFByb3BlcnR5Q2hhbmdlZFNpZ25hbCgnVmlld3BvcnRTaXplJyk6Q29ubmVjdCh1cGRhdGUpCiAgICBDb25uZWN0aW9uc1snZmllbGRfb2Zfdmlld191cGRhdGUnXSA9IHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhOkdldFByb3BlcnR5Q2hhbmdlZFNpZ25hbCgnRmllbGRPZlZpZXcnKTpDb25uZWN0KHVwZGF0ZSkKCiAgICBDb25uZWN0aW9uc1snZnJhbWVfYWJzb2x1dGVfcG9zaXRpb24nXSA9IHNlbGYuX2ZyYW1lOkdldFByb3BlcnR5Q2hhbmdlZFNpZ25hbCgnQWJzb2x1dGVQb3NpdGlvbicpOkNvbm5lY3Qob25fY2hhbmdlKQogICAgQ29ubmVjdGlvbnNbJ2ZyYW1lX2Fic29sdXRlX3NpemUnXSA9IHNlbGYuX2ZyYW1lOkdldFByb3BlcnR5Q2hhbmdlZFNpZ25hbCgnQWJzb2x1dGVTaXplJyk6Q29ubmVjdChvbl9jaGFuZ2UpCiAgICAKICAgIHRhc2suc3Bhd24odXBkYXRlKQplbmQKCgpmdW5jdGlvbiBBY3J5bGljQmx1cjpjaGVja19xdWFsaXR5X2xldmVsKCkKICAgIGxvY2FsIGdhbWVfc2V0dGluZ3MgPSBVc2VyU2V0dGluZ3MoKS5HYW1lU2V0dGluZ3MKICAgIGxvY2FsIHF1YWxpdHlfbGV2ZWwgPSBnYW1lX3NldHRpbmdzLlNhdmVkUXVhbGl0eUxldmVsLlZhbHVlCgogICAgaWYgcXVhbGl0eV9sZXZlbCA8IDggdGhlbgogICAgICAgIHNlbGY6Y2hhbmdlX3Zpc2libGl0eShmYWxzZSkKICAgIGVuZAoKICAgIENvbm5lY3Rpb25zWydxdWFsaXR5X2xldmVsJ10gPSBnYW1lX3NldHRpbmdzOkdldFByb3BlcnR5Q2hhbmdlZFNpZ25hbCgnU2F2ZWRRdWFsaXR5TGV2ZWwnKTpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBnYW1lX3NldHRpbmdzID0gVXNlclNldHRpbmdzKCkuR2FtZVNldHRpbmdzCiAgICAgICAgbG9jYWwgcXVhbGl0eV9sZXZlbCA9IGdhbWVfc2V0dGluZ3MuU2F2ZWRRdWFsaXR5TGV2ZWwuVmFsdWUKCiAgICAgICAgc2VsZjpjaGFuZ2VfdmlzaWJsaXR5KHF1YWxpdHlfbGV2ZWwgPj0gOCkKICAgIGVuZCkKZW5kCgoKZnVuY3Rpb24gQWNyeWxpY0JsdXI6Y2hhbmdlX3Zpc2libGl0eShzdGF0ZTogYm9vbGVhbikKICAgIHNlbGYuX3Jvb3QuVHJhbnNwYXJlbmN5ID0gc3RhdGUgYW5kIDAuOTggb3IgMQplbmQKCgpsb2NhbCBDb25maWcgPSBzZXRtZXRhdGFibGUoewogICAgc2F2ZSA9IGZ1bmN0aW9uKHNlbGY6IGFueSwgZmlsZV9uYW1lOiBhbnksIGNvbmZpZzogYW55KQogICAgICAgIGxvY2FsIHN1Y2Nlc3Nfc2F2ZSwgcmVzdWx0ID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBmbGFncyA9IEh0dHBTZXJ2aWNlOkpTT05FbmNvZGUoY29uZmlnKQogICAgICAgICAgICB3cml0ZWZpbGUoJ0xvc3RIdWIvJy4uZmlsZV9uYW1lLi4nLmpzb24nLCBmbGFncykKICAgICAgICBlbmQpCiAgICAKICAgICAgICBpZiBub3Qgc3VjY2Vzc19zYXZlIHRoZW4KICAgICAgICAgICAgd2FybignZmFpbGVkIHRvIHNhdmUgY29uZmlnJywgcmVzdWx0KQogICAgICAgIGVuZAogICAgZW5kLAogICAgbG9hZCA9IGZ1bmN0aW9uKHNlbGY6IGFueSwgZmlsZV9uYW1lOiBhbnksIGNvbmZpZzogYW55KQogICAgICAgIGxvY2FsIHN1Y2Nlc3NfbG9hZCwgcmVzdWx0ID0gcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBub3QgaXNmaWxlKCdMb3N0SHViLycuLmZpbGVfbmFtZS4uJy5qc29uJykgdGhlbgogICAgICAgICAgICAgICAgc2VsZjpzYXZlKGZpbGVfbmFtZSwgY29uZmlnKQogICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBsb2NhbCBmbGFncyA9IHJlYWRmaWxlKCdMb3N0SHViLycuLmZpbGVfbmFtZS4uJy5qc29uJykKICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGZsYWdzIHRoZW4KICAgICAgICAgICAgICAgIHNlbGY6c2F2ZShmaWxlX25hbWUsIGNvbmZpZykKICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBIdHRwU2VydmljZTpKU09ORGVjb2RlKGZsYWdzKQogICAgICAgIGVuZCkKICAgIAogICAgICAgIGlmIG5vdCBzdWNjZXNzX2xvYWQgdGhlbgogICAgICAgICAgICB3YXJuKCdmYWlsZWQgdG8gbG9hZCBjb25maWcnLCByZXN1bHQpCiAgICAgICAgZW5kCiAgICAKICAgICAgICBpZiBub3QgcmVzdWx0IHRoZW4KICAgICAgICAgICAgcmVzdWx0ID0gewogICAgICAgICAgICAgICAgX2ZsYWdzID0ge30sCiAgICAgICAgICAgICAgICBfa2V5YmluZHMgPSB7fSwKICAgICAgICAgICAgICAgIF9saWJyYXJ5ID0ge30KICAgICAgICAgICAgfQogICAgICAgIGVuZAogICAgCiAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgZW5kCn0sIENvbmZpZykKCgpsb2NhbCBMaWJyYXJ5ID0gewogICAgX2NvbmZpZyA9IENvbmZpZzpsb2FkKGdhbWUuR2FtZUlkKSwKCiAgICBfY2hvb3Npbmdfa2V5YmluZCA9IGZhbHNlLAogICAgX2RldmljZSA9IG5pbCwKCiAgICBfdWlfb3BlbiA9IHRydWUsCiAgICBfdWlfc2NhbGUgPSAxLAogICAgX3VpX2xvYWRlZCA9IGZhbHNlLAogICAgX3VpID0gbmlsLAoKICAgIF9kcmFnZ2luZyA9IGZhbHNlLAogICAgX2RyYWdfc3RhcnQgPSBuaWwsCiAgICBfY29udGFpbmVyX3Bvc2l0aW9uID0gbmlsCn0KTGlicmFyeS5fX2luZGV4ID0gTGlicmFyeQoKCmZ1bmN0aW9uIExpYnJhcnkubmV3KCkKICAgIGxvY2FsIHNlbGYgPSBzZXRtZXRhdGFibGUoewogICAgICAgIF9sb2FkZWQgPSBmYWxzZSwKICAgICAgICBfdGFiID0gMCwKICAgIH0sIExpYnJhcnkpCiAgICAKICAgIHNlbGY6Y3JlYXRlX3VpKCkKCiAgICByZXR1cm4gc2VsZgplbmQKCi0tIENyZWF0ZSBOb3RpZmljYXRpb24gQ29udGFpbmVyCmxvY2FsIE5vdGlmaWNhdGlvbkNvbnRhaW5lciA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQpOb3RpZmljYXRpb25Db250YWluZXIuTmFtZSA9ICJSb2Jsb3hDb3JlR3VpcyIKTm90aWZpY2F0aW9uQ29udGFpbmVyLlNpemUgPSBVRGltMi5uZXcoMCwgMzAwLCAwLCAwKSAgLS0gRml4ZWQgd2lkdGggKDMwMHB4KSwgZHluYW1pYyBoZWlnaHQgKFkpCk5vdGlmaWNhdGlvbkNvbnRhaW5lci5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjgsIDAsIDAsIDEwKSAgLS0gUmlnaHQgc2lkZSwgb2Zmc2V0IGJ5IDEwIGZyb20gdG9wCk5vdGlmaWNhdGlvbkNvbnRhaW5lci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQpOb3RpZmljYXRpb25Db250YWluZXIuQ2xpcHNEZXNjZW5kYW50cyA9IGZhbHNlOwpOb3RpZmljYXRpb25Db250YWluZXIuUGFyZW50ID0gZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuUm9ibG94R3VpOkZpbmRGaXJzdENoaWxkKCJSb2Jsb3hDb3JlR3VpcyIpIG9yIEluc3RhbmNlLm5ldygiU2NyZWVuR3VpIiwgZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuUm9ibG94R3VpKQpOb3RpZmljYXRpb25Db250YWluZXIuQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZCgotLSBVSUxpc3RMYXlvdXQgdG8gYXJyYW5nZSBub3RpZmljYXRpb25zIHZlcnRpY2FsbHkKbG9jYWwgVUlMaXN0TGF5b3V0ID0gSW5zdGFuY2UubmV3KCJVSUxpc3RMYXlvdXQiKQpVSUxpc3RMYXlvdXQuRmlsbERpcmVjdGlvbiA9IEVudW0uRmlsbERpcmVjdGlvbi5WZXJ0aWNhbApVSUxpc3RMYXlvdXQuU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKVUlMaXN0TGF5b3V0LlBhZGRpbmcgPSBVRGltLm5ldygwLCAxMCkKVUlMaXN0TGF5b3V0LlBhcmVudCA9IE5vdGlmaWNhdGlvbkNvbnRhaW5lcgoKLS0gRnVuY3Rpb24gdG8gY3JlYXRlIG5vdGlmaWNhdGlvbnMKZnVuY3Rpb24gTGlicmFyeS5TZW5kTm90aWZpY2F0aW9uKHNldHRpbmdzKQogICAgLS0gQ3JlYXRlIHRoZSBub3RpZmljYXRpb24gZnJhbWUgKHRoaXMgd2lsbCBiZSBtYW5hZ2VkIGJ5IFVJTGlzdExheW91dCkKICAgIGxvY2FsIE5vdGlmaWNhdGlvbiA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgTm90aWZpY2F0aW9uLlNpemUgPSBVRGltMi5uZXcoMSwgMCwgMCwgNjApICAtLSBXaWR0aCA9IDEwMCUgb2YgTm90aWZpY2F0aW9uQ29udGFpbmVyJ3Mgd2lkdGgsIGR5bmFtaWMgaGVpZ2h0IChZKQogICAgTm90aWZpY2F0aW9uLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxICAtLSBPdXRlciBmcmFtZSBpcyB0cmFuc3BhcmVudCBmb3IgbGF5b3V0IHRvIHdvcmsKICAgIE5vdGlmaWNhdGlvbi5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICBOb3RpZmljYXRpb24uTmFtZSA9ICJOb3RpZmljYXRpb24iCiAgICBOb3RpZmljYXRpb24uUGFyZW50ID0gTm90aWZpY2F0aW9uQ29udGFpbmVyICAtLSBQYXJlbnQgaXQgdG8geW91ciBOb3RpZmljYXRpb25Db250YWluZXIgKHRoZSBwYXJlbnQgb2YgdGhlIGxpc3QgbGF5b3V0KQogICAgTm90aWZpY2F0aW9uLkF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWSAgLS0gQWxsb3cgdGhpcyBmcmFtZSB0byByZXNpemUgYmFzZWQgb24gY2hpbGQgaGVpZ2h0CgogICAgLS0gQWRkIHJvdW5kZWQgY29ybmVycyB0byBvdXRlciBmcmFtZQogICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIikKICAgIFVJQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDQpCiAgICBVSUNvcm5lci5QYXJlbnQgPSBOb3RpZmljYXRpb24KCiAgICAtLSBDcmVhdGUgdGhlIGlubmVyIGZyYW1lIGZvciB0aGUgbm90aWZpY2F0aW9uJ3MgY29udGVudAogICAgbG9jYWwgSW5uZXJGcmFtZSA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgSW5uZXJGcmFtZS5TaXplID0gVURpbTIubmV3KDEsIDAsIDAsIDYwKSAgLS0gU3RhcnQgd2l0aCBhbiBpbml0aWFsIGhlaWdodCwgd2lkdGggd2lsbCBhZGFwdAogICAgSW5uZXJGcmFtZS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCAwLCAwLCAwKSAgLS0gUG9zaXRpb25lZCBpbnNpZGUgdGhlIG91dGVyIG5vdGlmaWNhdGlvbiBmcmFtZQogICAgSW5uZXJGcmFtZS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzIsIDM4LCA1MSkKICAgIElubmVyRnJhbWUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuMQogICAgSW5uZXJGcmFtZS5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICBJbm5lckZyYW1lLk5hbWUgPSAiSW5uZXJGcmFtZSIKICAgIElubmVyRnJhbWUuUGFyZW50ID0gTm90aWZpY2F0aW9uCiAgICBJbm5lckZyYW1lLkF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWSAgLS0gQXV0b21hdGljYWxseSByZXNpemUgYmFzZWQgb24gaXRzIGNvbnRlbnQKCiAgICAtLSBBZGQgcm91bmRlZCBjb3JuZXJzIHRvIHRoZSBpbm5lciBmcmFtZQogICAgbG9jYWwgSW5uZXJVSUNvcm5lciA9IEluc3RhbmNlLm5ldygiVUlDb3JuZXIiKQogICAgSW5uZXJVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLCA0KQogICAgSW5uZXJVSUNvcm5lci5QYXJlbnQgPSBJbm5lckZyYW1lCgogICAgLS0gVGl0bGUgTGFiZWwgKHdpdGggYXV0b21hdGljIHNpemUgc3VwcG9ydCkKICAgIGxvY2FsIFRpdGxlID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKQogICAgVGl0bGUuVGV4dCA9IHNldHRpbmdzLnRpdGxlIG9yICJOb3RpZmljYXRpb24gVGl0bGUiCiAgICBUaXRsZS5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjEwLCAyMTAsIDIxMCkKICAgIFRpdGxlLkZvbnRGYWNlID0gRm9udC5uZXcoJ3JieGFzc2V0Oi8vZm9udHMvZmFtaWxpZXMvR290aGFtU1NtLmpzb24nLCBFbnVtLkZvbnRXZWlnaHQuU2VtaUJvbGQsIEVudW0uRm9udFN0eWxlLk5vcm1hbCkKICAgIFRpdGxlLlRleHRTaXplID0gMTQKICAgIFRpdGxlLlNpemUgPSBVRGltMi5uZXcoMSwgLTEwLCAwLCAyMCkgIC0tIFdpZHRoIGlzIDEgKDEwMCUgb2YgcGFyZW50IHdpZHRoKSwgaGVpZ2h0IGlzIGZpeGVkIGluaXRpYWxseQogICAgVGl0bGUuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgNSwgMCwgNSkKICAgIFRpdGxlLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICBUaXRsZS5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgVGl0bGUuVGV4dFlBbGlnbm1lbnQgPSBFbnVtLlRleHRZQWxpZ25tZW50LkNlbnRlcgogICAgVGl0bGUuVGV4dFdyYXBwZWQgPSB0cnVlICAtLSBFbmFibGUgd3JhcHBpbmcKICAgIFRpdGxlLkF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWSAgLS0gQWxsb3cgdGhlIHRpdGxlIHRvIHJlc2l6ZSBiYXNlZCBvbiBjb250ZW50CiAgICBUaXRsZS5QYXJlbnQgPSBJbm5lckZyYW1lCgogICAgLS0gQm9keSBUZXh0ICh3aXRoIGF1dG9tYXRpYyBzaXplIHN1cHBvcnQpCiAgICBsb2NhbCBCb2R5ID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKQogICAgQm9keS5UZXh0ID0gc2V0dGluZ3MudGV4dCBvciAiVGhpcyBpcyB0aGUgYm9keSBvZiB0aGUgbm90aWZpY2F0aW9uLiIKICAgIEJvZHkuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE4MCwgMTgwLCAxODApCiAgICBCb2R5LkZvbnRGYWNlID0gRm9udC5uZXcoJ3JieGFzc2V0Oi8vZm9udHMvZmFtaWxpZXMvR290aGFtU1NtLmpzb24nLCBFbnVtLkZvbnRXZWlnaHQuUmVndWxhciwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgQm9keS5UZXh0U2l6ZSA9IDEyCiAgICBCb2R5LlNpemUgPSBVRGltMi5uZXcoMSwgLTEwLCAwLCAzMCkgIC0tIFdpZHRoIGlzIDEgKDEwMCUgb2YgcGFyZW50IHdpZHRoKSwgaGVpZ2h0IGlzIGZpeGVkIGluaXRpYWxseQogICAgQm9keS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCA1LCAwLCAyNSkKICAgIEJvZHkuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgIEJvZHkuVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQKICAgIEJvZHkuVGV4dFlBbGlnbm1lbnQgPSBFbnVtLlRleHRZQWxpZ25tZW50LlRvcAogICAgQm9keS5UZXh0V3JhcHBlZCA9IHRydWUgIC0tIEVuYWJsZSB3cmFwcGluZyBmb3IgbG9uZyB0ZXh0CiAgICBCb2R5LkF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWSAgLS0gQWxsb3cgdGhlIGJvZHkgdGV4dCB0byByZXNpemUgYmFzZWQgb24gY29udGVudAogICAgQm9keS5QYXJlbnQgPSBJbm5lckZyYW1lCgogICAgLS0gRm9yY2UgdGhlIHNpemUgdG8gYWRqdXN0IGFmdGVyIHRoZSB0ZXh0IGlzIGZ1bGx5IGxvYWRlZCBhbmQgd3JhcHBlZAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2FpdCgwLjEpICAtLSBBbGxvdyB0ZXh0IHdyYXBwaW5nIHRvIGZpbmlzaAogICAgICAgIC0tIEFkanVzdCBpbm5lciBmcmFtZSBzaXplIGJhc2VkIG9uIGNvbnRlbnQKICAgICAgICBsb2NhbCB0b3RhbEhlaWdodCA9IFRpdGxlLlRleHRCb3VuZHMuWSArIEJvZHkuVGV4dEJvdW5kcy5ZICsgMTAgIC0tIEFkZCBwYWRkaW5nCiAgICAgICAgSW5uZXJGcmFtZS5TaXplID0gVURpbTIubmV3KDEsIDAsIDAsIHRvdGFsSGVpZ2h0KSAgLS0gUmVzaXplIHRoZSBpbm5lciBmcmFtZQogICAgZW5kKQoKICAgIC0tIFVzZSB0YXNrLnNwYXduIHRvIGVuc3VyZSB0aGUgbm90aWZpY2F0aW9uIHR3ZWVuaW5nIGhhcHBlbnMgYXN5bmNocm9ub3VzbHkKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIC0tIFR3ZWVuIEluIHRoZSBOb3RpZmljYXRpb24gKGlubmVyIGZyYW1lKQogICAgICAgIGxvY2FsIHR3ZWVuSW4gPSBUd2VlblNlcnZpY2U6Q3JlYXRlKElubmVyRnJhbWUsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAsIDEwICsgTm90aWZpY2F0aW9uQ29udGFpbmVyLlNpemUuWS5PZmZzZXQpCiAgICAgICAgfSkKICAgICAgICB0d2VlbkluOlBsYXkoKQoKICAgICAgICAtLSBXYWl0IGZvciB0aGUgZHVyYXRpb24gYmVmb3JlIHR3ZWVuaW5nIG91dAogICAgICAgIGxvY2FsIGR1cmF0aW9uID0gc2V0dGluZ3MuZHVyYXRpb24gb3IgNSAgLS0gRGVmYXVsdCB0byA1IHNlY29uZHMgaWYgbm90IHByb3ZpZGVkCiAgICAgICAgd2FpdChkdXJhdGlvbikKCiAgICAgICAgLS0gVHdlZW4gT3V0IHRoZSBOb3RpZmljYXRpb24gKGlubmVyIGZyYW1lKSB0byB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgc2NyZWVuCiAgICAgICAgbG9jYWwgdHdlZW5PdXQgPSBUd2VlblNlcnZpY2U6Q3JlYXRlKElubmVyRnJhbWUsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5JbiksIHsKICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMi5uZXcoMSwgMzEwLCAwLCAxMCArIE5vdGlmaWNhdGlvbkNvbnRhaW5lci5TaXplLlkuT2Zmc2V0KSAgLS0gTW92ZSB0byB0aGUgcmlnaHQgb2ZmLXNjcmVlbgogICAgICAgIH0pCiAgICAgICAgdHdlZW5PdXQ6UGxheSgpCgogICAgICAgIC0tIFJlbW92ZSB0aGUgbm90aWZpY2F0aW9uIGFmdGVyIGl0IGlzIGRvbmUgdHdlZW5pbmcgb3V0CiAgICAgICAgdHdlZW5PdXQuQ29tcGxldGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICBOb3RpZmljYXRpb246RGVzdHJveSgpCiAgICAgICAgZW5kKQogICAgZW5kKQplbmQKCmZ1bmN0aW9uIExpYnJhcnk6Z2V0X3NjcmVlbl9zY2FsZSgpCiAgICBsb2NhbCB2aWV3cG9ydF9zaXplX3ggPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYS5WaWV3cG9ydFNpemUuWAoKICAgIHNlbGYuX3VpX3NjYWxlID0gdmlld3BvcnRfc2l6ZV94IC8gMTQwMAplbmQKCgpmdW5jdGlvbiBMaWJyYXJ5OmdldF9kZXZpY2UoKQogICAgbG9jYWwgZGV2aWNlID0gJ1Vua25vd24nCgogICAgaWYgbm90IFVzZXJJbnB1dFNlcnZpY2UuVG91Y2hFbmFibGVkIGFuZCBVc2VySW5wdXRTZXJ2aWNlLktleWJvYXJkRW5hYmxlZCBhbmQgVXNlcklucHV0U2VydmljZS5Nb3VzZUVuYWJsZWQgdGhlbgogICAgICAgIGRldmljZSA9ICdQQycKICAgIGVsc2VpZiBVc2VySW5wdXRTZXJ2aWNlLlRvdWNoRW5hYmxlZCB0aGVuCiAgICAgICAgZGV2aWNlID0gJ01vYmlsZScKICAgIGVsc2VpZiBVc2VySW5wdXRTZXJ2aWNlLkdhbWVwYWRFbmFibGVkIHRoZW4KICAgICAgICBkZXZpY2UgPSAnQ29uc29sZScKICAgIGVuZAoKICAgIHNlbGYuX2RldmljZSA9IGRldmljZQplbmQKCgpmdW5jdGlvbiBMaWJyYXJ5OnJlbW92ZWQoYWN0aW9uOiBhbnkpCiAgICBzZWxmLl91aS5BbmNlc3RyeUNoYW5nZWQ6T25jZShhY3Rpb24pCmVuZAoKCmZ1bmN0aW9uIExpYnJhcnk6ZmxhZ190eXBlKGZsYWc6IGFueSwgZmxhZ190eXBlOiBhbnkpCiAgICBpZiBub3QgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tmbGFnXSB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKCiAgICByZXR1cm4gdHlwZW9mKExpYnJhcnkuX2NvbmZpZy5fZmxhZ3NbZmxhZ10pID09IGZsYWdfdHlwZQplbmQKCgpmdW5jdGlvbiBMaWJyYXJ5OnJlbW92ZV90YWJsZV92YWx1ZShfX3RhYmxlOiBhbnksIHRhYmxlX3ZhbHVlOiBzdHJpbmcpCiAgICBmb3IgaW5kZXgsIHZhbHVlIGluIF9fdGFibGUgZG8KICAgICAgICBpZiB2YWx1ZSB+PSB0YWJsZV92YWx1ZSB0aGVuCiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgZW5kCgogICAgICAgIHRhYmxlLnJlbW92ZShfX3RhYmxlLCBpbmRleCkKICAgIGVuZAplbmQKCgpmdW5jdGlvbiBMaWJyYXJ5OmNyZWF0ZV91aSgpCiAgICBsb2NhbCBvbGRfTG9zdEh1YiA9IENvcmVHdWk6RmluZEZpcnN0Q2hpbGQoJ0xvc3RIdWInKQoKICAgIGlmIG9sZF9Mb3N0SHViIHRoZW4KICAgICAgICBEZWJyaXM6QWRkSXRlbShvbGRfTG9zdEh1YiwgMCkKICAgIGVuZAoKICAgIGxvY2FsIExvc3RIdWIgPSBJbnN0YW5jZS5uZXcoJ1NjcmVlbkd1aScpCiAgICBMb3N0SHViLlJlc2V0T25TcGF3biA9IGZhbHNlCiAgICBMb3N0SHViLk5hbWUgPSAnTG9zdEh1YicKICAgIExvc3RIdWIuWkluZGV4QmVoYXZpb3IgPSBFbnVtLlpJbmRleEJlaGF2aW9yLlNpYmxpbmcKICAgIExvc3RIdWIuUGFyZW50ID0gQ29yZUd1aQogICAgCiAgICBsb2NhbCBDb250YWluZXIgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgIENvbnRhaW5lci5DbGlwc0Rlc2NlbmRhbnRzID0gdHJ1ZQogICAgQ29udGFpbmVyLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICBDb250YWluZXIuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLjUsIDAuNSkKICAgIENvbnRhaW5lci5OYW1lID0gJ0NvbnRhaW5lcicKICAgIENvbnRhaW5lci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC4wNTAwMDAwMDA3NDUwNTgwNgogICAgQ29udGFpbmVyLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxMiwgMTMsIDE1KQogICAgQ29udGFpbmVyLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMC41LCAwKQogICAgQ29udGFpbmVyLlNpemUgPSBVRGltMi5uZXcoMCwgMCwgMCwgMCkKICAgIENvbnRhaW5lci5BY3RpdmUgPSB0cnVlCiAgICBDb250YWluZXIuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgQ29udGFpbmVyLlBhcmVudCA9IExvc3RIdWIKICAgIAogICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoJ1VJQ29ybmVyJykKICAgIFVJQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDEwKQogICAgVUlDb3JuZXIuUGFyZW50ID0gQ29udGFpbmVyCiAgICAKICAgIGxvY2FsIFVJU3Ryb2tlID0gSW5zdGFuY2UubmV3KCdVSVN0cm9rZScpCiAgICBVSVN0cm9rZS5Db2xvciA9IENvbG9yMy5mcm9tUkdCKDUyLCA2NiwgODkpCiAgICBVSVN0cm9rZS5UcmFuc3BhcmVuY3kgPSAwLjUKICAgIFVJU3Ryb2tlLkFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgVUlTdHJva2UuUGFyZW50ID0gQ29udGFpbmVyCiAgICAKICAgIGxvY2FsIEhhbmRsZXIgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgIEhhbmRsZXIuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgIEhhbmRsZXIuTmFtZSA9ICdIYW5kbGVyJwogICAgSGFuZGxlci5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgSGFuZGxlci5TaXplID0gVURpbTIubmV3KDAsIDY5OCwgMCwgNDc5KQogICAgSGFuZGxlci5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICBIYW5kbGVyLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgSGFuZGxlci5QYXJlbnQgPSBDb250YWluZXIKICAgIAogICAgbG9jYWwgVGFicyA9IEluc3RhbmNlLm5ldygnU2Nyb2xsaW5nRnJhbWUnKQogICAgVGFicy5TY3JvbGxCYXJJbWFnZVRyYW5zcGFyZW5jeSA9IDEKICAgIFRhYnMuU2Nyb2xsQmFyVGhpY2tuZXNzID0gMAogICAgVGFicy5OYW1lID0gJ1RhYnMnCiAgICBUYWJzLlNpemUgPSBVRGltMi5uZXcoMCwgMTI5LCAwLCA0MDEpCiAgICBUYWJzLlNlbGVjdGFibGUgPSBmYWxzZQogICAgVGFicy5BdXRvbWF0aWNDYW52YXNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZCiAgICBUYWJzLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICBUYWJzLlBvc2l0aW9uID0gVURpbTIubmV3KDAuMDI2MDk3MjcxNTkxNDI0OTQyLCAwLCAwLjExMTExMTExMTkzODk1MzQsIDApCiAgICBUYWJzLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICBUYWJzLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgVGFicy5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICBUYWJzLkNhbnZhc1NpemUgPSBVRGltMi5uZXcoMCwgMCwgMC41LCAwKQogICAgVGFicy5QYXJlbnQgPSBIYW5kbGVyCiAgICAKICAgIGxvY2FsIFVJTGlzdExheW91dCA9IEluc3RhbmNlLm5ldygnVUlMaXN0TGF5b3V0JykKICAgIFVJTGlzdExheW91dC5QYWRkaW5nID0gVURpbS5uZXcoMCwgNCkKICAgIFVJTGlzdExheW91dC5Tb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgVUlMaXN0TGF5b3V0LlBhcmVudCA9IFRhYnMKICAgIAogICAgbG9jYWwgQ2xpZW50TmFtZSA9IEluc3RhbmNlLm5ldygnVGV4dExhYmVsJykKICAgIENsaWVudE5hbWUuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgQ2xpZW50TmFtZS5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTUyLCAxODEsIDI1NSkKICAgIENsaWVudE5hbWUuVGV4dFRyYW5zcGFyZW5jeSA9IDAuMjAwMDAwMDAyOTgwMjMyMjQKICAgIENsaWVudE5hbWUuVGV4dCA9ICdMb3N0SHViJwogICAgQ2xpZW50TmFtZS5OYW1lID0gJ0NsaWVudE5hbWUnCiAgICBDbGllbnROYW1lLlNpemUgPSBVRGltMi5uZXcoMCwgMzEsIDAsIDEzKQogICAgQ2xpZW50TmFtZS5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDAuNSkKICAgIENsaWVudE5hbWUuUG9zaXRpb24gPSBVRGltMi5uZXcoMC4wNTYwMDAwMDE3Mjg1MzQ3LCAwLCAwLjA1NDk5OTk5OTcwMTk3Njc3NiwgMCkKICAgIENsaWVudE5hbWUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgIENsaWVudE5hbWUuVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQKICAgIENsaWVudE5hbWUuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgQ2xpZW50TmFtZS5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgQ2xpZW50TmFtZS5UZXh0U2l6ZSA9IDEzCiAgICBDbGllbnROYW1lLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgQ2xpZW50TmFtZS5QYXJlbnQgPSBIYW5kbGVyCiAgICAKICAgIGxvY2FsIFVJR3JhZGllbnQgPSBJbnN0YW5jZS5uZXcoJ1VJR3JhZGllbnQnKQogICAgVUlHcmFkaWVudC5Db2xvciA9IENvbG9yU2VxdWVuY2UubmV3ewogICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMCwgQ29sb3IzLmZyb21SR0IoMTU1LCAxNTUsIDE1NSkpLAogICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMSwgQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkpCiAgICB9CiAgICBVSUdyYWRpZW50LlBhcmVudCA9IENsaWVudE5hbWUKICAgIAogICAgbG9jYWwgUGluID0gSW5zdGFuY2UubmV3KCdGcmFtZScpCiAgICBQaW4uTmFtZSA9ICdQaW4nCiAgICBQaW4uUG9zaXRpb24gPSBVRGltMi5uZXcoMC4wMjYwMDAwMDA1MzY0NDE4MDMsIDAsIDAuMTM2MDAwMDA3MzkwOTc1OTUsIDApCiAgICBQaW4uQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgIFBpbi5TaXplID0gVURpbTIubmV3KDAsIDIsIDAsIDE2KQogICAgUGluLkJvcmRlclNpemVQaXhlbCA9IDAKICAgIFBpbi5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTUyLCAxODEsIDI1NSkKICAgIFBpbi5QYXJlbnQgPSBIYW5kbGVyCiAgICAKICAgIGxvY2FsIFVJQ29ybmVyID0gSW5zdGFuY2UubmV3KCdVSUNvcm5lcicpCiAgICBVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygxLCAwKQogICAgVUlDb3JuZXIuUGFyZW50ID0gUGluCiAgICAKICAgIGxvY2FsIEljb24gPSBJbnN0YW5jZS5uZXcoJ0ltYWdlTGFiZWwnKQogICAgSWNvbi5JbWFnZUNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MiwgMTgxLCAyNTUpCiAgICBJY29uLlNjYWxlVHlwZSA9IEVudW0uU2NhbGVUeXBlLkZpdAogICAgSWNvbi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgSWNvbi5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDAuNSkKICAgIEljb24uSW1hZ2UgPSAncmJ4YXNzZXRpZDovLzEwNzgxOTEzMjAwNzAwMScKICAgIEljb24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgIEljb24uUG9zaXRpb24gPSBVRGltMi5uZXcoMC4wMjUwMDAwMDAzNzI1MjkwMywgMCwgMC4wNTQ5OTk5OTk3MDE5NzY3NzYsIDApCiAgICBJY29uLk5hbWUgPSAnSWNvbicKICAgIEljb24uU2l6ZSA9IFVEaW0yLm5ldygwLCAxOCwgMCwgMTgpCiAgICBJY29uLkJvcmRlclNpemVQaXhlbCA9IDAKICAgIEljb24uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICBJY29uLlBhcmVudCA9IEhhbmRsZXIKICAgIAogICAgbG9jYWwgRGl2aWRlciA9IEluc3RhbmNlLm5ldygnRnJhbWUnKQogICAgRGl2aWRlci5OYW1lID0gJ0RpdmlkZXInCiAgICBEaXZpZGVyLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjUKICAgIERpdmlkZXIuUG9zaXRpb24gPSBVRGltMi5uZXcoMC4yMzQ5OTk5OTk0MDM5NTM1NSwgMCwgMCwgMCkKICAgIERpdmlkZXIuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgIERpdmlkZXIuU2l6ZSA9IFVEaW0yLm5ldygwLCAxLCAwLCA0NzkpCiAgICBEaXZpZGVyLkJvcmRlclNpemVQaXhlbCA9IDAKICAgIERpdmlkZXIuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDUyLCA2NiwgODkpCiAgICBEaXZpZGVyLlBhcmVudCA9IEhhbmRsZXIKICAgIAogICAgbG9jYWwgU2VjdGlvbnMgPSBJbnN0YW5jZS5uZXcoJ0ZvbGRlcicpCiAgICBTZWN0aW9ucy5OYW1lID0gJ1NlY3Rpb25zJwogICAgU2VjdGlvbnMuUGFyZW50ID0gSGFuZGxlcgogICAgCiAgICBsb2NhbCBNaW5pbWl6ZSA9IEluc3RhbmNlLm5ldygnVGV4dEJ1dHRvbicpCiAgICBNaW5pbWl6ZS5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL1NvdXJjZVNhbnNQcm8uanNvbicsIEVudW0uRm9udFdlaWdodC5SZWd1bGFyLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICBNaW5pbWl6ZS5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgIE1pbmltaXplLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICBNaW5pbWl6ZS5UZXh0ID0gJycKICAgIE1pbmltaXplLkF1dG9CdXR0b25Db2xvciA9IGZhbHNlCiAgICBNaW5pbWl6ZS5OYW1lID0gJ01pbmltaXplJwogICAgTWluaW1pemUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgIE1pbmltaXplLlBvc2l0aW9uID0gVURpbTIubmV3KDAuMDIwMDU3MzA1NjkzNjI2NDA0LCAwLCAwLjAyOTIyNzU1NjY2MDc3MTM3LCAwKQogICAgTWluaW1pemUuU2l6ZSA9IFVEaW0yLm5ldygwLCAyNCwgMCwgMjQpCiAgICBNaW5pbWl6ZS5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICBNaW5pbWl6ZS5UZXh0U2l6ZSA9IDE0CiAgICBNaW5pbWl6ZS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgIE1pbmltaXplLlBhcmVudCA9IEhhbmRsZXIKICAgIAogICAgbG9jYWwgVUlTY2FsZSA9IEluc3RhbmNlLm5ldygnVUlTY2FsZScpCiAgICBVSVNjYWxlLlBhcmVudCA9IENvbnRhaW5lciAgICAKICAgIAogICAgc2VsZi5fdWkgPSBMb3N0SHViCgogICAgbG9jYWwgZnVuY3Rpb24gb25fZHJhZyhpbnB1dDogSW5wdXRPYmplY3QsIHByb2Nlc3M6IGJvb2xlYW4pCiAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24xIG9yIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLlRvdWNoIHRoZW4gCiAgICAgICAgICAgIHNlbGYuX2RyYWdnaW5nID0gdHJ1ZQogICAgICAgICAgICBzZWxmLl9kcmFnX3N0YXJ0ID0gaW5wdXQuUG9zaXRpb24KICAgICAgICAgICAgc2VsZi5fY29udGFpbmVyX3Bvc2l0aW9uID0gQ29udGFpbmVyLlBvc2l0aW9uCgogICAgICAgICAgICBDb25uZWN0aW9uc1snY29udGFpbmVyX2lucHV0X2VuZGVkJ10gPSBpbnB1dC5DaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0U3RhdGUgfj0gRW51bS5Vc2VySW5wdXRTdGF0ZS5FbmQgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgQ29ubmVjdGlvbnM6ZGlzY29ubmVjdCgnY29udGFpbmVyX2lucHV0X2VuZGVkJykKICAgICAgICAgICAgICAgIHNlbGYuX2RyYWdnaW5nID0gZmFsc2UKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gdXBkYXRlX2RyYWcoaW5wdXQ6IGFueSkKICAgICAgICBsb2NhbCBkZWx0YSA9IGlucHV0LlBvc2l0aW9uIC0gc2VsZi5fZHJhZ19zdGFydAogICAgICAgIGxvY2FsIHBvc2l0aW9uID0gVURpbTIubmV3KHNlbGYuX2NvbnRhaW5lcl9wb3NpdGlvbi5YLlNjYWxlLCBzZWxmLl9jb250YWluZXJfcG9zaXRpb24uWC5PZmZzZXQgKyBkZWx0YS5YLCBzZWxmLl9jb250YWluZXJfcG9zaXRpb24uWS5TY2FsZSwgc2VsZi5fY29udGFpbmVyX3Bvc2l0aW9uLlkuT2Zmc2V0ICsgZGVsdGEuWSkKCiAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShDb250YWluZXIsIFR3ZWVuSW5mby5uZXcoMC4yKSwgewogICAgICAgICAgICBQb3NpdGlvbiA9IHBvc2l0aW9uCiAgICAgICAgfSk6UGxheSgpCiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBkcmFnKGlucHV0OiBJbnB1dE9iamVjdCwgcHJvY2VzczogYm9vbGVhbikKICAgICAgICBpZiBub3Qgc2VsZi5fZHJhZ2dpbmcgdGhlbgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKCiAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VNb3ZlbWVudCBvciBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Ub3VjaCB0aGVuCiAgICAgICAgICAgIHVwZGF0ZV9kcmFnKGlucHV0KQogICAgICAgIGVuZAogICAgZW5kCgogICAgQ29ubmVjdGlvbnNbJ2NvbnRhaW5lcl9pbnB1dF9iZWdhbiddID0gQ29udGFpbmVyLklucHV0QmVnYW46Q29ubmVjdChvbl9kcmFnKQogICAgQ29ubmVjdGlvbnNbJ2lucHV0X2NoYW5nZWQnXSA9IFVzZXJJbnB1dFNlcnZpY2UuSW5wdXRDaGFuZ2VkOkNvbm5lY3QoZHJhZykKCiAgICBzZWxmOnJlbW92ZWQoZnVuY3Rpb24oKQogICAgICAgIHNlbGYuX3VpID0gbmlsCiAgICAgICAgQ29ubmVjdGlvbnM6ZGlzY29ubmVjdF9hbGwoKQogICAgZW5kKQoKICAgIGZ1bmN0aW9uIHNlbGY6VXBkYXRlMVJ1bihhKQogICAgICAgIGlmIGEgPT0gIm5pbCIgdGhlbgogICAgICAgICAgICBDb250YWluZXIuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuMDUwMDAwMDAwNzQ1MDU4MDY7CiAgICAgICAgZWxzZQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBDb250YWluZXIuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IHRvbnVtYmVyKGEpOwogICAgICAgICAgICBlbmQpOwogICAgICAgIGVuZDsKICAgIGVuZDsKCiAgICBmdW5jdGlvbiBzZWxmOlVJVmlzaWJsaXR5KCkKICAgICAgICBMb3N0SHViLkVuYWJsZWQgPSBub3QgTG9zdEh1Yi5FbmFibGVkOwogICAgZW5kOwoKICAgIGZ1bmN0aW9uIHNlbGY6Y2hhbmdlX3Zpc2libGl0eShzdGF0ZTogYm9vbGVhbikKICAgICAgICBpZiBzdGF0ZSB0aGVuCiAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoQ29udGFpbmVyLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoNjk4LCA0NzkpCiAgICAgICAgICAgIH0pOlBsYXkoKQogICAgICAgIGVsc2UKICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShDb250YWluZXIsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldCgxMDQuNSwgNTIpCiAgICAgICAgICAgIH0pOlBsYXkoKQogICAgICAgIGVuZAogICAgZW5kCiAgICAKCiAgICBmdW5jdGlvbiBzZWxmOmxvYWQoKQogICAgICAgIGxvY2FsIGNvbnRlbnQgPSB7fQogICAgCiAgICAgICAgZm9yIF8sIG9iamVjdCBpbiBMb3N0SHViOkdldERlc2NlbmRhbnRzKCkgZG8KICAgICAgICAgICAgaWYgbm90IG9iamVjdDpJc0EoJ0ltYWdlTGFiZWwnKSB0aGVuCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICB0YWJsZS5pbnNlcnQoY29udGVudCwgb2JqZWN0KQogICAgICAgIGVuZAogICAgCiAgICAgICAgQ29udGVudFByb3ZpZGVyOlByZWxvYWRBc3luYyhjb250ZW50KQogICAgICAgIHNlbGY6Z2V0X2RldmljZSgpCgogICAgICAgIGlmIHNlbGYuX2RldmljZSA9PSAnTW9iaWxlJyBvciBzZWxmLl9kZXZpY2UgPT0gJ1Vua25vd24nIHRoZW4KICAgICAgICAgICAgc2VsZjpnZXRfc2NyZWVuX3NjYWxlKCkKICAgICAgICAgICAgVUlTY2FsZS5TY2FsZSA9IHNlbGYuX3VpX3NjYWxlCiAgICAKICAgICAgICAgICAgQ29ubmVjdGlvbnNbJ3VpX3NjYWxlJ10gPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYTpHZXRQcm9wZXJ0eUNoYW5nZWRTaWduYWwoJ1ZpZXdwb3J0U2l6ZScpOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgc2VsZjpnZXRfc2NyZWVuX3NjYWxlKCkKICAgICAgICAgICAgICAgIFVJU2NhbGUuU2NhbGUgPSBzZWxmLl91aV9zY2FsZQogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICAKICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKENvbnRhaW5lciwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoNjk4LCA0NzkpCiAgICAgICAgfSk6UGxheSgpCgogICAgICAgIEFjcnlsaWNCbHVyLm5ldyhDb250YWluZXIpCiAgICAgICAgc2VsZi5fdWlfbG9hZGVkID0gdHJ1ZQogICAgZW5kCgogICAgZnVuY3Rpb24gc2VsZjp1cGRhdGVfdGFicyh0YWI6IFRleHRCdXR0b24pCiAgICAgICAgZm9yIGluZGV4LCBvYmplY3QgaW4gVGFiczpHZXRDaGlsZHJlbigpIGRvCiAgICAgICAgICAgIGlmIG9iamVjdC5OYW1lIH49ICdUYWInIHRoZW4KICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgb2JqZWN0ID09IHRhYiB0aGVuCiAgICAgICAgICAgICAgICBpZiBvYmplY3QuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSB+PSAwLjUgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIG9mZnNldCA9IG9iamVjdC5MYXlvdXRPcmRlciAqICgwLjExMyAvIDEuMykKCiAgICAgICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShQaW4sIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uID0gVURpbTIuZnJvbVNjYWxlKDAuMDI2LCAwLjEzNSArIG9mZnNldCkKICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkgICAgCgogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUob2JqZWN0LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC41CiAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUob2JqZWN0LlRleHRMYWJlbCwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dFRyYW5zcGFyZW5jeSA9IDAuMiwKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MiwgMTgxLCAyNTUpCiAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUob2JqZWN0LlRleHRMYWJlbC5VSUdyYWRpZW50LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBPZmZzZXQgPSBWZWN0b3IyLm5ldygxLCAwKQogICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQoKICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKG9iamVjdC5JY29uLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBJbWFnZVRyYW5zcGFyZW5jeSA9IDAuMiwKICAgICAgICAgICAgICAgICAgICAgICAgSW1hZ2VDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxNTIsIDE4MSwgMjU1KQogICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBvYmplY3QuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSB+PSAxIHRoZW4KICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUob2JqZWN0LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICB9KTpQbGF5KCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShvYmplY3QuVGV4dExhYmVsLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgIFRleHRUcmFuc3BhcmVuY3kgPSAwLjcsCiAgICAgICAgICAgICAgICAgICAgVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTpQbGF5KCkKCiAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKG9iamVjdC5UZXh0TGFiZWwuVUlHcmFkaWVudCwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgICAgICBPZmZzZXQgPSBWZWN0b3IyLm5ldygwLCAwKQogICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShvYmplY3QuSWNvbiwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgICAgICBJbWFnZVRyYW5zcGFyZW5jeSA9IDAuOCwKICAgICAgICAgICAgICAgICAgICBJbWFnZUNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICB9KTpQbGF5KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmdW5jdGlvbiBzZWxmOnVwZGF0ZV9zZWN0aW9ucyhsZWZ0X3NlY3Rpb246IFNjcm9sbGluZ0ZyYW1lLCByaWdodF9zZWN0aW9uOiBTY3JvbGxpbmdGcmFtZSkKICAgICAgICBmb3IgXywgb2JqZWN0IGluIFNlY3Rpb25zOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgaWYgb2JqZWN0ID09IGxlZnRfc2VjdGlvbiBvciBvYmplY3QgPT0gcmlnaHRfc2VjdGlvbiB0aGVuCiAgICAgICAgICAgICAgICBvYmplY3QuVmlzaWJsZSA9IHRydWUKCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIG9iamVjdC5WaXNpYmxlID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGZ1bmN0aW9uIHNlbGY6Y3JlYXRlX3RhYih0aXRsZTogc3RyaW5nLCBpY29uOiBzdHJpbmcpCiAgICAgICAgbG9jYWwgVGFiTWFuYWdlciA9IHt9CgogICAgICAgIGxvY2FsIExheW91dE9yZGVyID0gMDsKCiAgICAgICAgbG9jYWwgZm9udF9wYXJhbXMgPSBJbnN0YW5jZS5uZXcoJ0dldFRleHRCb3VuZHNQYXJhbXMnKQogICAgICAgIGZvbnRfcGFyYW1zLlRleHQgPSB0aXRsZQogICAgICAgIGZvbnRfcGFyYW1zLkZvbnQgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgIGZvbnRfcGFyYW1zLlNpemUgPSAxMwogICAgICAgIGZvbnRfcGFyYW1zLldpZHRoID0gMTAwMDAKCiAgICAgICAgbG9jYWwgZm9udF9zaXplID0gVGV4dFNlcnZpY2U6R2V0VGV4dEJvdW5kc0FzeW5jKGZvbnRfcGFyYW1zKQogICAgICAgIGxvY2FsIGZpcnN0X3RhYiA9IG5vdCBUYWJzOkZpbmRGaXJzdENoaWxkKCdUYWInKQoKICAgICAgICBsb2NhbCBUYWIgPSBJbnN0YW5jZS5uZXcoJ1RleHRCdXR0b24nKQogICAgICAgIFRhYi5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL1NvdXJjZVNhbnNQcm8uanNvbicsIEVudW0uRm9udFdlaWdodC5SZWd1bGFyLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgVGFiLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgIFRhYi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgIFRhYi5UZXh0ID0gJycKICAgICAgICBUYWIuQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UKICAgICAgICBUYWIuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICBUYWIuTmFtZSA9ICdUYWInCiAgICAgICAgVGFiLlNpemUgPSBVRGltMi5uZXcoMCwgMTI5LCAwLCAzOCkKICAgICAgICBUYWIuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgIFRhYi5UZXh0U2l6ZSA9IDE0CiAgICAgICAgVGFiLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyMiwgMjgsIDM4KQogICAgICAgIFRhYi5QYXJlbnQgPSBUYWJzCiAgICAgICAgVGFiLkxheW91dE9yZGVyID0gc2VsZi5fdGFiCiAgICAgICAgCiAgICAgICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoJ1VJQ29ybmVyJykKICAgICAgICBVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLCA1KQogICAgICAgIFVJQ29ybmVyLlBhcmVudCA9IFRhYgogICAgICAgIAogICAgICAgIGxvY2FsIFRleHRMYWJlbCA9IEluc3RhbmNlLm5ldygnVGV4dExhYmVsJykKICAgICAgICBUZXh0TGFiZWwuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgIFRleHRMYWJlbC5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICBUZXh0TGFiZWwuVGV4dFRyYW5zcGFyZW5jeSA9IDAuNyAtLSAwLjgwMDAwMDAxMTkyMDkyOQogICAgICAgIFRleHRMYWJlbC5UZXh0ID0gdGl0bGUKICAgICAgICBUZXh0TGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygwLCBmb250X3NpemUuWCwgMCwgMTYpCiAgICAgICAgVGV4dExhYmVsLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgMC41KQogICAgICAgIFRleHRMYWJlbC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjI0MDAwMDE3MzQ0OTUxNjMsIDAsIDAuNSwgMCkKICAgICAgICBUZXh0TGFiZWwuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICBUZXh0TGFiZWwuVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQKICAgICAgICBUZXh0TGFiZWwuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgIFRleHRMYWJlbC5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgIFRleHRMYWJlbC5UZXh0U2l6ZSA9IDEzCiAgICAgICAgVGV4dExhYmVsLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgIFRleHRMYWJlbC5QYXJlbnQgPSBUYWIKICAgICAgICAKICAgICAgICBsb2NhbCBVSUdyYWRpZW50ID0gSW5zdGFuY2UubmV3KCdVSUdyYWRpZW50JykKICAgICAgICBVSUdyYWRpZW50LkNvbG9yID0gQ29sb3JTZXF1ZW5jZS5uZXd7CiAgICAgICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMCwgQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkpLAogICAgICAgICAgICBDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDAuNywgQ29sb3IzLmZyb21SR0IoMTU1LCAxNTUsIDE1NSkpLAogICAgICAgICAgICBDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDEsIENvbG9yMy5mcm9tUkdCKDU4LCA1OCwgNTgpKQogICAgICAgIH0KICAgICAgICBVSUdyYWRpZW50LlBhcmVudCA9IFRleHRMYWJlbAogICAgICAgIAogICAgICAgIGxvY2FsIEljb24gPSBJbnN0YW5jZS5uZXcoJ0ltYWdlTGFiZWwnKQogICAgICAgIEljb24uU2NhbGVUeXBlID0gRW51bS5TY2FsZVR5cGUuRml0CiAgICAgICAgSWNvbi5JbWFnZVRyYW5zcGFyZW5jeSA9IDAuODAwMDAwMDExOTIwOTI5CiAgICAgICAgSWNvbi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgIEljb24uQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLCAwLjUpCiAgICAgICAgSWNvbi5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgIEljb24uUG9zaXRpb24gPSBVRGltMi5uZXcoMC4xMDAwMDAwMDE0OTAxMTYxMiwgMCwgMC41LCAwKQogICAgICAgIEljb24uTmFtZSA9ICdJY29uJwogICAgICAgIEljb24uSW1hZ2UgPSBpY29uCiAgICAgICAgSWNvbi5TaXplID0gVURpbTIubmV3KDAsIDEyLCAwLCAxMikKICAgICAgICBJY29uLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICBJY29uLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgIEljb24uUGFyZW50ID0gVGFiCgogICAgICAgIGxvY2FsIExlZnRTZWN0aW9uID0gSW5zdGFuY2UubmV3KCdTY3JvbGxpbmdGcmFtZScpCiAgICAgICAgTGVmdFNlY3Rpb24uTmFtZSA9ICdMZWZ0U2VjdGlvbicKICAgICAgICBMZWZ0U2VjdGlvbi5BdXRvbWF0aWNDYW52YXNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZCiAgICAgICAgTGVmdFNlY3Rpb24uU2Nyb2xsQmFyVGhpY2tuZXNzID0gMAogICAgICAgIExlZnRTZWN0aW9uLlNpemUgPSBVRGltMi5uZXcoMCwgMjQzLCAwLCA0NDUpCiAgICAgICAgTGVmdFNlY3Rpb24uU2VsZWN0YWJsZSA9IGZhbHNlCiAgICAgICAgTGVmdFNlY3Rpb24uQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLCAwLjUpCiAgICAgICAgTGVmdFNlY3Rpb24uU2Nyb2xsQmFySW1hZ2VUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgTGVmdFNlY3Rpb24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICBMZWZ0U2VjdGlvbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjI1OTQzMjY0MzY1MTk2MjMsIDAsIDAuNSwgMCkKICAgICAgICBMZWZ0U2VjdGlvbi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgIExlZnRTZWN0aW9uLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgIExlZnRTZWN0aW9uLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICBMZWZ0U2VjdGlvbi5DYW52YXNTaXplID0gVURpbTIubmV3KDAsIDAsIDAuNSwgMCkKICAgICAgICBMZWZ0U2VjdGlvbi5WaXNpYmxlID0gZmFsc2UKICAgICAgICBMZWZ0U2VjdGlvbi5QYXJlbnQgPSBTZWN0aW9ucwogICAgICAgIAogICAgICAgIGxvY2FsIFVJTGlzdExheW91dCA9IEluc3RhbmNlLm5ldygnVUlMaXN0TGF5b3V0JykKICAgICAgICBVSUxpc3RMYXlvdXQuUGFkZGluZyA9IFVEaW0ubmV3KDAsIDExKQogICAgICAgIFVJTGlzdExheW91dC5Ib3Jpem9udGFsQWxpZ25tZW50ID0gRW51bS5Ib3Jpem9udGFsQWxpZ25tZW50LkNlbnRlcgogICAgICAgIFVJTGlzdExheW91dC5Tb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgIFVJTGlzdExheW91dC5QYXJlbnQgPSBMZWZ0U2VjdGlvbgogICAgICAgIAogICAgICAgIGxvY2FsIFVJUGFkZGluZyA9IEluc3RhbmNlLm5ldygnVUlQYWRkaW5nJykKICAgICAgICBVSVBhZGRpbmcuUGFkZGluZ1RvcCA9IFVEaW0ubmV3KDAsIDEpCiAgICAgICAgVUlQYWRkaW5nLlBhcmVudCA9IExlZnRTZWN0aW9uCgogICAgICAgIGxvY2FsIFJpZ2h0U2VjdGlvbiA9IEluc3RhbmNlLm5ldygnU2Nyb2xsaW5nRnJhbWUnKQogICAgICAgIFJpZ2h0U2VjdGlvbi5OYW1lID0gJ1JpZ2h0U2VjdGlvbicKICAgICAgICBSaWdodFNlY3Rpb24uQXV0b21hdGljQ2FudmFzU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWQogICAgICAgIFJpZ2h0U2VjdGlvbi5TY3JvbGxCYXJUaGlja25lc3MgPSAwCiAgICAgICAgUmlnaHRTZWN0aW9uLlNpemUgPSBVRGltMi5uZXcoMCwgMjQzLCAwLCA0NDUpCiAgICAgICAgUmlnaHRTZWN0aW9uLlNlbGVjdGFibGUgPSBmYWxzZQogICAgICAgIFJpZ2h0U2VjdGlvbi5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDAuNSkKICAgICAgICBSaWdodFNlY3Rpb24uU2Nyb2xsQmFySW1hZ2VUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgUmlnaHRTZWN0aW9uLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgUmlnaHRTZWN0aW9uLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNjI5MDAwMDA4MTA2MjMxNywgMCwgMC41LCAwKQogICAgICAgIFJpZ2h0U2VjdGlvbi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgIFJpZ2h0U2VjdGlvbi5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICBSaWdodFNlY3Rpb24uQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgIFJpZ2h0U2VjdGlvbi5DYW52YXNTaXplID0gVURpbTIubmV3KDAsIDAsIDAuNSwgMCkKICAgICAgICBSaWdodFNlY3Rpb24uVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgUmlnaHRTZWN0aW9uLlBhcmVudCA9IFNlY3Rpb25zCiAgICAgICAgCiAgICAgICAgbG9jYWwgVUlMaXN0TGF5b3V0ID0gSW5zdGFuY2UubmV3KCdVSUxpc3RMYXlvdXQnKQogICAgICAgIFVJTGlzdExheW91dC5QYWRkaW5nID0gVURpbS5uZXcoMCwgMTEpCiAgICAgICAgVUlMaXN0TGF5b3V0Lkhvcml6b250YWxBbGlnbm1lbnQgPSBFbnVtLkhvcml6b250YWxBbGlnbm1lbnQuQ2VudGVyCiAgICAgICAgVUlMaXN0TGF5b3V0LlNvcnRPcmRlciA9IEVudW0uU29ydE9yZGVyLkxheW91dE9yZGVyCiAgICAgICAgVUlMaXN0TGF5b3V0LlBhcmVudCA9IFJpZ2h0U2VjdGlvbgogICAgICAgIAogICAgICAgIGxvY2FsIFVJUGFkZGluZyA9IEluc3RhbmNlLm5ldygnVUlQYWRkaW5nJykKICAgICAgICBVSVBhZGRpbmcuUGFkZGluZ1RvcCA9IFVEaW0ubmV3KDAsIDEpCiAgICAgICAgVUlQYWRkaW5nLlBhcmVudCA9IFJpZ2h0U2VjdGlvbgoKICAgICAgICBzZWxmLl90YWIgKz0gMQoKICAgICAgICBpZiBmaXJzdF90YWIgdGhlbgogICAgICAgICAgICBzZWxmOnVwZGF0ZV90YWJzKFRhYiwgTGVmdFNlY3Rpb24sIFJpZ2h0U2VjdGlvbikKICAgICAgICAgICAgc2VsZjp1cGRhdGVfc2VjdGlvbnMoTGVmdFNlY3Rpb24sIFJpZ2h0U2VjdGlvbikKICAgICAgICBlbmQKCiAgICAgICAgVGFiLk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICBzZWxmOnVwZGF0ZV90YWJzKFRhYiwgTGVmdFNlY3Rpb24sIFJpZ2h0U2VjdGlvbikKICAgICAgICAgICAgc2VsZjp1cGRhdGVfc2VjdGlvbnMoTGVmdFNlY3Rpb24sIFJpZ2h0U2VjdGlvbikKICAgICAgICBlbmQpCgogICAgICAgIGZ1bmN0aW9uIFRhYk1hbmFnZXI6Y3JlYXRlX21vZHVsZShzZXR0aW5nczogYW55KQoKICAgICAgICAgICAgbG9jYWwgTGF5b3V0T3JkZXJNb2R1bGUgPSAwOwoKICAgICAgICAgICAgbG9jYWwgTW9kdWxlTWFuYWdlciA9IHsKICAgICAgICAgICAgICAgIF9zdGF0ZSA9IGZhbHNlLAogICAgICAgICAgICAgICAgX3NpemUgPSAwLAogICAgICAgICAgICAgICAgX211bHRpcGxpZXIgPSAwCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIHNldHRpbmdzLnNlY3Rpb24gPT0gJ3JpZ2h0JyB0aGVuCiAgICAgICAgICAgICAgICBzZXR0aW5ncy5zZWN0aW9uID0gUmlnaHRTZWN0aW9uCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHNldHRpbmdzLnNlY3Rpb24gPSBMZWZ0U2VjdGlvbgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIE1vZHVsZSA9IEluc3RhbmNlLm5ldygnRnJhbWUnKQogICAgICAgICAgICBNb2R1bGUuQ2xpcHNEZXNjZW5kYW50cyA9IHRydWUKICAgICAgICAgICAgTW9kdWxlLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgIE1vZHVsZS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC41CiAgICAgICAgICAgIE1vZHVsZS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjAwNDExNTIyNjIxMjg4ODk1NiwgMCwgMCwgMCkKICAgICAgICAgICAgTW9kdWxlLk5hbWUgPSAnTW9kdWxlJwogICAgICAgICAgICBNb2R1bGUuU2l6ZSA9IFVEaW0yLm5ldygwLCAyNDEsIDAsIDkzKQogICAgICAgICAgICBNb2R1bGUuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICBNb2R1bGUuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIyLCAyOCwgMzgpCiAgICAgICAgICAgIE1vZHVsZS5QYXJlbnQgPSBzZXR0aW5ncy5zZWN0aW9uCgogICAgICAgICAgICBsb2NhbCBVSUxpc3RMYXlvdXQgPSBJbnN0YW5jZS5uZXcoJ1VJTGlzdExheW91dCcpCiAgICAgICAgICAgIFVJTGlzdExheW91dC5Tb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICBVSUxpc3RMYXlvdXQuUGFyZW50ID0gTW9kdWxlCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBVSUNvcm5lciA9IEluc3RhbmNlLm5ldygnVUlDb3JuZXInKQogICAgICAgICAgICBVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLCA1KQogICAgICAgICAgICBVSUNvcm5lci5QYXJlbnQgPSBNb2R1bGUKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIFVJU3Ryb2tlID0gSW5zdGFuY2UubmV3KCdVSVN0cm9rZScpCiAgICAgICAgICAgIFVJU3Ryb2tlLkNvbG9yID0gQ29sb3IzLmZyb21SR0IoNTIsIDY2LCA4OSkKICAgICAgICAgICAgVUlTdHJva2UuVHJhbnNwYXJlbmN5ID0gMC41CiAgICAgICAgICAgIFVJU3Ryb2tlLkFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICBVSVN0cm9rZS5QYXJlbnQgPSBNb2R1bGUKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIEhlYWRlciA9IEluc3RhbmNlLm5ldygnVGV4dEJ1dHRvbicpCiAgICAgICAgICAgIEhlYWRlci5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL1NvdXJjZVNhbnNQcm8uanNvbicsIEVudW0uRm9udFdlaWdodC5SZWd1bGFyLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgICAgIEhlYWRlci5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgICAgICAgICAgSGVhZGVyLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgIEhlYWRlci5UZXh0ID0gJycKICAgICAgICAgICAgSGVhZGVyLkF1dG9CdXR0b25Db2xvciA9IGZhbHNlCiAgICAgICAgICAgIEhlYWRlci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICBIZWFkZXIuTmFtZSA9ICdIZWFkZXInCiAgICAgICAgICAgIEhlYWRlci5TaXplID0gVURpbTIubmV3KDAsIDI0MSwgMCwgOTMpCiAgICAgICAgICAgIEhlYWRlci5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgIEhlYWRlci5UZXh0U2l6ZSA9IDE0CiAgICAgICAgICAgIEhlYWRlci5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgSGVhZGVyLlBhcmVudCA9IE1vZHVsZQogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgSWNvbiA9IEluc3RhbmNlLm5ldygnSW1hZ2VMYWJlbCcpCiAgICAgICAgICAgIEljb24uSW1hZ2VDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxNTIsIDE4MSwgMjU1KQogICAgICAgICAgICBJY29uLlNjYWxlVHlwZSA9IEVudW0uU2NhbGVUeXBlLkZpdAogICAgICAgICAgICBJY29uLkltYWdlVHJhbnNwYXJlbmN5ID0gMC42OTk5OTk5ODgwNzkwNzEKICAgICAgICAgICAgSWNvbi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgICAgICBJY29uLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgMC41KQogICAgICAgICAgICBJY29uLkltYWdlID0gJ3JieGFzc2V0aWQ6Ly83OTA5NTkzNDQzODA0NScKICAgICAgICAgICAgSWNvbi5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICBJY29uLlBvc2l0aW9uID0gVURpbTIubmV3KDAuMDcxMDAwMDAyMzI0NTgxMTUsIDAsIDAuODE5OTk5OTkyODQ3NDQyNiwgMCkKICAgICAgICAgICAgSWNvbi5OYW1lID0gJ0ljb24nCiAgICAgICAgICAgIEljb24uU2l6ZSA9IFVEaW0yLm5ldygwLCAxNSwgMCwgMTUpCiAgICAgICAgICAgIEljb24uQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICBJY29uLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICBJY29uLlBhcmVudCA9IEhlYWRlcgogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgTW9kdWxlTmFtZSA9IEluc3RhbmNlLm5ldygnVGV4dExhYmVsJykKICAgICAgICAgICAgTW9kdWxlTmFtZS5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL0dvdGhhbVNTbS5qc29uJywgRW51bS5Gb250V2VpZ2h0LlNlbWlCb2xkLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgICAgIE1vZHVsZU5hbWUuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MiwgMTgxLCAyNTUpCiAgICAgICAgICAgIE1vZHVsZU5hbWUuVGV4dFRyYW5zcGFyZW5jeSA9IDAuMjAwMDAwMDAyOTgwMjMyMjQKICAgICAgICAgICAgaWYgbm90IHNldHRpbmdzLnJpY2ggdGhlbgogICAgICAgICAgICAgICAgTW9kdWxlTmFtZS5UZXh0ID0gc2V0dGluZ3MudGl0bGUgb3IgIlNraWJpZGkiCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIE1vZHVsZU5hbWUuUmljaFRleHQgPSB0cnVlCiAgICAgICAgICAgICAgICBNb2R1bGVOYW1lLlRleHQgPSBzZXR0aW5ncy5yaWNodGV4dCBvciAiPGZvbnQgY29sb3I9J3JnYigyNTUsMCwwKSc+TG9zdEh1YjwvZm9udD4gdXNlciIKICAgICAgICAgICAgZW5kOwogICAgICAgICAgICBNb2R1bGVOYW1lLk5hbWUgPSAnTW9kdWxlTmFtZScKICAgICAgICAgICAgTW9kdWxlTmFtZS5TaXplID0gVURpbTIubmV3KDAsIDIwNSwgMCwgMTMpCiAgICAgICAgICAgIE1vZHVsZU5hbWUuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLCAwLjUpCiAgICAgICAgICAgIE1vZHVsZU5hbWUuUG9zaXRpb24gPSBVRGltMi5uZXcoMC4wNzI5OTk5OTg5MjcxMTY0LCAwLCAwLjIzOTk5OTk5NDYzNTU4MTk3LCAwKQogICAgICAgICAgICBNb2R1bGVOYW1lLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgIE1vZHVsZU5hbWUuVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQKICAgICAgICAgICAgTW9kdWxlTmFtZS5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgIE1vZHVsZU5hbWUuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgICAgICAgICAgTW9kdWxlTmFtZS5UZXh0U2l6ZSA9IDEzCiAgICAgICAgICAgIE1vZHVsZU5hbWUuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIE1vZHVsZU5hbWUuUGFyZW50ID0gSGVhZGVyCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBEZXNjcmlwdGlvbiA9IEluc3RhbmNlLm5ldygnVGV4dExhYmVsJykKICAgICAgICAgICAgRGVzY3JpcHRpb24uRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICBEZXNjcmlwdGlvbi5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTUyLCAxODEsIDI1NSkKICAgICAgICAgICAgRGVzY3JpcHRpb24uVGV4dFRyYW5zcGFyZW5jeSA9IDAuNjk5OTk5OTg4MDc5MDcxCiAgICAgICAgICAgIERlc2NyaXB0aW9uLlRleHQgPSBzZXR0aW5ncy5kZXNjcmlwdGlvbgogICAgICAgICAgICBEZXNjcmlwdGlvbi5OYW1lID0gJ0Rlc2NyaXB0aW9uJwogICAgICAgICAgICBEZXNjcmlwdGlvbi5TaXplID0gVURpbTIubmV3KDAsIDIwNSwgMCwgMTMpCiAgICAgICAgICAgIERlc2NyaXB0aW9uLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgMC41KQogICAgICAgICAgICBEZXNjcmlwdGlvbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjA3Mjk5OTk5ODkyNzExNjQsIDAsIDAuNDE5OTk5OTg2ODg2OTc4MTUsIDApCiAgICAgICAgICAgIERlc2NyaXB0aW9uLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgIERlc2NyaXB0aW9uLlRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0CiAgICAgICAgICAgIERlc2NyaXB0aW9uLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgRGVzY3JpcHRpb24uQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgICAgICAgICAgRGVzY3JpcHRpb24uVGV4dFNpemUgPSAxMAogICAgICAgICAgICBEZXNjcmlwdGlvbi5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgRGVzY3JpcHRpb24uUGFyZW50ID0gSGVhZGVyCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBUb2dnbGUgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgICAgICAgICAgVG9nZ2xlLk5hbWUgPSAnVG9nZ2xlJwogICAgICAgICAgICBUb2dnbGUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuNjk5OTk5OTg4MDc5MDcxCiAgICAgICAgICAgIFRvZ2dsZS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjgxOTk5OTk5Mjg0NzQ0MjYsIDAsIDAuNzU3MDAwMDI5MDg3MDY2NywgMCkKICAgICAgICAgICAgVG9nZ2xlLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgIFRvZ2dsZS5TaXplID0gVURpbTIubmV3KDAsIDI1LCAwLCAxMikKICAgICAgICAgICAgVG9nZ2xlLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgVG9nZ2xlLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgICAgICBUb2dnbGUuUGFyZW50ID0gSGVhZGVyCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBVSUNvcm5lciA9IEluc3RhbmNlLm5ldygnVUlDb3JuZXInKQogICAgICAgICAgICBVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygxLCAwKQogICAgICAgICAgICBVSUNvcm5lci5QYXJlbnQgPSBUb2dnbGUKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIENpcmNsZSA9IEluc3RhbmNlLm5ldygnRnJhbWUnKQogICAgICAgICAgICBDaXJjbGUuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgICAgICAgICAgQ2lyY2xlLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgMC41KQogICAgICAgICAgICBDaXJjbGUuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuMjAwMDAwMDAyOTgwMjMyMjQKICAgICAgICAgICAgQ2lyY2xlLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAuNSwgMCkKICAgICAgICAgICAgQ2lyY2xlLk5hbWUgPSAnQ2lyY2xlJwogICAgICAgICAgICBDaXJjbGUuU2l6ZSA9IFVEaW0yLm5ldygwLCAxMiwgMCwgMTIpCiAgICAgICAgICAgIENpcmNsZS5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgIENpcmNsZS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoNjYsIDgwLCAxMTUpCiAgICAgICAgICAgIENpcmNsZS5QYXJlbnQgPSBUb2dnbGUKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIFVJQ29ybmVyID0gSW5zdGFuY2UubmV3KCdVSUNvcm5lcicpCiAgICAgICAgICAgIFVJQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDEsIDApCiAgICAgICAgICAgIFVJQ29ybmVyLlBhcmVudCA9IENpcmNsZQogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgS2V5YmluZCA9IEluc3RhbmNlLm5ldygnRnJhbWUnKQogICAgICAgICAgICBLZXliaW5kLk5hbWUgPSAnS2V5YmluZCcKICAgICAgICAgICAgS2V5YmluZC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC42OTk5OTk5ODgwNzkwNzEKICAgICAgICAgICAgS2V5YmluZC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjE1MDAwMDAwNTk2MDQ2NDQ4LCAwLCAwLjczNTAwMDAxNDMwNTExNDcsIDApCiAgICAgICAgICAgIEtleWJpbmQuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgICAgICAgICAgS2V5YmluZC5TaXplID0gVURpbTIubmV3KDAsIDMzLCAwLCAxNSkKICAgICAgICAgICAgS2V5YmluZC5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgIEtleWJpbmQuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MiwgMTgxLCAyNTUpCiAgICAgICAgICAgIEtleWJpbmQuUGFyZW50ID0gSGVhZGVyCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBVSUNvcm5lciA9IEluc3RhbmNlLm5ldygnVUlDb3JuZXInKQogICAgICAgICAgICBVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLCAzKQogICAgICAgICAgICBVSUNvcm5lci5QYXJlbnQgPSBLZXliaW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBUZXh0TGFiZWwgPSBJbnN0YW5jZS5uZXcoJ1RleHRMYWJlbCcpCiAgICAgICAgICAgIFRleHRMYWJlbC5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL0dvdGhhbVNTbS5qc29uJywgRW51bS5Gb250V2VpZ2h0LlNlbWlCb2xkLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjA5LCAyMjIsIDI1NSkKICAgICAgICAgICAgVGV4dExhYmVsLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0ID0gJ05vbmUnCiAgICAgICAgICAgIFRleHRMYWJlbC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMC41KQogICAgICAgICAgICBUZXh0TGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygwLCAyNSwgMCwgMTMpCiAgICAgICAgICAgIFRleHRMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICBUZXh0TGFiZWwuVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkxlZnQKICAgICAgICAgICAgVGV4dExhYmVsLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMC41LCAwKQogICAgICAgICAgICBUZXh0TGFiZWwuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICBUZXh0TGFiZWwuVGV4dFNpemUgPSAxMAogICAgICAgICAgICBUZXh0TGFiZWwuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIFRleHRMYWJlbC5QYXJlbnQgPSBLZXliaW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBEaXZpZGVyID0gSW5zdGFuY2UubmV3KCdGcmFtZScpCiAgICAgICAgICAgIERpdmlkZXIuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgICAgICAgICAgRGl2aWRlci5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMCkKICAgICAgICAgICAgRGl2aWRlci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC41CiAgICAgICAgICAgIERpdmlkZXIuUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLjYyMDAwMDAwNDc2ODM3MTYsIDApCiAgICAgICAgICAgIERpdmlkZXIuTmFtZSA9ICdEaXZpZGVyJwogICAgICAgICAgICBEaXZpZGVyLlNpemUgPSBVRGltMi5uZXcoMCwgMjQxLCAwLCAxKQogICAgICAgICAgICBEaXZpZGVyLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgRGl2aWRlci5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoNTIsIDY2LCA4OSkKICAgICAgICAgICAgRGl2aWRlci5QYXJlbnQgPSBIZWFkZXIKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIERpdmlkZXIgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgICAgICAgICAgRGl2aWRlci5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgICAgICBEaXZpZGVyLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAwKQogICAgICAgICAgICBEaXZpZGVyLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjUKICAgICAgICAgICAgRGl2aWRlci5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIDEsIDApCiAgICAgICAgICAgIERpdmlkZXIuTmFtZSA9ICdEaXZpZGVyJwogICAgICAgICAgICBEaXZpZGVyLlNpemUgPSBVRGltMi5uZXcoMCwgMjQxLCAwLCAxKQogICAgICAgICAgICBEaXZpZGVyLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgRGl2aWRlci5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoNTIsIDY2LCA4OSkKICAgICAgICAgICAgRGl2aWRlci5QYXJlbnQgPSBIZWFkZXIKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIE9wdGlvbnMgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgICAgICAgICAgT3B0aW9ucy5OYW1lID0gJ09wdGlvbnMnCiAgICAgICAgICAgIE9wdGlvbnMuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgT3B0aW9ucy5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCAwLCAxLCAwKQogICAgICAgICAgICBPcHRpb25zLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgIE9wdGlvbnMuU2l6ZSA9IFVEaW0yLm5ldygwLCAyNDEsIDAsIDgpCiAgICAgICAgICAgIE9wdGlvbnMuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICBPcHRpb25zLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICBPcHRpb25zLlBhcmVudCA9IE1vZHVsZQoKICAgICAgICAgICAgbG9jYWwgVUlQYWRkaW5nID0gSW5zdGFuY2UubmV3KCdVSVBhZGRpbmcnKQogICAgICAgICAgICBVSVBhZGRpbmcuUGFkZGluZ1RvcCA9IFVEaW0ubmV3KDAsIDgpCiAgICAgICAgICAgIFVJUGFkZGluZy5QYXJlbnQgPSBPcHRpb25zCgogICAgICAgICAgICBsb2NhbCBVSUxpc3RMYXlvdXQgPSBJbnN0YW5jZS5uZXcoJ1VJTGlzdExheW91dCcpCiAgICAgICAgICAgIFVJTGlzdExheW91dC5QYWRkaW5nID0gVURpbS5uZXcoMCwgNSkKICAgICAgICAgICAgVUlMaXN0TGF5b3V0Lkhvcml6b250YWxBbGlnbm1lbnQgPSBFbnVtLkhvcml6b250YWxBbGlnbm1lbnQuQ2VudGVyCiAgICAgICAgICAgIFVJTGlzdExheW91dC5Tb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICBVSUxpc3RMYXlvdXQuUGFyZW50ID0gT3B0aW9ucwoKICAgICAgICAgICAgZnVuY3Rpb24gTW9kdWxlTWFuYWdlcjpjaGFuZ2Vfc3RhdGUoc3RhdGU6IGJvb2xlYW4pCiAgICAgICAgICAgICAgICBzZWxmLl9zdGF0ZSA9IHN0YXRlCgogICAgICAgICAgICAgICAgaWYgc2VsZi5fc3RhdGUgdGhlbgogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoTW9kdWxlLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIDkzICsgc2VsZi5fc2l6ZSArIHNlbGYuX211bHRpcGxpZXIpCiAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoVG9nZ2xlLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTUyLCAxODEsIDI1NSkKICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKCiAgICAgICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShDaXJjbGUsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxNTIsIDE4MSwgMjU1KSwKICAgICAgICAgICAgICAgICAgICAgICAgUG9zaXRpb24gPSBVRGltMi5mcm9tU2NhbGUoMC41MywgMC41KQogICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoTW9kdWxlLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIDkzKQogICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQoKICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKFRvZ2dsZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoQ2lyY2xlLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoNjYsIDgwLCAxMTUpLAogICAgICAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiA9IFVEaW0yLmZyb21TY2FsZSgwLCAwLjUpCiAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddID0gc2VsZi5fc3RhdGUKICAgICAgICAgICAgICAgIENvbmZpZzpzYXZlKGdhbWUuR2FtZUlkLCBMaWJyYXJ5Ll9jb25maWcpCgogICAgICAgICAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soc2VsZi5fc3RhdGUpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gTW9kdWxlTWFuYWdlcjpjb25uZWN0X2tleWJpbmQoKQogICAgICAgICAgICAgICAgaWYgbm90IExpYnJhcnkuX2NvbmZpZy5fa2V5YmluZHNbc2V0dGluZ3MuZmxhZ10gdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNbc2V0dGluZ3MuZmxhZy4uJ19rZXliaW5kJ10gPSBVc2VySW5wdXRTZXJ2aWNlLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihpbnB1dDogSW5wdXRPYmplY3QsIHByb2Nlc3M6IGJvb2xlYW4pCiAgICAgICAgICAgICAgICAgICAgaWYgcHJvY2VzcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIHRvc3RyaW5nKGlucHV0LktleUNvZGUpIH49IExpYnJhcnkuX2NvbmZpZy5fa2V5YmluZHNbc2V0dGluZ3MuZmxhZ10gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWxmOmNoYW5nZV9zdGF0ZShub3Qgc2VsZi5fc3RhdGUpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZnVuY3Rpb24gTW9kdWxlTWFuYWdlcjpzY2FsZV9rZXliaW5kKGVtcHR5OiBib29sZWFuKQogICAgICAgICAgICAgICAgaWYgTGlicmFyeS5fY29uZmlnLl9rZXliaW5kc1tzZXR0aW5ncy5mbGFnXSBhbmQgbm90IGVtcHR5IHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBrZXliaW5kX3N0cmluZyA9IHN0cmluZy5nc3ViKHRvc3RyaW5nKExpYnJhcnkuX2NvbmZpZy5fa2V5YmluZHNbc2V0dGluZ3MuZmxhZ10pLCAnRW51bS5LZXlDb2RlLicsICcnKQoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBmb250X3BhcmFtcyA9IEluc3RhbmNlLm5ldygnR2V0VGV4dEJvdW5kc1BhcmFtcycpCiAgICAgICAgICAgICAgICAgICAgZm9udF9wYXJhbXMuVGV4dCA9IGtleWJpbmRfc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgZm9udF9wYXJhbXMuRm9udCA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL01vbnRzZXJyYXQuanNvbicsIEVudW0uRm9udFdlaWdodC5Cb2xkKQogICAgICAgICAgICAgICAgICAgIGZvbnRfcGFyYW1zLlNpemUgPSAxMAogICAgICAgICAgICAgICAgICAgIGZvbnRfcGFyYW1zLldpZHRoID0gMTAwMDAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsb2NhbCBmb250X3NpemUgPSBUZXh0U2VydmljZTpHZXRUZXh0Qm91bmRzQXN5bmMoZm9udF9wYXJhbXMpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgS2V5YmluZC5TaXplID0gVURpbTIuZnJvbU9mZnNldChmb250X3NpemUuWCArIDYsIDE1KQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5TaXplID0gVURpbTIuZnJvbU9mZnNldChmb250X3NpemUuWCwgMTMpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgS2V5YmluZC5TaXplID0gVURpbTIuZnJvbU9mZnNldCgzMSwgMTUpCiAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLlNpemUgPSBVRGltMi5mcm9tT2Zmc2V0KDI1LCAxMykKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIExpYnJhcnk6ZmxhZ190eXBlKHNldHRpbmdzLmZsYWcsICdib29sZWFuJykgdGhlbgogICAgICAgICAgICAgICAgTW9kdWxlTWFuYWdlci5fc3RhdGUgPSB0cnVlCiAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYWxsYmFjayhNb2R1bGVNYW5hZ2VyLl9zdGF0ZSkKCiAgICAgICAgICAgICAgICBUb2dnbGUuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MiwgMTgxLCAyNTUpCiAgICAgICAgICAgICAgICBDaXJjbGUuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MiwgMTgxLCAyNTUpCiAgICAgICAgICAgICAgICBDaXJjbGUuUG9zaXRpb24gPSBVRGltMi5mcm9tU2NhbGUoMC41MywgMC41KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIExpYnJhcnkuX2NvbmZpZy5fa2V5YmluZHNbc2V0dGluZ3MuZmxhZ10gdGhlbgogICAgICAgICAgICAgICAgbG9jYWwga2V5YmluZF9zdHJpbmcgPSBzdHJpbmcuZ3N1Yih0b3N0cmluZyhMaWJyYXJ5Ll9jb25maWcuX2tleWJpbmRzW3NldHRpbmdzLmZsYWddKSwgJ0VudW0uS2V5Q29kZS4nLCAnJykKICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0ID0ga2V5YmluZF9zdHJpbmcKCiAgICAgICAgICAgICAgICBNb2R1bGVNYW5hZ2VyOmNvbm5lY3Rfa2V5YmluZCgpCiAgICAgICAgICAgICAgICBNb2R1bGVNYW5hZ2VyOnNjYWxlX2tleWJpbmQoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIENvbm5lY3Rpb25zW3NldHRpbmdzLmZsYWcuLidfaW5wdXRfYmVnYW4nXSA9IEhlYWRlci5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQ6IElucHV0T2JqZWN0KQogICAgICAgICAgICAgICAgaWYgTGlicmFyeS5fY2hvb3Npbmdfa2V5YmluZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlIH49IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjMgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIExpYnJhcnkuX2Nob29zaW5nX2tleWJpbmQgPSB0cnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zWydrZXliaW5kX2Nob29zZV9zdGFydCddID0gVXNlcklucHV0U2VydmljZS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQ6IElucHV0T2JqZWN0LCBwcm9jZXNzOiBib29sZWFuKQogICAgICAgICAgICAgICAgICAgIGlmIHByb2Nlc3MgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBpbnB1dCA9PSBFbnVtLlVzZXJJbnB1dFN0YXRlIG9yIGlucHV0ID09IEVudW0uVXNlcklucHV0VHlwZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBpbnB1dC5LZXlDb2RlID09IEVudW0uS2V5Q29kZS5Vbmtub3duIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIGlucHV0LktleUNvZGUgPT0gRW51bS5LZXlDb2RlLkJhY2tzcGFjZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIE1vZHVsZU1hbmFnZXI6c2NhbGVfa2V5YmluZCh0cnVlKQoKICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9rZXliaW5kc1tzZXR0aW5ncy5mbGFnXSA9IG5pbAogICAgICAgICAgICAgICAgICAgICAgICBDb25maWc6c2F2ZShnYW1lLkdhbWVJZCwgTGlicmFyeS5fY29uZmlnKQoKICAgICAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLlRleHQgPSAnTm9uZScKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbm5lY3Rpb25zW3NldHRpbmdzLmZsYWcuLidfa2V5YmluZCddIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zW3NldHRpbmdzLmZsYWcuLidfa2V5YmluZCddOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNbc2V0dGluZ3MuZmxhZy4uJ19rZXliaW5kJ10gPSBuaWwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc1sna2V5YmluZF9jaG9vc2Vfc3RhcnQnXTpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNbJ2tleWJpbmRfY2hvb3NlX3N0YXJ0J10gPSBuaWwKCiAgICAgICAgICAgICAgICAgICAgICAgIExpYnJhcnkuX2Nob29zaW5nX2tleWJpbmQgPSBmYWxzZQoKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNbJ2tleWJpbmRfY2hvb3NlX3N0YXJ0J106RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNbJ2tleWJpbmRfY2hvb3NlX3N0YXJ0J10gPSBuaWwKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2tleWJpbmRzW3NldHRpbmdzLmZsYWddID0gdG9zdHJpbmcoaW5wdXQuS2V5Q29kZSkKICAgICAgICAgICAgICAgICAgICBDb25maWc6c2F2ZShnYW1lLkdhbWVJZCwgTGlicmFyeS5fY29uZmlnKQoKICAgICAgICAgICAgICAgICAgICBpZiBDb25uZWN0aW9uc1tzZXR0aW5ncy5mbGFnLi4nX2tleWJpbmQnXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zW3NldHRpbmdzLmZsYWcuLidfa2V5YmluZCddOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc1tzZXR0aW5ncy5mbGFnLi4nX2tleWJpbmQnXSA9IG5pbAogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBNb2R1bGVNYW5hZ2VyOmNvbm5lY3Rfa2V5YmluZCgpCiAgICAgICAgICAgICAgICAgICAgTW9kdWxlTWFuYWdlcjpzY2FsZV9rZXliaW5kKCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jaG9vc2luZ19rZXliaW5kID0gZmFsc2UKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwga2V5YmluZF9zdHJpbmcgPSBzdHJpbmcuZ3N1Yih0b3N0cmluZyhMaWJyYXJ5Ll9jb25maWcuX2tleWJpbmRzW3NldHRpbmdzLmZsYWddKSwgJ0VudW0uS2V5Q29kZS4nLCAnJykKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dCA9IGtleWJpbmRfc3RyaW5nCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgIEhlYWRlci5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIE1vZHVsZU1hbmFnZXI6Y2hhbmdlX3N0YXRlKG5vdCBNb2R1bGVNYW5hZ2VyLl9zdGF0ZSkKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgZnVuY3Rpb24gTW9kdWxlTWFuYWdlcjpjcmVhdGVfcGFyYWdyYXBoKHNldHRpbmdzOiBhbnkpCiAgICAgICAgICAgICAgICBMYXlvdXRPcmRlck1vZHVsZSA9IExheW91dE9yZGVyTW9kdWxlICsgMTsKCiAgICAgICAgICAgICAgICBsb2NhbCBQYXJhZ3JhcGhNYW5hZ2VyID0ge30KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgc2VsZi5fc2l6ZSA9PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBzZWxmLl9zaXplID0gMTEKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuX3NpemUgKz0gc2V0dGluZ3MuY3VzdG9tU2NhbGUgb3IgNzAKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBNb2R1bGVNYW5hZ2VyLl9zdGF0ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgTW9kdWxlLlNpemUgPSBVRGltMi5mcm9tT2Zmc2V0KDI0MSwgOTMgKyBzZWxmLl9zaXplKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgT3B0aW9ucy5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIHNlbGYuX3NpemUpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gQ29udGFpbmVyIEZyYW1lCiAgICAgICAgICAgICAgICBsb2NhbCBQYXJhZ3JhcGggPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgICAgICAgICAgICAgIFBhcmFncmFwaC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzIsIDM4LCA1MSkKICAgICAgICAgICAgICAgIFBhcmFncmFwaC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC4xCiAgICAgICAgICAgICAgICBQYXJhZ3JhcGguU2l6ZSA9IFVEaW0yLm5ldygwLCAyMDcsIDAsIDMwKSAtLSBJbml0aWFsIHNpemUsIGF1dG8tcmVzaXplZCBsYXRlcgogICAgICAgICAgICAgICAgUGFyYWdyYXBoLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIFBhcmFncmFwaC5OYW1lID0gIlBhcmFncmFwaCIKICAgICAgICAgICAgICAgIFBhcmFncmFwaC5BdXRvbWF0aWNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlkgLS0gU3VwcG9ydCBhdXRvLXJlc2l6aW5nIGhlaWdodAogICAgICAgICAgICAgICAgUGFyYWdyYXBoLlBhcmVudCA9IE9wdGlvbnMKICAgICAgICAgICAgICAgIFBhcmFncmFwaC5MYXlvdXRPcmRlciA9IExheW91dE9yZGVyTW9kdWxlOwogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFVJQ29ybmVyID0gSW5zdGFuY2UubmV3KCdVSUNvcm5lcicpCiAgICAgICAgICAgICAgICBVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLCA0KQogICAgICAgICAgICAgICAgVUlDb3JuZXIuUGFyZW50ID0gUGFyYWdyYXBoCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gVGl0bGUgTGFiZWwKICAgICAgICAgICAgICAgIGxvY2FsIFRpdGxlID0gSW5zdGFuY2UubmV3KCdUZXh0TGFiZWwnKQogICAgICAgICAgICAgICAgVGl0bGUuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgVGl0bGUuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIxMCwgMjEwLCAyMTApCiAgICAgICAgICAgICAgICBUaXRsZS5UZXh0ID0gc2V0dGluZ3MudGl0bGUgb3IgIlRpdGxlIgogICAgICAgICAgICAgICAgVGl0bGUuU2l6ZSA9IFVEaW0yLm5ldygxLCAtMTAsIDAsIDIwKQogICAgICAgICAgICAgICAgVGl0bGUuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgNSwgMCwgNSkKICAgICAgICAgICAgICAgIFRpdGxlLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICBUaXRsZS5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgICAgICAgICAgICAgVGl0bGUuVGV4dFlBbGlnbm1lbnQgPSBFbnVtLlRleHRZQWxpZ25tZW50LkNlbnRlcgogICAgICAgICAgICAgICAgVGl0bGUuVGV4dFNpemUgPSAxMgogICAgICAgICAgICAgICAgVGl0bGUuQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5YWQogICAgICAgICAgICAgICAgVGl0bGUuUGFyZW50ID0gUGFyYWdyYXBoCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gQm9keSBUZXh0CiAgICAgICAgICAgICAgICBsb2NhbCBCb2R5ID0gSW5zdGFuY2UubmV3KCdUZXh0TGFiZWwnKQogICAgICAgICAgICAgICAgQm9keS5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL0dvdGhhbVNTbS5qc29uJywgRW51bS5Gb250V2VpZ2h0LlJlZ3VsYXIsIEVudW0uRm9udFN0eWxlLk5vcm1hbCkKICAgICAgICAgICAgICAgIEJvZHkuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE4MCwgMTgwLCAxODApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy5yaWNoIHRoZW4KICAgICAgICAgICAgICAgICAgICBCb2R5LlRleHQgPSBzZXR0aW5ncy50ZXh0IG9yICJTa2liaWRpIgogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIEJvZHkuUmljaFRleHQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgQm9keS5UZXh0ID0gc2V0dGluZ3MucmljaHRleHQgb3IgIjxmb250IGNvbG9yPSdyZ2IoMjU1LDAsMCknPkxvc3RIdWI8L2ZvbnQ+IHVzZXIiCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgQm9keS5TaXplID0gVURpbTIubmV3KDEsIC0xMCwgMCwgMjApCiAgICAgICAgICAgICAgICBCb2R5LlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDUsIDAsIDMwKQogICAgICAgICAgICAgICAgQm9keS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgQm9keS5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgICAgICAgICAgICAgQm9keS5UZXh0WUFsaWdubWVudCA9IEVudW0uVGV4dFlBbGlnbm1lbnQuVG9wCiAgICAgICAgICAgICAgICBCb2R5LlRleHRTaXplID0gMTEKICAgICAgICAgICAgICAgIEJvZHkuVGV4dFdyYXBwZWQgPSB0cnVlCiAgICAgICAgICAgICAgICBCb2R5LkF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFkKICAgICAgICAgICAgICAgIEJvZHkuUGFyZW50ID0gUGFyYWdyYXBoCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gSG92ZXIgZWZmZWN0IGZvciBQYXJhZ3JhcGggKG9wdGlvbmFsKQogICAgICAgICAgICAgICAgUGFyYWdyYXBoLk1vdXNlRW50ZXI6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShQYXJhZ3JhcGgsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQig0MiwgNTAsIDY2KQogICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIFBhcmFncmFwaC5Nb3VzZUxlYXZlOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoUGFyYWdyYXBoLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzIsIDM4LCA1MSkKICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICByZXR1cm4gUGFyYWdyYXBoTWFuYWdlcgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIE1vZHVsZU1hbmFnZXI6Y3JlYXRlX3RleHQoc2V0dGluZ3M6IGFueSkKICAgICAgICAgICAgICAgIExheW91dE9yZGVyTW9kdWxlID0gTGF5b3V0T3JkZXJNb2R1bGUgKyAxCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgVGV4dE1hbmFnZXIgPSB7fQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNlbGYuX3NpemUgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2l6ZSA9IDExCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLl9zaXplICs9IHNldHRpbmdzLmN1c3RvbVNjYWxlIG9yIDUwIC0tIEFkanVzdCB0aGUgZGVmYXVsdCBoZWlnaHQgZm9yIHRleHQgZWxlbWVudHMKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBNb2R1bGVNYW5hZ2VyLl9zdGF0ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgTW9kdWxlLlNpemUgPSBVRGltMi5mcm9tT2Zmc2V0KDI0MSwgOTMgKyBzZWxmLl9zaXplKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgT3B0aW9ucy5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIHNlbGYuX3NpemUpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gQ29udGFpbmVyIEZyYW1lCiAgICAgICAgICAgICAgICBsb2NhbCBUZXh0RnJhbWUgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgICAgICAgICAgICAgIFRleHRGcmFtZS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzIsIDM4LCA1MSkKICAgICAgICAgICAgICAgIFRleHRGcmFtZS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC4xCiAgICAgICAgICAgICAgICBUZXh0RnJhbWUuU2l6ZSA9IFVEaW0yLm5ldygwLCAyMDcsIDAsIHNldHRpbmdzLkN1c3RvbVlTaXplKSAtLSBJbml0aWFsIHNpemUsIGF1dG8tcmVzaXplZCBsYXRlcgogICAgICAgICAgICAgICAgVGV4dEZyYW1lLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIFRleHRGcmFtZS5OYW1lID0gIlRleHQiCiAgICAgICAgICAgICAgICBUZXh0RnJhbWUuQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZIC0tIFN1cHBvcnQgYXV0by1yZXNpemluZyBoZWlnaHQKICAgICAgICAgICAgICAgIFRleHRGcmFtZS5QYXJlbnQgPSBPcHRpb25zCiAgICAgICAgICAgICAgICBUZXh0RnJhbWUuTGF5b3V0T3JkZXIgPSBMYXlvdXRPcmRlck1vZHVsZQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFVJQ29ybmVyID0gSW5zdGFuY2UubmV3KCdVSUNvcm5lcicpCiAgICAgICAgICAgICAgICBVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygwLCA0KQogICAgICAgICAgICAgICAgVUlDb3JuZXIuUGFyZW50ID0gVGV4dEZyYW1lCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gQm9keSBUZXh0CiAgICAgICAgICAgICAgICBsb2NhbCBCb2R5ID0gSW5zdGFuY2UubmV3KCdUZXh0TGFiZWwnKQogICAgICAgICAgICAgICAgQm9keS5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL0dvdGhhbVNTbS5qc29uJywgRW51bS5Gb250V2VpZ2h0LlJlZ3VsYXIsIEVudW0uRm9udFN0eWxlLk5vcm1hbCkKICAgICAgICAgICAgICAgIEJvZHkuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE4MCwgMTgwLCAxODApCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHNldHRpbmdzLnJpY2ggdGhlbgogICAgICAgICAgICAgICAgICAgIEJvZHkuVGV4dCA9IHNldHRpbmdzLnRleHQgb3IgIlNraWJpZGkiIC0tIERlZmF1bHQgdGV4dAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIEJvZHkuUmljaFRleHQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgQm9keS5UZXh0ID0gc2V0dGluZ3MucmljaHRleHQgb3IgIjxmb250IGNvbG9yPSdyZ2IoMjU1LDAsMCknPkxvc3RIdWI8L2ZvbnQ+IHVzZXIiIC0tIERlZmF1bHQgcmljaCB0ZXh0CiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBCb2R5LlNpemUgPSBVRGltMi5uZXcoMSwgLTEwLCAxLCAwKQogICAgICAgICAgICAgICAgQm9keS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCA1LCAwLCA1KQogICAgICAgICAgICAgICAgQm9keS5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgQm9keS5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgICAgICAgICAgICAgQm9keS5UZXh0WUFsaWdubWVudCA9IEVudW0uVGV4dFlBbGlnbm1lbnQuVG9wCiAgICAgICAgICAgICAgICBCb2R5LlRleHRTaXplID0gMTAKICAgICAgICAgICAgICAgIEJvZHkuVGV4dFdyYXBwZWQgPSB0cnVlCiAgICAgICAgICAgICAgICBCb2R5LkF1dG9tYXRpY1NpemUgPSBFbnVtLkF1dG9tYXRpY1NpemUuWFkKICAgICAgICAgICAgICAgIEJvZHkuUGFyZW50ID0gVGV4dEZyYW1lCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLS0gSG92ZXIgZWZmZWN0IGZvciBUZXh0RnJhbWUgKG9wdGlvbmFsKQogICAgICAgICAgICAgICAgVGV4dEZyYW1lLk1vdXNlRW50ZXI6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShUZXh0RnJhbWUsIFR3ZWVuSW5mby5uZXcoMC4zLCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQig0MiwgNTAsIDY2KQogICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIFRleHRGcmFtZS5Nb3VzZUxlYXZlOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoVGV4dEZyYW1lLCBUd2VlbkluZm8ubmV3KDAuMywgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzIsIDM4LCA1MSkKICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKICAgICAgICAgICAgICAgIGVuZCkKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBUZXh0TWFuYWdlcjpTZXQobmV3X3NldHRpbmdzKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBuZXdfc2V0dGluZ3MucmljaCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIEJvZHkuVGV4dCA9IG5ld19zZXR0aW5ncy50ZXh0IG9yICJTa2liaWRpIiAtLSBEZWZhdWx0IHRleHQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIEJvZHkuUmljaFRleHQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIEJvZHkuVGV4dCA9IG5ld19zZXR0aW5ncy5yaWNodGV4dCBvciAiPGZvbnQgY29sb3I9J3JnYigyNTUsMCwwKSc+TG9zdEh1YjwvZm9udD4gdXNlciIgLS0gRGVmYXVsdCByaWNoIHRleHQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gVGV4dE1hbmFnZXIKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGZ1bmN0aW9uIE1vZHVsZU1hbmFnZXI6Y3JlYXRlX3RleHRib3goc2V0dGluZ3M6IGFueSkKICAgICAgICAgICAgICAgIExheW91dE9yZGVyTW9kdWxlID0gTGF5b3V0T3JkZXJNb2R1bGUgKyAxCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgVGV4dGJveE1hbmFnZXIgPSB7CiAgICAgICAgICAgICAgICAgICAgX3RleHQgPSAiIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNlbGYuX3NpemUgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2l6ZSA9IDExCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLl9zaXplICs9IDMyCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgTW9kdWxlTWFuYWdlci5fc3RhdGUgdGhlbgogICAgICAgICAgICAgICAgICAgIE1vZHVsZS5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIDkzICsgc2VsZi5fc2l6ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIE9wdGlvbnMuU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjQxLCBzZWxmLl9zaXplKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIExhYmVsID0gSW5zdGFuY2UubmV3KCdUZXh0TGFiZWwnKQogICAgICAgICAgICAgICAgTGFiZWwuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgTGFiZWwuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICBMYWJlbC5UZXh0VHJhbnNwYXJlbmN5ID0gMC4yCiAgICAgICAgICAgICAgICBMYWJlbC5UZXh0ID0gc2V0dGluZ3MudGl0bGUgb3IgIkVudGVyIHRleHQiCiAgICAgICAgICAgICAgICBMYWJlbC5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgMTMpCiAgICAgICAgICAgICAgICBMYWJlbC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDApCiAgICAgICAgICAgICAgICBMYWJlbC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLCAwLCAwLCAwKQogICAgICAgICAgICAgICAgTGFiZWwuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIExhYmVsLlRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0CiAgICAgICAgICAgICAgICBMYWJlbC5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgICAgICBMYWJlbC5QYXJlbnQgPSBPcHRpb25zCiAgICAgICAgICAgICAgICBMYWJlbC5UZXh0U2l6ZSA9IDEwOwogICAgICAgICAgICAgICAgTGFiZWwuTGF5b3V0T3JkZXIgPSBMYXlvdXRPcmRlck1vZHVsZQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFRleHRib3ggPSBJbnN0YW5jZS5uZXcoJ1RleHRCb3gnKQogICAgICAgICAgICAgICAgVGV4dGJveC5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL1NvdXJjZVNhbnNQcm8uanNvbicsIEVudW0uRm9udFdlaWdodC5SZWd1bGFyLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgICAgICAgICBUZXh0Ym94LlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgVGV4dGJveC5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgICAgICAgICAgVGV4dGJveC5QbGFjZWhvbGRlclRleHQgPSBzZXR0aW5ncy5wbGFjZWhvbGRlciBvciAiRW50ZXIgdGV4dC4uLiIKICAgICAgICAgICAgICAgIFRleHRib3guVGV4dCA9IExpYnJhcnkuX2NvbmZpZy5fZmxhZ3Nbc2V0dGluZ3MuZmxhZ10gb3IgIiIKICAgICAgICAgICAgICAgIFRleHRib3guTmFtZSA9ICdUZXh0Ym94JwogICAgICAgICAgICAgICAgVGV4dGJveC5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgMTUpCiAgICAgICAgICAgICAgICBUZXh0Ym94LkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIFRleHRib3guVGV4dFNpemUgPSAxMAogICAgICAgICAgICAgICAgVGV4dGJveC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTUyLCAxODEsIDI1NSkKICAgICAgICAgICAgICAgIFRleHRib3guQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuOQogICAgICAgICAgICAgICAgVGV4dGJveC5DbGVhclRleHRPbkZvY3VzID0gZmFsc2UKICAgICAgICAgICAgICAgIFRleHRib3guUGFyZW50ID0gT3B0aW9ucwogICAgICAgICAgICAgICAgVGV4dGJveC5MYXlvdXRPcmRlciA9IExheW91dE9yZGVyTW9kdWxlCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoJ1VJQ29ybmVyJykKICAgICAgICAgICAgICAgIFVJQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDQpCiAgICAgICAgICAgICAgICBVSUNvcm5lci5QYXJlbnQgPSBUZXh0Ym94CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZnVuY3Rpb24gVGV4dGJveE1hbmFnZXI6dXBkYXRlX3RleHQodGV4dDogc3RyaW5nKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX3RleHQgPSB0ZXh0CiAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSA9IHNlbGYuX3RleHQKICAgICAgICAgICAgICAgICAgICBDb25maWc6c2F2ZShnYW1lLkdhbWVJZCwgTGlicmFyeS5fY29uZmlnKQogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKHNlbGYuX3RleHQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBMaWJyYXJ5OmZsYWdfdHlwZShzZXR0aW5ncy5mbGFnLCAnc3RyaW5nJykgdGhlbgogICAgICAgICAgICAgICAgICAgIFRleHRib3hNYW5hZ2VyOnVwZGF0ZV90ZXh0KExpYnJhcnkuX2NvbmZpZy5fZmxhZ3Nbc2V0dGluZ3MuZmxhZ10pCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBUZXh0Ym94LkZvY3VzTG9zdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBUZXh0Ym94TWFuYWdlcjp1cGRhdGVfdGV4dChUZXh0Ym94LlRleHQpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIFRleHRib3hNYW5hZ2VyCiAgICAgICAgICAgIGVuZCAgIAoKICAgICAgICAgICAgZnVuY3Rpb24gTW9kdWxlTWFuYWdlcjpjcmVhdGVfY2hlY2tib3goc2V0dGluZ3M6IGFueSkKICAgICAgICAgICAgICAgIExheW91dE9yZGVyTW9kdWxlID0gTGF5b3V0T3JkZXJNb2R1bGUgKyAxCiAgICAgICAgICAgICAgICBsb2NhbCBDaGVja2JveE1hbmFnZXIgPSB7IF9zdGF0ZSA9IGZhbHNlIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBzZWxmLl9zaXplID09IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NpemUgPSAxMQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBzZWxmLl9zaXplICs9IDIwCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgTW9kdWxlTWFuYWdlci5fc3RhdGUgdGhlbgogICAgICAgICAgICAgICAgICAgIE1vZHVsZS5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIDkzICsgc2VsZi5fc2l6ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgT3B0aW9ucy5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIHNlbGYuX3NpemUpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgQ2hlY2tib3ggPSBJbnN0YW5jZS5uZXcoIlRleHRCdXR0b24iKQogICAgICAgICAgICAgICAgQ2hlY2tib3guRm9udEZhY2UgPSBGb250Lm5ldygicmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Tb3VyY2VTYW5zUHJvLmpzb24iLCBFbnVtLkZvbnRXZWlnaHQuUmVndWxhciwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgQ2hlY2tib3guVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgICAgICBDaGVja2JveC5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgICAgICAgICAgQ2hlY2tib3guVGV4dCA9ICIiCiAgICAgICAgICAgICAgICBDaGVja2JveC5BdXRvQnV0dG9uQ29sb3IgPSBmYWxzZQogICAgICAgICAgICAgICAgQ2hlY2tib3guQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIENoZWNrYm94Lk5hbWUgPSAiQ2hlY2tib3giCiAgICAgICAgICAgICAgICBDaGVja2JveC5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgMTUpCiAgICAgICAgICAgICAgICBDaGVja2JveC5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgICAgICBDaGVja2JveC5UZXh0U2l6ZSA9IDE0CiAgICAgICAgICAgICAgICBDaGVja2JveC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgICAgICAgICAgICAgIENoZWNrYm94LlBhcmVudCA9IE9wdGlvbnMKICAgICAgICAgICAgICAgIENoZWNrYm94LkxheW91dE9yZGVyID0gTGF5b3V0T3JkZXJNb2R1bGUKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBUaXRsZUxhYmVsID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKQogICAgICAgICAgICAgICAgVGl0bGVMYWJlbC5OYW1lID0gIlRpdGxlTGFiZWwiCiAgICAgICAgICAgICAgICBpZiBTZWxlY3RlZExhbmd1YWdlID09ICJ0aCIgdGhlbgogICAgICAgICAgICAgICAgICAgIFRpdGxlTGFiZWwuRm9udEZhY2UgPSBGb250Lm5ldygicmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Ob3RvU2Fuc1RoYWkuanNvbiIsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgICAgIFRpdGxlTGFiZWwuVGV4dFNpemUgPSAxMwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIFRpdGxlTGFiZWwuRm9udEZhY2UgPSBGb250Lm5ldygicmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbiIsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgICAgIFRpdGxlTGFiZWwuVGV4dFNpemUgPSAxMQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBUaXRsZUxhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgVGl0bGVMYWJlbC5UZXh0VHJhbnNwYXJlbmN5ID0gMC4yCiAgICAgICAgICAgICAgICBUaXRsZUxhYmVsLlRleHQgPSBzZXR0aW5ncy50aXRsZSBvciAiU2tpYmlkaSIKICAgICAgICAgICAgICAgIFRpdGxlTGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygwLCAxNDIsIDAsIDEzKQogICAgICAgICAgICAgICAgVGl0bGVMYWJlbC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDAuNSkKICAgICAgICAgICAgICAgIFRpdGxlTGFiZWwuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMCwgMC41LCAwKQogICAgICAgICAgICAgICAgVGl0bGVMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgVGl0bGVMYWJlbC5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgICAgICAgICAgICAgVGl0bGVMYWJlbC5QYXJlbnQgPSBDaGVja2JveAoKICAgICAgICAgICAgICAgIGxvY2FsIEtleWJpbmRCb3ggPSBJbnN0YW5jZS5uZXcoIkZyYW1lIikKICAgICAgICAgICAgICAgIEtleWJpbmRCb3guTmFtZSA9ICJLZXliaW5kQm94IgogICAgICAgICAgICAgICAgS2V5YmluZEJveC5TaXplID0gVURpbTIuZnJvbU9mZnNldCgxNCwgMTQpCiAgICAgICAgICAgICAgICBLZXliaW5kQm94LlBvc2l0aW9uID0gVURpbTIubmV3KDEsIC0zNSwgMC41LCAwKQogICAgICAgICAgICAgICAgS2V5YmluZEJveC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDAuNSkKICAgICAgICAgICAgICAgIEtleWJpbmRCb3guQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MiwgMTgxLCAyNTUpCiAgICAgICAgICAgICAgICBLZXliaW5kQm94LkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIEtleWJpbmRCb3guUGFyZW50ID0gQ2hlY2tib3gKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBLZXliaW5kQ29ybmVyID0gSW5zdGFuY2UubmV3KCJVSUNvcm5lciIpCiAgICAgICAgICAgICAgICBLZXliaW5kQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDQpCiAgICAgICAgICAgICAgICBLZXliaW5kQ29ybmVyLlBhcmVudCA9IEtleWJpbmRCb3gKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBLZXliaW5kTGFiZWwgPSBJbnN0YW5jZS5uZXcoIlRleHRMYWJlbCIpCiAgICAgICAgICAgICAgICBLZXliaW5kTGFiZWwuTmFtZSA9ICJLZXliaW5kTGFiZWwiCiAgICAgICAgICAgICAgICBLZXliaW5kTGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygxLCAwLCAxLCAwKQogICAgICAgICAgICAgICAgS2V5YmluZExhYmVsLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICBLZXliaW5kTGFiZWwuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgICAgICBLZXliaW5kTGFiZWwuVGV4dFNjYWxlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICBLZXliaW5kTGFiZWwuVGV4dFNpemUgPSAxMAogICAgICAgICAgICAgICAgS2V5YmluZExhYmVsLkZvbnQgPSBFbnVtLkZvbnQuU291cmNlU2FucwogICAgICAgICAgICAgICAgS2V5YmluZExhYmVsLlRleHQgPSBMaWJyYXJ5Ll9jb25maWcuX2tleWJpbmRzW3NldHRpbmdzLmZsYWddIAogICAgICAgICAgICAgICAgICAgIGFuZCBzdHJpbmcuZ3N1Yih0b3N0cmluZyhMaWJyYXJ5Ll9jb25maWcuX2tleWJpbmRzW3NldHRpbmdzLmZsYWddKSwgIkVudW0uS2V5Q29kZS4iLCAiIikgCiAgICAgICAgICAgICAgICAgICAgb3IgIi4uLiIKICAgICAgICAgICAgICAgIEtleWJpbmRMYWJlbC5QYXJlbnQgPSBLZXliaW5kQm94CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgQm94ID0gSW5zdGFuY2UubmV3KCJGcmFtZSIpCiAgICAgICAgICAgICAgICBCb3guQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgICAgICAgICAgICAgIEJveC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDEsIDAuNSkKICAgICAgICAgICAgICAgIEJveC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC45CiAgICAgICAgICAgICAgICBCb3guUG9zaXRpb24gPSBVRGltMi5uZXcoMSwgMCwgMC41LCAwKQogICAgICAgICAgICAgICAgQm94Lk5hbWUgPSAiQm94IgogICAgICAgICAgICAgICAgQm94LlNpemUgPSBVRGltMi5uZXcoMCwgMTUsIDAsIDE1KQogICAgICAgICAgICAgICAgQm94LkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIEJveC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTUyLCAxODEsIDI1NSkKICAgICAgICAgICAgICAgIEJveC5QYXJlbnQgPSBDaGVja2JveAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIEJveENvcm5lciA9IEluc3RhbmNlLm5ldygiVUlDb3JuZXIiKQogICAgICAgICAgICAgICAgQm94Q29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDQpCiAgICAgICAgICAgICAgICBCb3hDb3JuZXIuUGFyZW50ID0gQm94CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgRmlsbCA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgICAgICAgICAgICAgRmlsbC5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAuNSwgMC41KQogICAgICAgICAgICAgICAgRmlsbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC4yCiAgICAgICAgICAgICAgICBGaWxsLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgMCwgMC41LCAwKQogICAgICAgICAgICAgICAgRmlsbC5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgICAgICAgICAgRmlsbC5OYW1lID0gIkZpbGwiCiAgICAgICAgICAgICAgICBGaWxsLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIEZpbGwuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MiwgMTgxLCAyNTUpCiAgICAgICAgICAgICAgICBGaWxsLlBhcmVudCA9IEJveAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIEZpbGxDb3JuZXIgPSBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIikKICAgICAgICAgICAgICAgIEZpbGxDb3JuZXIuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgMykKICAgICAgICAgICAgICAgIEZpbGxDb3JuZXIuUGFyZW50ID0gRmlsbAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIENoZWNrYm94TWFuYWdlcjpjaGFuZ2Vfc3RhdGUoc3RhdGU6IGJvb2xlYW4pCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc3RhdGUgPSBzdGF0ZQogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuX3N0YXRlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShCb3gsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC43CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQogICAgICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKEZpbGwsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldCg5LCA5KQogICAgICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoQm94LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDAuOQogICAgICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKICAgICAgICAgICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShGaWxsLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSA9IHNlbGYuX3N0YXRlCiAgICAgICAgICAgICAgICAgICAgQ29uZmlnOnNhdmUoZ2FtZS5HYW1lSWQsIExpYnJhcnkuX2NvbmZpZykKICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYWxsYmFjayhzZWxmLl9zdGF0ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIExpYnJhcnk6ZmxhZ190eXBlKHNldHRpbmdzLmZsYWcsICJib29sZWFuIikgdGhlbgogICAgICAgICAgICAgICAgICAgIENoZWNrYm94TWFuYWdlcjpjaGFuZ2Vfc3RhdGUoTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIENoZWNrYm94Lk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIENoZWNrYm94TWFuYWdlcjpjaGFuZ2Vfc3RhdGUobm90IENoZWNrYm94TWFuYWdlci5fc3RhdGUpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgQ2hlY2tib3guSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKGlucHV0LCBnYW1lUHJvY2Vzc2VkKQogICAgICAgICAgICAgICAgICAgIGlmIGdhbWVQcm9jZXNzZWQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgaW5wdXQuVXNlcklucHV0VHlwZSB+PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24zIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIExpYnJhcnkuX2Nob29zaW5nX2tleWJpbmQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIExpYnJhcnkuX2Nob29zaW5nX2tleWJpbmQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2hvb3NlQ29ubmVjdGlvbgogICAgICAgICAgICAgICAgICAgIGNob29zZUNvbm5lY3Rpb24gPSBVc2VySW5wdXRTZXJ2aWNlLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihrZXlJbnB1dCwgcHJvY2Vzc2VkKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBwcm9jZXNzZWQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGtleUlucHV0LlVzZXJJbnB1dFR5cGUgfj0gRW51bS5Vc2VySW5wdXRUeXBlLktleWJvYXJkIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBrZXlJbnB1dC5LZXlDb2RlID09IEVudW0uS2V5Q29kZS5Vbmtub3duIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYga2V5SW5wdXQuS2V5Q29kZSA9PSBFbnVtLktleUNvZGUuQmFja3NwYWNlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vZHVsZU1hbmFnZXI6c2NhbGVfa2V5YmluZCh0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9rZXliaW5kc1tzZXR0aW5ncy5mbGFnXSA9IG5pbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnOnNhdmUoZ2FtZS5HYW1lSWQsIExpYnJhcnkuX2NvbmZpZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmRMYWJlbC5UZXh0ID0gIi4uLiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIENvbm5lY3Rpb25zW3NldHRpbmdzLmZsYWcgLi4gIl9rZXliaW5kIl0gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zW3NldHRpbmdzLmZsYWcgLi4gIl9rZXliaW5kIl06RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNbc2V0dGluZ3MuZmxhZyAuLiAiX2tleWJpbmQiXSA9IG5pbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaG9vc2VDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY2hvb3Npbmdfa2V5YmluZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBjaG9vc2VDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2tleWJpbmRzW3NldHRpbmdzLmZsYWddID0gdG9zdHJpbmcoa2V5SW5wdXQuS2V5Q29kZSkKICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnOnNhdmUoZ2FtZS5HYW1lSWQsIExpYnJhcnkuX2NvbmZpZykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgQ29ubmVjdGlvbnNbc2V0dGluZ3MuZmxhZyAuLiAiX2tleWJpbmQiXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc1tzZXR0aW5ncy5mbGFnIC4uICJfa2V5YmluZCJdOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNbc2V0dGluZ3MuZmxhZyAuLiAiX2tleWJpbmQiXSA9IG5pbAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlTWFuYWdlcjpjb25uZWN0X2tleWJpbmQoKQogICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVNYW5hZ2VyOnNjYWxlX2tleWJpbmQoKQogICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jaG9vc2luZ19rZXliaW5kID0gZmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGtleWJpbmRfc3RyaW5nID0gc3RyaW5nLmdzdWIodG9zdHJpbmcoTGlicmFyeS5fY29uZmlnLl9rZXliaW5kc1tzZXR0aW5ncy5mbGFnXSksICJFbnVtLktleUNvZGUuIiwgIiIpCiAgICAgICAgICAgICAgICAgICAgICAgIEtleWJpbmRMYWJlbC5UZXh0ID0ga2V5YmluZF9zdHJpbmcKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwga2V5UHJlc3NDb25uZWN0aW9uID0gVXNlcklucHV0U2VydmljZS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQsIGdhbWVQcm9jZXNzZWQpCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZVByb2Nlc3NlZCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5LZXlib2FyZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN0b3JlZEtleSA9IExpYnJhcnkuX2NvbmZpZy5fa2V5YmluZHNbc2V0dGluZ3MuZmxhZ10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3RvcmVkS2V5IGFuZCB0b3N0cmluZyhpbnB1dC5LZXlDb2RlKSA9PSBzdG9yZWRLZXkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2hlY2tib3hNYW5hZ2VyOmNoYW5nZV9zdGF0ZShub3QgQ2hlY2tib3hNYW5hZ2VyLl9zdGF0ZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBDb25uZWN0aW9uc1tzZXR0aW5ncy5mbGFnIC4uICJfa2V5cHJlc3MiXSA9IGtleVByZXNzQ29ubmVjdGlvbgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBDaGVja2JveE1hbmFnZXIKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBNb2R1bGVNYW5hZ2VyOmNyZWF0ZV9kaXZpZGVyKHNldHRpbmdzOiBhbnkpCiAgICAgICAgICAgICAgICAtLSBMYXlvdXQgb3JkZXIgbWFuYWdlbWVudAogICAgICAgICAgICAgICAgTGF5b3V0T3JkZXJNb2R1bGUgPSBMYXlvdXRPcmRlck1vZHVsZSArIDE7CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgc2VsZi5fc2l6ZSA9PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBzZWxmLl9zaXplID0gMTEKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbGYuX3NpemUgKz0gMjcKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBNb2R1bGVNYW5hZ2VyLl9zdGF0ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgTW9kdWxlLlNpemUgPSBVRGltMi5mcm9tT2Zmc2V0KDI0MSwgOTMgKyBzZWxmLl9zaXplKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgbG9jYWwgZGl2aWRlckhlaWdodCA9IDEKICAgICAgICAgICAgICAgIGxvY2FsIGRpdmlkZXJXaWR0aCA9IDIwNyAtLSBBZGp1c3QgdGhpcyB0byBmaXQgeW91ciBVSSB3aWR0aAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIC0tIENyZWF0ZSB0aGUgb3V0ZXIgZnJhbWUgdG8gY29udHJvbCBzcGFjaW5nIGFib3ZlIGFuZCBiZWxvdwogICAgICAgICAgICAgICAgbG9jYWwgT3V0ZXJGcmFtZSA9IEluc3RhbmNlLm5ldygnRnJhbWUnKQogICAgICAgICAgICAgICAgT3V0ZXJGcmFtZS5TaXplID0gVURpbTIubmV3KDAsIGRpdmlkZXJXaWR0aCwgMCwgMjApIC0tIEhlaWdodCBoZXJlIGNvbnRyb2xzIHNwYWNpbmcgYWJvdmUgYW5kIGJlbG93CiAgICAgICAgICAgICAgICBPdXRlckZyYW1lLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxIC0tIEZ1bGx5IGludmlzaWJsZQogICAgICAgICAgICAgICAgT3V0ZXJGcmFtZS5OYW1lID0gJ091dGVyRnJhbWUnCiAgICAgICAgICAgICAgICBPdXRlckZyYW1lLlBhcmVudCA9IE9wdGlvbnMKICAgICAgICAgICAgICAgIE91dGVyRnJhbWUuTGF5b3V0T3JkZXIgPSBMYXlvdXRPcmRlck1vZHVsZQoKICAgICAgICAgICAgICAgIGlmIHNldHRpbmdzIGFuZCBzZXR0aW5ncy5zaG93dG9waWMgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIFRleHRMYWJlbCA9IEluc3RhbmNlLm5ldygnVGV4dExhYmVsJykKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkgLS0gMTU0LCAxODIsIDI1NQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0VHJhbnNwYXJlbmN5ID0gMAogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0ID0gc2V0dGluZ3MudGl0bGUKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygwLCAxNTMsIDAsIDEzKQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIDAuNTAxLCAwKQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuQ2VudGVyCiAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLjUsMC41KQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0U2l6ZSA9IDExCiAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5aSW5kZXggPSAzOwogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0U3Ryb2tlVHJhbnNwYXJlbmN5ID0gMDsKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuUGFyZW50ID0gT3V0ZXJGcmFtZQogICAgICAgICAgICAgICAgZW5kOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3Mgb3Igc2V0dGluZ3MgYW5kIG5vdCBzZXR0aW5ncy5kaXNhYmxlbGluZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgLS0gQ3JlYXRlIHRoZSBpbm5lciBkaXZpZGVyIGZyYW1lIHRoYXQgd2lsbCBiZSBwbGFjZWQgaW4gdGhlIG1pZGRsZSBvZiB0aGUgT3V0ZXJGcmFtZQogICAgICAgICAgICAgICAgICAgIGxvY2FsIERpdmlkZXIgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgICAgICAgICAgICAgICAgICBEaXZpZGVyLlNpemUgPSBVRGltMi5uZXcoMSwgMCwgMCwgZGl2aWRlckhlaWdodCkKICAgICAgICAgICAgICAgICAgICBEaXZpZGVyLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KSAtLSBXaGl0ZSBjb2xvcgogICAgICAgICAgICAgICAgICAgIERpdmlkZXIuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgICAgIERpdmlkZXIuTmFtZSA9ICdEaXZpZGVyJwogICAgICAgICAgICAgICAgICAgIERpdmlkZXIuUGFyZW50ID0gT3V0ZXJGcmFtZQogICAgICAgICAgICAgICAgICAgIERpdmlkZXIuWkluZGV4ID0gMjsKICAgICAgICAgICAgICAgICAgICBEaXZpZGVyLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAuNSwgLWRpdmlkZXJIZWlnaHQgLyAyKSAtLSBDZW50ZXIgdGhlIGRpdmlkZXIgdmVydGljYWxseSBpbiB0aGUgT3V0ZXJGcmFtZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLS0gQWRkIGEgVUlHcmFkaWVudCB0byB0aGUgZGl2aWRlciBmb3IgbGVmdCBhbmQgcmlnaHQgdHJhbnNwYXJlbmN5CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgR3JhZGllbnQgPSBJbnN0YW5jZS5uZXcoJ1VJR3JhZGllbnQnKQogICAgICAgICAgICAgICAgICAgIEdyYWRpZW50LlBhcmVudCA9IERpdmlkZXIKICAgICAgICAgICAgICAgICAgICBHcmFkaWVudC5Db2xvciA9IENvbG9yU2VxdWVuY2UubmV3KHsKICAgICAgICAgICAgICAgICAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KSksICAtLSBTdGFydCB3aXRoIHdoaXRlCiAgICAgICAgICAgICAgICAgICAgICAgIENvbG9yU2VxdWVuY2VLZXlwb2ludC5uZXcoMC41LCBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KSksIC0tIEtlZXAgaXQgd2hpdGUgaW4gdGhlIG1pZGRsZQogICAgICAgICAgICAgICAgICAgICAgICBDb2xvclNlcXVlbmNlS2V5cG9pbnQubmV3KDEsIENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUsIDApKSAgLS0gRmFkZSB0byB0cmFuc3BhcmVudCBvbiB0aGUgcmlnaHQgc2lkZQogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgR3JhZGllbnQuVHJhbnNwYXJlbmN5ID0gTnVtYmVyU2VxdWVuY2UubmV3KHsKICAgICAgICAgICAgICAgICAgICAgICAgTnVtYmVyU2VxdWVuY2VLZXlwb2ludC5uZXcoMCwgMSksICAgCiAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDAuNSwgMCksCiAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDEsIDEpCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICBHcmFkaWVudC5Sb3RhdGlvbiA9IDAgLS0gSG9yaXpvbnRhbCBncmFkaWVudCAoZmFkZSBmcm9tIGxlZnQgdG8gcmlnaHQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAtLSBPcHRpb25hbGx5LCB5b3UgY2FuIGFkZCBhIGNvcm5lciByYWRpdXMgZm9yIHJvdW5kZWQgZW5kcwogICAgICAgICAgICAgICAgICAgIGxvY2FsIFVJQ29ybmVyID0gSW5zdGFuY2UubmV3KCdVSUNvcm5lcicpCiAgICAgICAgICAgICAgICAgICAgVUlDb3JuZXIuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgMikgLS0gU21hbGwgY29ybmVyIHJhZGl1cyBmb3Igc21vb3RoIGVkZ2VzCiAgICAgICAgICAgICAgICAgICAgVUlDb3JuZXIuUGFyZW50ID0gRGl2aWRlcgoKICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBmdW5jdGlvbiBNb2R1bGVNYW5hZ2VyOmNyZWF0ZV9zbGlkZXIoc2V0dGluZ3M6IGFueSkKCiAgICAgICAgICAgICAgICBMYXlvdXRPcmRlck1vZHVsZSA9IExheW91dE9yZGVyTW9kdWxlICsgMQoKICAgICAgICAgICAgICAgIGxvY2FsIFNsaWRlck1hbmFnZXIgPSB7fQoKICAgICAgICAgICAgICAgIGlmIHNlbGYuX3NpemUgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2l6ZSA9IDExCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBzZWxmLl9zaXplICs9IDI3CgogICAgICAgICAgICAgICAgaWYgTW9kdWxlTWFuYWdlci5fc3RhdGUgdGhlbgogICAgICAgICAgICAgICAgICAgIE1vZHVsZS5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIDkzICsgc2VsZi5fc2l6ZSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIE9wdGlvbnMuU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjQxLCBzZWxmLl9zaXplKQoKICAgICAgICAgICAgICAgIGxvY2FsIFNsaWRlciA9IEluc3RhbmNlLm5ldygnVGV4dEJ1dHRvbicpCiAgICAgICAgICAgICAgICBTbGlkZXIuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Tb3VyY2VTYW5zUHJvLmpzb24nLCBFbnVtLkZvbnRXZWlnaHQuUmVndWxhciwgRW51bS5Gb250U3R5bGUuTm9ybWFsKTsKICAgICAgICAgICAgICAgIFNsaWRlci5UZXh0U2l6ZSA9IDE0OwogICAgICAgICAgICAgICAgU2xpZGVyLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgICAgICAgICAgU2xpZGVyLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgICAgICBTbGlkZXIuVGV4dCA9ICcnCiAgICAgICAgICAgICAgICBTbGlkZXIuQXV0b0J1dHRvbkNvbG9yID0gZmFsc2UKICAgICAgICAgICAgICAgIFNsaWRlci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgU2xpZGVyLk5hbWUgPSAnU2xpZGVyJwogICAgICAgICAgICAgICAgU2xpZGVyLlNpemUgPSBVRGltMi5uZXcoMCwgMjA3LCAwLCAyMikKICAgICAgICAgICAgICAgIFNsaWRlci5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgICAgICBTbGlkZXIuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgICAgICBTbGlkZXIuUGFyZW50ID0gT3B0aW9ucwogICAgICAgICAgICAgICAgU2xpZGVyLkxheW91dE9yZGVyID0gTGF5b3V0T3JkZXJNb2R1bGUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgVGV4dExhYmVsID0gSW5zdGFuY2UubmV3KCdUZXh0TGFiZWwnKQogICAgICAgICAgICAgICAgaWYgR0cuU2VsZWN0ZWRMYW5ndWFnZSA9PSAidGgiIHRoZW4KICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuRm9udEZhY2UgPSBGb250Lm5ldygicmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Ob3RvU2Fuc1RoYWkuanNvbiIsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0U2l6ZSA9IDEzOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIFRleHRMYWJlbC5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL0dvdGhhbVNTbS5qc29uJywgRW51bS5Gb250V2VpZ2h0LlNlbWlCb2xkLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLlRleHRTaXplID0gMTE7CiAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dFRyYW5zcGFyZW5jeSA9IDAuMjAwMDAwMDAyOTgwMjMyMjQKICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0ID0gc2V0dGluZ3MudGl0bGUKICAgICAgICAgICAgICAgIFRleHRMYWJlbC5TaXplID0gVURpbTIubmV3KDAsIDE1MywgMCwgMTMpCiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMCwgMC4wNTAwMDAwMDA3NDUwNTgwNiwgMCkKICAgICAgICAgICAgICAgIFRleHRMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgVGV4dExhYmVsLlRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0CiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgVGV4dExhYmVsLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuUGFyZW50ID0gU2xpZGVyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIERyYWcgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgICAgICAgICAgICAgIERyYWcuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgICAgICAgICAgICAgIERyYWcuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygwLjUsIDEpCiAgICAgICAgICAgICAgICBEcmFnLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjg5OTk5OTk3NjE1ODE0MjEKICAgICAgICAgICAgICAgIERyYWcuUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLjk0OTk5OTk4ODA3OTA3MSwgMCkKICAgICAgICAgICAgICAgIERyYWcuTmFtZSA9ICdEcmFnJwogICAgICAgICAgICAgICAgRHJhZy5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgNCkKICAgICAgICAgICAgICAgIERyYWcuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgRHJhZy5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTUyLCAxODEsIDI1NSkKICAgICAgICAgICAgICAgIERyYWcuUGFyZW50ID0gU2xpZGVyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFVJQ29ybmVyID0gSW5zdGFuY2UubmV3KCdVSUNvcm5lcicpCiAgICAgICAgICAgICAgICBVSUNvcm5lci5Db3JuZXJSYWRpdXMgPSBVRGltLm5ldygxLCAwKQogICAgICAgICAgICAgICAgVUlDb3JuZXIuUGFyZW50ID0gRHJhZwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBGaWxsID0gSW5zdGFuY2UubmV3KCdGcmFtZScpCiAgICAgICAgICAgICAgICBGaWxsLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgICAgICBGaWxsLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgMC41KQogICAgICAgICAgICAgICAgRmlsbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC41CiAgICAgICAgICAgICAgICBGaWxsLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDAsIDAuNSwgMCkKICAgICAgICAgICAgICAgIEZpbGwuTmFtZSA9ICdGaWxsJwogICAgICAgICAgICAgICAgRmlsbC5TaXplID0gVURpbTIubmV3KDAsIDEwMywgMCwgNCkKICAgICAgICAgICAgICAgIEZpbGwuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgRmlsbC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMTUyLCAxODEsIDI1NSkKICAgICAgICAgICAgICAgIEZpbGwuUGFyZW50ID0gRHJhZwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBVSUNvcm5lciA9IEluc3RhbmNlLm5ldygnVUlDb3JuZXInKQogICAgICAgICAgICAgICAgVUlDb3JuZXIuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgMykKICAgICAgICAgICAgICAgIFVJQ29ybmVyLlBhcmVudCA9IEZpbGwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgVUlHcmFkaWVudCA9IEluc3RhbmNlLm5ldygnVUlHcmFkaWVudCcpCiAgICAgICAgICAgICAgICBVSUdyYWRpZW50LkNvbG9yID0gQ29sb3JTZXF1ZW5jZS5uZXd7CiAgICAgICAgICAgICAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KSksCiAgICAgICAgICAgICAgICAgICAgQ29sb3JTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCBDb2xvcjMuZnJvbVJHQig3OSwgNzksIDc5KSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIFVJR3JhZGllbnQuUGFyZW50ID0gRmlsbAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBDaXJjbGUgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgICAgICAgICAgICAgIENpcmNsZS5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDEsIDAuNSkKICAgICAgICAgICAgICAgIENpcmNsZS5OYW1lID0gJ0NpcmNsZScKICAgICAgICAgICAgICAgIENpcmNsZS5Qb3NpdGlvbiA9IFVEaW0yLm5ldygxLCAwLCAwLjUsIDApCiAgICAgICAgICAgICAgICBDaXJjbGUuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgICAgICAgICAgICAgIENpcmNsZS5TaXplID0gVURpbTIubmV3KDAsIDYsIDAsIDYpCiAgICAgICAgICAgICAgICBDaXJjbGUuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgQ2lyY2xlLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgQ2lyY2xlLlBhcmVudCA9IEZpbGwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgVUlDb3JuZXIgPSBJbnN0YW5jZS5uZXcoJ1VJQ29ybmVyJykKICAgICAgICAgICAgICAgIFVJQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDEsIDApCiAgICAgICAgICAgICAgICBVSUNvcm5lci5QYXJlbnQgPSBDaXJjbGUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgVmFsdWUgPSBJbnN0YW5jZS5uZXcoJ1RleHRMYWJlbCcpCiAgICAgICAgICAgICAgICBWYWx1ZS5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldDovL2ZvbnRzL2ZhbWlsaWVzL0dvdGhhbVNTbS5qc29uJywgRW51bS5Gb250V2VpZ2h0LlNlbWlCb2xkLCBFbnVtLkZvbnRTdHlsZS5Ob3JtYWwpCiAgICAgICAgICAgICAgICBWYWx1ZS5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIFZhbHVlLlRleHRUcmFuc3BhcmVuY3kgPSAwLjIwMDAwMDAwMjk4MDIzMjI0CiAgICAgICAgICAgICAgICBWYWx1ZS5UZXh0ID0gJzUwJwogICAgICAgICAgICAgICAgVmFsdWUuTmFtZSA9ICdWYWx1ZScKICAgICAgICAgICAgICAgIFZhbHVlLlNpemUgPSBVRGltMi5uZXcoMCwgNDIsIDAsIDEzKQogICAgICAgICAgICAgICAgVmFsdWUuQW5jaG9yUG9pbnQgPSBWZWN0b3IyLm5ldygxLCAwKQogICAgICAgICAgICAgICAgVmFsdWUuUG9zaXRpb24gPSBVRGltMi5uZXcoMSwgMCwgMCwgMCkKICAgICAgICAgICAgICAgIFZhbHVlLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICBWYWx1ZS5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuUmlnaHQKICAgICAgICAgICAgICAgIFZhbHVlLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIFZhbHVlLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgICAgICBWYWx1ZS5UZXh0U2l6ZSA9IDEwCiAgICAgICAgICAgICAgICBWYWx1ZS5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIFZhbHVlLlBhcmVudCA9IFNsaWRlcgoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIFNsaWRlck1hbmFnZXI6c2V0X3BlcmNlbnRhZ2UocGVyY2VudGFnZTogbnVtYmVyKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHJvdW5kZWRfbnVtYmVyID0gMAoKICAgICAgICAgICAgICAgICAgICBpZiBzZXR0aW5ncy5yb3VuZF9udW1iZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByb3VuZGVkX251bWJlciA9IG1hdGguZmxvb3IocGVyY2VudGFnZSkKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHJvdW5kZWRfbnVtYmVyID0gbWF0aC5mbG9vcihwZXJjZW50YWdlICogMTApIC8gMTAKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgcGVyY2VudGFnZSA9IChwZXJjZW50YWdlIC0gc2V0dGluZ3MubWluaW11bV92YWx1ZSkgLyAoc2V0dGluZ3MubWF4aW11bV92YWx1ZSAtIHNldHRpbmdzLm1pbmltdW1fdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc2xpZGVyX3NpemUgPSBtYXRoLmNsYW1wKHBlcmNlbnRhZ2UsIDAuMDIsIDEpICogRHJhZy5TaXplLlguT2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgbnVtYmVyX3RocmVzaG9sZCA9IG1hdGguY2xhbXAocm91bmRlZF9udW1iZXIsIHNldHRpbmdzLm1pbmltdW1fdmFsdWUsIHNldHRpbmdzLm1heGltdW1fdmFsdWUpCiAgICAKICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddID0gbnVtYmVyX3RocmVzaG9sZAogICAgICAgICAgICAgICAgICAgIFZhbHVlLlRleHQgPSBudW1iZXJfdGhyZXNob2xkCiAgICAKICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKEZpbGwsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMi5mcm9tT2Zmc2V0KHNsaWRlcl9zaXplLCBEcmFnLlNpemUuWS5PZmZzZXQpCiAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCiAgICAKICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYWxsYmFjayhudW1iZXJfdGhyZXNob2xkKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgZnVuY3Rpb24gU2xpZGVyTWFuYWdlcjp1cGRhdGUoKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIG1vdXNlX3Bvc2l0aW9uID0gKG1vdXNlLlggLSBEcmFnLkFic29sdXRlUG9zaXRpb24uWCkgLyBEcmFnLlNpemUuWC5PZmZzZXQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBwZXJjZW50YWdlID0gc2V0dGluZ3MubWluaW11bV92YWx1ZSArIChzZXR0aW5ncy5tYXhpbXVtX3ZhbHVlIC0gc2V0dGluZ3MubWluaW11bV92YWx1ZSkgKiBtb3VzZV9wb3NpdGlvbgoKICAgICAgICAgICAgICAgICAgICBzZWxmOnNldF9wZXJjZW50YWdlKHBlcmNlbnRhZ2UpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBTbGlkZXJNYW5hZ2VyOmlucHV0KCkKICAgICAgICAgICAgICAgICAgICBTbGlkZXJNYW5hZ2VyOnVwZGF0ZSgpCiAgICAKICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc1snc2xpZGVyX2RyYWdfJy4uc2V0dGluZ3MuZmxhZ10gPSBtb3VzZS5Nb3ZlOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBTbGlkZXJNYW5hZ2VyOnVwZGF0ZSgpCiAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zWydzbGlkZXJfaW5wdXRfJy4uc2V0dGluZ3MuZmxhZ10gPSBVc2VySW5wdXRTZXJ2aWNlLklucHV0RW5kZWQ6Q29ubmVjdChmdW5jdGlvbihpbnB1dDogSW5wdXRPYmplY3QsIHByb2Nlc3M6IGJvb2xlYW4pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlucHV0LlVzZXJJbnB1dFR5cGUgfj0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMSBhbmQgaW5wdXQuVXNlcklucHV0VHlwZSB+PSBFbnVtLlVzZXJJbnB1dFR5cGUuVG91Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zOmRpc2Nvbm5lY3QoJ3NsaWRlcl9kcmFnXycuLnNldHRpbmdzLmZsYWcpCiAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zOmRpc2Nvbm5lY3QoJ3NsaWRlcl9pbnB1dF8nLi5zZXR0aW5ncy5mbGFnKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNldHRpbmdzLmlnbm9yZXNhdmVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZzpzYXZlKGdhbWUuR2FtZUlkLCBMaWJyYXJ5Ll9jb25maWcpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgZW5kCgoKICAgICAgICAgICAgICAgIGlmIExpYnJhcnk6ZmxhZ190eXBlKHNldHRpbmdzLmZsYWcsICdudW1iZXInKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNldHRpbmdzLmlnbm9yZXNhdmVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgU2xpZGVyTWFuYWdlcjpzZXRfcGVyY2VudGFnZShMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddKTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIFNsaWRlck1hbmFnZXI6c2V0X3BlcmNlbnRhZ2Uoc2V0dGluZ3MudmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBTbGlkZXJNYW5hZ2VyOnNldF9wZXJjZW50YWdlKHNldHRpbmdzLnZhbHVlKTsKICAgICAgICAgICAgICAgIGVuZDsKICAgIAogICAgICAgICAgICAgICAgU2xpZGVyLk1vdXNlQnV0dG9uMURvd246Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgU2xpZGVyTWFuYWdlcjppbnB1dCgpCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgcmV0dXJuIFNsaWRlck1hbmFnZXIKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBmdW5jdGlvbiBNb2R1bGVNYW5hZ2VyOmNyZWF0ZV9kcm9wZG93bihzZXR0aW5nczogYW55KQoKICAgICAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy5PcmRlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgTGF5b3V0T3JkZXJNb2R1bGUgPSBMYXlvdXRPcmRlck1vZHVsZSArIDE7CiAgICAgICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICAgICAgbG9jYWwgRHJvcGRvd25NYW5hZ2VyID0gewogICAgICAgICAgICAgICAgICAgIF9zdGF0ZSA9IGZhbHNlLAogICAgICAgICAgICAgICAgICAgIF9zaXplID0gMAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy5PcmRlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5fc2l6ZSA9PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2l6ZSA9IDExCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NpemUgKz0gNDQKICAgICAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MuT3JkZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIE1vZHVsZU1hbmFnZXIuX3N0YXRlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlLlNpemUgPSBVRGltMi5mcm9tT2Zmc2V0KDI0MSwgOTMgKyBzZWxmLl9zaXplKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIE9wdGlvbnMuU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjQxLCBzZWxmLl9zaXplKQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgbG9jYWwgRHJvcGRvd24gPSBJbnN0YW5jZS5uZXcoJ1RleHRCdXR0b24nKQogICAgICAgICAgICAgICAgRHJvcGRvd24uRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Tb3VyY2VTYW5zUHJvLmpzb24nLCBFbnVtLkZvbnRXZWlnaHQuUmVndWxhciwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgRHJvcGRvd24uVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgICAgICBEcm9wZG93bi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgICAgICAgICAgRHJvcGRvd24uVGV4dCA9ICcnCiAgICAgICAgICAgICAgICBEcm9wZG93bi5BdXRvQnV0dG9uQ29sb3IgPSBmYWxzZQogICAgICAgICAgICAgICAgRHJvcGRvd24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIERyb3Bkb3duLk5hbWUgPSAnRHJvcGRvd24nCiAgICAgICAgICAgICAgICBEcm9wZG93bi5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgMzkpCiAgICAgICAgICAgICAgICBEcm9wZG93bi5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgICAgICBEcm9wZG93bi5UZXh0U2l6ZSA9IDE0CiAgICAgICAgICAgICAgICBEcm9wZG93bi5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgICAgICAgICAgICAgIERyb3Bkb3duLlBhcmVudCA9IE9wdGlvbnMKCiAgICAgICAgICAgICAgICBpZiBub3Qgc2V0dGluZ3MuT3JkZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIERyb3Bkb3duLkxheW91dE9yZGVyID0gTGF5b3V0T3JkZXJNb2R1bGU7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgRHJvcGRvd24uTGF5b3V0T3JkZXIgPSBzZXR0aW5ncy5PcmRlclZhbHVlOwogICAgICAgICAgICAgICAgZW5kOwoKICAgICAgICAgICAgICAgIGlmIG5vdCBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddIHRoZW4KICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddID0ge307CiAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFRleHRMYWJlbCA9IEluc3RhbmNlLm5ldygnVGV4dExhYmVsJykKICAgICAgICAgICAgICAgIGlmIEdHLlNlbGVjdGVkTGFuZ3VhZ2UgPT0gInRoIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgVGV4dExhYmVsLkZvbnRGYWNlID0gRm9udC5uZXcoInJieGFzc2V0Oi8vZm9udHMvZmFtaWxpZXMvTm90b1NhbnNUaGFpLmpzb24iLCBFbnVtLkZvbnRXZWlnaHQuU2VtaUJvbGQsIEVudW0uRm9udFN0eWxlLk5vcm1hbCkKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dFNpemUgPSAxMzsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKTsKICAgICAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVGV4dFNpemUgPSAxMTsKICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0Q29sb3IzID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIFRleHRMYWJlbC5UZXh0VHJhbnNwYXJlbmN5ID0gMC4yMDAwMDAwMDI5ODAyMzIyNAogICAgICAgICAgICAgICAgVGV4dExhYmVsLlRleHQgPSBzZXR0aW5ncy50aXRsZQogICAgICAgICAgICAgICAgVGV4dExhYmVsLlNpemUgPSBVRGltMi5uZXcoMCwgMjA3LCAwLCAxMykKICAgICAgICAgICAgICAgIFRleHRMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgVGV4dExhYmVsLlRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0CiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgVGV4dExhYmVsLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuUGFyZW50ID0gRHJvcGRvd24KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgQm94ID0gSW5zdGFuY2UubmV3KCdGcmFtZScpCiAgICAgICAgICAgICAgICBCb3guQ2xpcHNEZXNjZW5kYW50cyA9IHRydWUKICAgICAgICAgICAgICAgIEJveC5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgICAgICAgICAgQm94LkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAwKQogICAgICAgICAgICAgICAgQm94LkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjg5OTk5OTk3NjE1ODE0MjEKICAgICAgICAgICAgICAgIEJveC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjUsIDAsIDEuMjAwMDAwMDQ3NjgzNzE1OCwgMCkKICAgICAgICAgICAgICAgIEJveC5OYW1lID0gJ0JveCcKICAgICAgICAgICAgICAgIEJveC5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgMjIpCiAgICAgICAgICAgICAgICBCb3guQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgQm94LkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxNTIsIDE4MSwgMjU1KQogICAgICAgICAgICAgICAgQm94LlBhcmVudCA9IFRleHRMYWJlbAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBVSUNvcm5lciA9IEluc3RhbmNlLm5ldygnVUlDb3JuZXInKQogICAgICAgICAgICAgICAgVUlDb3JuZXIuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgNCkKICAgICAgICAgICAgICAgIFVJQ29ybmVyLlBhcmVudCA9IEJveAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBIZWFkZXIgPSBJbnN0YW5jZS5uZXcoJ0ZyYW1lJykKICAgICAgICAgICAgICAgIEhlYWRlci5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgICAgICAgICAgSGVhZGVyLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAwKQogICAgICAgICAgICAgICAgSGVhZGVyLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICBIZWFkZXIuUG9zaXRpb24gPSBVRGltMi5uZXcoMC41LCAwLCAwLCAwKQogICAgICAgICAgICAgICAgSGVhZGVyLk5hbWUgPSAnSGVhZGVyJwogICAgICAgICAgICAgICAgSGVhZGVyLlNpemUgPSBVRGltMi5uZXcoMCwgMjA3LCAwLCAyMikKICAgICAgICAgICAgICAgIEhlYWRlci5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgICAgICBIZWFkZXIuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICBIZWFkZXIuUGFyZW50ID0gQm94CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIEN1cnJlbnRPcHRpb24gPSBJbnN0YW5jZS5uZXcoJ1RleHRMYWJlbCcpCiAgICAgICAgICAgICAgICBDdXJyZW50T3B0aW9uLkZvbnRGYWNlID0gRm9udC5uZXcoJ3JieGFzc2V0Oi8vZm9udHMvZmFtaWxpZXMvR290aGFtU1NtLmpzb24nLCBFbnVtLkZvbnRXZWlnaHQuU2VtaUJvbGQsIEVudW0uRm9udFN0eWxlLk5vcm1hbCkKICAgICAgICAgICAgICAgIEN1cnJlbnRPcHRpb24uVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICBDdXJyZW50T3B0aW9uLlRleHRUcmFuc3BhcmVuY3kgPSAwLjIwMDAwMDAwMjk4MDIzMjI0CiAgICAgICAgICAgICAgICBDdXJyZW50T3B0aW9uLk5hbWUgPSAnQ3VycmVudE9wdGlvbicKICAgICAgICAgICAgICAgIEN1cnJlbnRPcHRpb24uU2l6ZSA9IFVEaW0yLm5ldygwLCAxNjEsIDAsIDEzKQogICAgICAgICAgICAgICAgQ3VycmVudE9wdGlvbi5BbmNob3JQb2ludCA9IFZlY3RvcjIubmV3KDAsIDAuNSkKICAgICAgICAgICAgICAgIEN1cnJlbnRPcHRpb24uUG9zaXRpb24gPSBVRGltMi5uZXcoMC4wNDk5OTk4ODE1MzU3Njg1MSwgMCwgMC41LCAwKQogICAgICAgICAgICAgICAgQ3VycmVudE9wdGlvbi5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgQ3VycmVudE9wdGlvbi5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgICAgICAgICAgICAgQ3VycmVudE9wdGlvbi5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgICAgICBDdXJyZW50T3B0aW9uLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgICAgICBDdXJyZW50T3B0aW9uLlRleHRTaXplID0gMTAKICAgICAgICAgICAgICAgIEN1cnJlbnRPcHRpb24uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICBDdXJyZW50T3B0aW9uLlBhcmVudCA9IEhlYWRlcgogICAgICAgICAgICAgICAgbG9jYWwgVUlHcmFkaWVudCA9IEluc3RhbmNlLm5ldygnVUlHcmFkaWVudCcpCiAgICAgICAgICAgICAgICBVSUdyYWRpZW50LlRyYW5zcGFyZW5jeSA9IE51bWJlclNlcXVlbmNlLm5ld3sKICAgICAgICAgICAgICAgICAgICBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCAwKSwKICAgICAgICAgICAgICAgICAgICBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygwLjcwNCwgMCksCiAgICAgICAgICAgICAgICAgICAgTnVtYmVyU2VxdWVuY2VLZXlwb2ludC5uZXcoMC44NzIsIDAuMzYyNTAwMDExOTIwOTI4OTYpLAogICAgICAgICAgICAgICAgICAgIE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDEsIDEpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBVSUdyYWRpZW50LlBhcmVudCA9IEN1cnJlbnRPcHRpb24KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgQXJyb3cgPSBJbnN0YW5jZS5uZXcoJ0ltYWdlTGFiZWwnKQogICAgICAgICAgICAgICAgQXJyb3cuQm9yZGVyQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkKICAgICAgICAgICAgICAgIEFycm93LkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgMC41KQogICAgICAgICAgICAgICAgQXJyb3cuSW1hZ2UgPSAncmJ4YXNzZXRpZDovLzg0MjMyNDUzMTg5MzI0JwogICAgICAgICAgICAgICAgQXJyb3cuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIEFycm93LlBvc2l0aW9uID0gVURpbTIubmV3KDAuOTEwMDAwMDI2MjI2MDQzNywgMCwgMC41LCAwKQogICAgICAgICAgICAgICAgQXJyb3cuTmFtZSA9ICdBcnJvdycKICAgICAgICAgICAgICAgIEFycm93LlNpemUgPSBVRGltMi5uZXcoMCwgOCwgMCwgOCkKICAgICAgICAgICAgICAgIEFycm93LkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIEFycm93LkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgQXJyb3cuUGFyZW50ID0gSGVhZGVyCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIE9wdGlvbnMgPSBJbnN0YW5jZS5uZXcoJ1Njcm9sbGluZ0ZyYW1lJykKICAgICAgICAgICAgICAgIE9wdGlvbnMuU2Nyb2xsQmFySW1hZ2VDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgICAgICAgICAgT3B0aW9ucy5BY3RpdmUgPSB0cnVlCiAgICAgICAgICAgICAgICBPcHRpb25zLlNjcm9sbEJhckltYWdlVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgT3B0aW9ucy5BdXRvbWF0aWNDYW52YXNTaXplID0gRW51bS5BdXRvbWF0aWNTaXplLlhZCiAgICAgICAgICAgICAgICBPcHRpb25zLlNjcm9sbEJhclRoaWNrbmVzcyA9IDAKICAgICAgICAgICAgICAgIE9wdGlvbnMuTmFtZSA9ICdPcHRpb25zJwogICAgICAgICAgICAgICAgT3B0aW9ucy5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgMCkKICAgICAgICAgICAgICAgIE9wdGlvbnMuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgIE9wdGlvbnMuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMCwgMSwgMCkKICAgICAgICAgICAgICAgIE9wdGlvbnMuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICBPcHRpb25zLkJvcmRlckNvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApCiAgICAgICAgICAgICAgICBPcHRpb25zLkJvcmRlclNpemVQaXhlbCA9IDAKICAgICAgICAgICAgICAgIE9wdGlvbnMuQ2FudmFzU2l6ZSA9IFVEaW0yLm5ldygwLCAwLCAwLjUsIDApCiAgICAgICAgICAgICAgICBPcHRpb25zLlBhcmVudCA9IEJveAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBVSUxpc3RMYXlvdXQgPSBJbnN0YW5jZS5uZXcoJ1VJTGlzdExheW91dCcpCiAgICAgICAgICAgICAgICBVSUxpc3RMYXlvdXQuU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgIFVJTGlzdExheW91dC5QYXJlbnQgPSBPcHRpb25zCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFVJUGFkZGluZyA9IEluc3RhbmNlLm5ldygnVUlQYWRkaW5nJykKICAgICAgICAgICAgICAgIFVJUGFkZGluZy5QYWRkaW5nVG9wID0gVURpbS5uZXcoMCwgLTEpCiAgICAgICAgICAgICAgICBVSVBhZGRpbmcuUGFkZGluZ0xlZnQgPSBVRGltLm5ldygwLCAxMCkKICAgICAgICAgICAgICAgIFVJUGFkZGluZy5QYXJlbnQgPSBPcHRpb25zCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFVJTGlzdExheW91dCA9IEluc3RhbmNlLm5ldygnVUlMaXN0TGF5b3V0JykKICAgICAgICAgICAgICAgIFVJTGlzdExheW91dC5Tb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICAgICAgVUlMaXN0TGF5b3V0LlBhcmVudCA9IEJveAoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIERyb3Bkb3duTWFuYWdlcjp1cGRhdGUob3B0aW9uOiBzdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgLS0gSWYgbXVsdGktZHJvcGRvd24gaXMgZW5hYmxlZAogICAgICAgICAgICAgICAgICAgIGlmIHNldHRpbmdzLm11bHRpX2Ryb3Bkb3duIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgLS0gU3BsaXQgdGhlIEN1cnJlbnRPcHRpb24uVGV4dCBieSBjb21tYXMgaW50byBhIHRhYmxlCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEN1cnJlbnRUYXJnZXRWYWx1ZSA9IG5pbDsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICNMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddID4gMCB0aGVuCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudFRhcmdldFZhbHVlID0gY29udmVydFRhYmxlVG9TdHJpbmcoTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSk7CgogICAgICAgICAgICAgICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBzZWxlY3RlZCA9IHt9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiBDdXJyZW50VGFyZ2V0VmFsdWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHZhbHVlIGluIHN0cmluZy5nbWF0Y2goQ3VycmVudFRhcmdldFZhbHVlLCAiKFteLF0rKSIpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gVHJpbSBzcGFjZXMgYXJvdW5kIHRoZSBvcHRpb24gdXNpbmcgc3RyaW5nLm1hdGNoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdHJpbW1lZFZhbHVlID0gdmFsdWU6bWF0Y2goIl4lcyooLi0pJXMqJCIpICAtLSBUcmltIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHNwYWNlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIEV4Y2x1ZGUgYW55IHVud2FudGVkIGxhYmVscyAoZS5nLiAiTGFiZWwiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRyaW1tZWRWYWx1ZSB+PSAiTGFiZWwiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHNlbGVjdGVkLCB0cmltbWVkVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHZhbHVlIGluIHN0cmluZy5nbWF0Y2goQ3VycmVudE9wdGlvbi5UZXh0LCAiKFteLF0rKSIpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0gVHJpbSBzcGFjZXMgYXJvdW5kIHRoZSBvcHRpb24gdXNpbmcgc3RyaW5nLm1hdGNoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdHJpbW1lZFZhbHVlID0gdmFsdWU6bWF0Y2goIl4lcyooLi0pJXMqJCIpICAtLSBUcmltIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHNwYWNlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIEV4Y2x1ZGUgYW55IHVud2FudGVkIGxhYmVscyAoZS5nLiAiTGFiZWwiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRyaW1tZWRWYWx1ZSB+PSAiTGFiZWwiIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHNlbGVjdGVkLCB0cmltbWVkVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEN1cnJlbnRUZXh0R2V0ID0gY29udmVydFN0cmluZ1RvVGFibGUoQ3VycmVudE9wdGlvbi5UZXh0KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvblNraWJpZGkgPSAibmlsIjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHlwZW9mKG9wdGlvbikgfj0gJ3N0cmluZycgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uU2tpYmlkaSA9IG9wdGlvbi5OYW1lOwogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25Ta2liaWRpID0gb3B0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBmb3VuZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLCB2IGluIHBhaXJzKEN1cnJlbnRUZXh0R2V0KSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdiA9PSBvcHRpb25Ta2liaWRpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5yZW1vdmUoQ3VycmVudFRleHRHZXQsIGkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudE9wdGlvbi5UZXh0ID0gdGFibGUuY29uY2F0KHNlbGVjdGVkLCAiLCAiKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBPcHRpb25zQ2hpbGQgPSB7fQogICAgICAgICAgICAgICAgICAgICAgICAtLSBVcGRhdGUgdGhlIHRyYW5zcGFyZW50IGVmZmVjdCBvZiBlYWNoIG9wdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgb2JqZWN0IGluIE9wdGlvbnM6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb2JqZWN0Lk5hbWUgPT0gIk9wdGlvbiIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChPcHRpb25zQ2hpbGQsIG9iamVjdC5UZXh0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRhYmxlLmZpbmQoc2VsZWN0ZWQsIG9iamVjdC5UZXh0KSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5UZXh0VHJhbnNwYXJlbmN5ID0gMC4yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3QuVGV4dFRyYW5zcGFyZW5jeSA9IDAuNgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudFRhcmdldFZhbHVlID0gY29udmVydFN0cmluZ1RvVGFibGUoQ3VycmVudE9wdGlvbi5UZXh0KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIEN1cnJlbnRUYXJnZXRWYWx1ZSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHRhYmxlLmZpbmQoT3B0aW9uc0NoaWxkLCB2KSBhbmQgdGFibGUuZmluZChzZWxlY3RlZCwgdikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLnJlbW92ZShzZWxlY3RlZCwgXykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZDsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kOwoKICAgICAgICAgICAgICAgICAgICAgICAgQ3VycmVudE9wdGlvbi5UZXh0ID0gdGFibGUuY29uY2F0KHNlbGVjdGVkLCAiLCAiKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddID0gY29udmVydFN0cmluZ1RvVGFibGUoQ3VycmVudE9wdGlvbi5UZXh0KTsKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIC0tIEZvciBzaW5nbGUgZHJvcGRvd24sIGp1c3Qgc2V0IHRoZSBDdXJyZW50T3B0aW9uLlRleHQgdG8gdGhlIHNlbGVjdGVkIG9wdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50T3B0aW9uLlRleHQgPSAodHlwZW9mKG9wdGlvbikgPT0gInN0cmluZyIgYW5kIG9wdGlvbikgb3Igb3B0aW9uLk5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIG9iamVjdCBpbiBPcHRpb25zOkdldENoaWxkcmVuKCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9iamVjdC5OYW1lID09ICJPcHRpb24iIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLSBPbmx5IHVwZGF0ZSB0cmFuc3BhcmVuY3kgZm9yIGFjdHVhbCBvcHRpb24gdGV4dCBidXR0b25zCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb2JqZWN0LlRleHQgPT0gQ3VycmVudE9wdGlvbi5UZXh0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0LlRleHRUcmFuc3BhcmVuY3kgPSAwLjIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdC5UZXh0VHJhbnNwYXJlbmN5ID0gMC42CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIExpYnJhcnkuX2NvbmZpZy5fZmxhZ3Nbc2V0dGluZ3MuZmxhZ10gPSBvcHRpb24KICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC0tIFNhdmUgdGhlIGNvbmZpZ3VyYXRpb24gc3RhdGUKICAgICAgICAgICAgICAgICAgICBDb25maWc6c2F2ZShnYW1lLkdhbWVJZCwgTGlicmFyeS5fY29uZmlnKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLS0gQ2FsbGJhY2sgd2l0aCB0aGUgdXBkYXRlZCBvcHRpb24ocykKICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYWxsYmFjayhvcHRpb24pCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgQ3VycmVudERyb3BTaXplU3RhdGUgPSAwOwoKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIERyb3Bkb3duTWFuYWdlcjp1bmZvbGRfc2V0dGluZ3MoKQogICAgICAgICAgICAgICAgICAgIHNlbGYuX3N0YXRlID0gbm90IHNlbGYuX3N0YXRlCgogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuX3N0YXRlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgTW9kdWxlTWFuYWdlci5fbXVsdGlwbGllciArPSBzZWxmLl9zaXplCgogICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50RHJvcFNpemVTdGF0ZSA9IHNlbGYuX3NpemU7CgogICAgICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKE1vZHVsZSwgVHdlZW5JbmZvLm5ldygwLjUsIEVudW0uRWFzaW5nU3R5bGUuUXVpbnQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCksIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPSBVRGltMi5mcm9tT2Zmc2V0KDI0MSwgOTMgKyBNb2R1bGVNYW5hZ2VyLl9zaXplICsgTW9kdWxlTWFuYWdlci5fbXVsdGlwbGllcikKICAgICAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKE1vZHVsZS5PcHRpb25zLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjQxLCBNb2R1bGVNYW5hZ2VyLl9zaXplICsgTW9kdWxlTWFuYWdlci5fbXVsdGlwbGllcikKICAgICAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKERyb3Bkb3duLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjA3LCAzOSArIHNlbGYuX3NpemUpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQoKICAgICAgICAgICAgICAgICAgICAgICAgVHdlZW5TZXJ2aWNlOkNyZWF0ZShCb3gsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldCgyMDcsIDIyICsgc2VsZi5fc2l6ZSkKICAgICAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKEFycm93LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUm90YXRpb24gPSAxODAKICAgICAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBNb2R1bGVNYW5hZ2VyLl9tdWx0aXBsaWVyIC09IHNlbGYuX3NpemUKCiAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnREcm9wU2l6ZVN0YXRlID0gMDsKCiAgICAgICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoTW9kdWxlLCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjQxLCA5MyArIE1vZHVsZU1hbmFnZXIuX3NpemUgKyBNb2R1bGVNYW5hZ2VyLl9tdWx0aXBsaWVyKQogICAgICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKCiAgICAgICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoTW9kdWxlLk9wdGlvbnMsIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIE1vZHVsZU1hbmFnZXIuX3NpemUgKyBNb2R1bGVNYW5hZ2VyLl9tdWx0aXBsaWVyKQogICAgICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKCiAgICAgICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoRHJvcGRvd24sIFR3ZWVuSW5mby5uZXcoMC41LCBFbnVtLkVhc2luZ1N0eWxlLlF1aW50LCBFbnVtLkVhc2luZ0RpcmVjdGlvbi5PdXQpLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTaXplID0gVURpbTIuZnJvbU9mZnNldCgyMDcsIDM5KQogICAgICAgICAgICAgICAgICAgICAgICB9KTpQbGF5KCkKCiAgICAgICAgICAgICAgICAgICAgICAgIFR3ZWVuU2VydmljZTpDcmVhdGUoQm94LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjA3LCAyMikKICAgICAgICAgICAgICAgICAgICAgICAgfSk6UGxheSgpCgogICAgICAgICAgICAgICAgICAgICAgICBUd2VlblNlcnZpY2U6Q3JlYXRlKEFycm93LCBUd2VlbkluZm8ubmV3KDAuNSwgRW51bS5FYXNpbmdTdHlsZS5RdWludCwgRW51bS5FYXNpbmdEaXJlY3Rpb24uT3V0KSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgUm90YXRpb24gPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOlBsYXkoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgI3NldHRpbmdzLm9wdGlvbnMgPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBEcm9wZG93bk1hbmFnZXIuX3NpemUgPSAzCgogICAgICAgICAgICAgICAgICAgIGZvciBpbmRleCwgdmFsdWUgaW4gc2V0dGluZ3Mub3B0aW9ucyBkbwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBPcHRpb24gPSBJbnN0YW5jZS5uZXcoJ1RleHRCdXR0b24nKQogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKQogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uQWN0aXZlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uLlRleHRUcmFuc3BhcmVuY3kgPSAwLjYwMDAwMDAyMzg0MTg1NzkKICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMCwgMC41KQogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uVGV4dFNpemUgPSAxMAogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uU2l6ZSA9IFVEaW0yLm5ldygwLCAxODYsIDAsIDE2KQogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbi5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLCAwLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uVGV4dCA9ICh0eXBlb2YodmFsdWUpID09ICJzdHJpbmciIGFuZCB2YWx1ZSkgb3IgdmFsdWUuTmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uLkF1dG9CdXR0b25Db2xvciA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbi5OYW1lID0gJ09wdGlvbicKICAgICAgICAgICAgICAgICAgICAgICAgT3B0aW9uLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbi5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uU2VsZWN0YWJsZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbi5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLjA0OTk5OTg4MTUzNTc2ODUxLCAwLCAwLjM0MjEwNTI2OTQzMjA2Nzg3LCAwKQogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgICAgICAgICBPcHRpb24uQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbi5QYXJlbnQgPSBPcHRpb25zCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBVSUdyYWRpZW50ID0gSW5zdGFuY2UubmV3KCdVSUdyYWRpZW50JykKICAgICAgICAgICAgICAgICAgICAgICAgVUlHcmFkaWVudC5UcmFuc3BhcmVuY3kgPSBOdW1iZXJTZXF1ZW5jZS5uZXd7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDAuNzA0LCAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDAuODcyLCAwLjM2MjUwMDAxMTkyMDkyODk2KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDEsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgVUlHcmFkaWVudC5QYXJlbnQgPSBPcHRpb24KCiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbi5Nb3VzZUJ1dHRvbjFDbGljazpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddID0ge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2V0dGluZ3MubXVsdGlfZHJvcGRvd24gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRhYmxlLmZpbmQoTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSwgdmFsdWUpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeTpyZW1vdmVfdGFibGVfdmFsdWUoTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSwgdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSwgdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEcm9wZG93bk1hbmFnZXI6dXBkYXRlKHZhbHVlKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaW5kZXggPiBzZXR0aW5ncy5tYXhpbXVtX29wdGlvbnMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgRHJvcGRvd25NYW5hZ2VyLl9zaXplICs9IDE2CiAgICAgICAgICAgICAgICAgICAgICAgIE9wdGlvbnMuU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoMjA3LCBEcm9wZG93bk1hbmFnZXIuX3NpemUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBEcm9wZG93bk1hbmFnZXI6TmV3KHZhbHVlKQogICAgICAgICAgICAgICAgICAgIERyb3Bkb3duOkRlc3Ryb3kodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgdmFsdWUuT3JkZXJWYWx1ZSA9IERyb3Bkb3duLkxheW91dE9yZGVyCiAgICAgICAgICAgICAgICAgICAgTW9kdWxlTWFuYWdlci5fbXVsdGlwbGllciAtPSBDdXJyZW50RHJvcFNpemVTdGF0ZQogICAgICAgICAgICAgICAgICAgIHJldHVybiBNb2R1bGVNYW5hZ2VyOmNyZWF0ZV9kcm9wZG93bih2YWx1ZSkKICAgICAgICAgICAgICAgIGVuZDsKCiAgICAgICAgICAgICAgICBpZiBMaWJyYXJ5OmZsYWdfdHlwZShzZXR0aW5ncy5mbGFnLCAnc3RyaW5nJykgdGhlbgogICAgICAgICAgICAgICAgICAgIERyb3Bkb3duTWFuYWdlcjp1cGRhdGUoTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBEcm9wZG93bk1hbmFnZXI6dXBkYXRlKHNldHRpbmdzLm9wdGlvbnNbMV0pCiAgICAgICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICAgICAgRHJvcGRvd24uTW91c2VCdXR0b24xQ2xpY2s6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgRHJvcGRvd25NYW5hZ2VyOnVuZm9sZF9zZXR0aW5ncygpCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgcmV0dXJuIERyb3Bkb3duTWFuYWdlcgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGZ1bmN0aW9uIE1vZHVsZU1hbmFnZXI6Y3JlYXRlX2ZlYXR1cmUoc2V0dGluZ3MpCgogICAgICAgICAgICAgICAgbG9jYWwgY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBMYXlvdXRPcmRlck1vZHVsZSA9IExheW91dE9yZGVyTW9kdWxlICsgMQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNlbGYuX3NpemUgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2l6ZSA9IDExCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLl9zaXplICs9IDIwCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgTW9kdWxlTWFuYWdlci5fc3RhdGUgdGhlbgogICAgICAgICAgICAgICAgICAgIE1vZHVsZS5TaXplID0gVURpbTIuZnJvbU9mZnNldCgyNDEsIDkzICsgc2VsZi5fc2l6ZSk7CiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBPcHRpb25zLlNpemUgPSBVRGltMi5mcm9tT2Zmc2V0KDI0MSwgc2VsZi5fc2l6ZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgRmVhdHVyZUNvbnRhaW5lciA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgICAgICAgICAgICAgRmVhdHVyZUNvbnRhaW5lci5TaXplID0gVURpbTIubmV3KDAsIDIwNywgMCwgMTYpCiAgICAgICAgICAgICAgICBGZWF0dXJlQ29udGFpbmVyLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICBGZWF0dXJlQ29udGFpbmVyLlBhcmVudCA9IE9wdGlvbnMKICAgICAgICAgICAgICAgIEZlYXR1cmVDb250YWluZXIuTGF5b3V0T3JkZXIgPSBMYXlvdXRPcmRlck1vZHVsZQogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFVJTGlzdExheW91dCA9IEluc3RhbmNlLm5ldygiVUlMaXN0TGF5b3V0IikKICAgICAgICAgICAgICAgIFVJTGlzdExheW91dC5GaWxsRGlyZWN0aW9uID0gRW51bS5GaWxsRGlyZWN0aW9uLkhvcml6b250YWwKICAgICAgICAgICAgICAgIFVJTGlzdExheW91dC5Tb3J0T3JkZXIgPSBFbnVtLlNvcnRPcmRlci5MYXlvdXRPcmRlcgogICAgICAgICAgICAgICAgVUlMaXN0TGF5b3V0LlBhcmVudCA9IEZlYXR1cmVDb250YWluZXIKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBGZWF0dXJlQnV0dG9uID0gSW5zdGFuY2UubmV3KCJUZXh0QnV0dG9uIikKICAgICAgICAgICAgICAgIEZlYXR1cmVCdXR0b24uRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKTsKICAgICAgICAgICAgICAgIEZlYXR1cmVCdXR0b24uVGV4dFNpemUgPSAxMTsKICAgICAgICAgICAgICAgIEZlYXR1cmVCdXR0b24uU2l6ZSA9IFVEaW0yLm5ldygxLCAtMzUsIDAsIDE2KQogICAgICAgICAgICAgICAgRmVhdHVyZUJ1dHRvbi5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMzIsIDM4LCA1MSkKICAgICAgICAgICAgICAgIEZlYXR1cmVCdXR0b24uVGV4dENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDIxMCwgMjEwLCAyMTApCiAgICAgICAgICAgICAgICBGZWF0dXJlQnV0dG9uLlRleHQgPSAiICAgICIgLi4gc2V0dGluZ3MudGl0bGUgb3IgIiAgICAiIC4uICJGZWF0dXJlIgogICAgICAgICAgICAgICAgRmVhdHVyZUJ1dHRvbi5BdXRvQnV0dG9uQ29sb3IgPSBmYWxzZQogICAgICAgICAgICAgICAgRmVhdHVyZUJ1dHRvbi5UZXh0WEFsaWdubWVudCA9IEVudW0uVGV4dFhBbGlnbm1lbnQuTGVmdAogICAgICAgICAgICAgICAgRmVhdHVyZUJ1dHRvbi5UZXh0VHJhbnNwYXJlbmN5ID0gMC4yCiAgICAgICAgICAgICAgICBGZWF0dXJlQnV0dG9uLlBhcmVudCA9IEZlYXR1cmVDb250YWluZXIKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBSaWdodENvbnRhaW5lciA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgICAgICAgICAgICAgUmlnaHRDb250YWluZXIuU2l6ZSA9IFVEaW0yLm5ldygwLCA0NSwgMCwgMTYpCiAgICAgICAgICAgICAgICBSaWdodENvbnRhaW5lci5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgUmlnaHRDb250YWluZXIuUGFyZW50ID0gRmVhdHVyZUNvbnRhaW5lcgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIFJpZ2h0TGF5b3V0ID0gSW5zdGFuY2UubmV3KCJVSUxpc3RMYXlvdXQiKQogICAgICAgICAgICAgICAgUmlnaHRMYXlvdXQuUGFkZGluZyA9IFVEaW0ubmV3KDAuMSwgMCkKICAgICAgICAgICAgICAgIFJpZ2h0TGF5b3V0LkZpbGxEaXJlY3Rpb24gPSBFbnVtLkZpbGxEaXJlY3Rpb24uSG9yaXpvbnRhbAogICAgICAgICAgICAgICAgUmlnaHRMYXlvdXQuSG9yaXpvbnRhbEFsaWdubWVudCA9IEVudW0uSG9yaXpvbnRhbEFsaWdubWVudC5SaWdodAogICAgICAgICAgICAgICAgUmlnaHRMYXlvdXQuU29ydE9yZGVyID0gRW51bS5Tb3J0T3JkZXIuTGF5b3V0T3JkZXIKICAgICAgICAgICAgICAgIFJpZ2h0TGF5b3V0LlBhcmVudCA9IFJpZ2h0Q29udGFpbmVyCiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgS2V5YmluZEJveCA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikKICAgICAgICAgICAgICAgIEtleWJpbmRCb3guRm9udEZhY2UgPSBGb250Lm5ldygncmJ4YXNzZXQ6Ly9mb250cy9mYW1pbGllcy9Hb3RoYW1TU20uanNvbicsIEVudW0uRm9udFdlaWdodC5TZW1pQm9sZCwgRW51bS5Gb250U3R5bGUuTm9ybWFsKTsgICAgICAgICAgICAgICAgS2V5YmluZEJveC5TaXplID0gVURpbTIubmV3KDAsIDE1LCAwLCAxNSkKICAgICAgICAgICAgICAgIEtleWJpbmRCb3guQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDE1MiwgMTgxLCAyNTUpCiAgICAgICAgICAgICAgICBLZXliaW5kQm94LlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgS2V5YmluZEJveC5UZXh0U2l6ZSA9IDExCiAgICAgICAgICAgICAgICBLZXliaW5kQm94LkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICBLZXliaW5kQm94LkxheW91dE9yZGVyID0gMjsKICAgICAgICAgICAgICAgIEtleWJpbmRCb3guUGFyZW50ID0gUmlnaHRDb250YWluZXIKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBLZXliaW5kQnV0dG9uID0gSW5zdGFuY2UubmV3KCJUZXh0QnV0dG9uIikKICAgICAgICAgICAgICAgIEtleWJpbmRCdXR0b24uU2l6ZSA9IFVEaW0yLm5ldygxLCAwLCAxLCAwKQogICAgICAgICAgICAgICAgS2V5YmluZEJ1dHRvbi5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgS2V5YmluZEJ1dHRvbi5UZXh0VHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgS2V5YmluZEJ1dHRvbi5QYXJlbnQgPSBLZXliaW5kQm94CgogICAgICAgICAgICAgICAgbG9jYWwgQ2hlY2tib3hDb3JuZXIgPSBJbnN0YW5jZS5uZXcoIlVJQ29ybmVyIiwgS2V5YmluZEJveCkKICAgICAgICAgICAgICAgIENoZWNrYm94Q29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDMpCgogICAgICAgICAgICAgICAgbG9jYWwgVUlTdHJva2UgPSBJbnN0YW5jZS5uZXcoIlVJU3Ryb2tlIiwgS2V5YmluZEJveCkKICAgICAgICAgICAgICAgIFVJU3Ryb2tlLkNvbG9yID0gQ29sb3IzLmZyb21SR0IoMTUyLCAxODEsIDI1NSkKICAgICAgICAgICAgICAgIFVJU3Ryb2tlLlRoaWNrbmVzcyA9IDEKICAgICAgICAgICAgICAgIFVJU3Ryb2tlLkFwcGx5U3Ryb2tlTW9kZSA9IEVudW0uQXBwbHlTdHJva2VNb2RlLkJvcmRlcgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzIHRoZW4KICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzID0ge30KICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddIHRoZW4KICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddID0gewogICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIEJJTkQgPSBzZXR0aW5ncy5kZWZhdWx0IG9yICJVbmtub3duIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNoZWNrZWQgPSBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzW3NldHRpbmdzLmZsYWddLmNoZWNrZWQKICAgICAgICAgICAgICAgIEtleWJpbmRCb3guVGV4dCA9IExpYnJhcnkuX2NvbmZpZy5fZmxhZ3Nbc2V0dGluZ3MuZmxhZ10uQklORAoKICAgICAgICAgICAgICAgIGlmIEtleWJpbmRCb3guVGV4dCA9PSAiVW5rbm93biIgdGhlbgogICAgICAgICAgICAgICAgICAgIEtleWJpbmRCb3guVGV4dCA9ICIuLi4iOwogICAgICAgICAgICAgICAgZW5kOwoKICAgICAgICAgICAgICAgIGxvY2FsIFVzZUZfVmFyID0gbmlsOwogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBzZXR0aW5ncy5kaXNhYmxlY2hlY2sgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIENoZWNrYm94ID0gSW5zdGFuY2UubmV3KCJUZXh0QnV0dG9uIikKICAgICAgICAgICAgICAgICAgICBDaGVja2JveC5TaXplID0gVURpbTIubmV3KDAsIDE1LCAwLCAxNSkKICAgICAgICAgICAgICAgICAgICBDaGVja2JveC5CYWNrZ3JvdW5kQ29sb3IzID0gY2hlY2tlZCBhbmQgQ29sb3IzLmZyb21SR0IoMTUyLCAxODEsIDI1NSkgb3IgQ29sb3IzLmZyb21SR0IoMzIsIDM4LCA1MSkKICAgICAgICAgICAgICAgICAgICBDaGVja2JveC5UZXh0ID0gIiIKICAgICAgICAgICAgICAgICAgICBDaGVja2JveC5QYXJlbnQgPSBSaWdodENvbnRhaW5lcgogICAgICAgICAgICAgICAgICAgIENoZWNrYm94LkxheW91dE9yZGVyID0gMTsKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgVUlTdHJva2UgPSBJbnN0YW5jZS5uZXcoIlVJU3Ryb2tlIiwgQ2hlY2tib3gpCiAgICAgICAgICAgICAgICAgICAgVUlTdHJva2UuQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigxNTIsIDE4MSwgMjU1KQogICAgICAgICAgICAgICAgICAgIFVJU3Ryb2tlLlRoaWNrbmVzcyA9IDEKICAgICAgICAgICAgICAgICAgICBVSVN0cm9rZS5BcHBseVN0cm9rZU1vZGUgPSBFbnVtLkFwcGx5U3Ryb2tlTW9kZS5Cb3JkZXIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIENoZWNrYm94Q29ybmVyID0gSW5zdGFuY2UubmV3KCJVSUNvcm5lciIpCiAgICAgICAgICAgICAgICAgICAgQ2hlY2tib3hDb3JuZXIuQ29ybmVyUmFkaXVzID0gVURpbS5uZXcoMCwgMykKICAgICAgICAgICAgICAgICAgICBDaGVja2JveENvcm5lci5QYXJlbnQgPSBDaGVja2JveAogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsb2NhbCBmdW5jdGlvbiB0b2dnbGVTdGF0ZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQgPSBub3QgY2hlY2tlZAogICAgICAgICAgICAgICAgICAgICAgICBDaGVja2JveC5CYWNrZ3JvdW5kQ29sb3IzID0gY2hlY2tlZCBhbmQgQ29sb3IzLmZyb21SR0IoMTUyLCAxODEsIDI1NSkgb3IgQ29sb3IzLmZyb21SR0IoMzIsIDM4LCA1MSkKICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXS5jaGVja2VkID0gY2hlY2tlZAogICAgICAgICAgICAgICAgICAgICAgICBDb25maWc6c2F2ZShnYW1lLkdhbWVJZCwgTGlicmFyeS5fY29uZmlnKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBzZXR0aW5ncy5jYWxsYmFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5jYWxsYmFjayhjaGVja2VkKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgVXNlRl9WYXIgPSB0b2dnbGVTdGF0ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgQ2hlY2tib3guTW91c2VCdXR0b24xQ2xpY2s6Q29ubmVjdCh0b2dnbGVTdGF0ZSkKCiAgICAgICAgICAgICAgICBlbHNlCgogICAgICAgICAgICAgICAgICAgIFVzZUZfVmFyID0gZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5idXR0b25fY2FsbGJhY2soKTsKICAgICAgICAgICAgICAgICAgICBlbmQ7CgogICAgICAgICAgICAgICAgZW5kOwogICAgICAgICAgICAKICAgICAgICAgICAgICAgIEtleWJpbmRCdXR0b24uTW91c2VCdXR0b24xQ2xpY2s6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgS2V5YmluZEJveC5UZXh0ID0gIi4uLiIKICAgICAgICAgICAgICAgICAgICBsb2NhbCBpbnB1dENvbm5lY3Rpb24KICAgICAgICAgICAgICAgICAgICBpbnB1dENvbm5lY3Rpb24gPSBnYW1lOkdldFNlcnZpY2UoIlVzZXJJbnB1dFNlcnZpY2UiKS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW5wdXQsIGdhbWVQcm9jZXNzZWQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWVQcm9jZXNzZWQgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLktleWJvYXJkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG5ld0tleSA9IGlucHV0LktleUNvZGUuTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXS5CSU5EID0gbmV3S2V5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBuZXdLZXkgfj0gIlVua25vd24iIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXliaW5kQm94LlRleHQgPSBuZXdLZXk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25maWc6c2F2ZShnYW1lLkdhbWVJZCwgTGlicmFyeS5fY29uZmlnKSAtLSBTYXZlIG5ldyBrZXliaW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBpbnB1dC5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5fY29uZmlnLl9mbGFnc1tzZXR0aW5ncy5mbGFnXS5CSU5EID0gIlVua25vd24iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXliaW5kQm94LlRleHQgPSAiLi4uIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uZmlnOnNhdmUoZ2FtZS5HYW1lSWQsIExpYnJhcnkuX2NvbmZpZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0Q29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zWyJrZXliaW5kX2lucHV0XyIgLi4gc2V0dGluZ3MuZmxhZ10gPSBpbnB1dENvbm5lY3Rpb24KICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBrZXlQcmVzc0Nvbm5lY3Rpb24KICAgICAgICAgICAgICAgIGtleVByZXNzQ29ubmVjdGlvbiA9IGdhbWU6R2V0U2VydmljZSgiVXNlcklucHV0U2VydmljZSIpLklucHV0QmVnYW46Q29ubmVjdChmdW5jdGlvbihpbnB1dCwgZ2FtZVByb2Nlc3NlZCkKICAgICAgICAgICAgICAgICAgICBpZiBnYW1lUHJvY2Vzc2VkIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLktleWJvYXJkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaW5wdXQuS2V5Q29kZS5OYW1lID09IExpYnJhcnkuX2NvbmZpZy5fZmxhZ3Nbc2V0dGluZ3MuZmxhZ10uQklORCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2VGX1ZhcigpOwogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zWyJrZXliaW5kX3ByZXNzXyIgLi4gc2V0dGluZ3MuZmxhZ10gPSBrZXlQcmVzc0Nvbm5lY3Rpb24KICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBGZWF0dXJlQnV0dG9uLk1vdXNlQnV0dG9uMUNsaWNrOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGlmIHNldHRpbmdzLmJ1dHRvbl9jYWxsYmFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmJ1dHRvbl9jYWxsYmFjaygpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgaWYgbm90IHNldHRpbmdzLmRpc2FibGVjaGVjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soY2hlY2tlZCk7CiAgICAgICAgICAgICAgICBlbmQ7CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIEZlYXR1cmVDb250YWluZXIKICAgICAgICAgICAgZW5kICAgICAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgIHJldHVybiBNb2R1bGVNYW5hZ2VyCiAgICAgICAgZW5kCgogICAgICAgIHJldHVybiBUYWJNYW5hZ2VyCiAgICBlbmQKCiAgICBDb25uZWN0aW9uc1snbGlicmFyeV92aXNpYmxpdHknXSA9IFVzZXJJbnB1dFNlcnZpY2UuSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKGlucHV0OiBJbnB1dE9iamVjdCwgcHJvY2VzczogYm9vbGVhbikKICAgICAgICBpZiBpbnB1dC5LZXlDb2RlIH49IEVudW0uS2V5Q29kZS5JbnNlcnQgdGhlbgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKCiAgICAgICAgc2VsZi5fdWlfb3BlbiA9IG5vdCBzZWxmLl91aV9vcGVuCiAgICAgICAgc2VsZjpjaGFuZ2VfdmlzaWJsaXR5KHNlbGYuX3VpX29wZW4pCiAgICBlbmQpCgogICAgc2VsZi5fdWkuQ29udGFpbmVyLkhhbmRsZXIuTWluaW1pemUuTW91c2VCdXR0b24xQ2xpY2s6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgc2VsZi5fdWlfb3BlbiA9IG5vdCBzZWxmLl91aV9vcGVuCiAgICAgICAgc2VsZjpjaGFuZ2VfdmlzaWJsaXR5KHNlbGYuX3VpX29wZW4pCiAgICBlbmQpCgogICAgcmV0dXJuIHNlbGYKZW5kCgpsb2NhbCBtYWluID0gTGlicmFyeS5uZXcoKQoKbG9jYWwgcmFnZSA9IG1haW46Y3JlYXRlX3RhYignQmxhdGFudCcsICdyYnhhc3NldGlkOi8vNzY0OTkwNDI1OTkxMjcnKQpsb2NhbCBwbGF5ZXIgPSBtYWluOmNyZWF0ZV90YWIoJ1BsYXllcicsICdyYnhhc3NldGlkOi8vMTI2MDE3OTA3NDc3NjIzJykKbG9jYWwgd29ybGQgPSBtYWluOmNyZWF0ZV90YWIoJ1dvcmxkJywgJ3JieGFzc2V0aWQ6Ly84NTE2ODkwOTEzMTk5MCcpCmxvY2FsIGZhcm0gPSBtYWluOmNyZWF0ZV90YWIoJ0Zhcm0nLCAncmJ4YXNzZXRpZDovLzEzMjI0MzQyOTY0NzQ3OScpCmxvY2FsIG1pc2MgPSBtYWluOmNyZWF0ZV90YWIoJ01pc2MnLCAncmJ4YXNzZXRpZDovLzEzMjI0MzQyOTY0NzQ3OScpCgoKCnJlcGVhdCB0YXNrLndhaXQoKSB1bnRpbCBnYW1lOklzTG9hZGVkKCkKCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCdQbGF5ZXJzJykKbG9jYWwgUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgnUmVwbGljYXRlZFN0b3JhZ2UnKQpsb2NhbCBUb3JuYWRvX1RpbWUgPSB0aWNrKCkKbG9jYWwgVXNlcklucHV0U2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgnVXNlcklucHV0U2VydmljZScpCmxvY2FsIExhc3RfSW5wdXQgPSBVc2VySW5wdXRTZXJ2aWNlOkdldExhc3RJbnB1dFR5cGUoKQpsb2NhbCBEZWJyaXMgPSBnYW1lOkdldFNlcnZpY2UoJ0RlYnJpcycpCmxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoJ1J1blNlcnZpY2UnKQpsb2NhbCBWZWN0b3IyX01vdXNlX0xvY2F0aW9uID0gbmlsCmxvY2FsIEdyYWJfUGFycnkgPSBuaWwKbG9jYWwgUmVtb3RlcyA9IHt9CmxvY2FsIFBhcnJ5X0tleSA9IG5pbApsb2NhbCBTcGVlZF9EaXZpc29yX011bHRpcGxpZXIgPSAxLjEKbG9jYWwgTG9iYnlBUF9TcGVlZF9EaXZpc29yX011bHRpcGxpZXIgPSAxLjEKbG9jYWwgZmlyc3RQYXJyeUZpcmVkID0gZmFsc2UKbG9jYWwgUGFycnlUaHJlc2hvbGQgPSAyLjUKbG9jYWwgZmlyc3RQYXJyeVR5cGUgPSAnRl9LZXknCmxvY2FsIFByZXZpb3VzX1Bvc2l0aW9ucyA9IHt9CmxvY2FsIFZpcnR1YWxJbnB1dE1hbmFnZXIgPSBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKQpsb2NhbCBWaXJ0dWFsSW5wdXRTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIikKCgpsb2NhbCBHdWlTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCdHdWlTZXJ2aWNlJykKCmxvY2FsIGZ1bmN0aW9uIHVwZGF0ZU5hdmlnYXRpb24oZ3VpT2JqZWN0OiBHdWlPYmplY3QgfCBuaWwpCiAgICBHdWlTZXJ2aWNlLlNlbGVjdGVkT2JqZWN0ID0gZ3VpT2JqZWN0CmVuZAoKbG9jYWwgZnVuY3Rpb24gcGVyZm9ybUZpcnN0UHJlc3MocGFycnlUeXBlKQogICAgaWYgcGFycnlUeXBlID09ICdGX0tleScgdGhlbgogICAgICAgIFZpcnR1YWxJbnB1dFNlcnZpY2U6U2VuZEtleUV2ZW50KHRydWUsIEVudW0uS2V5Q29kZS5GLCBmYWxzZSwgbmlsKQogICAgZWxzZWlmIHBhcnJ5VHlwZSA9PSAnTGVmdF9DbGljaycgdGhlbgogICAgICAgIFZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZE1vdXNlQnV0dG9uRXZlbnQoMCwgMCwgMCwgdHJ1ZSwgZ2FtZSwgMCkKICAgIGVsc2VpZiBwYXJyeVR5cGUgPT0gJ05hdmlnYXRpb24nIHRoZW4KICAgICAgICBsb2NhbCBidXR0b24gPSBQbGF5ZXJzLkxvY2FsUGxheWVyLlBsYXllckd1aS5Ib3RiYXIuQmxvY2sKICAgICAgICB1cGRhdGVOYXZpZ2F0aW9uKGJ1dHRvbikKICAgICAgICBWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudCh0cnVlLCBFbnVtLktleUNvZGUuUmV0dXJuLCBmYWxzZSwgZ2FtZSkKICAgICAgICBWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudChmYWxzZSwgRW51bS5LZXlDb2RlLlJldHVybiwgZmFsc2UsIGdhbWUpCiAgICAgICAgdGFzay53YWl0KDAuMDEpCiAgICAgICAgdXBkYXRlTmF2aWdhdGlvbihuaWwpCiAgICBlbmQKZW5kCgppZiBub3QgTFBIX09CRlVTQ0FURUQgdGhlbgogICAgZnVuY3Rpb24gTFBIX0pJVChGdW5jdGlvbikgcmV0dXJuIEZ1bmN0aW9uIGVuZAogICAgZnVuY3Rpb24gTFBIX0pJVF9NQVgoRnVuY3Rpb24pIHJldHVybiBGdW5jdGlvbiBlbmQKICAgIGZ1bmN0aW9uIExQSF9OT19WSVJUVUFMSVpFKEZ1bmN0aW9uKSByZXR1cm4gRnVuY3Rpb24gZW5kCmVuZAoKbG9jYWwgUHJpdmF0ZUtleSA9IG5pbAoKbG9jYWwgUHJvcGVydHlDaGFuZ2VPcmRlciA9IHt9Cgpsb2NhbCBIYXNoT25lCmxvY2FsIEhhc2hUd28KbG9jYWwgSGFzaFRocmVlCgpMUEhfTk9fVklSVFVBTElaRShmdW5jdGlvbigpCiAgICBmb3IgSW5kZXgsIFZhbHVlIGluIG5leHQsIGdldGdjKCkgZG8KICAgICAgICBpZiByYXdlcXVhbCh0eXBlb2YoVmFsdWUpLCAiZnVuY3Rpb24iKSBhbmQgaXNsY2xvc3VyZShWYWx1ZSkgYW5kIGdldHJlbnYoKS5kZWJ1Zy5pbmZvKFZhbHVlLCAicyIpOmZpbmQoIlN3b3Jkc0NvbnRyb2xsZXIiKSB0aGVuCiAgICAgICAgICAgIGlmIHJhd2VxdWFsKGdldHJlbnYoKS5kZWJ1Zy5pbmZvKFZhbHVlLCAibCIpLCAyNjMpIHRoZW4KICAgICAgICAgICAgICAgIEhhc2hPbmUgPSBnZXRjb25zdGFudChWYWx1ZSwgNjIpCiAgICAgICAgICAgICAgICBIYXNoVHdvID0gZ2V0Y29uc3RhbnQoVmFsdWUsIDY0KQogICAgICAgICAgICAgICAgSGFzaFRocmVlID0gZ2V0Y29uc3RhbnQoVmFsdWUsIDY1KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQgCiAgICBlbmQKZW5kKSgpCgoKTFBIX05PX1ZJUlRVQUxJWkUoZnVuY3Rpb24oKQogICAgZm9yIEluZGV4LCBPYmplY3QgaW4gbmV4dCwgZ2FtZTpHZXREZXNjZW5kYW50cygpIGRvCiAgICAgICAgaWYgT2JqZWN0OklzQSgiUmVtb3RlRXZlbnQiKSBhbmQgc3RyaW5nLmZpbmQoT2JqZWN0Lk5hbWUsICJcbiIpIHRoZW4KICAgICAgICAgICAgT2JqZWN0LkNoYW5nZWQ6T25jZShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoUHJvcGVydHlDaGFuZ2VPcmRlciwgT2JqZWN0KQogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKSgpCgoKcmVwZWF0CiAgICB0YXNrLndhaXQoKQp1bnRpbCAjUHJvcGVydHlDaGFuZ2VPcmRlciA9PSAzCgoKbG9jYWwgU2hvdWxkUGxheWVySnVtcCA9IFByb3BlcnR5Q2hhbmdlT3JkZXJbMV0KbG9jYWwgTWFpblJlbW90ZSA9IFByb3BlcnR5Q2hhbmdlT3JkZXJbMl0KbG9jYWwgR2V0T3Bwb25lbnRQb3NpdGlvbiA9IFByb3BlcnR5Q2hhbmdlT3JkZXJbM10KCi0tW1sKCiAgICBsb2NhbCBfX25hbWVjYWxsCiAgICBfX25hbWVjYWxsID0gaG9va21ldGFtZXRob2QoZ2FtZSwgIl9fbmFtZWNhbGwiLCBmdW5jdGlvbihzZWxmLCAuLi4pCiAgICAgICAgbG9jYWwgQXJncyA9IHsuLi59CiAgICAgICAgbG9jYWwgTWV0aG9kID0gZ2V0bmFtZWNhbGxtZXRob2QoKQoKICAgICAgICBpZiBub3QgY2hlY2tjYWxsZXIoKSBhbmQgKE1ldGhvZCA9PSAiRmlyZVNlcnZlciIpIGFuZCBzdHJpbmcuZmluZChzZWxmLk5hbWUsICJcbiIpIHRoZW4KICAgICAgICAgICAgaWYgQXJnc1syXSB0aGVuCiAgICAgICAgICAgICAgICBQcml2YXRlS2V5ID0gQXJnc1syXQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgcmV0dXJuIF9fbmFtZWNhbGwoc2VsZiwgLi4uKQogICAgZW5kKQoKXV0KCmxvY2FsIFBhcnJ5X0tleQoKZm9yIEluZGV4LCBWYWx1ZSBpbiBwYWlycyhnZXRjb25uZWN0aW9ucyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuSG90YmFyLkJsb2NrLkFjdGl2YXRlZCkpIGRvCiAgICBpZiBWYWx1ZSBhbmQgVmFsdWUuRnVuY3Rpb24gYW5kIG5vdCBpc2NjbG9zdXJlKFZhbHVlLkZ1bmN0aW9uKSAgdGhlbgogICAgICAgIGZvciBJbmRleDIsVmFsdWUyIGluIHBhaXJzKGdldHVwdmFsdWVzKFZhbHVlLkZ1bmN0aW9uKSkgZG8KICAgICAgICAgICAgaWYgdHlwZShWYWx1ZTIpID09ICJmdW5jdGlvbiIgdGhlbgogICAgICAgICAgICAgICAgUGFycnlfS2V5ID0gZ2V0dXB2YWx1ZShnZXR1cHZhbHVlKFZhbHVlMiwgMiksIDE3KTsKICAgICAgICAgICAgZW5kOwogICAgICAgIGVuZDsKICAgIGVuZDsKZW5kOwoKbG9jYWwgZnVuY3Rpb24gUGFycnkoLi4uKQogICAgU2hvdWxkUGxheWVySnVtcDpGaXJlU2VydmVyKEhhc2hPbmUsIFBhcnJ5X0tleSwgLi4uKQogICAgTWFpblJlbW90ZTpGaXJlU2VydmVyKEhhc2hUd28sIFBhcnJ5X0tleSwgLi4uKQogICAgR2V0T3Bwb25lbnRQb3NpdGlvbjpGaXJlU2VydmVyKEhhc2hUaHJlZSwgUGFycnlfS2V5LCAuLi4pCmVuZAoKLS1bWwoKbG9jYWwgZnVuY3Rpb24gUGFycnkoLi4uKQogICAgU2hvdWxkUGxheWVySnVtcDpGaXJlU2VydmVyKEhhc2hPbmUsIFByaXZhdGVLZXksIC4uLikKICAgIE1haW5SZW1vdGU6RmlyZVNlcnZlcihIYXNoVHdvLCBQcml2YXRlS2V5LCAuLi4pCiAgICBHZXRPcHBvbmVudFBvc2l0aW9uOkZpcmVTZXJ2ZXIoSGFzaFRocmVlLCBQcml2YXRlS2V5LCAuLi4pCmVuZAoKXV0KCnR5cGUgZnVuY3Rpb25JbmZvID0gewogICAgc2NyaXB0TmFtZTogc3RyaW5nLAogICAgbmFtZTogc3RyaW5nLAogICAgbGluZTogbnVtYmVyLAogICAgdXB2YWx1ZUNvdW50OiBudW1iZXIsCiAgICBjb25zdGFudENvdW50OiBudW1iZXIKfQoKbG9jYWwgZnVuY3Rpb24gZ2V0RnVuY3Rpb24odDpmdW5jdGlvbkluZm8pCiAgICB0ID0gdCBvciB7fQogICAgbG9jYWwgZnVuY3Rpb25zID0ge30KICAgIGxvY2FsIGZ1bmN0aW9uIGZpbmRNYXRjaGVzKCkKICAgICAgICBzZXR0aHJlYWRpZGVudGl0eSg2KQogICAgICAgIGZvciBpLHYgaW4gZ2V0Z2MoKSBkbwogICAgICAgICAgICBpZiB0eXBlKHYpID09ICJmdW5jdGlvbiIgYW5kIGlzbGNsb3N1cmUodikgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgbWF0Y2ggPSB0cnVlCiAgICAgICAgICAgICAgICBsb2NhbCBpbmZvID0gZ2V0aW5mbyh2KQogICAgICAgICAgICAgICAgaWYgdC5zY3JpcHROYW1lIGFuZCAobm90IHRvc3RyaW5nKGdldGZlbnYodikuc2NyaXB0KTpmaW5kKHQuc2NyaXB0TmFtZSkpIHRoZW4KICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIHQubmFtZSBhbmQgaW5mby5uYW1lIH49IHQubmFtZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBmYWxzZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiB0LmxpbmUgYW5kIGluZm8uY3VycmVudGxpbmUgfj0gdC5saW5lIHRoZW4KICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIHQudXB2YWx1ZUNvdW50IGFuZCAjZ2V0dXB2YWx1ZXModikgfj0gdC51cHZhbHVlQ291bnQgdGhlbgogICAgICAgICAgICAgICAgICAgIG1hdGNoID0gZmFsc2UKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgdC5jb25zdGFudENvdW50IGFuZCAjZ2V0Y29uc3RhbnRzKHYpIH49IHQuY29uc3RhbnRzQ291bnQgdGhlbgogICAgICAgICAgICAgICAgICAgIG1hdGNoID0gZmFsc2UKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgbWF0Y2ggdGhlbgogICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChmdW5jdGlvbnMsdikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBzZXR0aHJlYWRpZGVudGl0eSg4KQogICAgZW5kCgogICAgZmluZE1hdGNoZXMoKQoKICAgIGlmICNmdW5jdGlvbnMgPT0gMCB0aGVuCiAgICAgICAgd2hpbGUgdGFzay53YWl0KDEpIGFuZCAjZnVuY3Rpb25zID09IDAgZG8KICAgICAgICAgICAgZmluZE1hdGNoZXMoKQogICAgICAgIGVuZAogICAgZW5kCiAgICAKICAgIGlmICNmdW5jdGlvbnMgPT0gMSB0aGVuCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uc1sxXQogICAgZW5kCmVuZAoKdHlwZSB0YWJsZUluZm8gPSB7CiAgICBoaWdoRW50cm9weVRhYmxlSW5kZXg6IHN0cmluZywKfQoKZ2V0Z2VudigpLnNraW5DaGFuZ2VyID0gZmFsc2UKZ2V0Z2VudigpLnN3b3JkTW9kZWwgPSAiIgpnZXRnZW52KCkuc3dvcmRBbmltYXRpb25zID0gIiIKZ2V0Z2VudigpLnN3b3JkRlggPSAiIgoKCmxvY2FsIHByaW50ID0gZnVuY3Rpb24oKSBlbmQKCmlmIGdldGdlbnYoKS51cGRhdGVTd29yZCBhbmQgZ2V0Z2VudigpLnNraW5DaGFuZ2VyIHRoZW4KICAgIGdldGdlbnYoKS51cGRhdGVTd29yZCgpCiAgICByZXR1cm4KZW5kCgpsb2NhbCBmdW5jdGlvbiBnZXRUYWJsZSh0OnRhYmxlSW5mbykKICAgIHQgPSB0IG9yIHt9CiAgICBsb2NhbCB0YWJsZXMgPSB7fQogICAgCiAgICBsb2NhbCBmdW5jdGlvbiBmaW5kTWF0Y2hlcygpCiAgICAgICAgZm9yIGksdiBpbiBnZXRnYyh0cnVlKSBkbwogICAgICAgICAgICBpZiB0eXBlKHYpID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgbWF0Y2ggPSB0cnVlCiAgICAgICAgICAgICAgICBpZiB0LmhpZ2hFbnRyb3B5VGFibGVJbmRleCBhbmQgKG5vdCByYXdnZXQodix0LmhpZ2hFbnRyb3B5VGFibGVJbmRleCkpIHRoZW4KICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIG1hdGNoIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQodGFibGVzLHYpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmaW5kTWF0Y2hlcygpCgogICAgaWYgI3RhYmxlcyA9PSAwIHRoZW4KICAgICAgICB3aGlsZSB0YXNrLndhaXQoMSkgYW5kICN0YWJsZXMgPT0gMCBkbwogICAgICAgICAgICBmaW5kTWF0Y2hlcygpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBpZiAjdGFibGVzID09IDEgdGhlbgogICAgICAgIHJldHVybiB0YWJsZXNbMV0KICAgIGVuZAplbmQKCmxvY2FsIHBscnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBwbHIgPSBwbHJzLkxvY2FsUGxheWVyCmxvY2FsIHJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCmxvY2FsIHN3b3JkSW5zdGFuY2VzSW5zdGFuY2UgPSByczpXYWl0Rm9yQ2hpbGQoIlNoYXJlZCIsOWU5KTpXYWl0Rm9yQ2hpbGQoIlJlcGxpY2F0ZWRJbnN0YW5jZXMiLDllOSk6V2FpdEZvckNoaWxkKCJTd29yZHMiLDllOSkKbG9jYWwgc3dvcmRJbnN0YW5jZXMgPSByZXF1aXJlKHN3b3JkSW5zdGFuY2VzSW5zdGFuY2UpCgpsb2NhbCBzd29yZHNDb250cm9sbGVyCgp3aGlsZSB0YXNrLndhaXQoKSBhbmQgKG5vdCBzd29yZHNDb250cm9sbGVyKSBkbwogICAgZm9yIGksdiBpbiBnZXRjb25uZWN0aW9ucyhycy5SZW1vdGVzLkZpcmVTd29yZEluZm8uT25DbGllbnRFdmVudCkgZG8KICAgICAgICBpZiB2LkZ1bmN0aW9uIGFuZCBpc2xjbG9zdXJlKHYuRnVuY3Rpb24pIHRoZW4KICAgICAgICAgICAgbG9jYWwgdXB2YWx1ZXMgPSBnZXR1cHZhbHVlcyh2LkZ1bmN0aW9uKQogICAgICAgICAgICBpZiAjdXB2YWx1ZXMgPT0gMSBhbmQgdHlwZSh1cHZhbHVlc1sxXSkgPT0gInRhYmxlIiB0aGVuCiAgICAgICAgICAgICAgICBzd29yZHNDb250cm9sbGVyID0gdXB2YWx1ZXNbMV0KICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKZnVuY3Rpb24gZ2V0U2xhc2hOYW1lKHN3b3JkTmFtZSkKICAgIGxvY2FsIHNsYXNoTmFtZSA9IHN3b3JkSW5zdGFuY2VzOkdldFN3b3JkKHN3b3JkTmFtZSkKICAgIHJldHVybiAoc2xhc2hOYW1lIGFuZCBzbGFzaE5hbWUuU2xhc2hOYW1lKSBvciAiU2xhc2hFZmZlY3QiCmVuZAoKZnVuY3Rpb24gc2V0U3dvcmQoKQogICAgaWYgbm90IGdldGdlbnYoKS5za2luQ2hhbmdlciB0aGVuIHJldHVybiBlbmQKICAgIAogICAgc2V0dXB2YWx1ZShyYXdnZXQoc3dvcmRJbnN0YW5jZXMsIkVxdWlwU3dvcmRUbyIpLDIsZmFsc2UpCiAgICAKICAgIHN3b3JkSW5zdGFuY2VzOkVxdWlwU3dvcmRUbyhwbHIuQ2hhcmFjdGVyLCBnZXRnZW52KCkuc3dvcmRNb2RlbCkKICAgIHN3b3Jkc0NvbnRyb2xsZXI6U2V0U3dvcmQoZ2V0Z2VudigpLnN3b3JkQW5pbWF0aW9ucykKZW5kCgpsb2NhbCBwbGF5UGFycnlGdW5jCmxvY2FsIHBhcnJ5U3VjY2Vzc0FsbENvbm5lY3Rpb24KCndoaWxlIHRhc2sud2FpdCgpIGFuZCBub3QgcGFycnlTdWNjZXNzQWxsQ29ubmVjdGlvbiBkbwogICAgZm9yIGksdiBpbiBnZXRjb25uZWN0aW9ucyhycy5SZW1vdGVzLlBhcnJ5U3VjY2Vzc0FsbC5PbkNsaWVudEV2ZW50KSBkbwogICAgICAgIGlmIHYuRnVuY3Rpb24gYW5kIGdldGluZm8odi5GdW5jdGlvbikubmFtZSA9PSAicGFycnlTdWNjZXNzQWxsIiB0aGVuCiAgICAgICAgICAgIHBhcnJ5U3VjY2Vzc0FsbENvbm5lY3Rpb24gPSB2CiAgICAgICAgICAgIHBsYXlQYXJyeUZ1bmMgPSB2LkZ1bmN0aW9uCiAgICAgICAgICAgIHY6RGlzYWJsZSgpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpsb2NhbCBwYXJyeVN1Y2Nlc3NDbGllbnRDb25uZWN0aW9uCndoaWxlIHRhc2sud2FpdCgpIGFuZCBub3QgcGFycnlTdWNjZXNzQ2xpZW50Q29ubmVjdGlvbiBkbwogICAgZm9yIGksdiBpbiBnZXRjb25uZWN0aW9ucyhycy5SZW1vdGVzLlBhcnJ5U3VjY2Vzc0NsaWVudC5FdmVudCkgZG8KICAgICAgICBpZiB2LkZ1bmN0aW9uIGFuZCBnZXRpbmZvKHYuRnVuY3Rpb24pLm5hbWUgPT0gInBhcnJ5U3VjY2Vzc0FsbCIgdGhlbgogICAgICAgICAgICBwYXJyeVN1Y2Nlc3NDbGllbnRDb25uZWN0aW9uID0gdgogICAgICAgICAgICB2OkRpc2FibGUoKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKZ2V0Z2VudigpLnNsYXNoTmFtZSA9IGdldFNsYXNoTmFtZShnZXRnZW52KCkuc3dvcmRGWCkKCmxvY2FsIGxhc3RPdGhlclBhcnJ5VGltZXN0YW1wID0gMApsb2NhbCBjbGFzaENvbm5lY3Rpb25zID0ge30KCnJzLlJlbW90ZXMuUGFycnlTdWNjZXNzQWxsLk9uQ2xpZW50RXZlbnQ6Q29ubmVjdChmdW5jdGlvbiguLi4pCiAgICBzZXR0aHJlYWRpZGVudGl0eSgyKQogICAgbG9jYWwgYXJncyA9IHsuLi59CiAgICBpZiB0b3N0cmluZyhhcmdzWzRdKSB+PSBwbHIuTmFtZSB0aGVuCiAgICAgICAgbGFzdE90aGVyUGFycnlUaW1lc3RhbXAgPSB0aWNrKCkKICAgIGVsc2VpZiBnZXRnZW52KCkuc2tpbkNoYW5nZXIgdGhlbgogICAgICAgIGFyZ3NbMV0gPSBnZXRnZW52KCkuc2xhc2hOYW1lCiAgICAgICAgYXJnc1szXSA9IGdldGdlbnYoKS5zd29yZEZYCiAgICBlbmQKICAgIHJldHVybiBwbGF5UGFycnlGdW5jKHVucGFjayhhcmdzKSkKZW5kKQoKdGFibGUuaW5zZXJ0KGNsYXNoQ29ubmVjdGlvbnMsIGdldGNvbm5lY3Rpb25zKHJzLlJlbW90ZXMuUGFycnlTdWNjZXNzQWxsLk9uQ2xpZW50RXZlbnQpWzFdKQoKZ2V0Z2VudigpLnVwZGF0ZVN3b3JkID0gZnVuY3Rpb24oKQogICAgZ2V0Z2VudigpLnNsYXNoTmFtZSA9IGdldFNsYXNoTmFtZShnZXRnZW52KCkuc3dvcmRGWCkKICAgIHNldFN3b3JkKCkKZW5kCgp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRhc2sud2FpdCgxKSBkbwogICAgICAgIGlmIGdldGdlbnYoKS5za2luQ2hhbmdlciB0aGVuCiAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBwbHIuQ2hhcmFjdGVyIG9yIHBsci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKICAgICAgICAgICAgaWYgcGxyOkdldEF0dHJpYnV0ZSgiQ3VycmVudGx5RXF1aXBwZWRTd29yZCIpIH49IGdldGdlbnYoKS5zd29yZE1vZGVsIHRoZW4KICAgICAgICAgICAgICAgIHNldFN3b3JkKCkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGNoYXIgYW5kIChub3QgY2hhcjpGaW5kRmlyc3RDaGlsZChnZXRnZW52KCkuc3dvcmRNb2RlbCkpIHRoZW4KICAgICAgICAgICAgICAgIHNldFN3b3JkKCkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGZvciBfLHYgaW4gKGNoYXIgYW5kIGNoYXI6R2V0Q2hpbGRyZW4oKSkgb3Ige30gZG8KICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJNb2RlbCIpIGFuZCB2Lk5hbWUgfj0gZ2V0Z2VudigpLnN3b3JkTW9kZWwgdGhlbgogICAgICAgICAgICAgICAgICAgIHY6RGVzdHJveSgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmxvY2FsIFBhcnJpZXMgPSAwCgpmdW5jdGlvbiBjcmVhdGVfYW5pbWF0aW9uKG9iamVjdCwgaW5mbywgdmFsdWUpCiAgICBsb2NhbCBhbmltYXRpb24gPSBnYW1lOkdldFNlcnZpY2UoJ1R3ZWVuU2VydmljZScpOkNyZWF0ZShvYmplY3QsIGluZm8sIHZhbHVlKQoKICAgIGFuaW1hdGlvbjpQbGF5KCkKICAgIHRhc2sud2FpdChpbmZvLlRpbWUpCgogICAgRGVicmlzOkFkZEl0ZW0oYW5pbWF0aW9uLCAwKQoKICAgIGFuaW1hdGlvbjpEZXN0cm95KCkKICAgIGFuaW1hdGlvbiA9IG5pbAplbmQKCmxvY2FsIEFuaW1hdGlvbiA9IHt9CkFuaW1hdGlvbi5zdG9yYWdlID0ge30KCkFuaW1hdGlvbi5jdXJyZW50ID0gbmlsCkFuaW1hdGlvbi50cmFjayA9IG5pbAoKZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLk1pc2MuRW1vdGVzOkdldENoaWxkcmVuKCkpIGRvCiAgICBpZiB2OklzQSgiQW5pbWF0aW9uIikgYW5kIHY6R2V0QXR0cmlidXRlKCJFbW90ZU5hbWUiKSB0aGVuCiAgICAgICAgbG9jYWwgRW1vdGVfTmFtZSA9IHY6R2V0QXR0cmlidXRlKCJFbW90ZU5hbWUiKQogICAgICAgIEFuaW1hdGlvbi5zdG9yYWdlW0Vtb3RlX05hbWVdID0gdgogICAgZW5kCmVuZAoKbG9jYWwgRW1vdGVzX0RhdGEgPSB7fQoKZm9yIE9iamVjdCBpbiBwYWlycyhBbmltYXRpb24uc3RvcmFnZSkgZG8KICAgIHRhYmxlLmluc2VydChFbW90ZXNfRGF0YSwgT2JqZWN0KQplbmQKCnRhYmxlLnNvcnQoRW1vdGVzX0RhdGEpCgpsb2NhbCBBdXRvX1BhcnJ5ID0ge30KCmZ1bmN0aW9uIEF1dG9fUGFycnkuUGFycnlfQW5pbWF0aW9uKCkKICAgIGxvY2FsIFBhcnJ5X0FuaW1hdGlvbiA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5TaGFyZWQuU3dvcmRBUEkuQ29sbGVjdGlvbi5EZWZhdWx0OkZpbmRGaXJzdENoaWxkKCdHcmFiUGFycnknKQogICAgbG9jYWwgQ3VycmVudF9Td29yZCA9IFBsYXllci5DaGFyYWN0ZXI6R2V0QXR0cmlidXRlKCdDdXJyZW50bHlFcXVpcHBlZFN3b3JkJykKCiAgICBpZiBub3QgQ3VycmVudF9Td29yZCB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKCiAgICBpZiBub3QgUGFycnlfQW5pbWF0aW9uIHRoZW4KICAgICAgICByZXR1cm4KICAgIGVuZAoKICAgIGxvY2FsIFN3b3JkX0RhdGEgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU2hhcmVkLlJlcGxpY2F0ZWRJbnN0YW5jZXMuU3dvcmRzLkdldFN3b3JkOkludm9rZShDdXJyZW50X1N3b3JkKQoKICAgIGlmIG5vdCBTd29yZF9EYXRhIG9yIG5vdCBTd29yZF9EYXRhWydBbmltYXRpb25UeXBlJ10gdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgZm9yIF8sIG9iamVjdCBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoJ1JlcGxpY2F0ZWRTdG9yYWdlJykuU2hhcmVkLlN3b3JkQVBJLkNvbGxlY3Rpb246R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiBvYmplY3QuTmFtZSA9PSBTd29yZF9EYXRhWydBbmltYXRpb25UeXBlJ10gdGhlbgogICAgICAgICAgICBpZiBvYmplY3Q6RmluZEZpcnN0Q2hpbGQoJ0dyYWJQYXJyeScpIG9yIG9iamVjdDpGaW5kRmlyc3RDaGlsZCgnR3JhYicpIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHN3b3JkX2FuaW1hdGlvbl90eXBlID0gJ0dyYWJQYXJyeScKCiAgICAgICAgICAgICAgICBpZiBvYmplY3Q6RmluZEZpcnN0Q2hpbGQoJ0dyYWInKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgc3dvcmRfYW5pbWF0aW9uX3R5cGUgPSAnR3JhYicKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIFBhcnJ5X0FuaW1hdGlvbiA9IG9iamVjdFtzd29yZF9hbmltYXRpb25fdHlwZV0KICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBHcmFiX1BhcnJ5ID0gUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5BbmltYXRvcjpMb2FkQW5pbWF0aW9uKFBhcnJ5X0FuaW1hdGlvbikKICAgIEdyYWJfUGFycnk6UGxheSgpCmVuZAoKZnVuY3Rpb24gQXV0b19QYXJyeS5QbGF5X0FuaW1hdGlvbih2KQogICAgbG9jYWwgQW5pbWF0aW9ucyA9IEFuaW1hdGlvbi5zdG9yYWdlW3ZdCgogICAgaWYgbm90IEFuaW1hdGlvbnMgdGhlbgogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCgogICAgbG9jYWwgQW5pbWF0b3IgPSBQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLkFuaW1hdG9yCgogICAgaWYgQW5pbWF0aW9uLnRyYWNrIHRoZW4KICAgICAgICBBbmltYXRpb24udHJhY2s6U3RvcCgpCiAgICBlbmQKCiAgICBBbmltYXRpb24udHJhY2sgPSBBbmltYXRvcjpMb2FkQW5pbWF0aW9uKEFuaW1hdGlvbnMpCiAgICBBbmltYXRpb24udHJhY2s6UGxheSgpCgogICAgQW5pbWF0aW9uLmN1cnJlbnQgPSB2CmVuZAoKZnVuY3Rpb24gQXV0b19QYXJyeS5HZXRfQmFsbHMoKQogICAgbG9jYWwgQmFsbHMgPSB7fQoKICAgIGZvciBfLCBJbnN0YW5jZSBpbiBwYWlycyh3b3Jrc3BhY2UuQmFsbHM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiBJbnN0YW5jZTpHZXRBdHRyaWJ1dGUoJ3JlYWxCYWxsJykgdGhlbgogICAgICAgICAgICBJbnN0YW5jZS5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KEJhbGxzLCBJbnN0YW5jZSkKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIEJhbGxzCmVuZAoKZnVuY3Rpb24gQXV0b19QYXJyeS5HZXRfQmFsbCgpCiAgICBmb3IgXywgSW5zdGFuY2UgaW4gcGFpcnMod29ya3NwYWNlLkJhbGxzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgSW5zdGFuY2U6R2V0QXR0cmlidXRlKCdyZWFsQmFsbCcpIHRoZW4KICAgICAgICAgICAgSW5zdGFuY2UuQ2FuQ29sbGlkZSA9IGZhbHNlCiAgICAgICAgICAgIHJldHVybiBJbnN0YW5jZQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKZnVuY3Rpb24gQXV0b19QYXJyeS5Mb2JieV9CYWxscygpCiAgICBmb3IgXywgSW5zdGFuY2UgaW4gcGFpcnMod29ya3NwYWNlLlRyYWluaW5nQmFsbHM6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiBJbnN0YW5jZTpHZXRBdHRyaWJ1dGUoInJlYWxCYWxsIikgdGhlbgogICAgICAgICAgICByZXR1cm4gSW5zdGFuY2UKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgpsb2NhbCBDbG9zZXN0X0VudGl0eSA9IG5pbAoKZnVuY3Rpb24gQXV0b19QYXJyeS5DbG9zZXN0X1BsYXllcigpCiAgICBsb2NhbCBNYXhfRGlzdGFuY2UgPSBtYXRoLmh1Z2UKICAgIGxvY2FsIEZvdW5kX0VudGl0eSA9IG5pbAogICAgCiAgICBmb3IgXywgRW50aXR5IGluIHBhaXJzKHdvcmtzcGFjZS5BbGl2ZTpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIHRvc3RyaW5nKEVudGl0eSkgfj0gdG9zdHJpbmcoUGxheWVyKSB0aGVuCiAgICAgICAgICAgIGlmIEVudGl0eS5QcmltYXJ5UGFydCB0aGVuICAtLSBDaGVjayBpZiBQcmltYXJ5UGFydCBleGlzdHMKICAgICAgICAgICAgICAgIGxvY2FsIERpc3RhbmNlID0gUGxheWVyOkRpc3RhbmNlRnJvbUNoYXJhY3RlcihFbnRpdHkuUHJpbWFyeVBhcnQuUG9zaXRpb24pCiAgICAgICAgICAgICAgICBpZiBEaXN0YW5jZSA8IE1heF9EaXN0YW5jZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgTWF4X0Rpc3RhbmNlID0gRGlzdGFuY2UKICAgICAgICAgICAgICAgICAgICBGb3VuZF9FbnRpdHkgPSBFbnRpdHkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICBDbG9zZXN0X0VudGl0eSA9IEZvdW5kX0VudGl0eQogICAgcmV0dXJuIEZvdW5kX0VudGl0eQplbmQKCmZ1bmN0aW9uIEF1dG9fUGFycnk6R2V0X0VudGl0eV9Qcm9wZXJ0aWVzKCkKICAgIEF1dG9fUGFycnkuQ2xvc2VzdF9QbGF5ZXIoKQoKICAgIGlmIG5vdCBDbG9zZXN0X0VudGl0eSB0aGVuCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKCiAgICBsb2NhbCBFbnRpdHlfVmVsb2NpdHkgPSBDbG9zZXN0X0VudGl0eS5QcmltYXJ5UGFydC5WZWxvY2l0eQogICAgbG9jYWwgRW50aXR5X0RpcmVjdGlvbiA9IChQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uIC0gQ2xvc2VzdF9FbnRpdHkuUHJpbWFyeVBhcnQuUG9zaXRpb24pLlVuaXQKICAgIGxvY2FsIEVudGl0eV9EaXN0YW5jZSA9IChQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uIC0gQ2xvc2VzdF9FbnRpdHkuUHJpbWFyeVBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZQoKICAgIHJldHVybiB7CiAgICAgICAgVmVsb2NpdHkgPSBFbnRpdHlfVmVsb2NpdHksCiAgICAgICAgRGlyZWN0aW9uID0gRW50aXR5X0RpcmVjdGlvbiwKICAgICAgICBEaXN0YW5jZSA9IEVudGl0eV9EaXN0YW5jZQogICAgfQplbmQKCmxvY2FsIGlzTW9iaWxlID0gVXNlcklucHV0U2VydmljZS5Ub3VjaEVuYWJsZWQgYW5kIG5vdCBVc2VySW5wdXRTZXJ2aWNlLk1vdXNlRW5hYmxlZAoKCmZ1bmN0aW9uIEF1dG9fUGFycnkuUGFycnlfRGF0YShQYXJyeV9UeXBlKQogICAgQXV0b19QYXJyeS5DbG9zZXN0X1BsYXllcigpCiAgICAKICAgIGxvY2FsIEV2ZW50cyA9IHt9CiAgICBsb2NhbCBDYW1lcmEgPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYQogICAgbG9jYWwgVmVjdG9yMl9Nb3VzZV9Mb2NhdGlvbgogICAgCiAgICBpZiBMYXN0X0lucHV0ID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjEgb3IgKEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjIgb3IgTGFzdF9JbnB1dCA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuS2V5Ym9hcmQpIHRoZW4KICAgICAgICBsb2NhbCBNb3VzZV9Mb2NhdGlvbiA9IFVzZXJJbnB1dFNlcnZpY2U6R2V0TW91c2VMb2NhdGlvbigpCiAgICAgICAgVmVjdG9yMl9Nb3VzZV9Mb2NhdGlvbiA9IHtNb3VzZV9Mb2NhdGlvbi5YLCBNb3VzZV9Mb2NhdGlvbi5ZfQogICAgZWxzZQogICAgICAgIFZlY3RvcjJfTW91c2VfTG9jYXRpb24gPSB7Q2FtZXJhLlZpZXdwb3J0U2l6ZS5YIC8gMiwgQ2FtZXJhLlZpZXdwb3J0U2l6ZS5ZIC8gMn0KICAgIGVuZAogICAgCiAgICBpZiBpc01vYmlsZSB0aGVuCiAgICAgICAgVmVjdG9yMl9Nb3VzZV9Mb2NhdGlvbiA9IHtDYW1lcmEuVmlld3BvcnRTaXplLlggLyAyLCBDYW1lcmEuVmlld3BvcnRTaXplLlkgLyAyfQogICAgZW5kCiAgICAKICAgIGxvY2FsIFBsYXllcnNfU2NyZWVuX1Bvc2l0aW9ucyA9IHt9CiAgICBmb3IgXywgdiBpbiBwYWlycyh3b3Jrc3BhY2UuQWxpdmU6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBpZiB2IH49IFBsYXllci5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICBsb2NhbCB3b3JsZFBvcyA9IHYuUHJpbWFyeVBhcnQuUG9zaXRpb24KICAgICAgICAgICAgbG9jYWwgc2NyZWVuUG9zLCBpc09uU2NyZWVuID0gQ2FtZXJhOldvcmxkVG9TY3JlZW5Qb2ludCh3b3JsZFBvcykKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGlzT25TY3JlZW4gdGhlbgogICAgICAgICAgICAgICAgUGxheWVyc19TY3JlZW5fUG9zaXRpb25zW3ZdID0gVmVjdG9yMi5uZXcoc2NyZWVuUG9zLlgsIHNjcmVlblBvcy5ZKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIEV2ZW50c1t0b3N0cmluZyh2KV0gPSBzY3JlZW5Qb3MKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICBpZiBQYXJyeV9UeXBlID09ICdDYW1lcmEnIHRoZW4KICAgICAgICByZXR1cm4gezAsIENhbWVyYS5DRnJhbWUsIEV2ZW50cywgVmVjdG9yMl9Nb3VzZV9Mb2NhdGlvbn0KICAgIGVuZAogICAgCiAgICBpZiBQYXJyeV9UeXBlID09ICdCYWNrd2FyZHMnIHRoZW4KICAgICAgICBsb2NhbCBCYWNrd2FyZHNfRGlyZWN0aW9uID0gQ2FtZXJhLkNGcmFtZS5Mb29rVmVjdG9yICogLTEwMDAwCiAgICAgICAgQmFja3dhcmRzX0RpcmVjdGlvbiA9IFZlY3RvcjMubmV3KEJhY2t3YXJkc19EaXJlY3Rpb24uWCwgMCwgQmFja3dhcmRzX0RpcmVjdGlvbi5aKQogICAgICAgIHJldHVybiB7MCwgQ0ZyYW1lLm5ldyhDYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uLCBDYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uICsgQmFja3dhcmRzX0RpcmVjdGlvbiksIEV2ZW50cywgVmVjdG9yMl9Nb3VzZV9Mb2NhdGlvbn0KICAgIGVuZAoKICAgIGlmIFBhcnJ5X1R5cGUgPT0gJ1N0cmFpZ2h0JyB0aGVuCiAgICAgICAgbG9jYWwgQWltZWRfUGxheWVyID0gbmlsCiAgICAgICAgbG9jYWwgQ2xvc2VzdF9EaXN0YW5jZSA9IG1hdGguaHVnZQogICAgICAgIGxvY2FsIE1vdXNlX1ZlY3RvciA9IFZlY3RvcjIubmV3KFZlY3RvcjJfTW91c2VfTG9jYXRpb25bMV0sIFZlY3RvcjJfTW91c2VfTG9jYXRpb25bMl0pCiAgICAgICAgCiAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMod29ya3NwYWNlLkFsaXZlOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIGlmIHYgfj0gUGxheWVyLkNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCB3b3JsZFBvcyA9IHYuUHJpbWFyeVBhcnQuUG9zaXRpb24KICAgICAgICAgICAgICAgIGxvY2FsIHNjcmVlblBvcywgaXNPblNjcmVlbiA9IENhbWVyYTpXb3JsZFRvU2NyZWVuUG9pbnQod29ybGRQb3MpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGlzT25TY3JlZW4gdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHBsYXllclNjcmVlblBvcyA9IFZlY3RvcjIubmV3KHNjcmVlblBvcy5YLCBzY3JlZW5Qb3MuWSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9IChNb3VzZV9WZWN0b3IgLSBwbGF5ZXJTY3JlZW5Qb3MpLk1hZ25pdHVkZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGRpc3RhbmNlIDwgQ2xvc2VzdF9EaXN0YW5jZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIENsb3Nlc3RfRGlzdGFuY2UgPSBkaXN0YW5jZQogICAgICAgICAgICAgICAgICAgICAgICBBaW1lZF9QbGF5ZXIgPSB2CiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgaWYgQWltZWRfUGxheWVyIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHswLCBDRnJhbWUubmV3KFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQuUG9zaXRpb24sIEFpbWVkX1BsYXllci5QcmltYXJ5UGFydC5Qb3NpdGlvbiksIEV2ZW50cywgVmVjdG9yMl9Nb3VzZV9Mb2NhdGlvbn0KICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiB7MCwgQ0ZyYW1lLm5ldyhQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uLCBDbG9zZXN0X0VudGl0eS5QcmltYXJ5UGFydC5Qb3NpdGlvbiksIEV2ZW50cywgVmVjdG9yMl9Nb3VzZV9Mb2NhdGlvbn0KICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICBpZiBQYXJyeV9UeXBlID09ICdSYW5kb20nIHRoZW4KICAgICAgICByZXR1cm4gezAsIENGcmFtZS5uZXcoQ2FtZXJhLkNGcmFtZS5Qb3NpdGlvbiwgVmVjdG9yMy5uZXcobWF0aC5yYW5kb20oLTQwMDAsIDQwMDApLCBtYXRoLnJhbmRvbSgtNDAwMCwgNDAwMCksIG1hdGgucmFuZG9tKC00MDAwLCA0MDAwKSkpLCBFdmVudHMsIFZlY3RvcjJfTW91c2VfTG9jYXRpb259CiAgICBlbmQKICAgIAogICAgaWYgUGFycnlfVHlwZSA9PSAnSGlnaCcgdGhlbgogICAgICAgIGxvY2FsIEhpZ2hfRGlyZWN0aW9uID0gQ2FtZXJhLkNGcmFtZS5VcFZlY3RvciAqIDEwMDAwCiAgICAgICAgcmV0dXJuIHswLCBDRnJhbWUubmV3KENhbWVyYS5DRnJhbWUuUG9zaXRpb24sIENhbWVyYS5DRnJhbWUuUG9zaXRpb24gKyBIaWdoX0RpcmVjdGlvbiksIEV2ZW50cywgVmVjdG9yMl9Nb3VzZV9Mb2NhdGlvbn0KICAgIGVuZAogICAgCiAgICBpZiBQYXJyeV9UeXBlID09ICdMZWZ0JyB0aGVuCiAgICAgICAgbG9jYWwgTGVmdF9EaXJlY3Rpb24gPSBDYW1lcmEuQ0ZyYW1lLlJpZ2h0VmVjdG9yICogMTAwMDAKICAgICAgICByZXR1cm4gezAsIENGcmFtZS5uZXcoQ2FtZXJhLkNGcmFtZS5Qb3NpdGlvbiwgQ2FtZXJhLkNGcmFtZS5Qb3NpdGlvbiAtIExlZnRfRGlyZWN0aW9uKSwgRXZlbnRzLCBWZWN0b3IyX01vdXNlX0xvY2F0aW9ufQogICAgZW5kCiAgICAKICAgIGlmIFBhcnJ5X1R5cGUgPT0gJ1JpZ2h0JyB0aGVuCiAgICAgICAgbG9jYWwgUmlnaHRfRGlyZWN0aW9uID0gQ2FtZXJhLkNGcmFtZS5SaWdodFZlY3RvciAqIDEwMDAwCiAgICAgICAgcmV0dXJuIHswLCBDRnJhbWUubmV3KENhbWVyYS5DRnJhbWUuUG9zaXRpb24sIENhbWVyYS5DRnJhbWUuUG9zaXRpb24gKyBSaWdodF9EaXJlY3Rpb24pLCBFdmVudHMsIFZlY3RvcjJfTW91c2VfTG9jYXRpb259CiAgICBlbmQKCiAgICBpZiBQYXJyeV9UeXBlID09ICdSYW5kb21UYXJnZXQnIHRoZW4KICAgICAgICBsb2NhbCBjYW5kaWRhdGVzID0ge30KICAgICAgICBmb3IgXywgdiBpbiBwYWlycyh3b3Jrc3BhY2UuQWxpdmU6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgaWYgdiB+PSBQbGF5ZXIuQ2hhcmFjdGVyIGFuZCB2LlByaW1hcnlQYXJ0IHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHNjcmVlblBvcywgaXNPblNjcmVlbiA9IENhbWVyYTpXb3JsZFRvU2NyZWVuUG9pbnQodi5QcmltYXJ5UGFydC5Qb3NpdGlvbikKICAgICAgICAgICAgICAgIGlmIGlzT25TY3JlZW4gdGhlbgogICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChjYW5kaWRhdGVzLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJhY3RlciA9IHYsCiAgICAgICAgICAgICAgICAgICAgICAgIHNjcmVlblhZICA9IHsgc2NyZWVuUG9zLlgsIHNjcmVlblBvcy5ZIH0KICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIGlmICNjYW5kaWRhdGVzID4gMCB0aGVuCiAgICAgICAgICAgIGxvY2FsIHBpY2sgPSBjYW5kaWRhdGVzWyBtYXRoLnJhbmRvbSgxLCAjY2FuZGlkYXRlcykgXQogICAgICAgICAgICBsb2NhbCBsb29rQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uLCBwaWNrLmNoYXJhY3Rlci5QcmltYXJ5UGFydC5Qb3NpdGlvbikKICAgICAgICAgICAgcmV0dXJuIHswLCBsb29rQ0ZyYW1lLCBFdmVudHMsIHBpY2suc2NyZWVuWFl9CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gezAsIENhbWVyYS5DRnJhbWUsIEV2ZW50cywgeyBDYW1lcmEuVmlld3BvcnRTaXplLlgvMiwgQ2FtZXJhLlZpZXdwb3J0U2l6ZS5ZLzIgfX0KICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICByZXR1cm4gUGFycnlfVHlwZQplbmQKCmZ1bmN0aW9uIEF1dG9fUGFycnkuUGFycnkoUGFycnlfVHlwZSkKICAgIGxvY2FsIFBhcnJ5X0RhdGEgPSBBdXRvX1BhcnJ5LlBhcnJ5X0RhdGEoUGFycnlfVHlwZSkKCiAgICBpZiBub3QgZmlyc3RQYXJyeUZpcmVkIHRoZW4KICAgICAgICBwZXJmb3JtRmlyc3RQcmVzcyhmaXJzdFBhcnJ5VHlwZSkKICAgICAgICBmaXJzdFBhcnJ5RmlyZWQgPSB0cnVlCiAgICBlbHNlCiAgICAgICAgUGFycnkoUGFycnlfRGF0YVsxXSwgUGFycnlfRGF0YVsyXSwgUGFycnlfRGF0YVszXSwgUGFycnlfRGF0YVs0XSkKICAgIGVuZAoKICAgIGlmIFBhcnJpZXMgPiA3IHRoZW4KICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZAoKICAgIFBhcnJpZXMgKz0gMQoKICAgIHRhc2suZGVsYXkoMC41LCBmdW5jdGlvbigpCiAgICAgICAgaWYgUGFycmllcyA+IDAgdGhlbgogICAgICAgICAgICBQYXJyaWVzIC09IDEKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgpsb2NhbCBMZXJwX1JhZGlhbnMgPSAwCmxvY2FsIExhc3RfV2FycGluZyA9IHRpY2soKQoKZnVuY3Rpb24gQXV0b19QYXJyeS5MaW5lYXJfSW50ZXJwb2xhdGlvbihhLCBiLCB0aW1lX3ZvbHVtZSkKICAgIHJldHVybiBhICsgKGIgLSBhKSAqIHRpbWVfdm9sdW1lCmVuZAoKbG9jYWwgUHJldmlvdXNfVmVsb2NpdHkgPSB7fQpsb2NhbCBDdXJ2aW5nID0gdGljaygpCgpsb2NhbCBSdW50aW1lID0gd29ya3NwYWNlLlJ1bnRpbWUKCmZ1bmN0aW9uIEF1dG9fUGFycnkuSXNfQ3VydmVkKCkKICAgIGxvY2FsIEJhbGwgPSBBdXRvX1BhcnJ5LkdldF9CYWxsKCkKCiAgICBpZiBub3QgQmFsbCB0aGVuCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKCiAgICBsb2NhbCBab29taWVzID0gQmFsbDpGaW5kRmlyc3RDaGlsZCgnem9vbWllcycpCiAgICBpZiBub3QgWm9vbWllcyB0aGVuCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKCiAgICBsb2NhbCBQaW5nID0gZ2FtZTpHZXRTZXJ2aWNlKCdTdGF0cycpLk5ldHdvcmsuU2VydmVyU3RhdHNJdGVtWydEYXRhIFBpbmcnXTpHZXRWYWx1ZSgpCiAgICBsb2NhbCBWZWxvY2l0eSA9IFpvb21pZXMuVmVjdG9yVmVsb2NpdHkKICAgIGxvY2FsIEJhbGxfRGlyZWN0aW9uID0gVmVsb2NpdHkuVW5pdAoKICAgIGxvY2FsIHBsYXllclBvcyA9IFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQuUG9zaXRpb24KICAgIGxvY2FsIGJhbGxQb3MgPSBCYWxsLlBvc2l0aW9uCiAgICBsb2NhbCBEaXJlY3Rpb24gPSAocGxheWVyUG9zIC0gYmFsbFBvcykuVW5pdAogICAgbG9jYWwgRG90ID0gRGlyZWN0aW9uOkRvdChCYWxsX0RpcmVjdGlvbikKICAgIGxvY2FsIFNwZWVkID0gVmVsb2NpdHkuTWFnbml0dWRlCgogICAgbG9jYWwgU3BlZWRfVGhyZXNob2xkID0gbWF0aC5taW4oU3BlZWQvMTAwLCA0MCkKICAgIGxvY2FsIEFuZ2xlX1RocmVzaG9sZCA9IDQwICogbWF0aC5tYXgoRG90LCAwKQogICAgbG9jYWwgRGlzdGFuY2UgPSAocGxheWVyUG9zIC0gYmFsbFBvcykuTWFnbml0dWRlCiAgICBsb2NhbCBSZWFjaF9UaW1lID0gRGlzdGFuY2UgLyBTcGVlZCAtIChQaW5nIC8gMTAwMCkKICAgIAogICAgbG9jYWwgQmFsbF9EaXN0YW5jZV9UaHJlc2hvbGQgPSAxNSAtIG1hdGgubWluKERpc3RhbmNlLzEwMDAsIDE1KSArIFNwZWVkX1RocmVzaG9sZAoKICAgIHRhYmxlLmluc2VydChQcmV2aW91c19WZWxvY2l0eSwgVmVsb2NpdHkpCiAgICBpZiAjUHJldmlvdXNfVmVsb2NpdHkgPiA0IHRoZW4KICAgICAgICB0YWJsZS5yZW1vdmUoUHJldmlvdXNfVmVsb2NpdHksIDEpCiAgICBlbmQKCiAgICBpZiBCYWxsOkZpbmRGaXJzdENoaWxkKCdBZXJvRHluYW1pY1NsYXNoVkZYJykgdGhlbgogICAgICAgIERlYnJpczpBZGRJdGVtKEJhbGwuQWVyb0R5bmFtaWNTbGFzaFZGWCwgMCkKICAgICAgICBUb3JuYWRvX1RpbWUgPSB0aWNrKCkKICAgIGVuZAoKICAgIGlmIFJ1bnRpbWU6RmluZEZpcnN0Q2hpbGQoJ1Rvcm5hZG8nKSB0aGVuCiAgICAgICAgaWYgKHRpY2soKSAtIFRvcm5hZG9fVGltZSkgPCAoKFJ1bnRpbWUuVG9ybmFkbzpHZXRBdHRyaWJ1dGUoIlRvcm5hZG9UaW1lIikgb3IgMSkgKyAwLjMxNDE1OSkgdGhlbgogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIGVuZAogICAgZW5kCgogICAgbG9jYWwgRW5vdWdoX1NwZWVkID0gU3BlZWQgPiAxNjAKICAgIGlmIEVub3VnaF9TcGVlZCBhbmQgUmVhY2hfVGltZSA+IFBpbmcgLyAxMCB0aGVuCiAgICAgICAgaWYgU3BlZWQgPCAzMDAgdGhlbgogICAgICAgICAgICBCYWxsX0Rpc3RhbmNlX1RocmVzaG9sZCA9IG1hdGgubWF4KEJhbGxfRGlzdGFuY2VfVGhyZXNob2xkIC0gMTUsIDE1KQogICAgICAgIGVsc2VpZiBTcGVlZCA+IDMwMCBhbmQgU3BlZWQgPCA2MDAgdGhlbgogICAgICAgICAgICBCYWxsX0Rpc3RhbmNlX1RocmVzaG9sZCA9IG1hdGgubWF4KEJhbGxfRGlzdGFuY2VfVGhyZXNob2xkIC0gMTYsIDE2KQogICAgICAgIGVsc2VpZiBTcGVlZCA+IDYwMCBhbmQgU3BlZWQgPCAxMDAwIHRoZW4KICAgICAgICAgICAgQmFsbF9EaXN0YW5jZV9UaHJlc2hvbGQgPSBtYXRoLm1heChCYWxsX0Rpc3RhbmNlX1RocmVzaG9sZCAtIDE3LCAxNykKICAgICAgICBlbHNlaWYgU3BlZWQgPiAxMDAwIGFuZCBTcGVlZCA8IDE1MDAgdGhlbgogICAgICAgICAgICBCYWxsX0Rpc3RhbmNlX1RocmVzaG9sZCA9IG1hdGgubWF4KEJhbGxfRGlzdGFuY2VfVGhyZXNob2xkIC0gMTksIDE5KQogICAgICAgIGVsc2VpZiBTcGVlZCA+IDE1MDAgdGhlbgogICAgICAgICAgICBCYWxsX0Rpc3RhbmNlX1RocmVzaG9sZCA9IG1hdGgubWF4KEJhbGxfRGlzdGFuY2VfVGhyZXNob2xkIC0gMjAsIDIwKQogICAgICAgIGVuZAogICAgZW5kCgogICAgaWYgRGlzdGFuY2UgPCBCYWxsX0Rpc3RhbmNlX1RocmVzaG9sZCB0aGVuCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKCiAgICBpZiBTcGVlZCA8IDMwMCB0aGVuCiAgICAgICAgaWYgKHRpY2soKSAtIEN1cnZpbmcpIDwgKFJlYWNoX1RpbWUgLyAxLjIpIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVsc2VpZiBTcGVlZCA+PSAzMDAgYW5kIFNwZWVkIDwgNDUwIHRoZW4KICAgICAgICBpZiAodGljaygpIC0gQ3VydmluZykgPCAoUmVhY2hfVGltZSAvIDEuMjEpIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVsc2VpZiBTcGVlZCA+IDQ1MCBhbmQgU3BlZWQgPCA2MDAgdGhlbgogICAgICAgIGlmICh0aWNrKCkgLSBDdXJ2aW5nKSA8IChSZWFjaF9UaW1lIC8gMS4zMzUpIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVsc2VpZiBTcGVlZCA+IDYwMCB0aGVuCiAgICAgICAgaWYgKHRpY2soKSAtIEN1cnZpbmcpIDwgKFJlYWNoX1RpbWUgLyAxLjUpIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICBsb2NhbCBEb3RfVGhyZXNob2xkID0gKDAuNSAtIFBpbmcgLyAxMDAwKQogICAgbG9jYWwgRGlyZWN0aW9uX0RpZmZlcmVuY2UgPSAoQmFsbF9EaXJlY3Rpb24gLSBWZWxvY2l0eS5Vbml0KQogICAgbG9jYWwgRGlyZWN0aW9uX1NpbWlsYXJpdHkgPSBEaXJlY3Rpb246RG90KERpcmVjdGlvbl9EaWZmZXJlbmNlLlVuaXQpCiAgICBsb2NhbCBEb3RfRGlmZmVyZW5jZSA9IERvdCAtIERpcmVjdGlvbl9TaW1pbGFyaXR5CgogICAgaWYgRG90X0RpZmZlcmVuY2UgPCBEb3RfVGhyZXNob2xkIHRoZW4KICAgICAgICByZXR1cm4gdHJ1ZQogICAgZW5kCgogICAgbG9jYWwgQ2xhbXBlZF9Eb3QgPSBtYXRoLmNsYW1wKERvdCwgLTEsIDEpCiAgICBsb2NhbCBSYWRpYW5zID0gbWF0aC5kZWcobWF0aC5hc2luKENsYW1wZWRfRG90KSkKCiAgICBMZXJwX1JhZGlhbnMgPSBBdXRvX1BhcnJ5LkxpbmVhcl9JbnRlcnBvbGF0aW9uKExlcnBfUmFkaWFucywgUmFkaWFucywgMC44KQogICAgaWYgU3BlZWQgPCAzMDAgdGhlbgogICAgICAgIGlmIExlcnBfUmFkaWFucyA8IDAuMDIgdGhlbgogICAgICAgICAgICBMYXN0X1dhcnBpbmcgPSB0aWNrKCkKICAgICAgICBlbmQKICAgICAgICBpZiAodGljaygpIC0gTGFzdF9XYXJwaW5nKSA8IChSZWFjaF9UaW1lIC8gMS4xOSkgdGhlbgogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIGlmIExlcnBfUmFkaWFucyA8IDAuMDE4IHRoZW4KICAgICAgICAgICAgTGFzdF9XYXJwaW5nID0gdGljaygpCiAgICAgICAgZW5kCiAgICAgICAgaWYgKHRpY2soKSAtIExhc3RfV2FycGluZykgPCAoUmVhY2hfVGltZSAvIDEuNSkgdGhlbgogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIGVuZAogICAgZW5kCgogICAgaWYgI1ByZXZpb3VzX1ZlbG9jaXR5ID09IDQgdGhlbgogICAgICAgIGxvY2FsIEludGVuZGVkX0RpcmVjdGlvbl9EaWZmZXJlbmNlID0gKEJhbGxfRGlyZWN0aW9uIC0gUHJldmlvdXNfVmVsb2NpdHlbMV0uVW5pdCkuVW5pdAogICAgICAgIGxvY2FsIEludGVuZGVkX0RvdCA9IERpcmVjdGlvbjpEb3QoSW50ZW5kZWRfRGlyZWN0aW9uX0RpZmZlcmVuY2UpCiAgICAgICAgbG9jYWwgSW50ZW5kZWRfRG90X0RpZmZlcmVuY2UgPSBEb3QgLSBJbnRlbmRlZF9Eb3QKCiAgICAgICAgbG9jYWwgSW50ZW5kZWRfRGlyZWN0aW9uX0RpZmZlcmVuY2UyID0gKEJhbGxfRGlyZWN0aW9uIC0gUHJldmlvdXNfVmVsb2NpdHlbMl0uVW5pdCkuVW5pdAogICAgICAgIGxvY2FsIEludGVuZGVkX0RvdDIgPSBEaXJlY3Rpb246RG90KEludGVuZGVkX0RpcmVjdGlvbl9EaWZmZXJlbmNlMikKICAgICAgICBsb2NhbCBJbnRlbmRlZF9Eb3RfRGlmZmVyZW5jZTIgPSBEb3QgLSBJbnRlbmRlZF9Eb3QyCgogICAgICAgIGlmIEludGVuZGVkX0RvdF9EaWZmZXJlbmNlIDwgRG90X1RocmVzaG9sZCBvciBJbnRlbmRlZF9Eb3RfRGlmZmVyZW5jZTIgPCBEb3RfVGhyZXNob2xkIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGJhY2t3YXJkc0N1cnZlRGV0ZWN0ZWQgPSBmYWxzZQogICAgbG9jYWwgYmFja3dhcmRzQW5nbGVUaHJlc2hvbGQgPSA4NQoKICAgIGxvY2FsIGhvcml6RGlyZWN0aW9uID0gVmVjdG9yMy5uZXcocGxheWVyUG9zLlggLSBiYWxsUG9zLlgsIDAsIHBsYXllclBvcy5aIC0gYmFsbFBvcy5aKQogICAgaWYgaG9yaXpEaXJlY3Rpb24uTWFnbml0dWRlID4gMCB0aGVuCiAgICAgICAgaG9yaXpEaXJlY3Rpb24gPSBob3JpekRpcmVjdGlvbi5Vbml0CiAgICBlbmQKCiAgICBsb2NhbCBhd2F5RnJvbVBsYXllciA9IC1ob3JpekRpcmVjdGlvbgoKICAgIGxvY2FsIGhvcml6QmFsbERpciA9IFZlY3RvcjMubmV3KEJhbGxfRGlyZWN0aW9uLlgsIDAsIEJhbGxfRGlyZWN0aW9uLlopCiAgICBpZiBob3JpekJhbGxEaXIuTWFnbml0dWRlID4gMCB0aGVuCiAgICAgICAgaG9yaXpCYWxsRGlyID0gaG9yaXpCYWxsRGlyLlVuaXQKICAgICAgICBsb2NhbCBiYWNrd2FyZHNBbmdsZSA9IG1hdGguZGVnKG1hdGguYWNvcyhtYXRoLmNsYW1wKGF3YXlGcm9tUGxheWVyOkRvdChob3JpekJhbGxEaXIpLCAtMSwgMSkpKQogICAgICAgIGlmIGJhY2t3YXJkc0FuZ2xlIDwgYmFja3dhcmRzQW5nbGVUaHJlc2hvbGQgdGhlbgogICAgICAgICAgICBiYWNrd2FyZHNDdXJ2ZURldGVjdGVkID0gdHJ1ZQogICAgICAgIGVuZAogICAgZW5kCgogICAgcmV0dXJuIChEb3QgPCBEb3RfVGhyZXNob2xkKSBvciBiYWNrd2FyZHNDdXJ2ZURldGVjdGVkCmVuZAoKZnVuY3Rpb24gQXV0b19QYXJyeTpHZXRfQmFsbF9Qcm9wZXJ0aWVzKCkKICAgIGxvY2FsIEJhbGwgPSBBdXRvX1BhcnJ5LkdldF9CYWxsKCkKCiAgICBsb2NhbCBCYWxsX1ZlbG9jaXR5ID0gVmVjdG9yMy56ZXJvCiAgICBsb2NhbCBCYWxsX09yaWdpbiA9IEJhbGwKCiAgICBsb2NhbCBCYWxsX0RpcmVjdGlvbiA9IChQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uIC0gQmFsbF9PcmlnaW4uUG9zaXRpb24pLlVuaXQKICAgIGxvY2FsIEJhbGxfRGlzdGFuY2UgPSAoUGxheWVyLkNoYXJhY3Rlci5QcmltYXJ5UGFydC5Qb3NpdGlvbiAtIEJhbGwuUG9zaXRpb24pLk1hZ25pdHVkZQogICAgbG9jYWwgQmFsbF9Eb3QgPSBCYWxsX0RpcmVjdGlvbjpEb3QoQmFsbF9WZWxvY2l0eS5Vbml0KQoKICAgIHJldHVybiB7CiAgICAgICAgVmVsb2NpdHkgPSBCYWxsX1ZlbG9jaXR5LAogICAgICAgIERpcmVjdGlvbiA9IEJhbGxfRGlyZWN0aW9uLAogICAgICAgIERpc3RhbmNlID0gQmFsbF9EaXN0YW5jZSwKICAgICAgICBEb3QgPSBCYWxsX0RvdAogICAgfQplbmQKCmZ1bmN0aW9uIEF1dG9fUGFycnkuU3BhbV9TZXJ2aWNlKHNlbGYpCiAgICBsb2NhbCBCYWxsID0gQXV0b19QYXJyeS5HZXRfQmFsbCgpCgogICAgbG9jYWwgRW50aXR5ID0gQXV0b19QYXJyeS5DbG9zZXN0X1BsYXllcigpCgogICAgaWYgbm90IEJhbGwgdGhlbgogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCgogICAgaWYgbm90IEVudGl0eSBvciBub3QgRW50aXR5LlByaW1hcnlQYXJ0IHRoZW4KICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZAoKICAgIGxvY2FsIFNwYW1fQWNjdXJhY3kgPSAwCgogICAgbG9jYWwgVmVsb2NpdHkgPSBCYWxsLkFzc2VtYmx5TGluZWFyVmVsb2NpdHkKICAgIGxvY2FsIFNwZWVkID0gVmVsb2NpdHkuTWFnbml0dWRlCgogICAgbG9jYWwgRGlyZWN0aW9uID0gKFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQuUG9zaXRpb24gLSBCYWxsLlBvc2l0aW9uKS5Vbml0CiAgICBsb2NhbCBEb3QgPSBEaXJlY3Rpb246RG90KFZlbG9jaXR5LlVuaXQpCgogICAgbG9jYWwgVGFyZ2V0X1Bvc2l0aW9uID0gRW50aXR5LlByaW1hcnlQYXJ0LlBvc2l0aW9uCiAgICBsb2NhbCBUYXJnZXRfRGlzdGFuY2UgPSBQbGF5ZXI6RGlzdGFuY2VGcm9tQ2hhcmFjdGVyKFRhcmdldF9Qb3NpdGlvbikKCiAgICBsb2NhbCBNYXhpbXVtX1NwYW1fRGlzdGFuY2UgPSBzZWxmLlBpbmcgKyBtYXRoLm1pbihTcGVlZCAvIDYsIDk1KQoKICAgIGlmIHNlbGYuRW50aXR5X1Byb3BlcnRpZXMuRGlzdGFuY2UgPiBNYXhpbXVtX1NwYW1fRGlzdGFuY2UgdGhlbgogICAgICAgIHJldHVybiBTcGFtX0FjY3VyYWN5CiAgICBlbmQKCiAgICBpZiBzZWxmLkJhbGxfUHJvcGVydGllcy5EaXN0YW5jZSA+IE1heGltdW1fU3BhbV9EaXN0YW5jZSB0aGVuCiAgICAgICAgcmV0dXJuIFNwYW1fQWNjdXJhY3kKICAgIGVuZAoKICAgIGlmIFRhcmdldF9EaXN0YW5jZSA+IE1heGltdW1fU3BhbV9EaXN0YW5jZSB0aGVuCiAgICAgICAgcmV0dXJuIFNwYW1fQWNjdXJhY3kKICAgIGVuZAoKICAgIGxvY2FsIE1heGltdW1fU3BlZWQgPSA1IC0gbWF0aC5taW4oU3BlZWQgLyA1LCA1KQogICAgbG9jYWwgTWF4aW11bV9Eb3QgPSBtYXRoLmNsYW1wKERvdCwgLTEsIDApICogTWF4aW11bV9TcGVlZAoKICAgIFNwYW1fQWNjdXJhY3kgPSBNYXhpbXVtX1NwYW1fRGlzdGFuY2UgLSBNYXhpbXVtX0RvdAoKICAgIHJldHVybiBTcGFtX0FjY3VyYWN5CmVuZAoKbG9jYWwgQ29ubmVjdGlvbnNfTWFuYWdlciA9IHt9CmxvY2FsIFNlbGVjdGVkX1BhcnJ5X1R5cGUgPSBuaWwKCmxvY2FsIFBhcnJpZWQgPSBmYWxzZQpsb2NhbCBMYXN0X1BhcnJ5ID0gMAoKCmxvY2FsIGRlYXRoc2hpdCA9IGZhbHNlCgpSZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLkRlYXRoQmFsbC5PbkNsaWVudEV2ZW50OkNvbm5lY3QoZnVuY3Rpb24oYywgZCkKICAgIGlmIGQgdGhlbgogICAgICAgIGRlYXRoc2hpdCA9IHRydWUKICAgIGVsc2UKICAgICAgICBkZWF0aHNoaXQgPSBmYWxzZQogICAgZW5kCmVuZCkKCmxvY2FsIEluZmluaXR5ID0gZmFsc2UKClJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuSW5maW5pdHlCYWxsLk9uQ2xpZW50RXZlbnQ6Q29ubmVjdChmdW5jdGlvbihhLCBiKQogICAgaWYgYiB0aGVuCiAgICAgICAgSW5maW5pdHkgPSB0cnVlCiAgICBlbHNlCiAgICAgICAgSW5maW5pdHkgPSBmYWxzZQogICAgZW5kCmVuZCkKCgpsb2NhbCB0aW1laG9sZSA9IGZhbHNlCgpSZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLlRpbWVIb2xlSG9sZEJhbGwuT25DbGllbnRFdmVudDpDb25uZWN0KGZ1bmN0aW9uKGUsIGYpCiAgICBpZiBmIHRoZW4KICAgICAgICB0aW1laG9sZSA9IHRydWUKICAgIGVsc2UKICAgICAgICB0aW1laG9sZSA9IGZhbHNlCiAgICBlbmQKZW5kKQoKCmxvY2FsIEF1dG9QYXJyeSA9IHRydWUKCmxvY2FsIEJhbGxzID0gd29ya3NwYWNlOldhaXRGb3JDaGlsZCgnQmFsbHMnKQpsb2NhbCBDdXJyZW50QmFsbCA9IG5pbApsb2NhbCBJbnB1dFRhc2sgPSBuaWwKbG9jYWwgQ29vbGRvd24gPSAwLjAyCmxvY2FsIFJ1blRpbWUgPSB3b3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIlJ1bnRpbWUiKQoKCgpsb2NhbCBmdW5jdGlvbiBHZXRCYWxsKCkKICAgIGZvciBfLCBCYWxsIGluIGlwYWlycyhCYWxsczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgIGlmIEJhbGw6RmluZEZpcnN0Q2hpbGQoImZmIikgdGhlbgogICAgICAgICAgICByZXR1cm4gQmFsbAogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gbmlsCmVuZAoKbG9jYWwgZnVuY3Rpb24gU3BhbUlucHV0KExhYmVsKQogICAgaWYgSW5wdXRUYXNrIHRoZW4gcmV0dXJuIGVuZAogICAgSW5wdXRUYXNrID0gdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgQXV0b1BhcnJ5IGRvCiAgICAgICAgICAgIEF1dG9fUGFycnkuUGFycnkoU2VsZWN0ZWRfUGFycnlfVHlwZSkKICAgICAgICAgICAgdGFzay53YWl0KENvb2xkb3duKQogICAgICAgIGVuZAogICAgICAgIElucHV0VGFzayA9IG5pbAogICAgZW5kKQplbmQKCkJhbGxzLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihWYWx1ZSkKICAgIFZhbHVlLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihDaGlsZCkKICAgICAgICBpZiBnZXRnZW52KCkuU2xhc2hPZkZ1cnlEZXRlY3Rpb24gYW5kIENoaWxkLk5hbWUgPT0gJ0NvbWJvQ291bnRlcicgdGhlbgogICAgICAgICAgICBsb2NhbCBTb2ZfTGFiZWwgPSBDaGlsZDpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoJ1RleHRMYWJlbCcpCgogICAgICAgICAgICBpZiBTb2ZfTGFiZWwgdGhlbgogICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgU2xhc2hlc19Db3VudGVyID0gdG9udW1iZXIoU29mX0xhYmVsLlRleHQpCgogICAgICAgICAgICAgICAgICAgIGlmIFNsYXNoZXNfQ291bnRlciBhbmQgU2xhc2hlc19Db3VudGVyIDwgMzIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBBdXRvX1BhcnJ5LlBhcnJ5KFNlbGVjdGVkX1BhcnJ5X1R5cGUpCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCgogICAgICAgICAgICAgICAgdW50aWwgbm90IFNvZl9MYWJlbC5QYXJlbnQgb3Igbm90IFNvZl9MYWJlbAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBwbGF5ZXIxMDIzOTEyMyA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgUnVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpCgppZiBub3QgcGxheWVyMTAyMzkxMjMgdGhlbiByZXR1cm4gZW5kCgpSdW5UaW1lLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihPYmplY3QpCiAgICBsb2NhbCBOYW1lID0gT2JqZWN0Lk5hbWUKICAgIGlmIGdldGdlbnYoKS5QaGFudG9tVjJEZXRlY3Rpb24gdGhlbgogICAgICAgIGlmIE5hbWUgPT0gIm1heFRyYW5zbWlzc2lvbiIgb3IgTmFtZSA9PSAidHJhbnNtaXNzaW9ucGFydCIgdGhlbgogICAgICAgICAgICBsb2NhbCBXZWxkID0gT2JqZWN0OkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIldlbGRDb25zdHJhaW50IikKICAgICAgICAgICAgaWYgV2VsZCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBDaGFyYWN0ZXIgPSBwbGF5ZXIxMDIzOTEyMy5DaGFyYWN0ZXIgb3IgcGxheWVyMTAyMzkxMjMuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCiAgICAgICAgICAgICAgICBpZiBDaGFyYWN0ZXIgYW5kIFdlbGQuUGFydDEgPT0gQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgIEN1cnJlbnRCYWxsID0gR2V0QmFsbCgpCiAgICAgICAgICAgICAgICAgICAgV2VsZDpEZXN0cm95KCkKICAgIAogICAgICAgICAgICAgICAgICAgIGlmIEN1cnJlbnRCYWxsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgRm9jdXNDb25uZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIEZvY3VzQ29ubmVjdGlvbiA9IFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEhpZ2hsaWdodGVkID0gQ3VycmVudEJhbGw6R2V0QXR0cmlidXRlKCJoaWdobGlnaHRlZCIpCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEhpZ2hsaWdodGVkID09IHRydWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMzYKICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEh1bWFub2lkUm9vdFBhcnQgPSBDaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEh1bWFub2lkUm9vdFBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBQbGF5ZXJQb3NpdGlvbiA9IEh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgQmFsbFBvc2l0aW9uID0gQ3VycmVudEJhbGwuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgUGxheWVyVG9CYWxsID0gKEJhbGxQb3NpdGlvbiAtIFBsYXllclBvc2l0aW9uKS5Vbml0CiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpNb3ZlKFBsYXllclRvQmFsbCwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiBIaWdobGlnaHRlZCA9PSBmYWxzZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9jdXNDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5XYWxrU3BlZWQgPSAxMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6TW92ZShWZWN0b3IzLm5ldygwLCAwLCAwKSwgZmFsc2UpCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLmRlbGF5KDMsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5XYWxrU3BlZWQgPSAzNgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEN1cnJlbnRCYWxsID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suZGVsYXkoMywgZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgRm9jdXNDb25uZWN0aW9uIGFuZCBGb2N1c0Nvbm5lY3Rpb24uQ29ubmVjdGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb2N1c0Nvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOk1vdmUoVmVjdG9yMy5uZXcoMCwgMCwgMCksIGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMzYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDdXJyZW50QmFsbCA9IG5pbAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpsb2NhbCBwbGF5ZXIxMSA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCBQbGF5ZXJHdWkgPSBwbGF5ZXIxMTpXYWl0Rm9yQ2hpbGQoIlBsYXllckd1aSIpCmxvY2FsIHBsYXllckd1aSA9IHBsYXllcjExOldhaXRGb3JDaGlsZCgiUGxheWVyR3VpIikKbG9jYWwgSG90YmFyID0gUGxheWVyR3VpOldhaXRGb3JDaGlsZCgiSG90YmFyIikKCgpsb2NhbCBQYXJyeUNEID0gcGxheWVyR3VpLkhvdGJhci5CbG9jay5VSUdyYWRpZW50CmxvY2FsIEFiaWxpdHlDRCA9IHBsYXllckd1aS5Ib3RiYXIuQWJpbGl0eS5VSUdyYWRpZW50Cgpsb2NhbCBmdW5jdGlvbiBpc0Nvb2xkb3duSW5FZmZlY3QxKHVpZ3JhZGllbnQpCiAgICByZXR1cm4gdWlncmFkaWVudC5PZmZzZXQuWSA8IDAuNAplbmQKCmxvY2FsIGZ1bmN0aW9uIGlzQ29vbGRvd25JbkVmZmVjdDIodWlncmFkaWVudCkKICAgIHJldHVybiB1aWdyYWRpZW50Lk9mZnNldC5ZID09IDAuNQplbmQKCmxvY2FsIGZ1bmN0aW9uIGNvb2xkb3duUHJvdGVjdGlvbigpCiAgICBpZiBpc0Nvb2xkb3duSW5FZmZlY3QxKFBhcnJ5Q0QpIHRoZW4KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuUmVtb3Rlcy5BYmlsaXR5QnV0dG9uUHJlc3M6RmlyZSgpCiAgICAgICAgcmV0dXJuIHRydWUKICAgIGVuZAogICAgcmV0dXJuIGZhbHNlCmVuZAoKbG9jYWwgZnVuY3Rpb24gQXV0b0FiaWxpdHkoKQogICAgaWYgaXNDb29sZG93bkluRWZmZWN0MihBYmlsaXR5Q0QpIHRoZW4KICAgICAgICBpZiBQbGF5ZXIuQ2hhcmFjdGVyLkFiaWxpdGllc1siUmFnaW5nIERlZmxlY3Rpb24iXS5FbmFibGVkIG9yIFBsYXllci5DaGFyYWN0ZXIuQWJpbGl0aWVzWyJSYXB0dXJlIl0uRW5hYmxlZCBvciBQbGF5ZXIuQ2hhcmFjdGVyLkFiaWxpdGllc1siQ2FsbWluZyBEZWZsZWN0aW9uIl0uRW5hYmxlZCBvciBQbGF5ZXIuQ2hhcmFjdGVyLkFiaWxpdGllc1siQWVyb2R5bmFtaWMgU2xhc2giXS5FbmFibGVkIG9yIFBsYXllci5DaGFyYWN0ZXIuQWJpbGl0aWVzWyJGcmFjdHVyZSJdLkVuYWJsZWQgb3IgUGxheWVyLkNoYXJhY3Rlci5BYmlsaXRpZXNbIkRlYXRoIFNsYXNoIl0uRW5hYmxlZCB0aGVuCiAgICAgICAgICAgIFBhcnJpZWQgPSB0cnVlCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5SZW1vdGVzLkFiaWxpdHlCdXR0b25QcmVzczpGaXJlKCkKICAgICAgICAgICAgdGFzay53YWl0KDIuNDMyKQogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJSZW1vdGVzIik6V2FpdEZvckNoaWxkKCJEZWF0aFNsYXNoU2hvb3RBY3RpdmF0aW9uIik6RmlyZVNlcnZlcih0cnVlKQogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gZmFsc2UKZW5kCgpkbwogICAgbG9jYWwgbW9kdWxlID0gcmFnZTpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICdBdXRvIFBhcnJ5JywKICAgICAgICBmbGFnID0gJ0F1dG9fUGFycnknLAogICAgICAgIGRlc2NyaXB0aW9uID0gJ0F1dG9tYXRpY2FsbHkgcGFycmllcyBiYWxsJywKICAgICAgICBzZWN0aW9uID0gJ2xlZnQnLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvUGFycnlOb3RpZnkgdGhlbgogICAgICAgICAgICAgICAgaWYgdmFsdWUgdGhlbgogICAgICAgICAgICAgICAgICAgIExpYnJhcnkuU2VuZE5vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gIk1vZHVsZSBOb3RpZmljYXRpb24iLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gIkF1dG8gUGFycnkgaGFzIGJlZW4gdHVybmVkIE9OIiwKICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb24gPSAzCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5LlNlbmROb3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZSA9ICJNb2R1bGUgTm90aWZpY2F0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9ICJBdXRvIFBhcnJ5IGhhcyBiZWVuIHR1cm5lZCBPRkYiLAogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IDMKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICBDb25uZWN0aW9uc19NYW5hZ2VyWydBdXRvIFBhcnJ5J10gPSBSdW5TZXJ2aWNlLlByZVNpbXVsYXRpb246Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgT25lX0JhbGwgPSBBdXRvX1BhcnJ5LkdldF9CYWxsKCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBCYWxscyA9IEF1dG9fUGFycnkuR2V0X0JhbGxzKCkKCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sIEJhbGwgaW4gcGFpcnMoQmFsbHMpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBCYWxsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFpvb21pZXMgPSBCYWxsOkZpbmRGaXJzdENoaWxkKCd6b29taWVzJykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IFpvb21pZXMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgQmFsbDpHZXRBdHRyaWJ1dGVDaGFuZ2VkU2lnbmFsKCd0YXJnZXQnKTpPbmNlKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcnJpZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBQYXJyaWVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEJhbGxfVGFyZ2V0ID0gQmFsbDpHZXRBdHRyaWJ1dGUoJ3RhcmdldCcpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIE9uZV9UYXJnZXQgPSBPbmVfQmFsbDpHZXRBdHRyaWJ1dGUoJ3RhcmdldCcpCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBWZWxvY2l0eSA9IFpvb21pZXMuVmVjdG9yVmVsb2NpdHkKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIERpc3RhbmNlID0gKFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQuUG9zaXRpb24gLSBCYWxsLlBvc2l0aW9uKS5NYWduaXR1ZGUKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFBpbmcgPSBnYW1lOkdldFNlcnZpY2UoJ1N0YXRzJykuTmV0d29yay5TZXJ2ZXJTdGF0c0l0ZW1bJ0RhdGEgUGluZyddOkdldFZhbHVlKCkgLyAxMAoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgUGluZ19UaHJlc2hvbGQgPSBtYXRoLmNsYW1wKFBpbmcgLyAxMCwgNSwgMTcpCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBTcGVlZCA9IFZlbG9jaXR5Lk1hZ25pdHVkZQoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2FwcGVkU3BlZWREaWZmID0gbWF0aC5taW4obWF0aC5tYXgoU3BlZWQgLSA5LjUsIDApLCA2NTApCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHNwZWVkX2Rpdmlzb3JfYmFzZSA9IDIuNCArIGNhcHBlZFNwZWVkRGlmZiAqIDAuMDAyCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBlZmZlY3RpdmVNdWx0aXBsaWVyID0gU3BlZWRfRGl2aXNvcl9NdWx0aXBsaWVyCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5SYW5kb21QYXJyeUFjY3VyYWN5RW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBTcGVlZCA8IDIwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWZmZWN0aXZlTXVsdGlwbGllciA9IDAuNyArIChtYXRoLnJhbmRvbSg0MCwgMTAwKSAtIDEpICogKDAuMzUgLyA5OSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZmZlY3RpdmVNdWx0aXBsaWVyID0gMC43ICsgKG1hdGgucmFuZG9tKDEsIDEwMCkgLSAxKSAqICgwLjM1IC8gOTkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBzcGVlZF9kaXZpc29yID0gc3BlZWRfZGl2aXNvcl9iYXNlICogZWZmZWN0aXZlTXVsdGlwbGllcgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBQYXJyeV9BY2N1cmFjeSA9IFBpbmdfVGhyZXNob2xkICsgbWF0aC5tYXgoU3BlZWQgLyBzcGVlZF9kaXZpc29yLCA5LjUpCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBDdXJ2ZWQgPSBBdXRvX1BhcnJ5LklzX0N1cnZlZCgpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBCYWxsOkZpbmRGaXJzdENoaWxkKCdBZXJvRHluYW1pY1NsYXNoVkZYJykgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVicmlzOkFkZEl0ZW0oQmFsbC5BZXJvRHluYW1pY1NsYXNoVkZYLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgVG9ybmFkb19UaW1lID0gdGljaygpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgUnVudGltZTpGaW5kRmlyc3RDaGlsZCgnVG9ybmFkbycpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aWNrKCkgLSBUb3JuYWRvX1RpbWUpIDwgKFJ1bnRpbWUuVG9ybmFkbzpHZXRBdHRyaWJ1dGUoIlRvcm5hZG9UaW1lIikgb3IgMSkgKyAwLjMxNDE1OSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIE9uZV9UYXJnZXQgPT0gdG9zdHJpbmcoUGxheWVyKSBhbmQgQ3VydmVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIEJhbGw6RmluZEZpcnN0Q2hpbGQoIkNvbWJvQ291bnRlciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFNpbmd1bGFyaXR5X0NhcGUgPSBQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0OkZpbmRGaXJzdENoaWxkKCdTaW5ndWxhcml0eUNhcGUnKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBTaW5ndWxhcml0eV9DYXBlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQgCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuSW5maW5pdHlEZXRlY3Rpb24gYW5kIEluZmluaXR5IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5EZWF0aFNsYXNoRGV0ZWN0aW9uIGFuZCBkZWF0aHNoaXQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlRpbWVIb2xlRGV0ZWN0aW9uIGFuZCB0aW1laG9sZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBCYWxsX1RhcmdldCA9PSB0b3N0cmluZyhQbGF5ZXIpIGFuZCBEaXN0YW5jZSA8PSBQYXJyeV9BY2N1cmFjeSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0FiaWxpdHkgYW5kIEF1dG9BYmlsaXR5KCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgQmFsbF9UYXJnZXQgPT0gdG9zdHJpbmcoUGxheWVyKSBhbmQgRGlzdGFuY2UgPD0gUGFycnlfQWNjdXJhY3kgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkNvb2xkb3duUHJvdGVjdGlvbiBhbmQgY29vbGRvd25Qcm90ZWN0aW9uKCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgUGFycnlfVGltZSA9IG9zLmNsb2NrKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFRpbWVfVmlldyA9IFBhcnJ5X1RpbWUgLSAoTGFzdF9QYXJyeSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIFRpbWVfVmlldyA+IDAuNSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b19QYXJyeS5QYXJyeV9BbmltYXRpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9QYXJyeUtleXByZXNzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWaXJ0dWFsSW5wdXRTZXJ2aWNlOlNlbmRLZXlFdmVudCh0cnVlLCBFbnVtLktleUNvZGUuRiwgZmFsc2UsIG5pbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRvX1BhcnJ5LlBhcnJ5KFNlbGVjdGVkX1BhcnJ5X1R5cGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMYXN0X1BhcnJ5ID0gUGFycnlfVGltZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFycmllZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIExhc3RfUGFycnlzID0gdGljaygpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUnVuU2VydmljZS5QcmVTaW11bGF0aW9uOldhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICB1bnRpbCAodGljaygpIC0gTGFzdF9QYXJyeXMpID49IDEgb3Igbm90IFBhcnJpZWQKICAgICAgICAgICAgICAgICAgICAgICAgUGFycmllZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlmIENvbm5lY3Rpb25zX01hbmFnZXJbJ0F1dG8gUGFycnknXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNfTWFuYWdlclsnQXV0byBQYXJyeSddOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ0F1dG8gUGFycnknXSA9IG5pbAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCiAgICBsb2NhbCBkcm9wZG93bjMgPSBtb2R1bGU6Y3JlYXRlX2Ryb3Bkb3duKHsKICAgICAgICB0aXRsZSA9ICdGaXJzdCBQYXJyeSBUeXBlJywKICAgICAgICBmbGFnID0gJ0ZpcnN0X1BhcnJ5X1R5cGUnLAoKICAgICAgICBvcHRpb25zID0gewogICAgICAgICAgICAnRl9LZXknLAogICAgICAgICAgICAnTGVmdF9DbGljaycsCiAgICAgICAgICAgICdOYXZpZ2F0aW9uJwogICAgICAgIH0sCgogICAgICAgIG11bHRpX2Ryb3Bkb3duID0gZmFsc2UsCiAgICAgICAgbWF4aW11bV9vcHRpb25zID0gMywKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBmaXJzdFBhcnJ5VHlwZSA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQoKICAgIGxvY2FsIHBhcnJ5VHlwZU1hcCA9IHsKICAgICAgICBbIkNhbWVyYSJdID0gIkNhbWVyYSIsCiAgICAgICAgWyJSYW5kb20iXSA9ICJSYW5kb20iLAogICAgICAgIFsiQmFja3dhcmRzIl0gPSAiQmFja3dhcmRzIiwKICAgICAgICBbIlN0cmFpZ2h0Il0gPSAiU3RyYWlnaHQiLAogICAgICAgIFsiSGlnaCJdID0gIkhpZ2giLAogICAgICAgIFsiTGVmdCJdID0gIkxlZnQiLAogICAgICAgIFsiUmlnaHQiXSA9ICJSaWdodCIsCiAgICAgICAgWyJSYW5kb20gVGFyZ2V0Il0gPSAiUmFuZG9tVGFyZ2V0IgogICAgfQoKICAgIGxvY2FsIGRyb3Bkb3duID0gbW9kdWxlOmNyZWF0ZV9kcm9wZG93bih7CiAgICAgICAgdGl0bGUgPSAnUGFycnkgVHlwZScsCiAgICAgICAgZmxhZyA9ICdQYXJyeV9UeXBlJywKCiAgICAgICAgb3B0aW9ucyA9IHsKICAgICAgICAgICAgJ0NhbWVyYScsCiAgICAgICAgICAgICdSYW5kb20nLAogICAgICAgICAgICAnQmFja3dhcmRzJywKICAgICAgICAgICAgJ1N0cmFpZ2h0JywKICAgICAgICAgICAgJ0hpZ2gnLAogICAgICAgICAgICAnTGVmdCcsCiAgICAgICAgICAgICdSaWdodCcsCiAgICAgICAgICAgICdSYW5kb20gVGFyZ2V0JwogICAgICAgIH0sCgogICAgICAgIG11bHRpX2Ryb3Bkb3duID0gZmFsc2UsCiAgICAgICAgbWF4aW11bV9vcHRpb25zID0gOCwKCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogc3RyaW5nKQogICAgICAgICAgICBTZWxlY3RlZF9QYXJyeV9UeXBlID0gcGFycnlUeXBlTWFwW3ZhbHVlXSBvciB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCgoKICAgIGxvY2FsIFVzZXJJbnB1dFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlVzZXJJbnB1dFNlcnZpY2UiKQoKICAgIGxvY2FsIHBhcnJ5T3B0aW9ucyA9IHsKICAgICAgICBbRW51bS5LZXlDb2RlLk9uZV0gPSAiQ2FtZXJhIiwKICAgICAgICBbRW51bS5LZXlDb2RlLlR3b10gPSAiUmFuZG9tIiwKICAgICAgICBbRW51bS5LZXlDb2RlLlRocmVlXSA9ICJCYWNrd2FyZHMiLAogICAgICAgIFtFbnVtLktleUNvZGUuRm91cl0gPSAiU3RyYWlnaHQiLAogICAgICAgIFtFbnVtLktleUNvZGUuRml2ZV0gPSAiSGlnaCIsCiAgICAgICAgW0VudW0uS2V5Q29kZS5TaXhdID0gIkxlZnQiLAogICAgICAgIFtFbnVtLktleUNvZGUuU2V2ZW5dID0gIlJpZ2h0IiwKICAgICAgICBbRW51bS5LZXlDb2RlLkVpZ2h0XSA9ICJSYW5kb20gVGFyZ2V0IgogICAgfQoKICAgIFVzZXJJbnB1dFNlcnZpY2UuSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKGlucHV0LCBnYW1lUHJvY2Vzc2VkKQogICAgICAgIGlmIGdhbWVQcm9jZXNzZWQgdGhlbiAKICAgICAgICAgICAgcmV0dXJuIAogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgZ2V0Z2VudigpLkhvdGtleVBhcnJ5VHlwZSB0aGVuCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBuZXdUeXBlID0gcGFycnlPcHRpb25zW2lucHV0LktleUNvZGVdCiAgICAgICAgaWYgbmV3VHlwZSB0aGVuCiAgICAgICAgICAgIFNlbGVjdGVkX1BhcnJ5X1R5cGUgPSBwYXJyeVR5cGVNYXBbbmV3VHlwZV0gb3IgbmV3VHlwZQogICAgICAgICAgICBkcm9wZG93bjp1cGRhdGUobmV3VHlwZSkKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkhvdGtleVBhcnJ5VHlwZU5vdGlmeSB0aGVuCiAgICAgICAgICAgICAgICBMaWJyYXJ5LlNlbmROb3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgIHRpdGxlID0gIk1vZHVsZSBOb3RpZmljYXRpb24iLAogICAgICAgICAgICAgICAgICAgIHRleHQgPSAiUGFycnkgVHlwZSBjaGFuZ2VkIHRvICIgLi4gbmV3VHlwZSwKICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IDMKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQoKICAgIG1vZHVsZTpjcmVhdGVfc2xpZGVyKHsKICAgICAgICB0aXRsZSA9ICdQYXJyeSBBY2N1cmFjeScsCiAgICAgICAgZmxhZyA9ICdQYXJyeV9BY2N1cmFjeScsCgogICAgICAgIG1heGltdW1fdmFsdWUgPSAxMDAsCiAgICAgICAgbWluaW11bV92YWx1ZSA9IDEsCiAgICAgICAgdmFsdWUgPSAxMDAsCgogICAgICAgIHJvdW5kX251bWJlciA9IHRydWUsCgogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCiAgICAgICAgICAgIFNwZWVkX0Rpdmlzb3JfTXVsdGlwbGllciA9IDAuNyArICh2YWx1ZSAtIDEpICogKDAuMzUgLyA5OSkKICAgICAgICBlbmQKICAgIH0pCgogICAgbW9kdWxlOmNyZWF0ZV9kaXZpZGVyKHsKICAgIH0pCgogICAgbW9kdWxlOmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiUmFuZG9taXplZCBQYXJyeSBBY2N1cmFjeSIsCiAgICAgICAgZmxhZyA9ICJSYW5kb21fUGFycnlfQWNjdXJhY3kiLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCiAgICAgICAgICAgIGdldGdlbnYoKS5SYW5kb21QYXJyeUFjY3VyYWN5RW5hYmxlZCA9IHZhbHVlCiAgICAgICAgICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIGdldGdlbnYoKS5SYW5kb21QYXJyeUFjY3VyYWN5RW5hYmxlZCA9IHZhbHVlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCiAgICBtb2R1bGU6Y3JlYXRlX2NoZWNrYm94KHsKICAgICAgICB0aXRsZSA9ICJJbmZpbml0eSBEZXRlY3Rpb24iLAogICAgICAgIGZsYWcgPSAiSW5maW5pdHlfRGV0ZWN0aW9uIiwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICBnZXRnZW52KCkuSW5maW5pdHlEZXRlY3Rpb24gPSB2YWx1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCgogICAgbW9kdWxlOmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiRGVhdGggU2xhc2ggRGV0ZWN0aW9uIiwKICAgICAgICBmbGFnID0gIkRlYXRoU2xhc2hfRGV0ZWN0aW9uIiwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgICAgICBnZXRnZW52KCkuRGVhdGhTbGFzaERldGVjdGlvbiA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQoKICAgIG1vZHVsZTpjcmVhdGVfY2hlY2tib3goewogICAgICAgIHRpdGxlID0gIlRpbWUgSG9sZSBEZXRlY3Rpb24iLAogICAgICAgIGZsYWcgPSAiVGltZUhvbGVfRGV0ZWN0aW9uIiwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgICAgICBnZXRnZW52KCkuVGltZUhvbGVEZXRlY3Rpb24gPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCiAgICBtb2R1bGU6Y3JlYXRlX2NoZWNrYm94KHsKICAgICAgICB0aXRsZSA9ICJTbGFzaCBPZiBGdXJ5IERldGVjdGlvbiIsCiAgICAgICAgZmxhZyA9ICJTbGFzaE9mRnVyeURldGVjdGlvbiIsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKICAgICAgICAgICAgZ2V0Z2VudigpLlNsYXNoT2ZGdXJ5RGV0ZWN0aW9uID0gdmFsdWUKICAgICAgICBlbmQKICAgIH0pCgogICAgbW9kdWxlOmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiQW50aSBQaGFudG9tIiwKICAgICAgICBmbGFnID0gIkFudGlfUGhhbnRvbSIsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKICAgICAgICAgICAgZ2V0Z2VudigpLlBoYW50b21WMkRldGVjdGlvbiA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQoKICAgIG1vZHVsZTpjcmVhdGVfY2hlY2tib3goewogICAgICAgIHRpdGxlID0gIkNvb2xkb3duIFByb3RlY3Rpb24iLAogICAgICAgIGZsYWcgPSAiQ29vbGRvd25Qcm90ZWN0aW9uIiwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgICAgICBnZXRnZW52KCkuQ29vbGRvd25Qcm90ZWN0aW9uID0gdmFsdWUKICAgICAgICBlbmQKICAgIH0pCgogICAgbW9kdWxlOmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiQXV0byBBYmlsaXR5IiwKICAgICAgICBmbGFnID0gIkF1dG9BYmlsaXR5IiwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgICAgICBnZXRnZW52KCkuQXV0b0FiaWxpdHkgPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCiAgICBtb2R1bGU6Y3JlYXRlX2NoZWNrYm94KHsKICAgICAgICB0aXRsZSA9ICJLZXlwcmVzcyIsCiAgICAgICAgZmxhZyA9ICJBdXRvX1BhcnJ5X0tleXByZXNzIiwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgICAgICBnZXRnZW52KCkuQXV0b1BhcnJ5S2V5cHJlc3MgPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCgogICAgbW9kdWxlOmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiTm90aWZ5IiwKICAgICAgICBmbGFnID0gIkF1dG9fUGFycnlfTm90aWZ5IiwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgICAgICBnZXRnZW52KCkuQXV0b1BhcnJ5Tm90aWZ5ID0gdmFsdWUKICAgICAgICBlbmQKICAgIH0pCgogICAgbG9jYWwgU3BhbVBhcnJ5ID0gcmFnZTpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICdBdXRvIFNwYW0gUGFycnknLAogICAgICAgIGZsYWcgPSAnQXV0b19TcGFtX1BhcnJ5JywKICAgICAgICBkZXNjcmlwdGlvbiA9ICdBdXRvbWF0aWNhbGx5IHNwYW0gcGFycmllcyBiYWxsJywKICAgICAgICBzZWN0aW9uID0gJ3JpZ2h0JywKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b1NwYW1Ob3RpZnkgdGhlbgogICAgICAgICAgICAgICAgaWYgdmFsdWUgdGhlbgogICAgICAgICAgICAgICAgICAgIExpYnJhcnkuU2VuZE5vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gIk1vZHVsZSBOb3RpZmljYXRpb24iLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gIkF1dG8gU3BhbSBQYXJyeSB0dXJuZWQgT04iLAogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IDMKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIExpYnJhcnkuU2VuZE5vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gIk1vZHVsZSBOb3RpZmljYXRpb24iLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gIkF1dG8gU3BhbSBQYXJyeSB0dXJuZWQgT0ZGIiwKICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb24gPSAzCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ0F1dG8gU3BhbSddID0gUnVuU2VydmljZS5QcmVTaW11bGF0aW9uOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIEJhbGwgPSBBdXRvX1BhcnJ5LkdldF9CYWxsKCkKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IEJhbGwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgWm9vbWllcyA9IEJhbGw6RmluZEZpcnN0Q2hpbGQoJ3pvb21pZXMnKQoKICAgICAgICAgICAgICAgICAgICBpZiBub3QgWm9vbWllcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBBdXRvX1BhcnJ5LkNsb3Nlc3RfUGxheWVyKCkKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgUGluZyA9IGdhbWU6R2V0U2VydmljZSgnU3RhdHMnKS5OZXR3b3JrLlNlcnZlclN0YXRzSXRlbVsnRGF0YSBQaW5nJ106R2V0VmFsdWUoKQoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBQaW5nX1RocmVzaG9sZCA9IG1hdGguY2xhbXAoUGluZyAvIDEwLCAxLCAxNikKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgQmFsbF9UYXJnZXQgPSBCYWxsOkdldEF0dHJpYnV0ZSgndGFyZ2V0JykKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgQmFsbF9Qcm9wZXJ0aWVzID0gQXV0b19QYXJyeTpHZXRfQmFsbF9Qcm9wZXJ0aWVzKCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBFbnRpdHlfUHJvcGVydGllcyA9IEF1dG9fUGFycnk6R2V0X0VudGl0eV9Qcm9wZXJ0aWVzKCkKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgU3BhbV9BY2N1cmFjeSA9IEF1dG9fUGFycnkuU3BhbV9TZXJ2aWNlKHsKICAgICAgICAgICAgICAgICAgICAgICAgQmFsbF9Qcm9wZXJ0aWVzID0gQmFsbF9Qcm9wZXJ0aWVzLAogICAgICAgICAgICAgICAgICAgICAgICBFbnRpdHlfUHJvcGVydGllcyA9IEVudGl0eV9Qcm9wZXJ0aWVzLAogICAgICAgICAgICAgICAgICAgICAgICBQaW5nID0gUGluZ19UaHJlc2hvbGQKICAgICAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBUYXJnZXRfUG9zaXRpb24gPSBDbG9zZXN0X0VudGl0eS5QcmltYXJ5UGFydC5Qb3NpdGlvbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIFRhcmdldF9EaXN0YW5jZSA9IFBsYXllcjpEaXN0YW5jZUZyb21DaGFyYWN0ZXIoVGFyZ2V0X1Bvc2l0aW9uKQoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBEaXJlY3Rpb24gPSAoUGxheWVyLkNoYXJhY3Rlci5QcmltYXJ5UGFydC5Qb3NpdGlvbiAtIEJhbGwuUG9zaXRpb24pLlVuaXQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBCYWxsX0RpcmVjdGlvbiA9IFpvb21pZXMuVmVjdG9yVmVsb2NpdHkuVW5pdAoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBEb3QgPSBEaXJlY3Rpb246RG90KEJhbGxfRGlyZWN0aW9uKQoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBEaXN0YW5jZSA9IFBsYXllcjpEaXN0YW5jZUZyb21DaGFyYWN0ZXIoQmFsbC5Qb3NpdGlvbikKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IEJhbGxfVGFyZ2V0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgIGlmIFRhcmdldF9EaXN0YW5jZSA+IFNwYW1fQWNjdXJhY3kgb3IgRGlzdGFuY2UgPiBTcGFtX0FjY3VyYWN5IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgUHVsc2VkID0gUGxheWVyLkNoYXJhY3RlcjpHZXRBdHRyaWJ1dGUoJ1B1bHNlZCcpCgogICAgICAgICAgICAgICAgICAgIGlmIFB1bHNlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBpZiBCYWxsX1RhcmdldCA9PSB0b3N0cmluZyhQbGF5ZXIpIGFuZCBUYXJnZXRfRGlzdGFuY2UgPiAzMCBhbmQgRGlzdGFuY2UgPiAzMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBsb2NhbCB0aHJlc2hvbGQgPSBQYXJyeVRocmVzaG9sZAoKICAgICAgICAgICAgICAgICAgICBpZiBEaXN0YW5jZSA8PSBTcGFtX0FjY3VyYWN5IGFuZCBQYXJyaWVzID4gdGhyZXNob2xkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlNwYW1QYXJyeUtleXByZXNzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KHRydWUsIEVudW0uS2V5Q29kZS5GLCBmYWxzZSwgZ2FtZSkgCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1dG9fUGFycnkuUGFycnkoU2VsZWN0ZWRfUGFycnlfVHlwZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlmIENvbm5lY3Rpb25zX01hbmFnZXJbJ0F1dG8gU3BhbSddIHRoZW4KICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc19NYW5hZ2VyWydBdXRvIFNwYW0nXTpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc19NYW5hZ2VyWydBdXRvIFNwYW0nXSA9IG5pbAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCiAgICBsb2NhbCBkcm9wZG93bjIgPSBTcGFtUGFycnk6Y3JlYXRlX2Ryb3Bkb3duKHsKICAgICAgICB0aXRsZSA9ICdQYXJyeSBUeXBlJywKICAgICAgICBmbGFnID0gJ1NwYW1fUGFycnlfVHlwZScsCgogICAgICAgIG9wdGlvbnMgPSB7CiAgICAgICAgICAgICdMZWdpdCcsCiAgICAgICAgICAgICdCbGF0YW50JwogICAgICAgIH0sCgogICAgICAgIG11bHRpX2Ryb3Bkb3duID0gZmFsc2UsCiAgICAgICAgbWF4aW11bV9vcHRpb25zID0gMiwKCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogc3RyaW5nKQogICAgICAgIGVuZAogICAgfSkKCiAgICBTcGFtUGFycnk6Y3JlYXRlX3NsaWRlcih7CiAgICAgICAgdGl0bGUgPSAiUGFycnkgVGhyZXNob2xkIiwKICAgICAgICBmbGFnID0gIlBhcnJ5X1RocmVzaG9sZCIsCiAgICAgICAgbWF4aW11bV92YWx1ZSA9IDMsCiAgICAgICAgbWluaW11bV92YWx1ZSA9IDEsCiAgICAgICAgdmFsdWUgPSAyLjUsCiAgICAgICAgcm91bmRfbnVtYmVyID0gZmFsc2UsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogbnVtYmVyKQogICAgICAgICAgICBQYXJyeVRocmVzaG9sZCA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQoKICAgIFNwYW1QYXJyeTpjcmVhdGVfZGl2aWRlcih7CiAgICB9KQoKICAgIGlmIG5vdCBpc01vYmlsZSB0aGVuCiAgICAgICAgbG9jYWwgQW5pbWF0aW9uRml4ID0gU3BhbVBhcnJ5OmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgICAgIHRpdGxlID0gIkFuaW1hdGlvbiBGaXgiLAogICAgICAgICAgICBmbGFnID0gIkFuaW1hdGlvbkZpeCIsCiAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCiAgICAgICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNfTWFuYWdlclsnQW5pbWF0aW9uIEZpeCddID0gUnVuU2VydmljZS5QcmVTaW11bGF0aW9uOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBCYWxsID0gQXV0b19QYXJyeS5HZXRfQmFsbCgpCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IEJhbGwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFpvb21pZXMgPSBCYWxsOkZpbmRGaXJzdENoaWxkKCd6b29taWVzJykKICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgWm9vbWllcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgQXV0b19QYXJyeS5DbG9zZXN0X1BsYXllcigpCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgUGluZyA9IGdhbWU6R2V0U2VydmljZSgnU3RhdHMnKS5OZXR3b3JrLlNlcnZlclN0YXRzSXRlbVsnRGF0YSBQaW5nJ106R2V0VmFsdWUoKQogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFBpbmdfVGhyZXNob2xkID0gbWF0aC5jbGFtcChQaW5nIC8gMTAsIDEwLCAxNikKICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBCYWxsX1RhcmdldCA9IEJhbGw6R2V0QXR0cmlidXRlKCd0YXJnZXQnKQogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEJhbGxfUHJvcGVydGllcyA9IEF1dG9fUGFycnk6R2V0X0JhbGxfUHJvcGVydGllcygpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEVudGl0eV9Qcm9wZXJ0aWVzID0gQXV0b19QYXJyeTpHZXRfRW50aXR5X1Byb3BlcnRpZXMoKQogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFNwYW1fQWNjdXJhY3kgPSBBdXRvX1BhcnJ5LlNwYW1fU2VydmljZSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYWxsX1Byb3BlcnRpZXMgPSBCYWxsX1Byb3BlcnRpZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbnRpdHlfUHJvcGVydGllcyA9IEVudGl0eV9Qcm9wZXJ0aWVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGluZyA9IFBpbmdfVGhyZXNob2xkCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgVGFyZ2V0X1Bvc2l0aW9uID0gQ2xvc2VzdF9FbnRpdHkuUHJpbWFyeVBhcnQuUG9zaXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgVGFyZ2V0X0Rpc3RhbmNlID0gUGxheWVyOkRpc3RhbmNlRnJvbUNoYXJhY3RlcihUYXJnZXRfUG9zaXRpb24pCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgRGlyZWN0aW9uID0gKFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQuUG9zaXRpb24gLSBCYWxsLlBvc2l0aW9uKS5Vbml0CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEJhbGxfRGlyZWN0aW9uID0gWm9vbWllcy5WZWN0b3JWZWxvY2l0eS5Vbml0CiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgRG90ID0gRGlyZWN0aW9uOkRvdChCYWxsX0RpcmVjdGlvbikKICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBEaXN0YW5jZSA9IFBsYXllcjpEaXN0YW5jZUZyb21DaGFyYWN0ZXIoQmFsbC5Qb3NpdGlvbikKICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgQmFsbF9UYXJnZXQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFRhcmdldF9EaXN0YW5jZSA+IFNwYW1fQWNjdXJhY3kgb3IgRGlzdGFuY2UgPiBTcGFtX0FjY3VyYWN5IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFB1bHNlZCA9IFBsYXllci5DaGFyYWN0ZXI6R2V0QXR0cmlidXRlKCdQdWxzZWQnKQogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFB1bHNlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgQmFsbF9UYXJnZXQgPT0gdG9zdHJpbmcoUGxheWVyKSBhbmQgVGFyZ2V0X0Rpc3RhbmNlID4gMzAgYW5kIERpc3RhbmNlID4gMzAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHRocmVzaG9sZCA9IFBhcnJ5VGhyZXNob2xkCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgRGlzdGFuY2UgPD0gU3BhbV9BY2N1cmFjeSBhbmQgUGFycmllcyA+IHRocmVzaG9sZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudCh0cnVlLCBFbnVtLktleUNvZGUuRiwgZmFsc2UsIGdhbWUpIAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgQ29ubmVjdGlvbnNfTWFuYWdlclsnQW5pbWF0aW9uIEZpeCddIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNfTWFuYWdlclsnQW5pbWF0aW9uIEZpeCddOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc19NYW5hZ2VyWydBbmltYXRpb24gRml4J10gPSBuaWwKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICB9KQoKICAgICAgICBBbmltYXRpb25GaXg6Y2hhbmdlX3N0YXRlKHRydWUpCiAgICBlbmQKCiAgICBTcGFtUGFycnk6Y3JlYXRlX2NoZWNrYm94KHsKICAgICAgICB0aXRsZSA9ICJLZXlwcmVzcyIsCiAgICAgICAgZmxhZyA9ICJBdXRvX1NwYW1fUGFycnlfS2V5cHJlc3MiLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCiAgICAgICAgICAgIGdldGdlbnYoKS5TcGFtUGFycnlLZXlwcmVzcyA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQoKICAgIFNwYW1QYXJyeTpjcmVhdGVfY2hlY2tib3goewogICAgICAgIHRpdGxlID0gIk5vdGlmeSIsCiAgICAgICAgZmxhZyA9ICJBdXRvX1NwYW1fUGFycnlfTm90aWZ5IiwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgICAgICBnZXRnZW52KCkuQXV0b1NwYW1Ob3RpZnkgPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCiAgICBsb2NhbCBNYW51YWxTcGFtID0gcmFnZTpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICdNYW51YWwgU3BhbSBQYXJyeScsCiAgICAgICAgZmxhZyA9ICdNYW51YWxfU3BhbV9QYXJyeScsCiAgICAgICAgZGVzY3JpcHRpb24gPSAnTWFudWFsbHkgU3BhbXMgUGFycnknLAogICAgICAgIHNlY3Rpb24gPSAncmlnaHQnLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5NYW51YWxTcGFtTm90aWZ5IHRoZW4KICAgICAgICAgICAgICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICAgICAgICAgICAgICBMaWJyYXJ5LlNlbmROb3RpZmljYXRpb24oewogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZSA9ICJNb2R1bGUgTm90aWZpY2F0aW9uIiwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9ICJNYW51YWwgU3BhbSBQYXJyeSB0dXJuZWQgT04iLAogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IDMKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIExpYnJhcnkuU2VuZE5vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gIk1vZHVsZSBOb3RpZmljYXRpb24iLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gIk1hbnVhbCBTcGFtIFBhcnJ5IHR1cm5lZCBPRkYiLAogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IDMKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICBDb25uZWN0aW9uc19NYW5hZ2VyWydNYW51YWwgU3BhbSddID0gUnVuU2VydmljZS5QcmVTaW11bGF0aW9uOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5zcGFtdWkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLk1hbnVhbFNwYW1LZXlwcmVzcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KHRydWUsIEVudW0uS2V5Q29kZS5GLCBmYWxzZSwgZ2FtZSkgCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBBdXRvX1BhcnJ5LlBhcnJ5KFNlbGVjdGVkX1BhcnJ5X1R5cGUpCiAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBpZiBDb25uZWN0aW9uc19NYW5hZ2VyWydNYW51YWwgU3BhbSddIHRoZW4KICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc19NYW5hZ2VyWydNYW51YWwgU3BhbSddOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ01hbnVhbCBTcGFtJ10gPSBuaWwKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCiAgICAKICAgIE1hbnVhbFNwYW06Y2hhbmdlX3N0YXRlKGZhbHNlKQoKICAgIGlmIGlzTW9iaWxlIHRoZW4KICAgICAgICBNYW51YWxTcGFtOmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgICAgIHRpdGxlID0gIlVJIiwKICAgICAgICAgICAgZmxhZyA9ICJNYW51YWxfU3BhbV9VSSIsCiAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCiAgICAgICAgICAgICAgICBnZXRnZW52KCkuc3BhbXVpID0gdmFsdWUKICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBndWkgPSBJbnN0YW5jZS5uZXcoIlNjcmVlbkd1aSIpCiAgICAgICAgICAgICAgICAgICAgZ3VpLk5hbWUgPSAiTWFudWFsU3BhbVVJIgogICAgICAgICAgICAgICAgICAgIGd1aS5SZXNldE9uU3Bhd24gPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGd1aS5QYXJlbnQgPSBnYW1lLkNvcmVHdWkKICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsb2NhbCBmcmFtZSA9IEluc3RhbmNlLm5ldygiRnJhbWUiKQogICAgICAgICAgICAgICAgICAgIGZyYW1lLk5hbWUgPSAiTWFpbkZyYW1lIgogICAgICAgICAgICAgICAgICAgIGZyYW1lLlBvc2l0aW9uID0gVURpbTIubmV3KDAsIDIwLCAwLCAyMCkKICAgICAgICAgICAgICAgICAgICBmcmFtZS5TaXplID0gVURpbTIubmV3KDAsIDIwMCwgMCwgMTAwKQogICAgICAgICAgICAgICAgICAgIGZyYW1lLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxMCwgMTAsIDUwKQogICAgICAgICAgICAgICAgICAgIGZyYW1lLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjMKICAgICAgICAgICAgICAgICAgICBmcmFtZS5Cb3JkZXJTaXplUGl4ZWwgPSAwCiAgICAgICAgICAgICAgICAgICAgZnJhbWUuQWN0aXZlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIGZyYW1lLkRyYWdnYWJsZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICBmcmFtZS5QYXJlbnQgPSBndWkKICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsb2NhbCB1aUNvcm5lciA9IEluc3RhbmNlLm5ldygiVUlDb3JuZXIiKQogICAgICAgICAgICAgICAgICAgIHVpQ29ybmVyLkNvcm5lclJhZGl1cyA9IFVEaW0ubmV3KDAsIDEyKQogICAgICAgICAgICAgICAgICAgIHVpQ29ybmVyLlBhcmVudCA9IGZyYW1lCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdWlTdHJva2UgPSBJbnN0YW5jZS5uZXcoIlVJU3Ryb2tlIikKICAgICAgICAgICAgICAgICAgICB1aVN0cm9rZS5UaGlja25lc3MgPSAyCiAgICAgICAgICAgICAgICAgICAgdWlTdHJva2UuQ29sb3IgPSBDb2xvcjMubmV3KDAsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgdWlTdHJva2UuUGFyZW50ID0gZnJhbWUKICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsb2NhbCBidXR0b24gPSBJbnN0YW5jZS5uZXcoIlRleHRCdXR0b24iKQogICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5OYW1lID0gIkNsYXNoTW9kZUJ1dHRvbiIKICAgICAgICAgICAgICAgICAgICBidXR0b24uVGV4dCA9ICJDbGFzaCBNb2RlIgogICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5TaXplID0gVURpbTIubmV3KDAsIDE2MCwgMCwgNDApCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgLTgwLCAwLjUsIC0yMCkKICAgICAgICAgICAgICAgICAgICBidXR0b24uQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgICAgICBidXR0b24uQm9yZGVyU2l6ZVBpeGVsID0gMAogICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5Gb250ID0gRW51bS5Gb250LkdvdGhhbVNlbWlib2xkCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLlRleHRDb2xvcjMgPSBDb2xvcjMubmV3KDEsIDEsIDEpCiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLlRleHRTaXplID0gMjIKICAgICAgICAgICAgICAgICAgICBidXR0b24uUGFyZW50ID0gZnJhbWUKICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsb2NhbCBhY3RpdmF0ZWQgPSBmYWxzZQogICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIHRvZ2dsZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2YXRlZCA9IG5vdCBhY3RpdmF0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLlRleHQgPSBhY3RpdmF0ZWQgYW5kICJTdG9wIiBvciAiQ2xhc2ggTW9kZSIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYWN0aXZhdGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ01hbnVhbCBTcGFtIFVJJ10gPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b19QYXJyeS5QYXJyeShTZWxlY3RlZF9QYXJyeV9UeXBlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBDb25uZWN0aW9uc19NYW5hZ2VyWydNYW51YWwgU3BhbSBVSSddIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc19NYW5hZ2VyWydNYW51YWwgU3BhbSBVSSddOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ01hbnVhbCBTcGFtIFVJJ10gPSBuaWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgICAgICAgICBidXR0b24uTW91c2VCdXR0b24xQ2xpY2s6Q29ubmVjdCh0b2dnbGUpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5Db3JlR3VpOkZpbmRGaXJzdENoaWxkKCJNYW51YWxTcGFtVUkiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuQ29yZUd1aTpGaW5kRmlyc3RDaGlsZCgiTWFudWFsU3BhbVVJIik6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgQ29ubmVjdGlvbnNfTWFuYWdlclsnTWFudWFsIFNwYW0gVUknXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ01hbnVhbCBTcGFtIFVJJ106RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ01hbnVhbCBTcGFtIFVJJ10gPSBuaWwKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICB9KQogICAgZW5kCiAgICAKICAgIE1hbnVhbFNwYW06Y3JlYXRlX2NoZWNrYm94KHsKICAgICAgICB0aXRsZSA9ICJLZXlwcmVzcyIsCiAgICAgICAgZmxhZyA9ICJNYW51YWxfU3BhbV9LZXlwcmVzcyIsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKICAgICAgICAgICAgZ2V0Z2VudigpLk1hbnVhbFNwYW1LZXlwcmVzcyA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQogICAgCiAgICBNYW51YWxTcGFtOmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiTm90aWZ5IiwKICAgICAgICBmbGFnID0gIk1hbnVhbF9TcGFtX1BhcnJ5X05vdGlmeSIsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKICAgICAgICAgICAgZ2V0Z2VudigpLk1hbnVhbFNwYW1Ob3RpZnkgPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCiAgICBsb2NhbCBUcmlnZ2VyYm90ID0gcmFnZTpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICdUcmlnZ2VyYm90JywKICAgICAgICBmbGFnID0gJ1RyaWdnZXJib3QnLAogICAgICAgIGRlc2NyaXB0aW9uID0gJ0luc3RhbnRseSBoaXRzIGJhbGwgd2hlbiB0YXJnZXRlZCcsCiAgICAgICAgc2VjdGlvbiA9ICdsZWZ0JywKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgICAgICBpZiBnZXRnZW52KCkuVHJpZ2dlcmJvdE5vdGlmeSB0aGVuCiAgICAgICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5TZW5kTm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSAiTW9kdWxlIE5vdGlmaWNhdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSAiVHJpZ2dlcmJvdCB0dXJuZWQgT04iLAogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IDMKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIExpYnJhcnkuU2VuZE5vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gIk1vZHVsZSBOb3RpZmljYXRpb24iLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gIlRyaWdnZXJib3QgdHVybmVkIE9GRiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uID0gMwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ1RyaWdnZXJib3QnXSA9IFJ1blNlcnZpY2UuUHJlU2ltdWxhdGlvbjpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBCYWxscyA9IEF1dG9fUGFycnkuR2V0X0JhbGxzKCkKICAgICAgICAKICAgICAgICAgICAgICAgICAgICBmb3IgXywgQmFsbCBpbiBwYWlycyhCYWxscykgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IEJhbGwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgQmFsbDpHZXRBdHRyaWJ1dGVDaGFuZ2VkU2lnbmFsKCd0YXJnZXQnKTpPbmNlKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyaWdnZXJib3RQYXJyaWVkID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFRyaWdnZXJib3RQYXJyaWVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEJhbGxfVGFyZ2V0ID0gQmFsbDpHZXRBdHRyaWJ1dGUoJ3RhcmdldCcpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFNpbmd1bGFyaXR5X0NhcGUgPSBQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0OkZpbmRGaXJzdENoaWxkKCdTaW5ndWxhcml0eUNhcGUnKQogICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgU2luZ3VsYXJpdHlfQ2FwZSB0aGVuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlRyaWdnZXJib3RJbmZpbml0eURldGVjdGlvbiBhbmQgSW5maW5pdHkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBCYWxsX1RhcmdldCA9PSB0b3N0cmluZyhQbGF5ZXIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5UcmlnZ2VyYm90S2V5cHJlc3MgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KHRydWUsIEVudW0uS2V5Q29kZS5GLCBmYWxzZSwgZ2FtZSkgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b19QYXJyeS5QYXJyeShTZWxlY3RlZF9QYXJyeV9UeXBlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcmlnZ2VyYm90UGFycmllZCA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFRyaWdnZXJib3RfTGFzdF9QYXJyeXMgPSB0aWNrKCkKICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSdW5TZXJ2aWNlLlByZVNpbXVsYXRpb246V2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIHVudGlsICh0aWNrKCkgLSBUcmlnZ2VyYm90X0xhc3RfUGFycnlzKSA+PSAxIG9yIG5vdCBUcmlnZ2VyYm90UGFycmllZAogICAgICAgICAgICAgICAgICAgICAgICBUcmlnZ2VyYm90UGFycmllZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWYgQ29ubmVjdGlvbnNfTWFuYWdlclsnVHJpZ2dlcmJvdCddIHRoZW4KICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc19NYW5hZ2VyWydUcmlnZ2VyYm90J106RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNfTWFuYWdlclsnVHJpZ2dlcmJvdCddID0gbmlsCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KQoKICAgIFRyaWdnZXJib3Q6Y3JlYXRlX2NoZWNrYm94KHsKICAgICAgICB0aXRsZSA9ICJJbmZpbml0eSBEZXRlY3Rpb24iLAogICAgICAgIGZsYWcgPSAiSW5maW5pdHlfRGV0ZWN0aW9uIiwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgICAgICBnZXRnZW52KCkuVHJpZ2dlcmJvdEluZmluaXR5RGV0ZWN0aW9uID0gdmFsdWUKICAgICAgICBlbmQKICAgIH0pCgogICAgVHJpZ2dlcmJvdDpjcmVhdGVfY2hlY2tib3goewogICAgICAgIHRpdGxlID0gIktleXByZXNzIiwKICAgICAgICBmbGFnID0gIlRyaWdnZXJib3RfS2V5cHJlc3MiLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCiAgICAgICAgICAgIGdldGdlbnYoKS5UcmlnZ2VyYm90S2V5cHJlc3MgPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCiAgICBUcmlnZ2VyYm90OmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiTm90aWZ5IiwKICAgICAgICBmbGFnID0gIlRyaWdnZXJib3ROb3RpZnkiLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCiAgICAgICAgICAgIGdldGdlbnYoKS5UcmlnZ2VyYm90Tm90aWZ5ID0gdmFsdWUKICAgICAgICBlbmQKICAgIH0pCgogICAgbG9jYWwgSG90a2V5UGFycnlUeXBlID0gcmFnZTpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICdIb3RrZXkgUGFycnkgVHlwZScsCiAgICAgICAgZmxhZyA9ICdIb3RrZXlQYXJyeVR5cGUnLAogICAgICAgIGRlc2NyaXB0aW9uID0gJ0FsbG93cyBIb3RrZXkgUGFycnkgVHlwZScsCiAgICAgICAgc2VjdGlvbiA9ICdsZWZ0JywKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgICAgICBnZXRnZW52KCkuSG90a2V5UGFycnlUeXBlID0gdmFsdWUKICAgICAgICBlbmQKICAgIH0pCgogICAgSG90a2V5UGFycnlUeXBlOmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiTm90aWZ5IiwKICAgICAgICBmbGFnID0gIkhvdGtleVBhcnJ5VHlwZU5vdGlmeSIsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKICAgICAgICAgICAgZ2V0Z2VudigpLkhvdGtleVBhcnJ5VHlwZU5vdGlmeSA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQoKICAgIGxvY2FsIExvYmJ5QVAgPSByYWdlOmNyZWF0ZV9tb2R1bGUoewogICAgICAgIHRpdGxlID0gJ0xvYmJ5IEFQJywKICAgICAgICBmbGFnID0gJ0xvYmJ5X0FQJywKICAgICAgICBkZXNjcmlwdGlvbiA9ICdBdXRvIHBhcnJpZXMgYmFsbCBpbiBsb2JieScsCiAgICAgICAgc2VjdGlvbiA9ICdyaWdodCcsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbihzdGF0ZSkKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkxvYmJ5QVBOb3RpZnkgdGhlbgogICAgICAgICAgICAgICAgaWYgc3RhdGUgdGhlbgogICAgICAgICAgICAgICAgICAgIExpYnJhcnkuU2VuZE5vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gIk1vZHVsZSBOb3RpZmljYXRpb24iLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gIkxvYmJ5IEFQIGhhcyBiZWVuIHR1cm5lZCBPTiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uID0gMwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5TZW5kTm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSAiTW9kdWxlIE5vdGlmaWNhdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSAiTG9iYnkgQVAgaGFzIGJlZW4gdHVybmVkIE9GRiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uID0gMwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIHN0YXRlIHRoZW4KICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ0xvYmJ5IEFQJ10gPSBSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBCYWxsID0gQXV0b19QYXJyeS5Mb2JieV9CYWxscygpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IEJhbGwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIFpvb21pZXMgPSBCYWxsOkZpbmRGaXJzdENoaWxkKCd6b29taWVzJykKICAgICAgICAgICAgICAgICAgICBpZiBub3QgWm9vbWllcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICAgICAgQmFsbDpHZXRBdHRyaWJ1dGVDaGFuZ2VkU2lnbmFsKCd0YXJnZXQnKTpPbmNlKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgVHJhaW5pbmdfUGFycmllZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgCiAgICAgICAgICAgICAgICAgICAgaWYgVHJhaW5pbmdfUGFycmllZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgQmFsbF9UYXJnZXQgPSBCYWxsOkdldEF0dHJpYnV0ZSgndGFyZ2V0JykKICAgICAgICAgICAgICAgICAgICBsb2NhbCBWZWxvY2l0eSA9IFpvb21pZXMuVmVjdG9yVmVsb2NpdHkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBEaXN0YW5jZSA9IFBsYXllcjpEaXN0YW5jZUZyb21DaGFyYWN0ZXIoQmFsbC5Qb3NpdGlvbikKICAgICAgICAgICAgICAgICAgICBsb2NhbCBTcGVlZCA9IFZlbG9jaXR5Lk1hZ25pdHVkZQogICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgUGluZyA9IGdhbWU6R2V0U2VydmljZSgnU3RhdHMnKS5OZXR3b3JrLlNlcnZlclN0YXRzSXRlbVsnRGF0YSBQaW5nJ106R2V0VmFsdWUoKSAvIDEwCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgTG9iYnlBUGNhcHBlZFNwZWVkRGlmZiA9IG1hdGgubWluKG1hdGgubWF4KFNwZWVkIC0gOS41LCAwKSwgNjUwKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIExvYmJ5QVBzcGVlZF9kaXZpc29yX2Jhc2UgPSAyLjQgKyBMb2JieUFQY2FwcGVkU3BlZWREaWZmICogMC4wMDIKICAgIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIExvYmJ5QVBlZmZlY3RpdmVNdWx0aXBsaWVyID0gTG9iYnlBUF9TcGVlZF9EaXZpc29yX011bHRpcGxpZXIKICAgICAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuTG9iYnlBUFJhbmRvbVBhcnJ5QWNjdXJhY3lFbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgTG9iYnlBUGVmZmVjdGl2ZU11bHRpcGxpZXIgPSAwLjcgKyAobWF0aC5yYW5kb20oMSwgMTAwKSAtIDEpICogKDAuMzUgLyA5OSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIExvYmJ5QVBzcGVlZF9kaXZpc29yID0gTG9iYnlBUHNwZWVkX2Rpdmlzb3JfYmFzZSAqIExvYmJ5QVBlZmZlY3RpdmVNdWx0aXBsaWVyCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgTG9iYnlBUFBhcnJ5X0FjY3VyYWN5cyA9IFBpbmcgKyBtYXRoLm1heChTcGVlZCAvIExvYmJ5QVBzcGVlZF9kaXZpc29yLCA5LjUpCiAgICAKICAgICAgICAgICAgICAgICAgICBpZiBCYWxsX1RhcmdldCA9PSB0b3N0cmluZyhQbGF5ZXIpIGFuZCBEaXN0YW5jZSA8PSBMb2JieUFQUGFycnlfQWNjdXJhY3lzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Mb2JieUFQS2V5cHJlc3MgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KHRydWUsIEVudW0uS2V5Q29kZS5GLCBmYWxzZSwgZ2FtZSkgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b19QYXJyeS5QYXJyeShTZWxlY3RlZF9QYXJyeV9UeXBlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIFRyYWluaW5nX1BhcnJpZWQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgTGFzdF9QYXJyeXMgPSB0aWNrKCkKICAgICAgICAgICAgICAgICAgICByZXBlYXQgCiAgICAgICAgICAgICAgICAgICAgICAgIFJ1blNlcnZpY2UuUHJlU2ltdWxhdGlvbjpXYWl0KCkgCiAgICAgICAgICAgICAgICAgICAgdW50aWwgKHRpY2soKSAtIExhc3RfUGFycnlzKSA+PSAxIG9yIG5vdCBUcmFpbmluZ19QYXJyaWVkCiAgICAgICAgICAgICAgICAgICAgVHJhaW5pbmdfUGFycmllZCA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlmIENvbm5lY3Rpb25zX01hbmFnZXJbJ0xvYmJ5IEFQJ10gdGhlbgogICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ0xvYmJ5IEFQJ106RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNfTWFuYWdlclsnTG9iYnkgQVAnXSA9IG5pbAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCiAgICBMb2JieUFQOmNyZWF0ZV9zbGlkZXIoewogICAgICAgIHRpdGxlID0gJ1BhcnJ5IEFjY3VyYWN5JywKICAgICAgICBmbGFnID0gJ1BhcnJ5X0FjY3VyYWN5JywKICAgICAgICBtYXhpbXVtX3ZhbHVlID0gMTAwLAogICAgICAgIG1pbmltdW1fdmFsdWUgPSAxLAogICAgICAgIHZhbHVlID0gMTAwLAogICAgICAgIHJvdW5kX251bWJlciA9IHRydWUsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogbnVtYmVyKQogICAgICAgICAgICBMb2JieUFQX1NwZWVkX0Rpdmlzb3JfTXVsdGlwbGllciA9IDAuNyArICh2YWx1ZSAtIDEpICogKDAuMzUgLyA5OSkKICAgICAgICBlbmQKICAgIH0pCgogICAgTG9iYnlBUDpjcmVhdGVfZGl2aWRlcih7CiAgICB9KQogICAgCiAgICBMb2JieUFQOmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiUmFuZG9taXplZCBQYXJyeSBBY2N1cmFjeSIsCiAgICAgICAgZmxhZyA9ICJSYW5kb21fUGFycnlfQWNjdXJhY3kiLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCiAgICAgICAgICAgIGdldGdlbnYoKS5Mb2JieUFQUmFuZG9tUGFycnlBY2N1cmFjeUVuYWJsZWQgPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCiAgICBMb2JieUFQOmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiS2V5cHJlc3MiLAogICAgICAgIGZsYWcgPSAiTG9iYnlfQVBfS2V5cHJlc3MiLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCiAgICAgICAgICAgIGdldGdlbnYoKS5Mb2JieUFQS2V5cHJlc3MgPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCiAgICBMb2JieUFQOmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiTm90aWZ5IiwKICAgICAgICBmbGFnID0gIkxvYmJ5X0FQX05vdGlmeSIsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKICAgICAgICAgICAgZ2V0Z2VudigpLkxvYmJ5QVBOb3RpZnkgPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCiAgICBsb2NhbCBwbHIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgIGxvY2FsIGNhbSA9IHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhCiAgICBsb2NhbCBoaXQgPSBnYW1lLlJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuUGFycnlBdHRlbXB0CiAgICAKICAgIGdldGdlbnYoKS5vcmlnaW5hbENhbWVyYVN1YmplY3QgPSBuaWwKICAgIAogICAgZnVuY3Rpb24gZ2V0c3BlZWQoYmFsbCkKICAgICAgICBpZiBiYWxsIHRoZW4KICAgICAgICAgICAgaWYgYmFsbDpGaW5kRmlyc3RDaGlsZCgiem9vbWllcyIpIGFuZCBiYWxsLnpvb21pZXMuVmVjdG9yVmVsb2NpdHkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIGJhbGwuem9vbWllcy5WZWN0b3JWZWxvY2l0eQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIGZvciBfLCBiIGluIHBhaXJzKHdvcmtzcGFjZS5CYWxsczpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgaWYgYjpGaW5kRmlyc3RDaGlsZCgiem9vbWllcyIpIGFuZCBiLnpvb21pZXMuVmVjdG9yVmVsb2NpdHkgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiBiLnpvb21pZXMuVmVjdG9yVmVsb2NpdHkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gVmVjdG9yMy5uZXcoMCwwLDApCiAgICBlbmQKICAgIAogICAgZnVuY3Rpb24gcmVzdG9yZUNhbWVyYSgpCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxyLkNoYXJhY3RlcgogICAgICAgIGlmIGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICAgICAgY2FtLkNhbWVyYVN1YmplY3QgPSBjaGFyYWN0ZXIuSHVtYW5vaWQKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICBsb2NhbCBCYWxsVFAgPSByYWdlOmNyZWF0ZV9tb2R1bGUoewogICAgICAgIHRpdGxlID0gIkJhbGwgVFAiLAogICAgICAgIGZsYWcgPSAiQmFsbF9UUCIsCiAgICAgICAgZGVzY3JpcHRpb24gPSAiVGVsZXBvcnRzIHRvIHRoZSBiYWxsIiwKICAgICAgICBzZWN0aW9uID0gImxlZnQiLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIGdldGdlbnYoKS5CYWxsVFBFbmFibGVkID0gdmFsdWUKICAgICAgICAgICAgaWYgdmFsdWUgdGhlbgogICAgICAgICAgICAgICAgaWYgcGxyLkNoYXJhY3RlciBhbmQgcGxyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLm9yaWdpbmFsQ2FtZXJhU3ViamVjdCA9IGNhbS5DYW1lcmFTdWJqZWN0CiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNfTWFuYWdlclsnQmFsbFRQX0FkZGVkJ10gPSB3b3Jrc3BhY2UuQmFsbHMuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHYpCiAgICAgICAgICAgICAgICAgICAgaWYgdjpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc19NYW5hZ2VyWydCYWxsVFBfQ2hhbmdlZF8nIC4uIHYuTmFtZV0gPSB2LkNoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbihwcm9wKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYyA9IHBsci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBjIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgaHJwID0gYzpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaHJwIHRoZW4gcmV0dXJuIGVuZAogICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBzcGVlZCA9IGdldHNwZWVkKHYpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzcGVlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWF0aC5hYnMoc3BlZWQuWCkgPiBtYXRoLmFicyhzcGVlZC5aKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhycC5DRnJhbWUgPSB2LkNGcmFtZSArIFZlY3RvcjMubmV3KDAsNSwxMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhycC5DRnJhbWUgPSB2LkNGcmFtZSArIFZlY3RvcjMubmV3KDEwLDUsMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW0uQ2FtZXJhU3ViamVjdCA9IHYKICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpHZXRBdHRyaWJ1dGUoInRhcmdldCIpID09IHBsci5OYW1lIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSB2OkdldEF0dHJpYnV0ZSgidGFyZ2V0IikgPT0gcGxyLk5hbWUgYW5kIHYgYW5kIGM6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIGMuSHVtYW5vaWQuSGVhbHRoID4gMCBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjbnQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIHY6R2V0QXR0cmlidXRlKCJ0YXJnZXQiKSA9PSBwbHIuTmFtZSBhbmQgY250IH49IDIwIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbnQgPSBjbnQgKyAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZm9yIGNvbm5OYW1lLCBjb25uIGluIHBhaXJzKENvbm5lY3Rpb25zX01hbmFnZXIpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgc3RyaW5nLmZpbmQoY29ubk5hbWUsICJCYWxsVFAiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbm46RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbY29ubk5hbWVdID0gbmlsCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmVzdG9yZUNhbWVyYSgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCiAgICBsb2NhbCBJbnN0YW50QmFsbFRQID0gcmFnZTpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICJJbnN0YW50IEJhbGwgVFAiLAogICAgICAgIGZsYWcgPSAiSW5zdGFudF9CYWxsX1RQIiwKICAgICAgICBkZXNjcmlwdGlvbiA9ICJJbnN0YW50bHkgdGVsZXBvcnRzIHRvIHRoZSBiYWxsIGFuZCBiYWNrLiIsCiAgICAgICAgc2VjdGlvbiA9ICJyaWdodCIsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgZ2V0Z2VudigpLkluc3RhbnRCYWxsVFBFbmFibGVkID0gdmFsdWUKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIGlmIHBsci5DaGFyYWN0ZXIgYW5kIHBsci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5vcmlnaW5hbENhbWVyYVN1YmplY3QgPSBjYW0uQ2FtZXJhU3ViamVjdAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGdldGdlbnYoKS5vcmlnaW5hbENGcmFtZSA9IG5pbAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgXywgYmFsbCBpbiBpcGFpcnMod29ya3NwYWNlLkJhbGxzOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgYmFsbDpJc0EoIkJhc2VQYXJ0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc19NYW5hZ2VyWydJbnN0YW50QmFsbFRQX0F0dHJfJyAuLiBiYWxsLk5hbWVdID0gYmFsbDpHZXRBdHRyaWJ1dGVDaGFuZ2VkU2lnbmFsKCJ0YXJnZXQiKTpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUJhbGxUYXJnZXRDaGFuZ2UoYmFsbCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ0luc3RhbnRCYWxsVFBfQWRkZWQnXSA9IHdvcmtzcGFjZS5CYWxscy5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oYmFsbCkKICAgICAgICAgICAgICAgICAgICBpZiBiYWxsOklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBiYWxsOkdldEF0dHJpYnV0ZSgidGFyZ2V0IikgPT0gcGxyLk5hbWUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQmFsbFRhcmdldENoYW5nZShiYWxsKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ0luc3RhbnRCYWxsVFBfQXR0cl8nIC4uIGJhbGwuTmFtZV0gPSBiYWxsOkdldEF0dHJpYnV0ZUNoYW5nZWRTaWduYWwoInRhcmdldCIpOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlQmFsbFRhcmdldENoYW5nZShiYWxsKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGZvciBjb25uTmFtZSwgY29ubiBpbiBwYWlycyhDb25uZWN0aW9uc19NYW5hZ2VyKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHN0cmluZy5maW5kKGNvbm5OYW1lLCAiSW5zdGFudEJhbGxUUCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgY29ubjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNfTWFuYWdlcltjb25uTmFtZV0gPSBuaWwKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkub3JpZ2luYWxDRnJhbWUgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGMgPSBwbHIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgaWYgYyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGhycCA9IGM6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBodW0gPSBjOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGhycCBhbmQgaHVtIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh1bS5QbGF0Zm9ybVN0YW5kID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaHJwOlBpdm90VG8oZ2V0Z2VudigpLm9yaWdpbmFsQ0ZyYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh1bS5QbGF0Zm9ybVN0YW5kID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLm9yaWdpbmFsQ0ZyYW1lID0gbmlsCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmVzdG9yZUNhbWVyYSgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKICAgIAogICAgZnVuY3Rpb24gaGFuZGxlQmFsbFRhcmdldENoYW5nZShiYWxsKQogICAgICAgIGxvY2FsIHRhcmdldCA9IGJhbGw6R2V0QXR0cmlidXRlKCJ0YXJnZXQiKQogICAgICAgIGxvY2FsIGMgPSBwbHIuQ2hhcmFjdGVyCiAgICAgICAgaWYgbm90IGMgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgbG9jYWwgaHJwID0gYzpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgbG9jYWwgaHVtID0gYzpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKQogICAgICAgIGlmIG5vdCBocnAgb3Igbm90IGh1bSB0aGVuIHJldHVybiBlbmQKICAgICAgICAKICAgICAgICBpZiB0YXJnZXQgPT0gcGxyLk5hbWUgdGhlbgogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLm9yaWdpbmFsQ0ZyYW1lIHRoZW4KICAgICAgICAgICAgICAgIGdldGdlbnYoKS5vcmlnaW5hbENGcmFtZSA9IGhycC5DRnJhbWUKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBzcGVlZCA9IGdldHNwZWVkKGJhbGwpCiAgICAgICAgICAgIGlmIHNwZWVkLk1hZ25pdHVkZSA+IDEwMCB0aGVuCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4yKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIC0tIFRlbGVwb3J0IHRvIGJhbGwKICAgICAgICAgICAgbG9jYWwgb2Zmc2V0ID0gVmVjdG9yMy5uZXcoNSwgNSwgNSkKICAgICAgICAgICAgaHVtLlBsYXRmb3JtU3RhbmQgPSB0cnVlCiAgICAgICAgICAgIGhycDpQaXZvdFRvKGJhbGwuQ0ZyYW1lICsgb2Zmc2V0KQogICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBodW0uUGxhdGZvcm1TdGFuZCA9IGZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBjYW0uQ2FtZXJhU3ViamVjdCA9IGJhbGwKICAgICAgICBlbHNlCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5vcmlnaW5hbENGcmFtZSB0aGVuCiAgICAgICAgICAgICAgICBodW0uUGxhdGZvcm1TdGFuZCA9IHRydWUKICAgICAgICAgICAgICAgIGhycDpQaXZvdFRvKGdldGdlbnYoKS5vcmlnaW5hbENGcmFtZSkKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgICAgICBodW0uUGxhdGZvcm1TdGFuZCA9IGZhbHNlCiAgICAgICAgICAgICAgICBnZXRnZW52KCkub3JpZ2luYWxDRnJhbWUgPSBuaWwKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmVzdG9yZUNhbWVyYSgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgbG9jYWwgU3RyYWZlU3BlZWQgPSAzNgoKICAgIGxvY2FsIFN0cmFmZSA9IHBsYXllcjpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICdTcGVlZCcsCiAgICAgICAgZmxhZyA9ICdTcGVlZCcsCiAgICAgICAgZGVzY3JpcHRpb24gPSAnQ2hhbmdlcyBjaGFyYWN0ZXIgc3BlZWQnLAogICAgICAgIHNlY3Rpb24gPSAnbGVmdCcsCiAgICAKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICBDb25uZWN0aW9uc19NYW5hZ2VyWydTdHJhZmUnXSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLlByZVNpbXVsYXRpb246Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgIGlmIGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgY2hhcmFjdGVyLkh1bWFub2lkLldhbGtTcGVlZCA9IFN0cmFmZVNwZWVkCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGlmIGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBjaGFyYWN0ZXIuSHVtYW5vaWQuV2Fsa1NwZWVkID0gMzYKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBDb25uZWN0aW9uc19NYW5hZ2VyWydTdHJhZmUnXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNfTWFuYWdlclsnU3RyYWZlJ106RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNfTWFuYWdlclsnU3RyYWZlJ10gPSBuaWwKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCiAgICAKICAgIFN0cmFmZTpjcmVhdGVfc2xpZGVyKHsKICAgICAgICB0aXRsZSA9ICdTdHJhZmUgU3BlZWQnLAogICAgICAgIGZsYWcgPSAnU3RyYWZlX1NwZWVkJywKICAgICAgICBtaW5pbXVtX3ZhbHVlID0gMzYsCiAgICAgICAgbWF4aW11bV92YWx1ZSA9IDIwMCwKICAgICAgICB2YWx1ZSA9IDM2LAogICAgICAgIHJvdW5kX251bWJlciA9IHRydWUsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgU3RyYWZlU3BlZWQgPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCiAgICBsb2NhbCBTcGluYm90ID0gcGxheWVyOmNyZWF0ZV9tb2R1bGUoewogICAgICAgIHRpdGxlID0gJ1NwaW5ib3QnLAogICAgICAgIGZsYWcgPSAnU3BpbmJvdCcsCgogICAgICAgIGRlc2NyaXB0aW9uID0gJ1NwaW5zIFBsYXllcicsCiAgICAgICAgc2VjdGlvbiA9ICdyaWdodCcsCgogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWU6IGJvb2xlYW4pCgogICAgICAgICAgICBnZXRnZW52KCkuU3BpbmJvdCA9IHZhbHVlCiAgICAgICAgICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIGdldGdlbnYoKS5zcGluID0gdHJ1ZQogICAgICAgICAgICAgICAgZ2V0Z2VudigpLnNwaW5TcGVlZCA9IGdldGdlbnYoKS5zcGluU3BlZWQgb3IgMSAKICAgICAgICAgICAgICAgIGxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQogICAgICAgICAgICAgICAgbG9jYWwgUnVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpCiAgICAgICAgICAgICAgICBsb2NhbCBDbGllbnQgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgZnVuY3Rpb24gc3BpbkNoYXJhY3RlcigpCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgZ2V0Z2VudigpLnNwaW4gZG8KICAgICAgICAgICAgICAgICAgICAgICAgUnVuU2VydmljZS5IZWFydGJlYXQ6V2FpdCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBDbGllbnQuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGZ1bmNIUlAgPSBjaGFyIGFuZCBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoYXIgYW5kIGZ1bmNIUlAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY0hSUC5DRnJhbWUgKj0gQ0ZyYW1lLkFuZ2xlcygwLCBnZXRnZW52KCkuc3BpblNwZWVkLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuc3BpblRocmVhZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLnNwaW5UaHJlYWQgPSBjb3JvdXRpbmUuY3JlYXRlKHNwaW5DaGFyYWN0ZXIpCiAgICAgICAgICAgICAgICAgICAgY29yb3V0aW5lLnJlc3VtZShnZXRnZW52KCkuc3BpblRocmVhZCkKICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGdldGdlbnYoKS5zcGluID0gZmFsc2UKICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuc3BpblRocmVhZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLnNwaW5UaHJlYWQgPSBuaWwKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCgogICAgU3BpbmJvdDpjcmVhdGVfc2xpZGVyKHsKICAgICAgICB0aXRsZSA9ICdTcGluYm90IFNwZWVkJywKICAgICAgICBmbGFnID0gJ1NwaW5ib3RfU3BlZWQnLAogICAgCiAgICAgICAgbWF4aW11bV92YWx1ZSA9IDEwMCwKICAgICAgICBtaW5pbXVtX3ZhbHVlID0gMSwKICAgICAgICB2YWx1ZSA9IDEsCiAgICAKICAgICAgICByb3VuZF9udW1iZXIgPSB0cnVlLAogICAgCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgZ2V0Z2VudigpLnNwaW5TcGVlZCA9IG1hdGgucmFkKHZhbHVlKQogICAgICAgIGVuZAogICAgfSkKCiAgICBsb2NhbCBDYW1lcmFUb2dnbGUgPSBwbGF5ZXI6Y3JlYXRlX21vZHVsZSh7CiAgICAgICAgdGl0bGUgPSAnRmllbGQgb2YgVmlldycsCiAgICAgICAgZmxhZyA9ICdGaWVsZF9PZl9WaWV3JywKICAgIAogICAgICAgIGRlc2NyaXB0aW9uID0gJ0NoYW5nZXMgQ2FtZXJhIFBPVicsCiAgICAgICAgc2VjdGlvbiA9ICdsZWZ0JywKICAgIAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIGdldGdlbnYoKS5DYW1lcmFFbmFibGVkID0gdmFsdWUKICAgICAgICAgICAgbG9jYWwgQ2FtZXJhID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5DdXJyZW50Q2FtZXJhCiAgICAKICAgICAgICAgICAgaWYgdmFsdWUgdGhlbgogICAgICAgICAgICAgICAgZ2V0Z2VudigpLkNhbWVyYUZPViA9IGdldGdlbnYoKS5DYW1lcmFGT1Ygb3IgNzAKICAgICAgICAgICAgICAgIENhbWVyYS5GaWVsZE9mVmlldyA9IGdldGdlbnYoKS5DYW1lcmFGT1YKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5GT1ZMb29wIHRoZW4KICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuRk9WTG9vcCA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5DYW1lcmFFbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhbWVyYS5GaWVsZE9mVmlldyA9IGdldGdlbnYoKS5DYW1lcmFGT1YKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIENhbWVyYS5GaWVsZE9mVmlldyA9IDcwCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5GT1ZMb29wIHRoZW4KICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuRk9WTG9vcDpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuRk9WTG9vcCA9IG5pbAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKICAgIAogICAgQ2FtZXJhVG9nZ2xlOmNyZWF0ZV9zbGlkZXIoewogICAgICAgIHRpdGxlID0gJ0NhbWVyYSBGT1YnLCAgICAgICAgZmxhZyA9ICdDYW1lcmFfRk9WJywKICAgIAogICAgICAgIG1heGltdW1fdmFsdWUgPSAxMjAsCiAgICAgICAgbWluaW11bV92YWx1ZSA9IDUwLAogICAgICAgIHZhbHVlID0gNzAsCiAgICAKICAgICAgICByb3VuZF9udW1iZXIgPSB0cnVlLAogICAgCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgZ2V0Z2VudigpLkNhbWVyYUZPViA9IHZhbHVlCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5DYW1lcmFFbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuQ3VycmVudENhbWVyYS5GaWVsZE9mVmlldyA9IHZhbHVlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKICAgIAogICAgbG9jYWwgQW5pbWF0aW9ucyA9IHBsYXllcjpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICdFbW90ZXMnLAogICAgICAgIGZsYWcgPSAnRW1vdGVzJywKICAgIAogICAgICAgIGRlc2NyaXB0aW9uID0gJ0N1c3RvbSBFbW90ZXMnLAogICAgICAgIHNlY3Rpb24gPSAncmlnaHQnLAogICAgCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgZ2V0Z2VudigpLkFuaW1hdGlvbnMgPSB2YWx1ZQogICAgCiAgICAgICAgICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ0FuaW1hdGlvbnMnXSA9IFJ1blNlcnZpY2UuSGVhcnRiZWF0OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBQbGF5ZXIuQ2hhcmFjdGVyIG9yIG5vdCBQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgICAgICBsb2NhbCBTcGVlZCA9IFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQuQXNzZW1ibHlMaW5lYXJWZWxvY2l0eS5NYWduaXR1ZGUKICAgIAogICAgICAgICAgICAgICAgICAgIGlmIFNwZWVkID4gMzAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiBBbmltYXRpb24udHJhY2sgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgQW5pbWF0aW9uLnRyYWNrOlN0b3AoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQW5pbWF0aW9uLnRyYWNrOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQW5pbWF0aW9uLnRyYWNrID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IEFuaW1hdGlvbi50cmFjayBhbmQgQW5pbWF0aW9uLmN1cnJlbnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXV0b19QYXJyeS5QbGF5X0FuaW1hdGlvbihBbmltYXRpb24uY3VycmVudCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlmIEFuaW1hdGlvbi50cmFjayB0aGVuCiAgICAgICAgICAgICAgICAgICAgQW5pbWF0aW9uLnRyYWNrOlN0b3AoKQogICAgICAgICAgICAgICAgICAgIEFuaW1hdGlvbi50cmFjazpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICBBbmltYXRpb24udHJhY2sgPSBuaWwKICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICBpZiBDb25uZWN0aW9uc19NYW5hZ2VyWydBbmltYXRpb25zJ10gdGhlbgogICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ0FuaW1hdGlvbnMnXTpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICBDb25uZWN0aW9uc19NYW5hZ2VyWydBbmltYXRpb25zJ10gPSBuaWwKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCiAgIAogICAgbG9jYWwgc2VsZWN0ZWRfYW5pbWF0aW9uID0gRW1vdGVzX0RhdGFbMV0KICAgIAogICAgbG9jYWwgQW5pbWF0aW9uQ2hvaWNlID0gQW5pbWF0aW9uczpjcmVhdGVfZHJvcGRvd24oewogICAgICAgIHRpdGxlID0gJ0FuaW1hdGlvbiBUeXBlJywKICAgICAgICBmbGFnID0gJ1NlbGVjdGVkX0FuaW1hdGlvbicsCiAgICAKICAgICAgICBvcHRpb25zID0gRW1vdGVzX0RhdGEsCiAgICAKICAgICAgICBtdWx0aV9kcm9wZG93biA9IGZhbHNlLAogICAgICAgIG1heGltdW1fb3B0aW9ucyA9ICNFbW90ZXNfRGF0YSwKICAgIAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIHNlbGVjdGVkX2FuaW1hdGlvbiA9IHZhbHVlCiAgICAKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkFuaW1hdGlvbnMgdGhlbgogICAgICAgICAgICAgICAgQXV0b19QYXJyeS5QbGF5X0FuaW1hdGlvbih2YWx1ZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KQogICAgCiAgICBBbmltYXRpb25DaG9pY2U6dXBkYXRlKHNlbGVjdGVkX2FuaW1hdGlvbikKCiAgICBfRy5QbGF5ZXJDb3NtZXRpY3NDbGVhbnVwID0ge30KICAgIAogICAgbG9jYWwgUGxheWVyQ29zbWV0aWNzID0gcGxheWVyOmNyZWF0ZV9tb2R1bGUoewogICAgICAgIHRpdGxlID0gIlBsYXllciBDb3NtZXRpY3MiLAogICAgICAgIGZsYWcgPSAiUGxheWVyX0Nvc21ldGljcyIsCiAgICAgICAgZGVzY3JpcHRpb24gPSAiQXBwbHkgaGVhZGxlc3MgYW5kIGtvcmJsb3giLAogICAgICAgIHNlY3Rpb24gPSAibGVmdCIsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKICAgICAgICAgICAgbG9jYWwgcGxheWVycyA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpCiAgICAgICAgICAgIGxvY2FsIGxwID0gcGxheWVycy5Mb2NhbFBsYXllcgogICAgCiAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIGFwcGx5S29yYmxveChjaGFyYWN0ZXIpCiAgICAgICAgICAgICAgICBsb2NhbCByaWdodExlZyA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRMZWciKSBvciBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0IExlZyIpCiAgICAgICAgICAgICAgICBpZiBub3QgcmlnaHRMZWcgdGhlbgogICAgICAgICAgICAgICAgICAgIHdhcm4oIlJpZ2h0IGxlZyBub3QgZm91bmQgb24gY2hhcmFjdGVyIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgXywgY2hpbGQgaW4gcGFpcnMocmlnaHRMZWc6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBjaGlsZDpJc0EoIlNwZWNpYWxNZXNoIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBjaGlsZDpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgbG9jYWwgc3BlY2lhbE1lc2ggPSBJbnN0YW5jZS5uZXcoIlNwZWNpYWxNZXNoIikKICAgICAgICAgICAgICAgIHNwZWNpYWxNZXNoLk1lc2hJZCA9ICJyYnhhc3NldGlkOi8vMTAxODUxNjk2IgogICAgICAgICAgICAgICAgc3BlY2lhbE1lc2guVGV4dHVyZUlkID0gInJieGFzc2V0aWQ6Ly8xMTU3Mjc4NjMiCiAgICAgICAgICAgICAgICBzcGVjaWFsTWVzaC5TY2FsZSA9IFZlY3RvcjMubmV3KDEsIDEsIDEpCiAgICAgICAgICAgICAgICBzcGVjaWFsTWVzaC5QYXJlbnQgPSByaWdodExlZwogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBsb2NhbCBmdW5jdGlvbiBzYXZlUmlnaHRMZWdQcm9wZXJ0aWVzKGNoYXIpCiAgICAgICAgICAgICAgICBpZiBjaGFyIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCByaWdodExlZyA9IGNoYXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0TGVnIikgb3IgY2hhcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHQgTGVnIikKICAgICAgICAgICAgICAgICAgICBpZiByaWdodExlZyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG9yaWdpbmFsTWVzaCA9IHJpZ2h0TGVnOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiU3BlY2lhbE1lc2giKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBvcmlnaW5hbE1lc2ggdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5vcmlnaW5hbE1lc2hJZCA9IG9yaWdpbmFsTWVzaC5NZXNoSWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLlBsYXllckNvc21ldGljc0NsZWFudXAub3JpZ2luYWxUZXh0dXJlSWQgPSBvcmlnaW5hbE1lc2guVGV4dHVyZUlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5QbGF5ZXJDb3NtZXRpY3NDbGVhbnVwLm9yaWdpbmFsU2NhbGUgPSBvcmlnaW5hbE1lc2guU2NhbGUKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5oYWROb01lc2ggPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5yaWdodExlZ0NoaWxkcmVuID0ge30KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIGNoaWxkIGluIHBhaXJzKHJpZ2h0TGVnOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGlsZDpJc0EoIlNwZWNpYWxNZXNoIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChfRy5QbGF5ZXJDb3NtZXRpY3NDbGVhbnVwLnJpZ2h0TGVnQ2hpbGRyZW4sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2xhc3NOYW1lID0gY2hpbGQuQ2xhc3NOYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcm9wZXJ0aWVzID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWVzaElkID0gY2hpbGQuTWVzaElkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dHVyZUlkID0gY2hpbGQuVGV4dHVyZUlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2NhbGUgPSBjaGlsZC5TY2FsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIHJlc3RvcmVSaWdodExlZyhjaGFyKQogICAgICAgICAgICAgICAgaWYgY2hhciB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcmlnaHRMZWcgPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJSaWdodExlZyIpIG9yIGNoYXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0IExlZyIpCiAgICAgICAgICAgICAgICAgICAgaWYgcmlnaHRMZWcgYW5kIF9HLlBsYXllckNvc21ldGljc0NsZWFudXAucmlnaHRMZWdDaGlsZHJlbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCBjaGlsZCBpbiBwYWlycyhyaWdodExlZzpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2hpbGQ6SXNBKCJTcGVjaWFsTWVzaCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZDpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIF9HLlBsYXllckNvc21ldGljc0NsZWFudXAuaGFkTm9NZXNoIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCBjaGlsZERhdGEgaW4gaXBhaXJzKF9HLlBsYXllckNvc21ldGljc0NsZWFudXAucmlnaHRMZWdDaGlsZHJlbikgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoaWxkRGF0YS5DbGFzc05hbWUgPT0gIlNwZWNpYWxNZXNoIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbmV3TWVzaCA9IEluc3RhbmNlLm5ldygiU3BlY2lhbE1lc2giKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld01lc2guTWVzaElkID0gY2hpbGREYXRhLlByb3BlcnRpZXMuTWVzaElkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3TWVzaC5UZXh0dXJlSWQgPSBjaGlsZERhdGEuUHJvcGVydGllcy5UZXh0dXJlSWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdNZXNoLlNjYWxlID0gY2hpbGREYXRhLlByb3BlcnRpZXMuU2NhbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdNZXNoLlBhcmVudCA9IHJpZ2h0TGVnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgaWYgdmFsdWUgdGhlbgogICAgICAgICAgICAgICAgQ29zbWV0aWNzQWN0aXZlID0gdHJ1ZQogICAgCiAgICAgICAgICAgICAgICBnZXRnZW52KCkuQ29uZmlnID0gewogICAgICAgICAgICAgICAgICAgIEhlYWRsZXNzID0gdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBscC5DaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGhlYWQgPSBscC5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKQogICAgICAgICAgICAgICAgICAgIGlmIGhlYWQgYW5kIGdldGdlbnYoKS5Db25maWcuSGVhZGxlc3MgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBfRy5QbGF5ZXJDb3NtZXRpY3NDbGVhbnVwLmhlYWRUcmFuc3BhcmVuY3kgPSBoZWFkLlRyYW5zcGFyZW5jeQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZGVjYWwgPSBoZWFkOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiRGVjYWwiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBkZWNhbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfRy5QbGF5ZXJDb3NtZXRpY3NDbGVhbnVwLmZhY2VEZWNhbElkID0gZGVjYWwuVGV4dHVyZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5mYWNlRGVjYWxOYW1lID0gZGVjYWwuTmFtZQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzYXZlUmlnaHRMZWdQcm9wZXJ0aWVzKGxwLkNoYXJhY3RlcikKICAgICAgICAgICAgICAgICAgICBhcHBseUtvcmJsb3gobHAuQ2hhcmFjdGVyKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIF9HLlBsYXllckNvc21ldGljc0NsZWFudXAuY2hhcmFjdGVyQWRkZWRDb25uID0gbHAuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGFyKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGhlYWQgPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJIZWFkIikKICAgICAgICAgICAgICAgICAgICBpZiBoZWFkIGFuZCBnZXRnZW52KCkuQ29uZmlnLkhlYWRsZXNzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5oZWFkVHJhbnNwYXJlbmN5ID0gaGVhZC5UcmFuc3BhcmVuY3kKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGRlY2FsID0gaGVhZDpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkRlY2FsIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGVjYWwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5mYWNlRGVjYWxJZCA9IGRlY2FsLlRleHR1cmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9HLlBsYXllckNvc21ldGljc0NsZWFudXAuZmFjZURlY2FsTmFtZSA9IGRlY2FsLk5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc2F2ZVJpZ2h0TGVnUHJvcGVydGllcyhjaGFyKQogICAgICAgICAgICAgICAgICAgIGFwcGx5S29yYmxveChjaGFyKQogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuQ29uZmlnLkhlYWRsZXNzIHRoZW4KICAgICAgICAgICAgICAgICAgICBoZWFkTG9vcCA9IHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSBDb3NtZXRpY3NBY3RpdmUgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBscC5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoYXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGhlYWQgPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJIZWFkIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBoZWFkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZC5UcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGRlY2FsID0gaGVhZDpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkRlY2FsIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGVjYWwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVjYWw6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBDb3NtZXRpY3NBY3RpdmUgPSBmYWxzZQogICAgCiAgICAgICAgICAgICAgICBpZiBfRy5QbGF5ZXJDb3NtZXRpY3NDbGVhbnVwLmNoYXJhY3RlckFkZGVkQ29ubiB0aGVuCiAgICAgICAgICAgICAgICAgICAgX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5jaGFyYWN0ZXJBZGRlZENvbm46RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5jaGFyYWN0ZXJBZGRlZENvbm4gPSBuaWwKICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICBpZiBoZWFkTG9vcCB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFzay5jYW5jZWwoaGVhZExvb3ApCiAgICAgICAgICAgICAgICAgICAgaGVhZExvb3AgPSBuaWwKICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gbHAuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICBpZiBjaGFyIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBoZWFkID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpCiAgICAgICAgICAgICAgICAgICAgaWYgaGVhZCBhbmQgX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5oZWFkVHJhbnNwYXJlbmN5IH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWQuVHJhbnNwYXJlbmN5ID0gX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5oZWFkVHJhbnNwYXJlbmN5CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBfRy5QbGF5ZXJDb3NtZXRpY3NDbGVhbnVwLmZhY2VEZWNhbElkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG5ld0RlY2FsID0gaGVhZDpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkRlY2FsIikgb3IgSW5zdGFuY2UubmV3KCJEZWNhbCIsIGhlYWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdEZWNhbC5OYW1lID0gX0cuUGxheWVyQ29zbWV0aWNzQ2xlYW51cC5mYWNlRGVjYWxOYW1lIG9yICJmYWNlIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3RGVjYWwuVGV4dHVyZSA9IF9HLlBsYXllckNvc21ldGljc0NsZWFudXAuZmFjZURlY2FsSWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0RlY2FsLkZhY2UgPSBFbnVtLk5vcm1hbElkLkZyb250CiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJlc3RvcmVSaWdodExlZyhjaGFyKQogICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIF9HLlBsYXllckNvc21ldGljc0NsZWFudXAgPSB7fQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCgogICAgbG9jYWwgZmx5ID0gcGxheWVyOmNyZWF0ZV9tb2R1bGUoewogICAgICAgIHRpdGxlID0gIkZseSIsCiAgICAgICAgZmxhZyA9ICJGbHkiLAogICAgICAgIGRlc2NyaXB0aW9uID0gIkFsbG93cyB0aGUgcGxheWVyIHRvIGZseSIsCiAgICAgICAgc2VjdGlvbiA9ICJyaWdodCIsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKICAgICAgICAgICAgaWYgdmFsdWUgdGhlbgogICAgICAgICAgICAgICAgZ2V0Z2VudigpLkZseUVuYWJsZWQgPSB0cnVlCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gUGxheWVyLkNoYXJhY3RlciBvciBQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCiAgICAgICAgICAgICAgICBsb2NhbCBocnAgPSBjaGFyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICBsb2NhbCBodW1hbm9pZCA9IGNoYXI6V2FpdEZvckNoaWxkKCJIdW1hbm9pZCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGdldGdlbnYoKS5PcmlnaW5hbFN0YXRlVHlwZSA9IGh1bWFub2lkOkdldFN0YXRlKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ2V0Z2VudigpLlJhZ2RvbGxIYW5kbGVyID0gaHVtYW5vaWQuU3RhdGVDaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24ob2xkU3RhdGUsIG5ld1N0YXRlKQogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5GbHlFbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmV3U3RhdGUgPT0gRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5QaHlzaWNzIG9yIG5ld1N0YXRlID09IEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuUmFnZG9sbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLmRlZmVyKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodW1hbm9pZDpDaGFuZ2VTdGF0ZShFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkdldHRpbmdVcCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodW1hbm9pZDpDaGFuZ2VTdGF0ZShFbnVtLkh1bWFub2lkU3RhdGVUeXBlLlJ1bm5pbmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBib2R5R3lybyA9IEluc3RhbmNlLm5ldygiQm9keUd5cm8iKQogICAgICAgICAgICAgICAgYm9keUd5cm8uUCA9IDkwMDAwCiAgICAgICAgICAgICAgICBib2R5R3lyby5NYXhUb3JxdWUgPSBWZWN0b3IzLm5ldyg5ZTksIDllOSwgOWU5KQogICAgICAgICAgICAgICAgYm9keUd5cm8uUGFyZW50ID0gaHJwCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGJvZHlWZWxvY2l0eSA9IEluc3RhbmNlLm5ldygiQm9keVZlbG9jaXR5IikKICAgICAgICAgICAgICAgIGJvZHlWZWxvY2l0eS5WZWxvY2l0eSA9IFZlY3RvcjMubmV3KDAsIDAsIDApCiAgICAgICAgICAgICAgICBib2R5VmVsb2NpdHkuTWF4Rm9yY2UgPSBWZWN0b3IzLm5ldyg5ZTksIDllOSwgOWU5KQogICAgICAgICAgICAgICAgYm9keVZlbG9jaXR5LlBhcmVudCA9IGhycAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBodW1hbm9pZC5QbGF0Zm9ybVN0YW5kID0gdHJ1ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBnZXRnZW52KCkuUmVzZXR0ZXJDb25uZWN0aW9uID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5GbHlFbmFibGVkIHRoZW4gcmV0dXJuIGVuZAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIGJvZHlHeXJvIGFuZCBib2R5R3lyby5QYXJlbnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBib2R5R3lyby5QID0gOTAwMDAKICAgICAgICAgICAgICAgICAgICAgICAgYm9keUd5cm8uTWF4VG9ycXVlID0gVmVjdG9yMy5uZXcoOWU5LCA5ZTksIDllOSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBib2R5VmVsb2NpdHkgYW5kIGJvZHlWZWxvY2l0eS5QYXJlbnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBib2R5VmVsb2NpdHkuTWF4Rm9yY2UgPSBWZWN0b3IzLm5ldyg5ZTksIDllOSwgOWU5KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGh1bWFub2lkLlBsYXRmb3JtU3RhbmQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGJvZHlHeXJvLlBhcmVudCBvciBub3QgYm9keVZlbG9jaXR5LlBhcmVudCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJvZHlHeXJvIHRoZW4gYm9keUd5cm86RGVzdHJveSgpIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBib2R5VmVsb2NpdHkgdGhlbiBib2R5VmVsb2NpdHk6RGVzdHJveSgpIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgYm9keUd5cm8gPSBJbnN0YW5jZS5uZXcoIkJvZHlHeXJvIikKICAgICAgICAgICAgICAgICAgICAgICAgYm9keUd5cm8uUCA9IDkwMDAwCiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHlHeXJvLk1heFRvcnF1ZSA9IFZlY3RvcjMubmV3KDllOSwgOWU5LCA5ZTkpCiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHlHeXJvLlBhcmVudCA9IGhycAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgYm9keVZlbG9jaXR5ID0gSW5zdGFuY2UubmV3KCJCb2R5VmVsb2NpdHkiKQogICAgICAgICAgICAgICAgICAgICAgICBib2R5VmVsb2NpdHkuVmVsb2NpdHkgPSBWZWN0b3IzLm5ldygwLCAwLCAwKQogICAgICAgICAgICAgICAgICAgICAgICBib2R5VmVsb2NpdHkuTWF4Rm9yY2UgPSBWZWN0b3IzLm5ldyg5ZTksIDllOSwgOWU5KQogICAgICAgICAgICAgICAgICAgICAgICBib2R5VmVsb2NpdHkuUGFyZW50ID0gaHJwCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGdldGdlbnYoKS5GbHlDb25uZWN0aW9uID0gUnVuU2VydmljZS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuRmx5RW5hYmxlZCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgICAgICBsb2NhbCBjYW1DRiA9IHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZQogICAgICAgICAgICAgICAgICAgIGxvY2FsIG1vdmVEaXIgPSBWZWN0b3IzLm5ldygwLCAwLCAwKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIFVzZXJJbnB1dFNlcnZpY2U6SXNLZXlEb3duKEVudW0uS2V5Q29kZS5XKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVEaXIgPSBtb3ZlRGlyICsgY2FtQ0YuTG9va1ZlY3RvcgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIFVzZXJJbnB1dFNlcnZpY2U6SXNLZXlEb3duKEVudW0uS2V5Q29kZS5TKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVEaXIgPSBtb3ZlRGlyIC0gY2FtQ0YuTG9va1ZlY3RvcgogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIFVzZXJJbnB1dFNlcnZpY2U6SXNLZXlEb3duKEVudW0uS2V5Q29kZS5BKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVEaXIgPSBtb3ZlRGlyIC0gY2FtQ0YuUmlnaHRWZWN0b3IKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBVc2VySW5wdXRTZXJ2aWNlOklzS2V5RG93bihFbnVtLktleUNvZGUuRCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBtb3ZlRGlyID0gbW92ZURpciArIGNhbUNGLlJpZ2h0VmVjdG9yCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgaWYgVXNlcklucHV0U2VydmljZTpJc0tleURvd24oRW51bS5LZXlDb2RlLkUpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbW92ZURpciA9IG1vdmVEaXIgKyBWZWN0b3IzLm5ldygwLCAxLCAwKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIFVzZXJJbnB1dFNlcnZpY2U6SXNLZXlEb3duKEVudW0uS2V5Q29kZS5RKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVEaXIgPSBtb3ZlRGlyIC0gVmVjdG9yMy5uZXcoMCwgMSwgMCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBtb3ZlRGlyLk1hZ25pdHVkZSA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBtb3ZlRGlyID0gbW92ZURpci5Vbml0CiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgYm9keVZlbG9jaXR5LlZlbG9jaXR5ID0gbW92ZURpciAqIChnZXRnZW52KCkuRmx5U3BlZWQgb3IgNTApCiAgICAgICAgICAgICAgICAgICAgYm9keUd5cm8uQ0ZyYW1lID0gY2FtQ0YKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZ2V0Z2VudigpLkZseUVuYWJsZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuRmx5Q29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLkZseUNvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLkZseUNvbm5lY3Rpb24gPSBuaWwKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuUmFnZG9sbEhhbmRsZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5SYWdkb2xsSGFuZGxlcjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuUmFnZG9sbEhhbmRsZXIgPSBuaWwKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuUmVzZXR0ZXJDb25uZWN0aW9uIHRoZW4KICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuUmVzZXR0ZXJDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5SZXNldHRlckNvbm5lY3Rpb24gPSBuaWwKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgaWYgY2hhciB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaHJwID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgaHVtYW5vaWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBodW1hbm9pZC5QbGF0Zm9ybVN0YW5kID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLk9yaWdpbmFsU3RhdGVUeXBlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh1bWFub2lkOkNoYW5nZVN0YXRlKGdldGdlbnYoKS5PcmlnaW5hbFN0YXRlVHlwZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgaHJwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gaXBhaXJzKGhycDpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpJc0EoIkJvZHlHeXJvIikgb3IgdjpJc0EoIkJvZHlWZWxvY2l0eSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2OkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKICAgIAogICAgZmx5OmNyZWF0ZV9zbGlkZXIoewogICAgICAgIHRpdGxlID0gIkZseSBTcGVlZCIsCiAgICAgICAgZmxhZyA9ICJGbHlfU3BlZWQiLAogICAgICAgIG1pbmltdW1fdmFsdWUgPSAxMCwKICAgICAgICBtYXhpbXVtX3ZhbHVlID0gMjAwLAogICAgICAgIHZhbHVlID0gNTAsCiAgICAgICAgcm91bmRfbnVtYmVyID0gdHJ1ZSwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBudW1iZXIpCiAgICAgICAgICAgIGdldGdlbnYoKS5GbHlTcGVlZCA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQoKICAgIGxvY2FsIGxvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgogICAgICAgICAgICAgICAgCiAgICBsb2NhbCBTZWxlY3RlZFBsYXllckZvbGxvdyA9IG5pbAogICAgbG9jYWwgZm9sbG93RHJvcGRvd24KICAgIAogICAgbG9jYWwgZnVuY3Rpb24gZ2V0UGxheWVyTmFtZXMoKQogICAgICAgIGxvY2FsIG5hbWVzID0ge30KICAgICAgICBmb3IgXywgcGxheWVyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgaWYgcGxheWVyIH49IGxvY2FsUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChuYW1lcywgcGxheWVyLk5hbWUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIHJldHVybiBuYW1lcwogICAgZW5kCiAgICAKICAgIGxvY2FsIGZ1bmN0aW9uIHVwZGF0ZUZvbGxvd1RhcmdldCgpCiAgICAgICAgbG9jYWwgYXZhaWxhYmxlUGxheWVycyA9IGdldFBsYXllck5hbWVzKCkKICAgICAgICBpZiAjYXZhaWxhYmxlUGxheWVycyA+IDAgdGhlbgogICAgICAgICAgICBTZWxlY3RlZFBsYXllckZvbGxvdyA9IGF2YWlsYWJsZVBsYXllcnNbMV0KICAgICAgICAgICAgaWYgZm9sbG93RHJvcGRvd24gdGhlbgogICAgICAgICAgICAgICAgZm9sbG93RHJvcGRvd246dXBkYXRlKFNlbGVjdGVkUGxheWVyRm9sbG93KQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIFNlbGVjdGVkUGxheWVyRm9sbG93ID0gbmlsCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgbG9jYWwgUGxheWVyRm9sbG93ID0gcGxheWVyOmNyZWF0ZV9tb2R1bGUoewogICAgICAgIHRpdGxlID0gIlBsYXllciBGb2xsb3ciLAogICAgICAgIGZsYWcgPSAiUGxheWVyX0ZvbGxvdyIsCiAgICAgICAgZGVzY3JpcHRpb24gPSAiRm9sbG93cyB0aGUgc2VsZWN0ZWQgcGxheWVyIiwKICAgICAgICBzZWN0aW9uID0gImxlZnQiLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIGdldGdlbnYoKS5QbGF5ZXJGb2xsb3dFbmFibGVkID0gdHJ1ZQogICAgICAgICAgICAgICAgZ2V0Z2VudigpLlBsYXllckZvbGxvd0Nvbm5lY3Rpb24gPSBSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBpZiBub3QgU2VsZWN0ZWRQbGF5ZXJGb2xsb3cgdGhlbiByZXR1cm4gZW5kIC0tIFByZXZlbnRzIG5pbCBpbmRleGluZwogICAgICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldFBsYXllciA9IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQoU2VsZWN0ZWRQbGF5ZXJGb2xsb3cpCiAgICAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0UGxheWVyIGFuZCB0YXJnZXRQbGF5ZXIuQ2hhcmFjdGVyIGFuZCB0YXJnZXRQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2hhciA9IGxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGFyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGh1bWFub2lkID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaHVtYW5vaWQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGh1bWFub2lkOk1vdmVUbyh0YXJnZXRQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBnZXRnZW52KCkuUGxheWVyRm9sbG93RW5hYmxlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuUGxheWVyRm9sbG93Q29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlBsYXllckZvbGxvd0Nvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlBsYXllckZvbGxvd0Nvbm5lY3Rpb24gPSBuaWwKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCgogICAgbG9jYWwgaW5pdGlhbE9wdGlvbnMgPSBnZXRQbGF5ZXJOYW1lcygpCiAgICBpZiAjaW5pdGlhbE9wdGlvbnMgPiAwIHRoZW4KICAgICAgICBmb2xsb3dEcm9wZG93biA9IFBsYXllckZvbGxvdzpjcmVhdGVfZHJvcGRvd24oewogICAgICAgICAgICB0aXRsZSA9ICJGb2xsb3cgVGFyZ2V0IiwKICAgICAgICAgICAgZmxhZyA9ICJGb2xsb3dfVGFyZ2V0IiwKICAgICAgICAgICAgb3B0aW9ucyA9IGluaXRpYWxPcHRpb25zLAogICAgICAgICAgICBtdWx0aV9kcm9wZG93biA9IGZhbHNlLAogICAgICAgICAgICBtYXhpbXVtX29wdGlvbnMgPSAjaW5pdGlhbE9wdGlvbnMsCiAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRQbGF5ZXJGb2xsb3cgPSB2YWx1ZQogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5Gb2xsb3dOb3RpZnlFbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgTGlicmFyeS5TZW5kTm90aWZpY2F0aW9uKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gIk1vZHVsZSBOb3RpZmljYXRpb24iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dCA9ICJOb3cgZm9sbG93aW5nOiAiIC4uIHZhbHVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb24gPSAzCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgfSkKICAgICAgICBTZWxlY3RlZFBsYXllckZvbGxvdyA9IGluaXRpYWxPcHRpb25zWzFdCiAgICAgICAgZm9sbG93RHJvcGRvd246dXBkYXRlKFNlbGVjdGVkUGxheWVyRm9sbG93KQogICAgICAgIGdldGdlbnYoKS5Gb2xsb3dEcm9wZG93biA9IGZvbGxvd0Ryb3Bkb3duCiAgICBlbHNlCiAgICAgICAgU2VsZWN0ZWRQbGF5ZXJGb2xsb3cgPSBuaWwKICAgIGVuZAogICAgCiAgICBsb2NhbCBsYXN0T3B0aW9uc1N0cmluZyA9IHRhYmxlLmNvbmNhdChpbml0aWFsT3B0aW9ucywgIiwiKQogICAgbG9jYWwgdXBkYXRlVGltZXIgPSAwCiAgICAKICAgIFJ1blNlcnZpY2UuSGVhcnRiZWF0OkNvbm5lY3QoZnVuY3Rpb24oZHQpCiAgICAgICAgdXBkYXRlVGltZXIgPSB1cGRhdGVUaW1lciArIGR0CiAgICAgICAgaWYgdXBkYXRlVGltZXIgPj0gMTAgdGhlbgogICAgICAgICAgICBsb2NhbCBuZXdPcHRpb25zID0gZ2V0UGxheWVyTmFtZXMoKQogICAgICAgICAgICB0YWJsZS5zb3J0KG5ld09wdGlvbnMpCiAgICAgICAgICAgIGxvY2FsIG5ld09wdGlvbnNTdHJpbmcgPSB0YWJsZS5jb25jYXQobmV3T3B0aW9ucywgIiwiKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbmV3T3B0aW9uc1N0cmluZyB+PSBsYXN0T3B0aW9uc1N0cmluZyB0aGVuCiAgICAgICAgICAgICAgICBpZiBmb2xsb3dEcm9wZG93biB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgI25ld09wdGlvbnMgPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZm9sbG93RHJvcGRvd24uc2V0X29wdGlvbnMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9sbG93RHJvcGRvd246c2V0X29wdGlvbnMobmV3T3B0aW9ucykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9sbG93RHJvcGRvd24ubWF4aW11bV9vcHRpb25zID0gI25ld09wdGlvbnMKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0YWJsZS5maW5kKG5ld09wdGlvbnMsIFNlbGVjdGVkUGxheWVyRm9sbG93KSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZFBsYXllckZvbGxvdyA9IG5ld09wdGlvbnNbMV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbGxvd0Ryb3Bkb3duOnVwZGF0ZShTZWxlY3RlZFBsYXllckZvbGxvdykKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZFBsYXllckZvbGxvdyA9IG5pbAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBsYXN0T3B0aW9uc1N0cmluZyA9IG5ld09wdGlvbnNTdHJpbmcKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHVwZGF0ZVRpbWVyID0gMAogICAgICAgIGVuZAogICAgZW5kKQogICAgCiAgICBQbGF5ZXJGb2xsb3c6Y3JlYXRlX2NoZWNrYm94KHsKICAgICAgICB0aXRsZSA9ICJOb3RpZnkiLAogICAgICAgIGZsYWcgPSAiRm9sbG93X05vdGlmeSIsCiAgICAgICAgZGVmYXVsdCA9IGZhbHNlLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIGdldGdlbnYoKS5Gb2xsb3dOb3RpZnlFbmFibGVkID0gdmFsdWUKICAgICAgICBlbmQKICAgIH0pCgogICAgbG9jYWwgSGl0U291bmRzID0gcGxheWVyOmNyZWF0ZV9tb2R1bGUoewogICAgICAgIHRpdGxlID0gJ0hpdCBTb3VuZHMnLAogICAgICAgIGZsYWcgPSAnSGl0X1NvdW5kcycsCiAgICAgICAgZGVzY3JpcHRpb24gPSAnVG9nZ2xlcyBoaXQgc291bmRzJywKICAgICAgICBzZWN0aW9uID0gJ3JpZ2h0JywKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBoaXRfU291bmRfRW5hYmxlZCA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQogICAgCiAgICBsb2NhbCBGb2xkZXIgPSBJbnN0YW5jZS5uZXcoIkZvbGRlciIpCiAgICBGb2xkZXIuTmFtZSA9ICJVc2VmdWwgVXRpbGl0eSIKICAgIEZvbGRlci5QYXJlbnQgPSB3b3Jrc3BhY2UKICAgIAogICAgbG9jYWwgaGl0X1NvdW5kID0gSW5zdGFuY2UubmV3KCdTb3VuZCcsIEZvbGRlcikKICAgIGhpdF9Tb3VuZC5Wb2x1bWUgPSA2CiAgICAKICAgIGxvY2FsIGhpdFNvdW5kT3B0aW9ucyA9IHsgCiAgICAgICAgIk1lZGFsIiwgCiAgICAgICAgIkZhdGFsaXR5IiwgCiAgICAgICAgIlNrZWV0IiwKICAgICAgICAiU3dpdGNoZXMiLAogICAgICAgICJSdXN0IEhlYWRzaG90IiwgCiAgICAgICAgIk5ldmVybG9zZSBTb3VuZCIsIAogICAgICAgICJCdWJibGUiLCAKICAgICAgICAiTGFzZXIiLCAKICAgICAgICAiU3RldmUiLCAKICAgICAgICAiQ2FsbCBvZiBEdXR5IiwgCiAgICAgICAgIkJhdCIsIAogICAgICAgICJURjIgQ3JpdGljYWwiLCAKICAgICAgICAiU2FiZXIiLCAKICAgICAgICAiQmFtZXdhcmUiCiAgICB9CiAgICAKICAgIGxvY2FsIGhpdFNvdW5kSWRzID0gewogICAgICAgIE1lZGFsID0gInJieGFzc2V0aWQ6Ly82NjA3MzM2NzE4IiwKICAgICAgICBGYXRhbGl0eSA9ICJyYnhhc3NldGlkOi8vNjYwNzExMzI1NSIsCiAgICAgICAgU2tlZXQgPSAicmJ4YXNzZXRpZDovLzY2MDcyMDQ1MDEiLAogICAgICAgIFN3aXRjaGVzID0gInJieGFzc2V0aWQ6Ly82NjA3MTczMzYzIiwKICAgICAgICBbIlJ1c3QgSGVhZHNob3QiXSA9ICJyYnhhc3NldGlkOi8vMTM4NzUwMzMxMzg3MDY0IiwKICAgICAgICBbIk5ldmVybG9zZSBTb3VuZCJdID0gInJieGFzc2V0aWQ6Ly8xMTAxNjg3MjM0NDcxNTMiLAogICAgICAgIEJ1YmJsZSA9ICJyYnhhc3NldGlkOi8vNjUzNDk0NzU4OCIsCiAgICAgICAgTGFzZXIgPSAicmJ4YXNzZXRpZDovLzc4Mzc0NjEzMzEiLAogICAgICAgIFN0ZXZlID0gInJieGFzc2V0aWQ6Ly80OTY1MDgzOTk3IiwKICAgICAgICBbIkNhbGwgb2YgRHV0eSJdID0gInJieGFzc2V0aWQ6Ly81OTUyMTIwMzAxIiwKICAgICAgICBCYXQgPSAicmJ4YXNzZXRpZDovLzMzMzM5MDczNDciLAogICAgICAgIFsiVEYyIENyaXRpY2FsIl0gPSAicmJ4YXNzZXRpZDovLzI5NjEwMjczNCIsCiAgICAgICAgU2FiZXIgPSAicmJ4YXNzZXRpZDovLzg0MTU2Nzg4MTMiLAogICAgICAgIEJhbWV3YXJlID0gInJieGFzc2V0aWQ6Ly8zMTI0MzMxODIwIgogICAgfQoKICAgIEhpdFNvdW5kczpjcmVhdGVfc2xpZGVyKHsKICAgICAgICB0aXRsZSA9ICdWb2x1bWUnLAogICAgICAgIGZsYWcgPSAnSGl0U291bmRWb2x1bWUnLAogICAgICAgIG1pbmltdW1fdmFsdWUgPSAxLAogICAgICAgIG1heGltdW1fdmFsdWUgPSAxMCwKICAgICAgICB2YWx1ZSA9IDUsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgaGl0X1NvdW5kLlZvbHVtZSA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQoKICAgIEhpdFNvdW5kczpjcmVhdGVfZHJvcGRvd24oewogICAgICAgIHRpdGxlID0gIkhpdCBTb3VuZCBUeXBlIiwKICAgICAgICBmbGFnID0gImhpdF9zb3VuZF90eXBlIiwKICAgICAgICBvcHRpb25zID0gaGl0U291bmRPcHRpb25zLAogICAgICAgIG1heGltdW1fb3B0aW9ucyA9ICNoaXRTb3VuZE9wdGlvbnMsCiAgICAgICAgbXVsdGlfZHJvcGRvd24gPSBmYWxzZSwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHNlbGVjdGVkT3B0aW9uKQogICAgICAgICAgICBpZiBoaXRTb3VuZElkc1tzZWxlY3RlZE9wdGlvbl0gdGhlbgogICAgICAgICAgICAgICAgaGl0X1NvdW5kLlNvdW5kSWQgPSBoaXRTb3VuZElkc1tzZWxlY3RlZE9wdGlvbl0KICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgd2FybigiSW52YWxpZCBoaXQgc291bmQgc2VsZWN0aW9uOiAiIC4uIHRvc3RyaW5nKHNlbGVjdGVkT3B0aW9uKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KQogICAgCiAgICBSZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLlBhcnJ5U3VjY2Vzcy5PbkNsaWVudEV2ZW50OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgIGlmIGhpdF9Tb3VuZF9FbmFibGVkIHRoZW4KICAgICAgICAgICAgaGl0X1NvdW5kOlBsYXkoKQogICAgICAgIGVuZAogICAgZW5kKQoKICAgIGxvY2FsIHNvdW5kT3B0aW9ucyA9IHsKICAgICAgICBbIkVleXVoIl0gPSAicmJ4YXNzZXRpZDovLzE2MTkwNzgyMTgxIiwKICAgICAgICBbIlN3ZWVwIl0gPSAicmJ4YXNzZXRpZDovLzEwMzUwODkzNjY1ODU1MyIsCiAgICAgICAgWyJCb3VuY2UiXSA9ICJyYnhhc3NldGlkOi8vMTM0ODE4ODgyODIxNjYwIiwKICAgICAgICBbIkV2ZXJ5Ym9keSBXYW50cyBUbyBSdWxlIFRoZSBXb3JsZCJdID0gInJieGFzc2V0aWQ6Ly84NzIwOTUyNzAzNDY3MCIsCiAgICAgICAgWyJNaXNzaW5nIE1vbmV5Il0gPSAicmJ4YXNzZXRpZDovLzEzNDY2ODE5NDEyODAzNyIsCiAgICAgICAgWyJTb3VyIEdyYXBlcyJdID0gInJieGFzc2V0aWQ6Ly8xMTc4MjAzOTIxNzIyOTEiLAogICAgICAgIFsiRXJ3YWNoZW4iXSA9ICJyYnhhc3NldGlkOi8vMTI0ODUzNjEyODgxNzcyIiwKICAgICAgICBbIkdyYXNwIHRoZSBMaWdodCJdID0gInJieGFzc2V0aWQ6Ly84OTU0OTE1NTY4OTM5NyIsCiAgICAgICAgWyJCZXlvbmQgdGhlIFNoYWRvd3MiXSA9ICJyYnhhc3NldGlkOi8vMTIwNzI5NzkyNTI5OTc4IiwKICAgICAgICBbIlJpc2UgdG8gdGhlIEhvcml6b24iXSA9ICJyYnhhc3NldGlkOi8vNzI1NzMyNjYyNjgzMTMiLAogICAgICAgIFsiRWNob2VzIG9mIHRoZSBDYW5keSBLaW5nZG9tIl0gPSAicmJ4YXNzZXRpZDovLzEwMzA0MDQ3NzMzMzU5MCIsCiAgICAgICAgWyJTcGVlZCJdID0gInJieGFzc2V0aWQ6Ly8xMjU1NTAyNTM4OTU4OTMiLAogICAgICAgIFsiTG8tZmkgQ2hpbGwgQSJdID0gInJieGFzc2V0aWQ6Ly85MDQzODg3MDkxIiwKICAgICAgICBbIkxvLWZpIEFtYmllbnQiXSA9ICJyYnhhc3NldGlkOi8vMTI5Nzc1Nzc2OTg3NTIzIiwKICAgICAgICBbIlRlYXJzIGluIHRoZSBSYWluIl0gPSAicmJ4YXNzZXRpZDovLzEyOTcxMDg0NTAzODI2MyIKICAgIH0KICAgIAogICAgbG9jYWwgY3VycmVudFNvdW5kID0gSW5zdGFuY2UubmV3KCJTb3VuZCIpCiAgICBjdXJyZW50U291bmQuVm9sdW1lID0gMwogICAgY3VycmVudFNvdW5kLkxvb3BlZCA9IGZhbHNlCiAgICBjdXJyZW50U291bmQuUGFyZW50ID0gZ2FtZTpHZXRTZXJ2aWNlKCJTb3VuZFNlcnZpY2UiKSAgIAogICAgCiAgICBsb2NhbCBzb3VuZE1vZHVsZQogICAgCiAgICBsb2NhbCBmdW5jdGlvbiBwbGF5U291bmRCeUlkKHNvdW5kSWQpCiAgICAgICAgY3VycmVudFNvdW5kOlN0b3AoKQogICAgICAgIGN1cnJlbnRTb3VuZC5Tb3VuZElkID0gc291bmRJZAogICAgICAgIGN1cnJlbnRTb3VuZDpQbGF5KCkKICAgIGVuZAogICAgCiAgICBsb2NhbCBzZWxlY3RlZFNvdW5kID0gIkVleXVoIgogICAgCiAgICBsb2NhbCBzb3VuZE1vZHVsZSA9IHdvcmxkOmNyZWF0ZV9tb2R1bGUoewogICAgICAgIHRpdGxlID0gJ1NvdW5kIENvbnRyb2xsZXInLAogICAgICAgIGZsYWcgPSAnc291bmRfY29udHJvbGxlcicsCiAgICAgICAgZGVzY3JpcHRpb24gPSAnQ29udHJvbCBiYWNrZ3JvdW5kIG11c2ljIGFuZCBzb3VuZHMnLAogICAgICAgIHNlY3Rpb24gPSAnbGVmdCcsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgZ2V0Z2VudigpLnNvdW5kbW9kdWxlID0gdmFsdWUKICAgICAgICAgICAgaWYgdmFsdWUgdGhlbgogICAgICAgICAgICAgICAgcGxheVNvdW5kQnlJZChzb3VuZE9wdGlvbnNbc2VsZWN0ZWRTb3VuZF0pCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGN1cnJlbnRTb3VuZDpTdG9wKCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KQoKICAgIHNvdW5kTW9kdWxlOmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiTG9vcCBTb25nIiwKICAgICAgICBmbGFnID0gIkxvb3BTb25nIiwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBjdXJyZW50U291bmQuTG9vcGVkID0gdmFsdWUKICAgICAgICBlbmQKICAgIH0pCgogICAgc291bmRNb2R1bGU6Y3JlYXRlX3NsaWRlcih7CiAgICAgICAgdGl0bGUgPSAnVm9sdW1lJywKICAgICAgICBmbGFnID0gJ0hpdFNvdW5kVm9sdW1lJywKICAgICAgICBtaW5pbXVtX3ZhbHVlID0gMSwKICAgICAgICBtYXhpbXVtX3ZhbHVlID0gMTAsCiAgICAgICAgdmFsdWUgPSAzLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIGN1cnJlbnRTb3VuZC5Wb2x1bWUgPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCiAgICBzb3VuZE1vZHVsZTpjcmVhdGVfZGl2aWRlcih7CiAgICB9KQogICAgCiAgICBzb3VuZE1vZHVsZTpjcmVhdGVfZHJvcGRvd24oewogICAgICAgIHRpdGxlID0gJ1NlbGVjdCBTb3VuZCcsCiAgICAgICAgZmxhZyA9ICdzb3VuZF9zZWxlY3Rpb24nLAogICAgICAgIG9wdGlvbnMgPSB7CiAgICAgICAgICAgICJFZXl1aCIsCiAgICAgICAgICAgICJTd2VlcCIsIAogICAgICAgICAgICAiQm91bmNlIiwKICAgICAgICAgICAgIkV2ZXJ5Ym9keSBXYW50cyBUbyBSdWxlIFRoZSBXb3JsZCIsCiAgICAgICAgICAgICJNaXNzaW5nIE1vbmV5IiwKICAgICAgICAgICAgIlNvdXIgR3JhcGVzIiwKICAgICAgICAgICAgIkVyd2FjaGVuIiwKICAgICAgICAgICAgIkdyYXNwIHRoZSBMaWdodCIsCiAgICAgICAgICAgICJCZXlvbmQgdGhlIFNoYWRvd3MiLAogICAgICAgICAgICAiUmlzZSB0byB0aGUgSG9yaXpvbiIsCiAgICAgICAgICAgICJFY2hvZXMgb2YgdGhlIENhbmR5IEtpbmdkb20iLAogICAgICAgICAgICAiU3BlZWQiLAogICAgICAgICAgICAiTG8tZmkgQ2hpbGwgQSIsCiAgICAgICAgICAgICJMby1maSBBbWJpZW50IiwKICAgICAgICAgICAgIlRlYXJzIGluIHRoZSBSYWluIgogICAgICAgIH0sCiAgICAgICAgbXVsdGlfZHJvcGRvd24gPSBmYWxzZSwKICAgICAgICBtYXhpbXVtX29wdGlvbnMgPSAxNSwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBzZWxlY3RlZFNvdW5kID0gdmFsdWUKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLnNvdW5kbW9kdWxlIHRoZW4KICAgICAgICAgICAgICAgIHBsYXlTb3VuZEJ5SWQoc291bmRPcHRpb25zW3ZhbHVlXSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KQoKICAgIGxvY2FsIFdvcmxkRmlsdGVyID0gd29ybGQ6Y3JlYXRlX21vZHVsZSh7CiAgICAgICAgdGl0bGUgPSAnRmlsdGVyJywKICAgICAgICBmbGFnID0gJ0ZpbHRlcicsCiAgICAKICAgICAgICBkZXNjcmlwdGlvbiA9ICdUb2dnbGVzIGN1c3RvbSB3b3JsZCBmaWx0ZXIgZWZmZWN0cycsCiAgICAgICAgc2VjdGlvbiA9ICdyaWdodCcsCiAgICAKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBnZXRnZW52KCkuV29ybGRGaWx0ZXJFbmFibGVkID0gdmFsdWUKICAgIAogICAgICAgICAgICBpZiBub3QgdmFsdWUgdGhlbgoKICAgICAgICAgICAgICAgIGlmIGdhbWUuTGlnaHRpbmc6RmluZEZpcnN0Q2hpbGQoIkN1c3RvbUF0bW9zcGhlcmUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZ2FtZS5MaWdodGluZy5DdXN0b21BdG1vc3BoZXJlOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBnYW1lLkxpZ2h0aW5nLkZvZ0VuZCA9IDEwMDAwMAogICAgICAgICAgICAgICAgZ2FtZS5MaWdodGluZy5Db2xvckNvcnJlY3Rpb24uVGludENvbG9yID0gQ29sb3IzLm5ldygxLCAxLCAxKQogICAgICAgICAgICAgICAgZ2FtZS5MaWdodGluZy5Db2xvckNvcnJlY3Rpb24uU2F0dXJhdGlvbiA9IDAKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KQogICAgCiAgICBXb3JsZEZpbHRlcjpjcmVhdGVfY2hlY2tib3goewogICAgICAgIHRpdGxlID0gJ0VuYWJsZSBBdG1vc3BoZXJlJywKICAgICAgICBmbGFnID0gJ1dvcmxkX0ZpbHRlcl9BdG1vc3BoZXJlJywKICAgIAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIGdldGdlbnYoKS5BdG1vc3BoZXJlRW5hYmxlZCA9IHZhbHVlCiAgICAKICAgICAgICAgICAgaWYgdmFsdWUgdGhlbgogICAgICAgICAgICAgICAgaWYgbm90IGdhbWUuTGlnaHRpbmc6RmluZEZpcnN0Q2hpbGQoIkN1c3RvbUF0bW9zcGhlcmUiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXRtb3NwaGVyZSA9IEluc3RhbmNlLm5ldygiQXRtb3NwaGVyZSIpCiAgICAgICAgICAgICAgICAgICAgYXRtb3NwaGVyZS5OYW1lID0gIkN1c3RvbUF0bW9zcGhlcmUiCiAgICAgICAgICAgICAgICAgICAgYXRtb3NwaGVyZS5QYXJlbnQgPSBnYW1lLkxpZ2h0aW5nCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWYgZ2FtZS5MaWdodGluZzpGaW5kRmlyc3RDaGlsZCgiQ3VzdG9tQXRtb3NwaGVyZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBnYW1lLkxpZ2h0aW5nLkN1c3RvbUF0bW9zcGhlcmU6RGVzdHJveSgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KQoKICAgIFdvcmxkRmlsdGVyOmNyZWF0ZV9zbGlkZXIoewogICAgICAgIHRpdGxlID0gJ0F0bW9zcGhlcmUgRGVuc2l0eScsCiAgICAgICAgZmxhZyA9ICdXb3JsZF9GaWx0ZXJfQXRtb3NwaGVyZV9TbGlkZXInLAogICAgCiAgICAgICAgbWluaW11bV92YWx1ZSA9IDAsCiAgICAgICAgbWF4aW11bV92YWx1ZSA9IDEsCiAgICAgICAgdmFsdWUgPSAwLjUsCiAgICAKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBpZiBnZXRnZW52KCkuQXRtb3NwaGVyZUVuYWJsZWQgYW5kIGdhbWUuTGlnaHRpbmc6RmluZEZpcnN0Q2hpbGQoIkN1c3RvbUF0bW9zcGhlcmUiKSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lLkxpZ2h0aW5nLkN1c3RvbUF0bW9zcGhlcmUuRGVuc2l0eSA9IHZhbHVlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCiAgICBXb3JsZEZpbHRlcjpjcmVhdGVfY2hlY2tib3goewogICAgICAgIHRpdGxlID0gJ0VuYWJsZSBGb2cnLAogICAgICAgIGZsYWcgPSAnV29ybGRfRmlsdGVyX0ZvZycsCiAgICAKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBnZXRnZW52KCkuRm9nRW5hYmxlZCA9IHZhbHVlCiAgICAKICAgICAgICAgICAgaWYgbm90IHZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIGdhbWUuTGlnaHRpbmcuRm9nRW5kID0gMTAwMDAwCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCiAgICBXb3JsZEZpbHRlcjpjcmVhdGVfc2xpZGVyKHsKICAgICAgICB0aXRsZSA9ICdGb2cgRGlzdGFuY2UnLAogICAgICAgIGZsYWcgPSAnV29ybGRfRmlsdGVyX0ZvZ19TbGlkZXInLAogICAgCiAgICAgICAgbWluaW11bV92YWx1ZSA9IDUwLAogICAgICAgIG1heGltdW1fdmFsdWUgPSAxMDAwMCwKICAgICAgICB2YWx1ZSA9IDEwMDAsCiAgICAKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBpZiBnZXRnZW52KCkuRm9nRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICBnYW1lLkxpZ2h0aW5nLkZvZ0VuZCA9IHZhbHVlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCiAgICBXb3JsZEZpbHRlcjpjcmVhdGVfY2hlY2tib3goewogICAgICAgIHRpdGxlID0gJ0VuYWJsZSBTYXR1cmF0aW9uJywKICAgICAgICBmbGFnID0gJ1dvcmxkX0ZpbHRlcl9TYXR1cmF0aW9uJywKICAgIAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIGdldGdlbnYoKS5TYXR1cmF0aW9uRW5hYmxlZCA9IHZhbHVlCiAgICAKICAgICAgICAgICAgaWYgbm90IHZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIGdhbWUuTGlnaHRpbmcuQ29sb3JDb3JyZWN0aW9uLlNhdHVyYXRpb24gPSAwCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCiAgICBXb3JsZEZpbHRlcjpjcmVhdGVfc2xpZGVyKHsKICAgICAgICB0aXRsZSA9ICdTYXR1cmF0aW9uIExldmVsJywKICAgICAgICBmbGFnID0gJ1dvcmxkX0ZpbHRlcl9TYXR1cmF0aW9uX1NsaWRlcicsCiAgICAKICAgICAgICBtaW5pbXVtX3ZhbHVlID0gLTEsCiAgICAgICAgbWF4aW11bV92YWx1ZSA9IDEsCiAgICAgICAgdmFsdWUgPSAwLAogICAgCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlNhdHVyYXRpb25FbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgIGdhbWUuTGlnaHRpbmcuQ29sb3JDb3JyZWN0aW9uLlNhdHVyYXRpb24gPSB2YWx1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCgogICAgV29ybGRGaWx0ZXI6Y3JlYXRlX2NoZWNrYm94KHsKICAgICAgICB0aXRsZSA9ICdFbmFibGUgSHVlJywKICAgICAgICBmbGFnID0gJ1dvcmxkX0ZpbHRlcl9IdWUnLAogICAgCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgZ2V0Z2VudigpLkh1ZUVuYWJsZWQgPSB2YWx1ZQogICAgCiAgICAgICAgICAgIGlmIG5vdCB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICBnYW1lLkxpZ2h0aW5nLkNvbG9yQ29ycmVjdGlvbi5UaW50Q29sb3IgPSBDb2xvcjMubmV3KDEsIDEsIDEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKICAgIAogICAgV29ybGRGaWx0ZXI6Y3JlYXRlX3NsaWRlcih7CiAgICAgICAgdGl0bGUgPSAnSHVlIFNoaWZ0JywKICAgICAgICBmbGFnID0gJ1dvcmxkX0ZpbHRlcl9IdWVfU2xpZGVyJywKICAgIAogICAgICAgIG1pbmltdW1fdmFsdWUgPSAtMSwKICAgICAgICBtYXhpbXVtX3ZhbHVlID0gMSwKICAgICAgICB2YWx1ZSA9IDAsCiAgICAKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBpZiBnZXRnZW52KCkuSHVlRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICBnYW1lLkxpZ2h0aW5nLkNvbG9yQ29ycmVjdGlvbi5UaW50Q29sb3IgPSBDb2xvcjMuZnJvbUhTVih2YWx1ZSwgMSwgMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KQoKICAgIGxvY2FsIEJhbGxUcmFpbCA9IHdvcmxkOmNyZWF0ZV9tb2R1bGUoewogICAgICAgIHRpdGxlID0gIkJhbGwgVHJhaWwiLAogICAgICAgIGZsYWcgPSAiQmFsbF9UcmFpbCIsCiAgICAgICAgZGVzY3JpcHRpb24gPSAiVG9nZ2xlcyBiYWxsIHRyYWlsIGVmZmVjdHMiLAogICAgICAgIHNlY3Rpb24gPSAibGVmdCIsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgZ2V0Z2VudigpLkJhbGxUcmFpbEVuYWJsZWQgPSB2YWx1ZQogICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgYmFsbCBpbiBwYWlycyhBdXRvX1BhcnJ5LkdldF9CYWxscygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBiYWxsOkZpbmRGaXJzdENoaWxkKCJUcmFpbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgdHJhaWwgPSBJbnN0YW5jZS5uZXcoIlRyYWlsIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJhaWwuTmFtZSA9ICJUcmFpbCIKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGF0dDAgPSBJbnN0YW5jZS5uZXcoIkF0dGFjaG1lbnQiKQogICAgICAgICAgICAgICAgICAgICAgICBhdHQwLk5hbWUgPSAiQXR0YWNobWVudDAiCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dDAuUGFyZW50ID0gYmFsbAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXR0MSA9IEluc3RhbmNlLm5ldygiQXR0YWNobWVudCIpCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dDEuTmFtZSA9ICJBdHRhY2htZW50MSIKICAgICAgICAgICAgICAgICAgICAgICAgYXR0MS5QYXJlbnQgPSBiYWxsCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBhdHQwLlBvc2l0aW9uID0gVmVjdG9yMy5uZXcoMCwgYmFsbC5TaXplLlkvMiwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgYXR0MS5Qb3NpdGlvbiA9IFZlY3RvcjMubmV3KDAsIC1iYWxsLlNpemUuWS8yLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdHJhaWwuQXR0YWNobWVudDAgPSBhdHQwCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWlsLkF0dGFjaG1lbnQxID0gYXR0MQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdHJhaWwuTGlmZXRpbWUgPSAwLjQKICAgICAgICAgICAgICAgICAgICAgICAgdHJhaWwuV2lkdGhTY2FsZSA9IE51bWJlclNlcXVlbmNlLm5ldyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCAwLjUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTnVtYmVyU2VxdWVuY2VLZXlwb2ludC5uZXcoMSwgMC41KQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICB0cmFpbC5UcmFuc3BhcmVuY3kgPSBOdW1iZXJTZXF1ZW5jZS5uZXcoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTnVtYmVyU2VxdWVuY2VLZXlwb2ludC5uZXcoMCwgMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCAxKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdHJhaWwuQ29sb3IgPSBDb2xvclNlcXVlbmNlLm5ldyhnZXRnZW52KCkuQmFsbFRyYWlsQ29sb3Igb3IgQ29sb3IzLm5ldygxLCAxLCAxKSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWlsLlBhcmVudCA9IGJhbGwKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHRyYWlsID0gYmFsbDpGaW5kRmlyc3RDaGlsZCgiVHJhaWwiKQogICAgICAgICAgICAgICAgICAgICAgICB0cmFpbC5Db2xvciA9IENvbG9yU2VxdWVuY2UubmV3KGdldGdlbnYoKS5CYWxsVHJhaWxDb2xvciBvciBDb2xvcjMubmV3KDEsIDEsIDEpKQogICAgICAgICAgICAgICAgICAgICAgICB0cmFpbC5MaWZldGltZSA9IDAuNAogICAgICAgICAgICAgICAgICAgICAgICB0cmFpbC5XaWR0aFNjYWxlID0gTnVtYmVyU2VxdWVuY2UubmV3KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsIDAuNSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCAwLjUpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWlsLlRyYW5zcGFyZW5jeSA9IE51bWJlclNlcXVlbmNlLm5ldyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCAwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDEsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgZm9yIF8sIGJhbGwgaW4gcGFpcnMoQXV0b19QYXJyeS5HZXRfQmFsbHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBsb2NhbCB0cmFpbCA9IGJhbGw6RmluZEZpcnN0Q2hpbGQoIlRyYWlsIikKICAgICAgICAgICAgICAgICAgICBpZiB0cmFpbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWlsOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCiAgICBCYWxsVHJhaWw6Y3JlYXRlX3NsaWRlcih7CiAgICAgICAgdGl0bGUgPSAiQmFsbCBUcmFpbCBIdWUiLAogICAgICAgIGZsYWcgPSAiQmFsbF9UcmFpbF9IdWUiLAogICAgICAgIG1pbmltdW1fdmFsdWUgPSAwLAogICAgICAgIG1heGltdW1fdmFsdWUgPSAzNjAsCiAgICAgICAgdmFsdWUgPSAwLAogICAgICAgIHJvdW5kX251bWJlciA9IHRydWUsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5CYWxsVHJhaWxSYWluYm93RW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBuZXdDb2xvciA9IENvbG9yMy5mcm9tSFNWKHZhbHVlIC8gMzYwLCAxLCAxKQogICAgICAgICAgICAgICAgZ2V0Z2VudigpLkJhbGxUcmFpbENvbG9yID0gbmV3Q29sb3IKICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5CYWxsVHJhaWxFbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgXywgYmFsbCBpbiBwYWlycyhBdXRvX1BhcnJ5LkdldF9CYWxscygpKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCB0cmFpbCA9IGJhbGw6RmluZEZpcnN0Q2hpbGQoIlRyYWlsIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHJhaWwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhaWwuQ29sb3IgPSBDb2xvclNlcXVlbmNlLm5ldyhuZXdDb2xvcikKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KSAgCgogICAgQmFsbFRyYWlsOmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiUmFpbmJvdyBUcmFpbCIsCiAgICAgICAgZmxhZyA9ICJCYWxsX1RyYWlsX1JhaW5ib3ciLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIGdldGdlbnYoKS5CYWxsVHJhaWxSYWluYm93RW5hYmxlZCA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQoKICAgIEJhbGxUcmFpbDpjcmVhdGVfY2hlY2tib3goewogICAgICAgIHRpdGxlID0gIlBhcnRpY2xlIEVtaXR0ZXIiLAogICAgICAgIGZsYWcgPSAiQmFsbF9UcmFpbF9QYXJ0aWNsZSIsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgZ2V0Z2VudigpLkJhbGxUcmFpbFBhcnRpY2xlRW5hYmxlZCA9IHZhbHVlCiAgICAgICAgICAgIGZvciBfLCBiYWxsIGluIHBhaXJzKEF1dG9fUGFycnkuR2V0X0JhbGxzKCkpIGRvCiAgICAgICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGJhbGw6RmluZEZpcnN0Q2hpbGQoIlBhcnRpY2xlRW1pdHRlciIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZW1pdHRlciA9IEluc3RhbmNlLm5ldygiUGFydGljbGVFbWl0dGVyIikKICAgICAgICAgICAgICAgICAgICAgICAgZW1pdHRlci5OYW1lID0gIlBhcnRpY2xlRW1pdHRlciIKICAgICAgICAgICAgICAgICAgICAgICAgZW1pdHRlci5SYXRlID0gMTAwCiAgICAgICAgICAgICAgICAgICAgICAgIGVtaXR0ZXIuTGlmZXRpbWUgPSBOdW1iZXJSYW5nZS5uZXcoMC41LCAxKQogICAgICAgICAgICAgICAgICAgICAgICBlbWl0dGVyLlNwZWVkID0gTnVtYmVyUmFuZ2UubmV3KDAsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGVtaXR0ZXIuU2l6ZSA9IE51bWJlclNlcXVlbmNlLm5ldyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygwLCAwLjUpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTnVtYmVyU2VxdWVuY2VLZXlwb2ludC5uZXcoMSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgZW1pdHRlci5UcmFuc3BhcmVuY3kgPSBOdW1iZXJTZXF1ZW5jZS5uZXcoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTnVtYmVyU2VxdWVuY2VLZXlwb2ludC5uZXcoMCwgMCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOdW1iZXJTZXF1ZW5jZUtleXBvaW50Lm5ldygxLCAxKQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICBlbWl0dGVyLlBhcmVudCA9IGJhbGwKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBsb2NhbCBlbWl0dGVyID0gYmFsbDpGaW5kRmlyc3RDaGlsZCgiUGFydGljbGVFbWl0dGVyIikKICAgICAgICAgICAgICAgICAgICBpZiBlbWl0dGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZW1pdHRlcjpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCgogICAgQmFsbFRyYWlsOmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiR2xvdyBFZmZlY3QiLAogICAgICAgIGZsYWcgPSAiQmFsbF9UcmFpbF9HbG93IiwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBnZXRnZW52KCkuQmFsbFRyYWlsR2xvd0VuYWJsZWQgPSB2YWx1ZQogICAgICAgICAgICBmb3IgXywgYmFsbCBpbiBwYWlycyhBdXRvX1BhcnJ5LkdldF9CYWxscygpKSBkbwogICAgICAgICAgICAgICAgaWYgdmFsdWUgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBiYWxsOkZpbmRGaXJzdENoaWxkKCJCYWxsR2xvdyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZ2xvdyA9IEluc3RhbmNlLm5ldygiUG9pbnRMaWdodCIpCiAgICAgICAgICAgICAgICAgICAgICAgIGdsb3cuTmFtZSA9ICJCYWxsR2xvdyIKICAgICAgICAgICAgICAgICAgICAgICAgZ2xvdy5SYW5nZSA9IDE1CiAgICAgICAgICAgICAgICAgICAgICAgIGdsb3cuQnJpZ2h0bmVzcyA9IDIKICAgICAgICAgICAgICAgICAgICAgICAgZ2xvdy5QYXJlbnQgPSBiYWxsCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZ2xvdyA9IGJhbGw6RmluZEZpcnN0Q2hpbGQoIkJhbGxHbG93IikKICAgICAgICAgICAgICAgICAgICBpZiBnbG93IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZ2xvdzpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCgogICAgbG9jYWwgaHVlID0gMAogICAgZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikuSGVhcnRiZWF0OkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgIGlmIGdldGdlbnYoKS5CYWxsVHJhaWxFbmFibGVkIHRoZW4KICAgICAgICAgICAgZm9yIF8sIGJhbGwgaW4gcGFpcnMoQXV0b19QYXJyeS5HZXRfQmFsbHMoKSkgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHRyYWlsID0gYmFsbDpGaW5kRmlyc3RDaGlsZCgiVHJhaWwiKQogICAgICAgICAgICAgICAgaWYgdHJhaWwgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5CYWxsVHJhaWxSYWluYm93RW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGh1ZSA9IChodWUgKyAxKSAlIDM2MAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBuZXdDb2xvciA9IENvbG9yMy5mcm9tSFNWKGh1ZSAvIDM2MCwgMSwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgdHJhaWwuQ29sb3IgPSBDb2xvclNlcXVlbmNlLm5ldyhuZXdDb2xvcikKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLkJhbGxUcmFpbENvbG9yID0gbmV3Q29sb3IKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWlsLkNvbG9yID0gQ29sb3JTZXF1ZW5jZS5uZXcoZ2V0Z2VudigpLkJhbGxUcmFpbENvbG9yIG9yIENvbG9yMy5uZXcoMSwgMSwgMSkpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCgogICAgbG9jYWwgYmlsbGJvYXJkTGFiZWxzID0ge30KCiAgICBmdW5jdGlvbiBxb2xQbGF5ZXJOYW1lVmlzaWJpbGl0eSgpCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gY3JlYXRlQmlsbGJvYXJkR3VpKHApCiAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IHAuQ2hhcmFjdGVyCiAgICAKICAgICAgICAgICAgd2hpbGUgKG5vdCBjaGFyYWN0ZXIpIG9yIChub3QgY2hhcmFjdGVyLlBhcmVudCkgZG8KICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgICAgICBjaGFyYWN0ZXIgPSBwLkNoYXJhY3RlcgogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBsb2NhbCBoZWFkID0gY2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSGVhZCIpCiAgICAKICAgICAgICAgICAgbG9jYWwgYmlsbGJvYXJkR3VpID0gSW5zdGFuY2UubmV3KCJCaWxsYm9hcmRHdWkiKQogICAgICAgICAgICBiaWxsYm9hcmRHdWkuQWRvcm5lZSA9IGhlYWQKICAgICAgICAgICAgYmlsbGJvYXJkR3VpLlNpemUgPSBVRGltMi5uZXcoMCwgMjAwLCAwLCA1MCkKICAgICAgICAgICAgYmlsbGJvYXJkR3VpLlN0dWRzT2Zmc2V0ID0gVmVjdG9yMy5uZXcoMCwgMywgMCkKICAgICAgICAgICAgYmlsbGJvYXJkR3VpLkFsd2F5c09uVG9wID0gdHJ1ZQogICAgICAgICAgICBiaWxsYm9hcmRHdWkuUGFyZW50ID0gaGVhZAogICAgCiAgICAgICAgICAgIGxvY2FsIHRleHRMYWJlbCA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikKICAgICAgICAgICAgdGV4dExhYmVsLlNpemUgPSBVRGltMi5uZXcoMSwgMCwgMSwgMCkKICAgICAgICAgICAgdGV4dExhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICB0ZXh0TGFiZWwuVGV4dFNpemUgPSA4CiAgICAgICAgICAgIHRleHRMYWJlbC5UZXh0V3JhcHBlZCA9IGZhbHNlCiAgICAgICAgICAgIHRleHRMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICB0ZXh0TGFiZWwuVGV4dFhBbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LkNlbnRlcgogICAgICAgICAgICB0ZXh0TGFiZWwuVGV4dFlBbGlnbm1lbnQgPSBFbnVtLlRleHRZQWxpZ25tZW50LkNlbnRlcgogICAgICAgICAgICB0ZXh0TGFiZWwuUGFyZW50ID0gYmlsbGJvYXJkR3VpCiAgICAKICAgICAgICAgICAgYmlsbGJvYXJkTGFiZWxzW3BdID0gdGV4dExhYmVsCiAgICAKICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikKICAgICAgICAgICAgaWYgaHVtYW5vaWQgdGhlbgogICAgICAgICAgICAgICAgaHVtYW5vaWQuRGlzcGxheURpc3RhbmNlVHlwZSA9IEVudW0uSHVtYW5vaWREaXNwbGF5RGlzdGFuY2VUeXBlLk5vbmUKICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgbG9jYWwgaGVhcnRiZWF0Q29ubmVjdGlvbgogICAgICAgICAgICBoZWFydGJlYXRDb25uZWN0aW9uID0gUnVuU2VydmljZS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICBpZiBub3QgKGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyLlBhcmVudCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGhlYXJ0YmVhdENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICAgICAgYmlsbGJvYXJkR3VpOkRlc3Ryb3koKQogICAgICAgICAgICAgICAgICAgIGJpbGxib2FyZExhYmVsc1twXSA9IG5pbAogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BYmlsaXR5RVNQIHRoZW4KICAgICAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuVmlzaWJsZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICBsb2NhbCBhYmlsaXR5TmFtZSA9IHA6R2V0QXR0cmlidXRlKCJFcXVpcHBlZEFiaWxpdHkiKQogICAgICAgICAgICAgICAgICAgIGlmIGFiaWxpdHlOYW1lIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgdGV4dExhYmVsLlRleHQgPSBwLkRpc3BsYXlOYW1lIC4uICIgWyIgLi4gYWJpbGl0eU5hbWUgLi4gIl0iCiAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuVGV4dCA9IHAuRGlzcGxheU5hbWUKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgCiAgICAgICAgZm9yIF8sIHAgaW4gUGxheWVyczpHZXRQbGF5ZXJzKCkgZG8KICAgICAgICAgICAgaWYgcCB+PSBwbHIgdGhlbgogICAgICAgICAgICAgICAgcC5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBjcmVhdGVCaWxsYm9hcmRHdWkocCkKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGNyZWF0ZUJpbGxib2FyZEd1aShwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIAogICAgICAgIFBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihuZXdQbGF5ZXIpCiAgICAgICAgICAgIG5ld1BsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGNyZWF0ZUJpbGxib2FyZEd1aShuZXdQbGF5ZXIpCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQpCiAgICBlbmQKICAgIAogICAgcW9sUGxheWVyTmFtZVZpc2liaWxpdHkoKQogICAgCiAgICBsb2NhbCBBYmlsaXR5RVNQID0gd29ybGQ6Y3JlYXRlX21vZHVsZSh7CiAgICAgICAgdGl0bGUgPSAnQWJpbGl0eSBFU1AnLAogICAgICAgIGZsYWcgPSAnQWJpbGl0eUVTUCcsCiAgICAgICAgZGVzY3JpcHRpb24gPSAnRGlzcGxheXMgUGxheWVyIEFiaWxpdGllcycsCiAgICAgICAgc2VjdGlvbiA9ICdyaWdodCcsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKICAgICAgICAgICAgZ2V0Z2VudigpLkFiaWxpdHlFU1AgPSB2YWx1ZQogICAgICAgICAgICBmb3IgXywgbGFiZWwgaW4gcGFpcnMoYmlsbGJvYXJkTGFiZWxzKSBkbwogICAgICAgICAgICAgICAgbGFiZWwuVmlzaWJsZSA9IHZhbHVlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCiAgICBsb2NhbCBDdXN0b21Ta3kgPSB3b3JsZDpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICdDdXN0b20gU2t5JywKICAgICAgICBmbGFnID0gJ0N1c3RvbV9Ta3knLAogICAgICAgIGRlc2NyaXB0aW9uID0gJ1RvZ2dsZXMgYSBjdXN0b20gc2t5Ym94JywKICAgICAgICBzZWN0aW9uID0gJ2xlZnQnLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIGxvY2FsIExpZ2h0aW5nID0gZ2FtZS5MaWdodGluZwogICAgICAgICAgICBsb2NhbCBTa3kgPSBMaWdodGluZzpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIlNreSIpCiAgICAgICAgICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICAgICAgICAgIGlmIG5vdCBTa3kgdGhlbgogICAgICAgICAgICAgICAgICAgIFNreSA9IEluc3RhbmNlLm5ldygiU2t5IiwgTGlnaHRpbmcpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWYgU2t5IHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBkZWZhdWx0U2t5Ym94SWRzID0geyI1OTEwNTg4MjMiLCAiNTkxMDU5ODc2IiwgIjU5MTA1ODEwNCIsICI1OTEwNTc4NjEiLCAiNTkxMDU3NjI1IiwgIjU5MTA1OTY0MiJ9CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc2t5RmFjZXMgPSB7IlNreWJveEJrIiwgIlNreWJveERuIiwgIlNreWJveEZ0IiwgIlNreWJveExmIiwgIlNreWJveFJ0IiwgIlNreWJveFVwIn0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBmb3IgaW5kZXgsIGZhY2UgaW4gaXBhaXJzKHNreUZhY2VzKSBkbwogICAgICAgICAgICAgICAgICAgICAgICBTa3lbZmFjZV0gPSAicmJ4YXNzZXRpZDovLyIgLi4gZGVmYXVsdFNreWJveElkc1tpbmRleF0KICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBMaWdodGluZy5HbG9iYWxTaGFkb3dzID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKICAgIAogICAgQ3VzdG9tU2t5OmNyZWF0ZV9kcm9wZG93bih7CiAgICAgICAgdGl0bGUgPSAnU2VsZWN0IFNreScsCiAgICAgICAgZmxhZyA9ICdjdXN0b21fc2t5X3NlbGVjdG9yJywKICAgICAgICBvcHRpb25zID0gewogICAgICAgICAgICAiRGVmYXVsdCIsCiAgICAgICAgICAgICJWYXBvcndhdmUiLAogICAgICAgICAgICAiUmVkc2hpZnQiLAogICAgICAgICAgICAiRGVzZXJ0IiwKICAgICAgICAgICAgIkRhQmFieSIsCiAgICAgICAgICAgICJNaW5lY3JhZnQiLAogICAgICAgICAgICAiU3BvbmdlQm9iIiwKICAgICAgICAgICAgIlNraWJpZGkiLAogICAgICAgICAgICAiQmxhemUiLAogICAgICAgICAgICAiUHVzc3kgQ2F0IiwKICAgICAgICAgICAgIkFtb25nIFVzIiwKICAgICAgICAgICAgIlNwYWNlIFdhdmUiLAogICAgICAgICAgICAiU3BhY2UgV2F2ZTIiLAogICAgICAgICAgICAiVHVycXVvaXNlIFdhdmUiLAogICAgICAgICAgICAiRGFyayBOaWdodCIsCiAgICAgICAgICAgICJCcmlnaHQgUGluayIsCiAgICAgICAgICAgICJXaGl0ZSBHYWxheHkiLAogICAgICAgICAgICAiQmx1ZSBHYWxheHkiCiAgICAgICAgfSwKICAgICAgICBtdWx0aV9kcm9wZG93biA9IGZhbHNlLAogICAgICAgIG1heGltdW1fb3B0aW9ucyA9IDE4LAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24oc2VsZWN0ZWRPcHRpb24pCiAgICAgICAgICAgIGxvY2FsIHNreWJveERhdGEgPSBuaWwKICAgICAgICAgICAgaWYgc2VsZWN0ZWRPcHRpb24gPT0gIkRlZmF1bHQiIHRoZW4KICAgICAgICAgICAgICAgIHNreWJveERhdGEgPSB7IjU5MTA1ODgyMyIsICI1OTEwNTk4NzYiLCAiNTkxMDU4MTA0IiwgIjU5MTA1Nzg2MSIsICI1OTEwNTc2MjUiLCAiNTkxMDU5NjQyIn0KICAgICAgICAgICAgZWxzZWlmIHNlbGVjdGVkT3B0aW9uID09ICJWYXBvcndhdmUiIHRoZW4KICAgICAgICAgICAgICAgIHNreWJveERhdGEgPSB7IjE0MTc0OTQwMzAiLCAiMTQxNzQ5NDE0NiIsICIxNDE3NDk0MjUzIiwgIjE0MTc0OTQ0MDIiLCAiMTQxNzQ5NDQ5OSIsICIxNDE3NDk0NjQzIn0KICAgICAgICAgICAgZWxzZWlmIHNlbGVjdGVkT3B0aW9uID09ICJSZWRzaGlmdCIgdGhlbgogICAgICAgICAgICAgICAgc2t5Ym94RGF0YSA9IHsiNDAxNjY0ODM5IiwgIjQwMTY2NDg2MiIsICI0MDE2NjQ5NjAiLCAiNDAxNjY0ODgxIiwgIjQwMTY2NDkwMSIsICI0MDE2NjQ5MzYifQogICAgICAgICAgICBlbHNlaWYgc2VsZWN0ZWRPcHRpb24gPT0gIkRlc2VydCIgdGhlbgogICAgICAgICAgICAgICAgc2t5Ym94RGF0YSA9IHsiMTAxMzg1MiIsICIxMDEzODUzIiwgIjEwMTM4NTAiLCAiMTAxMzg1MSIsICIxMDEzODQ5IiwgIjEwMTM4NTQifQogICAgICAgICAgICBlbHNlaWYgc2VsZWN0ZWRPcHRpb24gPT0gIkRhQmFieSIgdGhlbgogICAgICAgICAgICAgICAgc2t5Ym94RGF0YSA9IHsiNzI0NTQxODQ3MiIsICI3MjQ1NDE4NDcyIiwgIjcyNDU0MTg0NzIiLCAiNzI0NTQxODQ3MiIsICI3MjQ1NDE4NDcyIiwgIjcyNDU0MTg0NzIifQogICAgICAgICAgICBlbHNlaWYgc2VsZWN0ZWRPcHRpb24gPT0gIk1pbmVjcmFmdCIgdGhlbgogICAgICAgICAgICAgICAgc2t5Ym94RGF0YSA9IHsiMTg3NjU0NTAwMyIsICIxODc2NTQ0MzMxIiwgIjE4NzY1NDI5NDEiLCAiMTg3NjU0MzM5MiIsICIxODc2NTQzNzY0IiwgIjE4NzY1NDQ2NDIifQogICAgICAgICAgICBlbHNlaWYgc2VsZWN0ZWRPcHRpb24gPT0gIlNwb25nZUJvYiIgdGhlbgogICAgICAgICAgICAgICAgc2t5Ym94RGF0YSA9IHsiNzYzMzE3ODE2NiIsICI3NjMzMTc4MTY2IiwgIjc2MzMxNzgxNjYiLCAiNzYzMzE3ODE2NiIsICI3NjMzMTc4MTY2IiwgIjc2MzMxNzgxNjYifQogICAgICAgICAgICBlbHNlaWYgc2VsZWN0ZWRPcHRpb24gPT0gIlNraWJpZGkiIHRoZW4KICAgICAgICAgICAgICAgIHNreWJveERhdGEgPSB7IjE0OTUyMjU2MTEzIiwgIjE0OTUyMjU2MTEzIiwgIjE0OTUyMjU2MTEzIiwgIjE0OTUyMjU2MTEzIiwgIjE0OTUyMjU2MTEzIiwgIjE0OTUyMjU2MTEzIn0KICAgICAgICAgICAgZWxzZWlmIHNlbGVjdGVkT3B0aW9uID09ICJCbGF6ZSIgdGhlbgogICAgICAgICAgICAgICAgc2t5Ym94RGF0YSA9IHsiMTUwOTM5MDIyIiwgIjE1MDkzOTAzOCIsICIxNTA5MzkwNDciLCAiMTUwOTM5MDU2IiwgIjE1MDkzOTA2MyIsICIxNTA5MzkwODIifQogICAgICAgICAgICBlbHNlaWYgc2VsZWN0ZWRPcHRpb24gPT0gIlB1c3N5IENhdCIgdGhlbgogICAgICAgICAgICAgICAgc2t5Ym94RGF0YSA9IHsiMTExNTQ0MjI5MDIiLCAiMTExNTQ0MjI5MDIiLCAiMTExNTQ0MjI5MDIiLCAiMTExNTQ0MjI5MDIiLCAiMTExNTQ0MjI5MDIiLCAiMTExNTQ0MjI5MDIifQogICAgICAgICAgICBlbHNlaWYgc2VsZWN0ZWRPcHRpb24gPT0gIkFtb25nIFVzIiB0aGVuCiAgICAgICAgICAgICAgICBza3lib3hEYXRhID0geyI1NzUyNDYzMTkwIiwgIjU3NTI0NjMxOTAiLCAiNTc1MjQ2MzE5MCIsICI1NzUyNDYzMTkwIiwgIjU3NTI0NjMxOTAiLCAiNTc1MjQ2MzE5MCJ9CiAgICAgICAgICAgIGVsc2VpZiBzZWxlY3RlZE9wdGlvbiA9PSAiU3BhY2UgV2F2ZSIgdGhlbgogICAgICAgICAgICAgICAgc2t5Ym94RGF0YSA9IHsiMTYyNjIzNTY1NzgiLCAiMTYyNjIzNTgwMjYiLCAiMTYyNjIzNjA0NjkiLCAiMTYyNjIzNjIwMDMiLCAiMTYyNjIzNjM4NzMiLCAiMTYyNjIzNjYwMTYifQogICAgICAgICAgICBlbHNlaWYgc2VsZWN0ZWRPcHRpb24gPT0gIlNwYWNlIFdhdmUyIiB0aGVuCiAgICAgICAgICAgICAgICBza3lib3hEYXRhID0geyIxMjMzMTU4NDIwIiwgIjEyMzMxNTg4MzgiLCAiMTIzMzE1NzEwNSIsICIxMjMzMTU3NjQwIiwgIjEyMzMxNTc5OTUiLCAiMTIzMzE1OTE1OCJ9CiAgICAgICAgICAgIGVsc2VpZiBzZWxlY3RlZE9wdGlvbiA9PSAiVHVycXVvaXNlIFdhdmUiIHRoZW4KICAgICAgICAgICAgICAgIHNreWJveERhdGEgPSB7IjQ3OTc0ODk0IiwgIjQ3OTc0NjkwIiwgIjQ3OTc0ODIxIiwgIjQ3OTc0Nzc2IiwgIjQ3OTc0ODU5IiwgIjQ3OTc0OTA5In0KICAgICAgICAgICAgZWxzZWlmIHNlbGVjdGVkT3B0aW9uID09ICJEYXJrIE5pZ2h0IiB0aGVuCiAgICAgICAgICAgICAgICBza3lib3hEYXRhID0geyI2Mjg1NzE5MzM4IiwgIjYyODU3MjEwNzgiLCAiNjI4NTcyMjk2NCIsICI2Mjg1NzI0NjgyIiwgIjYyODU3MjYzMzUiLCAiNjI4NTczMDYzNSJ9CiAgICAgICAgICAgIGVsc2VpZiBzZWxlY3RlZE9wdGlvbiA9PSAiQnJpZ2h0IFBpbmsiIHRoZW4KICAgICAgICAgICAgICAgIHNreWJveERhdGEgPSB7IjI3MTA0MjUxNiIsICIyNzEwNzcyNDMiLCAiMjcxMDQyNTU2IiwgIjI3MTA0MjMxMCIsICIyNzEwNDI0NjciLCAiMjcxMDc3OTU4In0KICAgICAgICAgICAgZWxzZWlmIHNlbGVjdGVkT3B0aW9uID09ICJXaGl0ZSBHYWxheHkiIHRoZW4KICAgICAgICAgICAgICAgIHNreWJveERhdGEgPSB7IjU1NDA3OTg0NTYiLCAiNTU0MDc5OTg5NCIsICI1NTQwODAxNzc5IiwgIjU1NDA4MDExOTIiLCAiNTU0MDc5OTEwOCIsICI1NTQwODAwNjM1In0KICAgICAgICAgICAgZWxzZWlmIHNlbGVjdGVkT3B0aW9uID09ICJCbHVlIEdhbGF4eSIgdGhlbgogICAgICAgICAgICAgICAgc2t5Ym94RGF0YSA9IHsiMTQ5NjE0OTU2NzMiLCAiMTQ5NjE0OTQ0OTIiLCAiMTQ5NjE0OTI4NDQiLCAiMTQ5NjE0OTEyOTgiLCAiMTQ5NjE0OTA0MzkiLCAiMTQ5NjE0ODk1MDgifQogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBpZiBub3Qgc2t5Ym94RGF0YSB0aGVuCiAgICAgICAgICAgICAgICB3YXJuKCJTa3kgb3B0aW9uIG5vdCBmb3VuZDogIiAuLiB0b3N0cmluZyhzZWxlY3RlZE9wdGlvbikpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgbG9jYWwgTGlnaHRpbmcgPSBnYW1lLkxpZ2h0aW5nCiAgICAgICAgICAgIGxvY2FsIFNreSA9IExpZ2h0aW5nOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiU2t5Iikgb3IgSW5zdGFuY2UubmV3KCJTa3kiLCBMaWdodGluZykKICAgIAogICAgICAgICAgICBsb2NhbCBza3lGYWNlcyA9IHsiU2t5Ym94QmsiLCAiU2t5Ym94RG4iLCAiU2t5Ym94RnQiLCAiU2t5Ym94TGYiLCAiU2t5Ym94UnQiLCAiU2t5Ym94VXAifQogICAgICAgICAgICBmb3IgaW5kZXgsIGZhY2UgaW4gaXBhaXJzKHNreUZhY2VzKSBkbwogICAgICAgICAgICAgICAgU2t5W2ZhY2VdID0gInJieGFzc2V0aWQ6Ly8iIC4uIHNreWJveERhdGFbaW5kZXhdCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgTGlnaHRpbmcuR2xvYmFsU2hhZG93cyA9IGZhbHNlCiAgICAgICAgZW5kCiAgICB9KQoKICAgIGxvY2FsIEFiaWxpdHlFeHBsb2l0ID0gd29ybGQ6Y3JlYXRlX21vZHVsZSh7CiAgICAgICAgdGl0bGUgPSAnQWJpbGl0eSBFeHBsb2l0JywKICAgICAgICBmbGFnID0gJ0FiaWxpdHlFeHBsb2l0JywKICAgICAgICBkZXNjcmlwdGlvbiA9ICdBYmlsaXR5IEV4cGxvaXQnLCAgICAKICAgICAgICBzZWN0aW9uID0gJ3JpZ2h0JywKICAgIAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIGdldGdlbnYoKS5BYmlsaXR5RXhwbG9pdCA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQogICAgQWJpbGl0eUV4cGxvaXQ6Y3JlYXRlX2NoZWNrYm94KHsKICAgICAgICB0aXRsZSA9ICdUaHVuZGVyIERhc2ggTm8gQ29vbGRvd24nLAogICAgICAgIGZsYWcgPSAnVGh1bmRlckRhc2hOb0Nvb2xkb3duJywKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBnZXRnZW52KCkuVGh1bmRlckRhc2hOb0Nvb2xkb3duID0gdmFsdWUKICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkFiaWxpdHlFeHBsb2l0IGFuZCBnZXRnZW52KCkuVGh1bmRlckRhc2hOb0Nvb2xkb3duIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHRodW5kZXJNb2R1bGUgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJTaGFyZWQiKTpXYWl0Rm9yQ2hpbGQoIkFiaWxpdGllcyIpOldhaXRGb3JDaGlsZCgiVGh1bmRlciBEYXNoIikKICAgICAgICAgICAgICAgIGxvY2FsIG1vZCA9IHJlcXVpcmUodGh1bmRlck1vZHVsZSkKICAgICAgICAgICAgICAgIG1vZC5jb29sZG93biA9IDAKICAgICAgICAgICAgICAgIG1vZC5jb29sZG93blJlZHVjdGlvblBlclVwZ3JhZGUgPSAwCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCiAgICBBYmlsaXR5RXhwbG9pdDpjcmVhdGVfY2hlY2tib3goewogICAgICAgIHRpdGxlID0gJ0NvbnRpbnVpdHkgWmVybyBFeHBsb2l0JywKICAgICAgICBmbGFnICA9ICdDb250aW51aXR5WmVyb0V4cGxvaXQnLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIGdldGdlbnYoKS5Db250aW51aXR5WmVyb0V4cGxvaXQgPSB2YWx1ZQogICAgCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BYmlsaXR5RXhwbG9pdCBhbmQgZ2V0Z2VudigpLkNvbnRpbnVpdHlaZXJvRXhwbG9pdCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBDb250aW51aXR5WmVyb1JlbW90ZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIlVzZUNvbnRpbnVpdHlQb3J0YWwiKQogICAgICAgICAgICAgICAgbG9jYWwgb2xkTmFtZWNhbGwKICAgICAgICAgICAgICAgIG9sZE5hbWVjYWxsID0gaG9va21ldGFtZXRob2QoZ2FtZSwgIl9fbmFtZWNhbGwiLCBmdW5jdGlvbihzZWxmLCAuLi4pCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgbWV0aG9kID0gZ2V0bmFtZWNhbGxtZXRob2QoKQogICAgCiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZiA9PSBDb250aW51aXR5WmVyb1JlbW90ZSBhbmQgbWV0aG9kID09ICJGaXJlU2VydmVyIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBvbGROYW1lY2FsbChzZWxmLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ0ZyYW1lLm5ldyg5ZTE3LCA5ZTE2LCA5ZTE1LCA5ZTE0LCA5ZTEzLCA5ZTEyLCA5ZTExLCA5ZTEwLCA5ZTksIDllOCwgOWU3LCA5ZTYpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLk5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9sZE5hbWVjYWxsKHNlbGYsIC4uLikKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KQoKICAgIGxvY2FsIGF1dG9EdWVsc1JlcXVldWVFbmFibGVkID0gZmFsc2UKCiAgICBsb2NhbCBBdXRvRHVlbHNSZXF1ZXVlID0gZmFybTpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICdBdXRvIER1ZWxzIFJlcXVldWUnLAogICAgICAgIGZsYWcgPSAnQXV0b0R1ZWxzUmVxdWV1ZScsCiAgICAKICAgICAgICBkZXNjcmlwdGlvbiA9ICdBdXRvbWF0aWNhbGx5IHJlcXVldWVzIGR1ZWxzJywKICAgICAgICBzZWN0aW9uID0gJ2xlZnQnLAogICAgCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgYXV0b0R1ZWxzUmVxdWV1ZUVuYWJsZWQgPSB2YWx1ZQoKICAgICAgICAgICAgaWYgYXV0b0R1ZWxzUmVxdWV1ZUVuYWJsZWQgdGhlbgogICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgYXV0b0R1ZWxzUmVxdWV1ZUVuYWJsZWQgZG8KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiUGFja2FnZXMiKTpXYWl0Rm9yQ2hpbGQoIl9JbmRleCIpOldhaXRGb3JDaGlsZCgic2xlaXRuaWNrX25ldEAwLjEuMCIpOldhaXRGb3JDaGlsZCgibmV0Iik6V2FpdEZvckNoaWxkKCJSRS9QbGF5ZXJXYW50c1JlbWF0Y2giKTpGaXJlU2VydmVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCiAgICBsb2NhbCB2YWxpZFJhbmtlZFBsYWNlSWRzID0gewogICAgICAgIDEzNzcyMzk0NjI1LAogICAgICAgIDE0OTE1MjIwNjIxLAogICAgfQoKICAgIGxvY2FsIHNlbGVjdGVkUXVldWUgPSAiRkZBIgogICAgbG9jYWwgYXV0b1JlcXVldWVFbmFibGVkID0gZmFsc2UKCiAgICBsb2NhbCBBdXRvUmFua2VkUmVxdWV1ZSA9IGZhcm06Y3JlYXRlX21vZHVsZSh7CiAgICAgICAgdGl0bGUgPSAnQXV0byBSYW5rZWQgUmVxdWV1ZScsCiAgICAgICAgZmxhZyA9ICdBdXRvUmFua2VkUmVxdWV1ZScsCiAgICAKICAgICAgICBkZXNjcmlwdGlvbiA9ICdBdXRvbWF0aWNhbGx5IHJlcXVldWVzIFJhbmtlZCcsCiAgICAgICAgc2VjdGlvbiA9ICdyaWdodCcsCiAgICAKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBhdXRvUmVxdWV1ZUVuYWJsZWQgPSB2YWx1ZQoKICAgICAgICAgICAgaWYgYXV0b1JlcXVldWVFbmFibGVkIHRoZW4KICAgICAgICAgICAgICAgIGlmIG5vdCB0YWJsZS5maW5kKHZhbGlkUmFua2VkUGxhY2VJZHMsIGdhbWUuUGxhY2VJZCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGF1dG9SZXF1ZXVlRW5hYmxlZCA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICB3aGlsZSBhdXRvUmVxdWV1ZUVuYWJsZWQgZG8KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiUmVtb3RlcyIpOldhaXRGb3JDaGlsZCgiSm9pblF1ZXVlIik6RmlyZVNlcnZlcigiUmFua2VkIiwgc2VsZWN0ZWRRdWV1ZSwgIk5vcm1hbCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCg1KQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCgogICAgQXV0b1JhbmtlZFJlcXVldWU6Y3JlYXRlX2Ryb3Bkb3duKHsKICAgICAgICB0aXRsZSA9ICdTZWxlY3QgUXVldWUgVHlwZScsCiAgICAgICAgZmxhZyA9ICdRdWV1ZVR5cGUnLAogICAgICAgIG9wdGlvbnMgPSB7IAogICAgICAgICAgICAiRkZBIiwKICAgICAgICAgICAgIkR1byIgCiAgICAgICAgfSwKICAgICAgICBtdWx0aV9kcm9wZG93biA9IGZhbHNlLAogICAgICAgIG1heGltdW1fb3B0aW9ucyA9IDIsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbihzZWxlY3RlZE9wdGlvbikKICAgICAgICAgICAgc2VsZWN0ZWRRdWV1ZSA9IHNlbGVjdGVkT3B0aW9uCiAgICAgICAgZW5kCiAgICB9KQoKICAgIGxvY2FsIGF1dG9MVE1SZXF1ZXVlRW5hYmxlZCA9IGZhbHNlCiAgICBsb2NhbCB2YWxpZExUTVBsYWNlSWQgPSAxMzc3MjM5NDYyNQoKICAgIGxvY2FsIEF1dG9MVE1SZXF1ZXVlID0gZmFybTpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICdBdXRvIExUTSBSZXF1ZXVlJywKICAgICAgICBmbGFnID0gJ0F1dG9MVE1SZXF1ZXVlJywKICAgIAogICAgICAgIGRlc2NyaXB0aW9uID0gJ0F1dG9tYXRpY2FsbHkgcmVxdWV1ZXMgTFRNJywKICAgICAgICBzZWN0aW9uID0gJ2xlZnQnLAogICAgCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgYXV0b0xUTVJlcXVldWVFbmFibGVkID0gdmFsdWUKCiAgICAgICAgICAgIGlmIGF1dG9MVE1SZXF1ZXVlRW5hYmxlZCB0aGVuCiAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYWNlSWQgfj0gdmFsaWRMVE1QbGFjZUlkIHRoZW4KICAgICAgICAgICAgICAgICAgICBhdXRvTFRNUmVxdWV1ZUVuYWJsZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgYXV0b0xUTVJlcXVldWVFbmFibGVkIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlBhY2thZ2VzIik6V2FpdEZvckNoaWxkKCJfSW5kZXgiKTpXYWl0Rm9yQ2hpbGQoInNsZWl0bmlja19uZXRAMC4xLjAiKTpXYWl0Rm9yQ2hpbGQoIm5ldCIpOldhaXRGb3JDaGlsZCgiUkYvSm9pblRvdXJuYW1lbnRFdmVudFF1ZXVlIik6SW52b2tlU2VydmVyKHt9KQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoNSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KQoKICAgIGxvY2FsIFNraW5DaGFuZ2VyID0gbWlzYzpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICdTa2luIENoYW5nZXInLAogICAgICAgIGZsYWcgPSAnU2tpbkNoYW5nZXInLAogICAgICAgIGRlc2NyaXB0aW9uID0gJ1NraW4gQ2hhbmdlcicsCiAgICAgICAgc2VjdGlvbiA9ICdsZWZ0JywKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgICAgICBnZXRnZW52KCkuc2tpbkNoYW5nZXIgPSB2YWx1ZQogICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICBnZXRnZW52KCkudXBkYXRlU3dvcmQoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCgogICAgU2tpbkNoYW5nZXI6Y2hhbmdlX3N0YXRlKGZhbHNlKQoKICAgIFNraW5DaGFuZ2VyOmNyZWF0ZV9wYXJhZ3JhcGgoewogICAgICAgIHRpdGxlID0gIsODwqLDhcKhw4Igw4PCr8OCwrjDgsKPRVZFUllPTkUgQ0FOIFNFRSBBTklNQVRJT05TIiwKICAgICAgICB0ZXh0ID0gIklGIFlPVSBVU0UgU0tJTiBDSEFOR0VSIEJBQ0tTV09SRCBZT1UgTVVTVCBFUVVJUCBBTiBBQ1RVQUwgQkFDS1NXT1JEIgogICAgfSkKCiAgICBsb2NhbCBza2luY2hhbmdlcnRleHRib3ggPSBTa2luQ2hhbmdlcjpjcmVhdGVfdGV4dGJveCh7CiAgICAgICAgdGl0bGUgPSAiw4PCr8OCwr/DgsKsIFNraW4gTmFtZSAoQ2FzZSBTZW5zaXRpdmUpIMODwq/DgsK/w4LCrCIsCiAgICAgICAgcGxhY2Vob2xkZXIgPSAiRW50ZXIgU3dvcmQgU2tpbiBOYW1lLi4uICIsCiAgICAgICAgZmxhZyA9ICJTa2luQ2hhbmdlclRleHRib3giLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odGV4dCkKICAgICAgICAgICAgZ2V0Z2VudigpLnN3b3JkTW9kZWwgPSB0ZXh0CiAgICAgICAgICAgIGdldGdlbnYoKS5zd29yZEFuaW1hdGlvbnMgPSB0ZXh0CiAgICAgICAgICAgIGdldGdlbnYoKS5zd29yZEZYID0gdGV4dAogICAgICAgICAgICBpZiBnZXRnZW52KCkuc2tpbkNoYW5nZXIgdGhlbgogICAgICAgICAgICAgICAgZ2V0Z2VudigpLnVwZGF0ZVN3b3JkKCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KQogICAgCiAgICBsb2NhbCBBdXRvUGxheU1vZHVsZSA9IHt9CiAgICBBdXRvUGxheU1vZHVsZS5DT05GSUcgPSB7CiAgICAgICAgREVGQVVMVF9ESVNUQU5DRSA9IDMwLAogICAgICAgIE1VTFRJUExJRVJfVEhSRVNIT0xEID0gNzAsCiAgICAgICAgVFJBVkVSU0lORyA9IDI1LAogICAgICAgIERJUkVDVElPTiA9IDEsCiAgICAgICAgSlVNUF9QRVJDRU5UQUdFID0gNTAsCiAgICAgICAgRE9VQkxFX0pVTVBfUEVSQ0VOVEFHRSA9IDUwLAogICAgICAgIEpVTVBJTkdfRU5BQkxFRCA9IGZhbHNlLAogICAgICAgIE1PVkVNRU5UX0RVUkFUSU9OID0gMC44LAogICAgICAgIE9GRlNFVF9GQUNUT1IgPSAwLjcsCiAgICAgICAgR0VORVJBVElPTl9USFJFU0hPTEQgPSAwLjI1CiAgICB9CiAgICAKICAgIEF1dG9QbGF5TW9kdWxlLmJhbGwgPSBuaWwKICAgIEF1dG9QbGF5TW9kdWxlLmxvYmJ5Q2hvaWNlID0gbmlsCiAgICBBdXRvUGxheU1vZHVsZS5hbmltYXRpb25DYWNoZSA9IG5pbAogICAgQXV0b1BsYXlNb2R1bGUuZG91YmxlSnVtcGVkID0gZmFsc2UKICAgIEF1dG9QbGF5TW9kdWxlLkVMQVBTRUQgPSAwCiAgICBBdXRvUGxheU1vZHVsZS5DT05UUk9MX1BPSU5UID0gbmlsCiAgICBBdXRvUGxheU1vZHVsZS5MQVNUX0dFTkVSQVRJT04gPSAwCiAgICBBdXRvUGxheU1vZHVsZS5zaWduYWxzID0ge30KICAgIAogICAgZG8KICAgICAgICBsb2NhbCBnZXRTZXJ2aWNlRnVuY3Rpb24gPSBnYW1lLkdldFNlcnZpY2UKICAgICAgICAKICAgICAgICBsb2NhbCBmdW5jdGlvbiBnZXRDbG9uZXJlZlBlcm1pc3Npb24oKQogICAgICAgICAgICBsb2NhbCBwZXJtaXNzaW9uID0gY2xvbmVyZWYoZ2V0U2VydmljZUZ1bmN0aW9uKGdhbWUsICJSZXBsaWNhdGVkRmlyc3QiKSkKICAgICAgICAgICAgcmV0dXJuIHBlcm1pc3Npb24KICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBBdXRvUGxheU1vZHVsZS5jbG9uZXJlZlBlcm1pc3Npb24gPSBnZXRDbG9uZXJlZlBlcm1pc3Npb24oKQogICAgICAgIAogICAgICAgIGlmIG5vdCBBdXRvUGxheU1vZHVsZS5jbG9uZXJlZlBlcm1pc3Npb24gdGhlbgogICAgICAgICAgICB3YXJuKCJjbG9uZXJlZiBpcyBub3QgYXZhaWxhYmxlIG9uIHlvdXIgZXhlY3V0b3IhIFRoZXJlIGlzIGEgcmlzayBvZiBnZXR0aW5nIGRldGVjdGVkLiIpCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gQXV0b1BsYXlNb2R1bGUuZmluZENhY2hlZFNlcnZpY2Uoc2VsZiwgbmFtZSkKICAgICAgICAgICAgZm9yIGluZGV4LCB2YWx1ZSBpbiBzZWxmIGRvCiAgICAgICAgICAgICAgICBpZiB2YWx1ZS5OYW1lID09IG5hbWUgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBBdXRvUGxheU1vZHVsZS5nZXRTZXJ2aWNlKHNlbGYsIG5hbWUpCiAgICAgICAgICAgIGxvY2FsIGNhY2hlZFNlcnZpY2UgPSBBdXRvUGxheU1vZHVsZS5maW5kQ2FjaGVkU2VydmljZShzZWxmLCBuYW1lKQogICAgICAgIAogICAgICAgICAgICBpZiBjYWNoZWRTZXJ2aWNlIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBjYWNoZWRTZXJ2aWNlCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBsb2NhbCBzZXJ2aWNlID0gZ2V0U2VydmljZUZ1bmN0aW9uKGdhbWUsIG5hbWUpCiAgICAgICAgCiAgICAgICAgICAgIGlmIEF1dG9QbGF5TW9kdWxlLmNsb25lcmVmUGVybWlzc2lvbiB0aGVuCiAgICAgICAgICAgICAgICBzZXJ2aWNlID0gY2xvbmVyZWYoc2VydmljZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIHRhYmxlLmluc2VydChzZWxmLCBzZXJ2aWNlKQogICAgICAgICAgICByZXR1cm4gc2VydmljZQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIEF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UgPSBzZXRtZXRhdGFibGUoe30sIHsKICAgICAgICAgICAgX19pbmRleCA9IEF1dG9QbGF5TW9kdWxlLmdldFNlcnZpY2UKICAgICAgICB9KQogICAgZW5kCiAgICAKICAgIEF1dG9QbGF5TW9kdWxlLnBsYXllckhlbHBlciA9IHsKICAgICAgICBpc0FsaXZlID0gZnVuY3Rpb24ocGxheWVyKQogICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBuaWwKICAgICAgICAKICAgICAgICAgICAgaWYgcGxheWVyIGFuZCBwbGF5ZXI6SXNBKCJQbGF5ZXIiKSB0aGVuCiAgICAgICAgICAgICAgICBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBpZiBub3QgY2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICBsb2NhbCBodW1hbm9pZCA9IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKQogICAgICAgIAogICAgICAgICAgICBpZiBub3Qgcm9vdFBhcnQgb3Igbm90IGh1bWFub2lkIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGh1bWFub2lkLkhlYWx0aCA+IDAKICAgICAgICBlbmQsCiAgICAgICAgCiAgICAgICAgaW5Mb2JieSA9IGZ1bmN0aW9uKGNoYXJhY3RlcikKICAgICAgICAgICAgaWYgbm90IGNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBjaGFyYWN0ZXIuUGFyZW50ID09IEF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuV29ya3NwYWNlLkRlYWQKICAgICAgICBlbmQsCiAgICAgICAgCiAgICAgICAgb25Hcm91bmQgPSBmdW5jdGlvbihjaGFyYWN0ZXIpCiAgICAgICAgICAgIGlmIG5vdCBjaGFyYWN0ZXIgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICByZXR1cm4gY2hhcmFjdGVyLkh1bWFub2lkLkZsb29yTWF0ZXJpYWwgfj0gRW51bS5NYXRlcmlhbC5BaXIKICAgICAgICBlbmQKICAgIH0KICAgIAogICAgZnVuY3Rpb24gQXV0b1BsYXlNb2R1bGUuaXNMaW1pdGVkKCkKICAgICAgICBsb2NhbCBwYXNzZWRUaW1lID0gdGljaygpIC0gQXV0b1BsYXlNb2R1bGUuTEFTVF9HRU5FUkFUSU9OCiAgICAgICAgcmV0dXJuIHBhc3NlZFRpbWUgPCBBdXRvUGxheU1vZHVsZS5DT05GSUcuR0VORVJBVElPTl9USFJFU0hPTEQKICAgIGVuZAogICAgCiAgICBmdW5jdGlvbiBBdXRvUGxheU1vZHVsZS5wZXJjZW50YWdlQ2hlY2sobGltaXQpCiAgICAgICAgaWYgQXV0b1BsYXlNb2R1bGUuaXNMaW1pdGVkKCkgdGhlbgogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICBlbmQKICAgIAogICAgICAgIGxvY2FsIHBlcmNlbnRhZ2UgPSBtYXRoLnJhbmRvbSgxMDApCiAgICAgICAgQXV0b1BsYXlNb2R1bGUuTEFTVF9HRU5FUkFUSU9OID0gdGljaygpCiAgICAKICAgICAgICByZXR1cm4gbGltaXQgPj0gcGVyY2VudGFnZQogICAgZW5kCgogICAgQXV0b1BsYXlNb2R1bGUuYmFsbFV0aWxzID0gewogICAgICAgIGdldEJhbGwgPSBmdW5jdGlvbigpCiAgICAgICAgICAgIGZvciBfLCBvYmplY3QgaW4gQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5Xb3Jrc3BhY2UuQmFsbHM6R2V0Q2hpbGRyZW4oKSBkbwogICAgICAgICAgICAgICAgaWYgb2JqZWN0OkdldEF0dHJpYnV0ZSgicmVhbEJhbGwiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgQXV0b1BsYXlNb2R1bGUuYmFsbCA9IG9iamVjdAogICAgICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBBdXRvUGxheU1vZHVsZS5iYWxsID0gbmlsCiAgICAgICAgZW5kLAogICAgICAgIAogICAgICAgIGdldERpcmVjdGlvbiA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgbm90IEF1dG9QbGF5TW9kdWxlLmJhbGwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBsb2NhbCBkaXJlY3Rpb24gPSAoQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gQXV0b1BsYXlNb2R1bGUuYmFsbC5Qb3NpdGlvbikuVW5pdAogICAgICAgICAgICByZXR1cm4gZGlyZWN0aW9uCiAgICAgICAgZW5kLAogICAgICAgIAogICAgICAgIGdldFZlbG9jaXR5ID0gZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBub3QgQXV0b1BsYXlNb2R1bGUuYmFsbCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIHpvb21pZXMgPSBBdXRvUGxheU1vZHVsZS5iYWxsOkZpbmRGaXJzdENoaWxkKCJ6b29taWVzIikKICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHpvb21pZXMgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICByZXR1cm4gem9vbWllcy5WZWN0b3JWZWxvY2l0eQogICAgICAgIGVuZCwKICAgICAgICAKICAgICAgICBnZXRTcGVlZCA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgbG9jYWwgdmVsb2NpdHkgPSBBdXRvUGxheU1vZHVsZS5iYWxsVXRpbHMuZ2V0VmVsb2NpdHkoKQogICAgICAgIAogICAgICAgICAgICBpZiBub3QgdmVsb2NpdHkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICByZXR1cm4gdmVsb2NpdHkuTWFnbml0dWRlCiAgICAgICAgZW5kLAogICAgICAgIAogICAgICAgIGlzRXhpc3RpbmcgPSBmdW5jdGlvbigpCiAgICAgICAgICAgIHJldHVybiBBdXRvUGxheU1vZHVsZS5iYWxsIH49IG5pbAogICAgICAgIGVuZAogICAgfQogICAgCiAgICBBdXRvUGxheU1vZHVsZS5sZXJwID0gZnVuY3Rpb24oc3RhcnQsIGZpbmlzaCwgYWxwaGEpCiAgICAgICAgcmV0dXJuIHN0YXJ0ICsgKGZpbmlzaCAtIHN0YXJ0KSAqIGFscGhhCiAgICBlbmQKICAgIAogICAgQXV0b1BsYXlNb2R1bGUucXVhZHJhdGljID0gZnVuY3Rpb24oc3RhcnQsIG1pZGRsZSwgZmluaXNoLCBhbHBoYSkKICAgICAgICBsb2NhbCBmaXJzdExlcnAgPSBBdXRvUGxheU1vZHVsZS5sZXJwKHN0YXJ0LCBtaWRkbGUsIGFscGhhKQogICAgICAgIGxvY2FsIHNlY29uZExlcnAgPSBBdXRvUGxheU1vZHVsZS5sZXJwKG1pZGRsZSwgZmluaXNoLCBhbHBoYSkKICAgIAogICAgICAgIHJldHVybiBBdXRvUGxheU1vZHVsZS5sZXJwKGZpcnN0TGVycCwgc2Vjb25kTGVycCwgYWxwaGEpCiAgICBlbmQKICAgIAogICAgQXV0b1BsYXlNb2R1bGUuZ2V0Q2FuZGlkYXRlcyA9IGZ1bmN0aW9uKG1pZGRsZSwgdGhldGEsIG9mZnNldExlbmd0aCkKICAgICAgICBsb2NhbCBmaXJzdENhbmRpdGF0ZVggPSBtYXRoLmNvcyh0aGV0YSArIG1hdGgucGkgLyAyKQogICAgICAgIGxvY2FsIGZpcnN0Q2FuZGl0YXRlWiA9IG1hdGguc2luKHRoZXRhICsgbWF0aC5waSAvIDIpCiAgICAgICAgbG9jYWwgZmlyc3RDYW5kaWRhdGUgPSBtaWRkbGUgKyBWZWN0b3IzLm5ldyhmaXJzdENhbmRpdGF0ZVgsIDAsIGZpcnN0Q2FuZGl0YXRlWikgKiBvZmZzZXRMZW5ndGgKICAgIAogICAgICAgIGxvY2FsIHNlY29uZENhbmRpdGF0ZVggPSBtYXRoLmNvcyh0aGV0YSAtIG1hdGgucGkgLyAyKQogICAgICAgIGxvY2FsIHNlY29uZENhbmRpdGF0ZVogPSBtYXRoLnNpbih0aGV0YSAtIG1hdGgucGkgLyAyKQogICAgICAgIGxvY2FsIHNlY29uZENhbmRpZGF0ZSA9IG1pZGRsZSArIFZlY3RvcjMubmV3KHNlY29uZENhbmRpdGF0ZVgsIDAsIHNlY29uZENhbmRpdGF0ZVopICogb2Zmc2V0TGVuZ3RoCiAgICAKICAgICAgICByZXR1cm4gZmlyc3RDYW5kaWRhdGUsIHNlY29uZENhbmRpZGF0ZQogICAgZW5kCiAgICAKICAgIEF1dG9QbGF5TW9kdWxlLmdldENvbnRyb2xQb2ludCA9IGZ1bmN0aW9uKHN0YXJ0LCBmaW5pc2gpCiAgICAgICAgbG9jYWwgbWlkZGxlID0gKHN0YXJ0ICsgZmluaXNoKSAqIDAuNQogICAgICAgIGxvY2FsIGRpZmZlcmVuY2UgPSBzdGFydCAtIGZpbmlzaAogICAgCiAgICAgICAgaWYgZGlmZmVyZW5jZS5NYWduaXR1ZGUgPCA1IHRoZW4KICAgICAgICAgICAgcmV0dXJuIGZpbmlzaAogICAgICAgIGVuZAogICAgCiAgICAgICAgbG9jYWwgdGhldGEgPSBtYXRoLmF0YW4yKGRpZmZlcmVuY2UuWiwgZGlmZmVyZW5jZS5YKQogICAgICAgIGxvY2FsIG9mZnNldExlbmd0aCA9IGRpZmZlcmVuY2UuTWFnbml0dWRlICogQXV0b1BsYXlNb2R1bGUuQ09ORklHLk9GRlNFVF9GQUNUT1IKICAgIAogICAgICAgIGxvY2FsIGZpcnN0Q2FuZGlkYXRlLCBzZWNvbmRDYW5kaWRhdGUgPSBBdXRvUGxheU1vZHVsZS5nZXRDYW5kaWRhdGVzKG1pZGRsZSwgdGhldGEsIG9mZnNldExlbmd0aCkKICAgICAgICBsb2NhbCBkb3RWYWx1ZSA9IHN0YXJ0IC0gbWlkZGxlCiAgICAKICAgICAgICBpZiAoZmlyc3RDYW5kaWRhdGUgLSBtaWRkbGUpOkRvdChkb3RWYWx1ZSkgPCAwIHRoZW4KICAgICAgICAgICAgcmV0dXJuIGZpcnN0Q2FuZGlkYXRlCiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gc2Vjb25kQ2FuZGlkYXRlCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgQXV0b1BsYXlNb2R1bGUuZ2V0Q3VydmUgPSBmdW5jdGlvbihzdGFydCwgZmluaXNoLCBkZWx0YSkKICAgICAgICBBdXRvUGxheU1vZHVsZS5FTEFQU0VEID0gQXV0b1BsYXlNb2R1bGUuRUxBUFNFRCArIGRlbHRhCiAgICAgICAgbG9jYWwgdGltZUVsYXBzZWQgPSBtYXRoLmNsYW1wKEF1dG9QbGF5TW9kdWxlLkVMQVBTRUQgLyBBdXRvUGxheU1vZHVsZS5DT05GSUcuTU9WRU1FTlRfRFVSQVRJT04sIDAsIDEpCiAgICAKICAgICAgICBpZiB0aW1lRWxhcHNlZCA+PSAxIHRoZW4KICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSAoc3RhcnQgLSBmaW5pc2gpLk1hZ25pdHVkZQogICAgCiAgICAgICAgICAgIGlmIGRpc3RhbmNlID49IDEwIHRoZW4KICAgICAgICAgICAgICAgIEF1dG9QbGF5TW9kdWxlLkVMQVBTRUQgPSAwCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIEF1dG9QbGF5TW9kdWxlLkNPTlRST0xfUE9JTlQgPSBuaWwKICAgICAgICAgICAgcmV0dXJuIGZpbmlzaAogICAgICAgIGVuZAogICAgCiAgICAgICAgaWYgbm90IEF1dG9QbGF5TW9kdWxlLkNPTlRST0xfUE9JTlQgdGhlbgogICAgICAgICAgICBBdXRvUGxheU1vZHVsZS5DT05UUk9MX1BPSU5UID0gQXV0b1BsYXlNb2R1bGUuZ2V0Q29udHJvbFBvaW50KHN0YXJ0LCBmaW5pc2gpCiAgICAgICAgZW5kCiAgICAKICAgICAgICBhc3NlcnQoQXV0b1BsYXlNb2R1bGUuQ09OVFJPTF9QT0lOVCwgIkNPTlRST0xfUE9JTlQ6IFZlY3RvcjMgZXhwZWN0ZWQsIGdvdCBuaWwiKQogICAgICAgIHJldHVybiBBdXRvUGxheU1vZHVsZS5xdWFkcmF0aWMoc3RhcnQsIEF1dG9QbGF5TW9kdWxlLkNPTlRST0xfUE9JTlQsIGZpbmlzaCwgdGltZUVsYXBzZWQpCiAgICBlbmQKICAgIAogICAgQXV0b1BsYXlNb2R1bGUubWFwID0gewogICAgICAgIGdldEZsb29yID0gZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBmbG9vciA9IEF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuV29ya3NwYWNlOkZpbmRGaXJzdENoaWxkKCJGTE9PUiIpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3QgZmxvb3IgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHBhcnQgaW4gcGFpcnMoQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5Xb3Jrc3BhY2U6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBwYXJ0OklzQSgiTWVzaFBhcnQiKSBvciBwYXJ0OklzQSgiQmFzZVBhcnQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHNpemUgPSBwYXJ0LlNpemUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2l6ZS5YID4gNTAgYW5kIHNpemUuWiA+IDUwIGFuZCBwYXJ0LlBvc2l0aW9uLlkgPCA1IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJ0CiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGZsb29yCiAgICAgICAgZW5kCiAgICB9CiAgICAKICAgIEF1dG9QbGF5TW9kdWxlLmdldFJhbmRvbVBvc2l0aW9uID0gZnVuY3Rpb24oKQogICAgICAgIGxvY2FsIGZsb29yID0gQXV0b1BsYXlNb2R1bGUubWFwLmdldEZsb29yKCkKICAgIAogICAgICAgIGlmIG5vdCBmbG9vciBvciBub3QgQXV0b1BsYXlNb2R1bGUuYmFsbFV0aWxzLmlzRXhpc3RpbmcoKSB0aGVuCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgCiAgICAgICAgbG9jYWwgYmFsbERpcmVjdGlvbiA9IEF1dG9QbGF5TW9kdWxlLmJhbGxVdGlscy5nZXREaXJlY3Rpb24oKSAqIEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5ESVJFQ1RJT04KICAgICAgICBsb2NhbCBiYWxsU3BlZWQgPSBBdXRvUGxheU1vZHVsZS5iYWxsVXRpbHMuZ2V0U3BlZWQoKQogICAgCiAgICAgICAgbG9jYWwgc3BlZWRUaHJlc2hvbGQgPSBtYXRoLm1pbihiYWxsU3BlZWQgLyAxMCwgQXV0b1BsYXlNb2R1bGUuQ09ORklHLk1VTFRJUExJRVJfVEhSRVNIT0xEKQogICAgICAgIGxvY2FsIHNwZWVkTXVsdGlwbGllciA9IEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5ERUZBVUxUX0RJU1RBTkNFICsgc3BlZWRUaHJlc2hvbGQKICAgICAgICBsb2NhbCBuZWdhdGl2ZURpcmVjdGlvbiA9IGJhbGxEaXJlY3Rpb24gKiBzcGVlZE11bHRpcGxpZXIKICAgIAogICAgICAgIGxvY2FsIGN1cnJlbnRUaW1lID0gb3MudGltZSgpIC8gMS4yCiAgICAgICAgbG9jYWwgc2luZSA9IG1hdGguc2luKGN1cnJlbnRUaW1lKSAqIEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5UUkFWRVJTSU5HCiAgICAgICAgbG9jYWwgY29zaW5lID0gbWF0aC5jb3MoY3VycmVudFRpbWUpICogQXV0b1BsYXlNb2R1bGUuQ09ORklHLlRSQVZFUlNJTkcKICAgIAogICAgICAgIGxvY2FsIHRyYXZlcnNpbmcgPSBWZWN0b3IzLm5ldyhzaW5lLCAwLCBjb3NpbmUpCiAgICAgICAgbG9jYWwgZmluYWxQb3NpdGlvbiA9IGZsb29yLlBvc2l0aW9uICsgbmVnYXRpdmVEaXJlY3Rpb24gKyB0cmF2ZXJzaW5nCiAgICAKICAgICAgICByZXR1cm4gZmluYWxQb3NpdGlvbgogICAgZW5kCiAgICAKICAgIAogICAgQXV0b1BsYXlNb2R1bGUubG9iYnkgPSB7CiAgICAgICAgaXNDaG9vc2VyQXZhaWxhYmxlID0gZnVuY3Rpb24oKQogICAgICAgICAgICByZXR1cm4gQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5Xb3Jrc3BhY2UuU3Bhd24uTmV3UGxheWVyQ291bnRlci5HVUkuU3VyZmFjZUd1aS5Ub3AuT3B0aW9ucy5WaXNpYmxlCiAgICAgICAgZW5kLAogICAgICAgIAogICAgICAgIHVwZGF0ZUNob2ljZSA9IGZ1bmN0aW9uKGNob2ljZSkKICAgICAgICAgICAgQXV0b1BsYXlNb2R1bGUubG9iYnlDaG9pY2UgPSBjaG9pY2UKICAgICAgICBlbmQsCiAgICAgICAgCiAgICAgICAgZ2V0TWFwQ2hvaWNlID0gZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBjaG9pY2UgPSBBdXRvUGxheU1vZHVsZS5sb2JieUNob2ljZSBvciBtYXRoLnJhbmRvbSgxLCAzKQogICAgICAgICAgICBsb2NhbCBjb2xsaWRlciA9IEF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuV29ya3NwYWNlLlNwYXduLk5ld1BsYXllckNvdW50ZXIuQ29sbGlkZXJzOkZpbmRGaXJzdENoaWxkKGNob2ljZSkKICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGNvbGxpZGVyCiAgICAgICAgZW5kLAogICAgICAgIAogICAgICAgIGdldFBhZFBvc2l0aW9uID0gZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBub3QgQXV0b1BsYXlNb2R1bGUubG9iYnkuaXNDaG9vc2VyQXZhaWxhYmxlKCkgdGhlbgogICAgICAgICAgICAgICAgQXV0b1BsYXlNb2R1bGUubG9iYnlDaG9pY2UgPSBuaWwKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgY2hvaWNlID0gQXV0b1BsYXlNb2R1bGUubG9iYnkuZ2V0TWFwQ2hvaWNlKCkKICAgICAgICAKICAgICAgICAgICAgaWYgbm90IGNob2ljZSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBjaG9pY2UuUG9zaXRpb24sIGNob2ljZS5OYW1lCiAgICAgICAgZW5kCiAgICB9CiAgICAKICAgIEF1dG9QbGF5TW9kdWxlLm1vdmVtZW50ID0gewogICAgICAgIHJlbW92ZUNhY2hlID0gZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBBdXRvUGxheU1vZHVsZS5hbmltYXRpb25DYWNoZSB0aGVuCiAgICAgICAgICAgICAgICBBdXRvUGxheU1vZHVsZS5hbmltYXRpb25DYWNoZSA9IG5pbAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQsCiAgICAgICAgCiAgICAgICAgY3JlYXRlSnVtcFZlbG9jaXR5ID0gZnVuY3Rpb24ocGxheWVyKQogICAgICAgICAgICBsb2NhbCBtYXhGb3JjZSA9IG1hdGguaHVnZQogICAgICAgICAgICBsb2NhbCB2ZWxvY2l0eSA9IEluc3RhbmNlLm5ldygiQm9keVZlbG9jaXR5IikKICAgICAgICAgICAgdmVsb2NpdHkuTWF4Rm9yY2UgPSBWZWN0b3IzLm5ldyhtYXhGb3JjZSwgbWF4Rm9yY2UsIG1heEZvcmNlKQogICAgICAgICAgICB2ZWxvY2l0eS5WZWxvY2l0eSA9IFZlY3RvcjMubmV3KDAsIDgwLCAwKQogICAgICAgICAgICB2ZWxvY2l0eS5QYXJlbnQgPSBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQKICAgICAgICAKICAgICAgICAgICAgQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5EZWJyaXM6QWRkSXRlbSh2ZWxvY2l0eSwgMC4wMDEpCiAgICAgICAgICAgIEF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5Eb3VibGVKdW1wOkZpcmVTZXJ2ZXIoKQogICAgICAgIGVuZCwKICAgICAgICAKICAgICAgICBwbGF5SnVtcEFuaW1hdGlvbiA9IGZ1bmN0aW9uKHBsYXllcikKICAgICAgICAgICAgaWYgbm90IEF1dG9QbGF5TW9kdWxlLmFuaW1hdGlvbkNhY2hlIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGRvdWJsZUp1bXBBbmltYXRpb24gPSBBdXRvUGxheU1vZHVsZS5jdXN0b21TZXJ2aWNlLlJlcGxpY2F0ZWRTdG9yYWdlLkFzc2V0cy5UdXRvcmlhbC5BbmltYXRpb25zLkRvdWJsZUp1bXAKICAgICAgICAgICAgICAgIEF1dG9QbGF5TW9kdWxlLmFuaW1hdGlvbkNhY2hlID0gcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5BbmltYXRvcjpMb2FkQW5pbWF0aW9uKGRvdWJsZUp1bXBBbmltYXRpb24pCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBpZiBBdXRvUGxheU1vZHVsZS5hbmltYXRpb25DYWNoZSB0aGVuCiAgICAgICAgICAgICAgICBBdXRvUGxheU1vZHVsZS5hbmltYXRpb25DYWNoZTpQbGF5KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kLAogICAgICAgIAogICAgICAgIGRvdWJsZUp1bXAgPSBmdW5jdGlvbihwbGF5ZXIpCiAgICAgICAgICAgIGlmIEF1dG9QbGF5TW9kdWxlLmRvdWJsZUp1bXBlZCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBBdXRvUGxheU1vZHVsZS5wZXJjZW50YWdlQ2hlY2soQXV0b1BsYXlNb2R1bGUuQ09ORklHLkRPVUJMRV9KVU1QX1BFUkNFTlRBR0UpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgQXV0b1BsYXlNb2R1bGUuZG91YmxlSnVtcGVkID0gdHJ1ZQogICAgICAgICAgICBBdXRvUGxheU1vZHVsZS5tb3ZlbWVudC5jcmVhdGVKdW1wVmVsb2NpdHkocGxheWVyKQogICAgICAgICAgICBBdXRvUGxheU1vZHVsZS5tb3ZlbWVudC5wbGF5SnVtcEFuaW1hdGlvbihwbGF5ZXIpCiAgICAgICAgZW5kLAogICAgICAgIAogICAgICAgIGp1bXAgPSBmdW5jdGlvbihwbGF5ZXIpCiAgICAgICAgICAgIGlmIG5vdCBBdXRvUGxheU1vZHVsZS5DT05GSUcuSlVNUElOR19FTkFCTEVEIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBBdXRvUGxheU1vZHVsZS5wbGF5ZXJIZWxwZXIub25Hcm91bmQocGxheWVyLkNoYXJhY3RlcikgdGhlbgogICAgICAgICAgICAgICAgQXV0b1BsYXlNb2R1bGUubW92ZW1lbnQuZG91YmxlSnVtcChwbGF5ZXIpCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBBdXRvUGxheU1vZHVsZS5wZXJjZW50YWdlQ2hlY2soQXV0b1BsYXlNb2R1bGUuQ09ORklHLkpVTVBfUEVSQ0VOVEFHRSkgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIAogICAgICAgICAgICBBdXRvUGxheU1vZHVsZS5kb3VibGVKdW1wZWQgPSBmYWxzZQogICAgICAgICAgICBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkNoYW5nZVN0YXRlKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuSnVtcGluZykKICAgICAgICBlbmQsCiAgICAgICAgCiAgICAgICAgbW92ZSA9IGZ1bmN0aW9uKHBsYXllciwgcGxheWVyUG9zaXRpb24pCiAgICAgICAgICAgIHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6TW92ZVRvKHBsYXllclBvc2l0aW9uKQogICAgICAgIGVuZCwKICAgICAgICAKICAgICAgICBzdG9wID0gZnVuY3Rpb24ocGxheWVyKQogICAgICAgICAgICBsb2NhbCBwbGF5ZXJQb3NpdGlvbiA9IHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbgogICAgICAgICAgICBwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOk1vdmVUbyhwbGF5ZXJQb3NpdGlvbikKICAgICAgICBlbmQKICAgIH0KICAgIAogICAgQXV0b1BsYXlNb2R1bGUuc2lnbmFsID0gewogICAgICAgIGNvbm5lY3QgPSBmdW5jdGlvbihuYW1lLCBjb25uZWN0aW9uLCBjYWxsYmFjaykKICAgICAgICAgICAgaWYgbm90IG5hbWUgdGhlbgogICAgICAgICAgICAgICAgbmFtZSA9IEF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuSHR0cFNlcnZpY2U6R2VuZXJhdGVHVUlEKCkKICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIEF1dG9QbGF5TW9kdWxlLnNpZ25hbHNbbmFtZV0gPSBjb25uZWN0aW9uOkNvbm5lY3QoY2FsbGJhY2spCiAgICAgICAgICAgIHJldHVybiBBdXRvUGxheU1vZHVsZS5zaWduYWxzW25hbWVdCiAgICAgICAgZW5kLAogICAgICAgIAogICAgICAgIGRpc2Nvbm5lY3QgPSBmdW5jdGlvbihuYW1lKQogICAgICAgICAgICBpZiBub3QgbmFtZSBvciBub3QgQXV0b1BsYXlNb2R1bGUuc2lnbmFsc1tuYW1lXSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgICAgIEF1dG9QbGF5TW9kdWxlLnNpZ25hbHNbbmFtZV06RGlzY29ubmVjdCgpCiAgICAgICAgICAgIEF1dG9QbGF5TW9kdWxlLnNpZ25hbHNbbmFtZV0gPSBuaWwKICAgICAgICBlbmQsCiAgICAgICAgCiAgICAgICAgc3RvcCA9IGZ1bmN0aW9uKCkKICAgICAgICAgICAgZm9yIG5hbWUsIGNvbm5lY3Rpb24gaW4gcGFpcnMoQXV0b1BsYXlNb2R1bGUuc2lnbmFscykgZG8KICAgICAgICAgICAgICAgIGlmIHR5cGVvZihjb25uZWN0aW9uKSB+PSAiUkJYU2NyaXB0Q29ubmVjdGlvbiIgdGhlbgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAgICAgICAgIGNvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgICAgICBBdXRvUGxheU1vZHVsZS5zaWduYWxzW25hbWVdID0gbmlsCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfQogICAgCiAgICBBdXRvUGxheU1vZHVsZS5maW5kUGF0aCA9IGZ1bmN0aW9uKGluTG9iYnksIGRlbHRhKQogICAgICAgIGxvY2FsIHJvb3RQb3NpdGlvbiA9IEF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbgogICAgCiAgICAgICAgaWYgaW5Mb2JieSB0aGVuCiAgICAgICAgICAgIGxvY2FsIHBhZFBvc2l0aW9uLCBwYWROdW1iZXIgPSBBdXRvUGxheU1vZHVsZS5sb2JieS5nZXRQYWRQb3NpdGlvbigpCiAgICAgICAgICAgIGxvY2FsIGNob2ljZSA9IHRvbnVtYmVyKHBhZE51bWJlcikKICAgICAgICAgICAgaWYgY2hvaWNlIHRoZW4KICAgICAgICAgICAgICAgIEF1dG9QbGF5TW9kdWxlLmxvYmJ5LnVwZGF0ZUNob2ljZShjaG9pY2UpCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b1ZvdGUgdGhlbgogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlBhY2thZ2VzIik6V2FpdEZvckNoaWxkKCJfSW5kZXgiKTpXYWl0Rm9yQ2hpbGQoInNsZWl0bmlja19uZXRAMC4xLjAiKTpXYWl0Rm9yQ2hpbGQoIm5ldCIpOldhaXRGb3JDaGlsZCgiUkUvVXBkYXRlVm90ZXMiKTpGaXJlU2VydmVyKCJGRkEiKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgIGlmIG5vdCBwYWRQb3NpdGlvbiB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgcmV0dXJuIEF1dG9QbGF5TW9kdWxlLmdldEN1cnZlKHJvb3RQb3NpdGlvbiwgcGFkUG9zaXRpb24sIGRlbHRhKQogICAgICAgIGVuZAogICAgCiAgICAgICAgbG9jYWwgcmFuZG9tUG9zaXRpb24gPSBBdXRvUGxheU1vZHVsZS5nZXRSYW5kb21Qb3NpdGlvbigpCiAgICAKICAgICAgICBpZiBub3QgcmFuZG9tUG9zaXRpb24gdGhlbgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgIAogICAgICAgIHJldHVybiBBdXRvUGxheU1vZHVsZS5nZXRDdXJ2ZShyb290UG9zaXRpb24sIHJhbmRvbVBvc2l0aW9uLCBkZWx0YSkKICAgIGVuZAogICAgCiAgICAKICAgIEF1dG9QbGF5TW9kdWxlLmZvbGxvd1BhdGggPSBmdW5jdGlvbihkZWx0YSkKICAgICAgICBpZiBub3QgQXV0b1BsYXlNb2R1bGUucGxheWVySGVscGVyLmlzQWxpdmUoQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5QbGF5ZXJzLkxvY2FsUGxheWVyKSB0aGVuCiAgICAgICAgICAgIEF1dG9QbGF5TW9kdWxlLm1vdmVtZW50LnJlbW92ZUNhY2hlKCkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCiAgICAKICAgICAgICBsb2NhbCBpbkxvYmJ5ID0gQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5QYXJlbnQgPT0gQXV0b1BsYXlNb2R1bGUuY3VzdG9tU2VydmljZS5Xb3Jrc3BhY2UuRGVhZAogICAgICAgIGxvY2FsIHBhdGggPSBBdXRvUGxheU1vZHVsZS5maW5kUGF0aChpbkxvYmJ5LCBkZWx0YSkKICAgIAogICAgICAgIGlmIG5vdCBwYXRoIHRoZW4KICAgICAgICAgICAgQXV0b1BsYXlNb2R1bGUubW92ZW1lbnQuc3RvcChBdXRvUGxheU1vZHVsZS5jdXN0b21TZXJ2aWNlLlBsYXllcnMuTG9jYWxQbGF5ZXIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgCiAgICAgICAgQXV0b1BsYXlNb2R1bGUubW92ZW1lbnQubW92ZShBdXRvUGxheU1vZHVsZS5jdXN0b21TZXJ2aWNlLlBsYXllcnMuTG9jYWxQbGF5ZXIsIHBhdGgpCiAgICAgICAgQXV0b1BsYXlNb2R1bGUubW92ZW1lbnQuanVtcChBdXRvUGxheU1vZHVsZS5jdXN0b21TZXJ2aWNlLlBsYXllcnMuTG9jYWxQbGF5ZXIpCiAgICBlbmQKICAgIAogICAgQXV0b1BsYXlNb2R1bGUuZmluaXNoVGhyZWFkID0gZnVuY3Rpb24oKQogICAgICAgIEF1dG9QbGF5TW9kdWxlLnNpZ25hbC5kaXNjb25uZWN0KCJhdXRvLXBsYXkiKQogICAgICAgIEF1dG9QbGF5TW9kdWxlLnNpZ25hbC5kaXNjb25uZWN0KCJzeW5jaHJvbml6ZSIpCiAgICAgICAgCiAgICAgICAgaWYgbm90IEF1dG9QbGF5TW9kdWxlLnBsYXllckhlbHBlci5pc0FsaXZlKEF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuUGxheWVycy5Mb2NhbFBsYXllcikgdGhlbgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBBdXRvUGxheU1vZHVsZS5tb3ZlbWVudC5zdG9wKEF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuUGxheWVycy5Mb2NhbFBsYXllcikKICAgIGVuZAogICAgCiAgICBBdXRvUGxheU1vZHVsZS5ydW5UaHJlYWQgPSBmdW5jdGlvbigpCiAgICAgICAgQXV0b1BsYXlNb2R1bGUuc2lnbmFsLmNvbm5lY3QoImF1dG8tcGxheSIsIEF1dG9QbGF5TW9kdWxlLmN1c3RvbVNlcnZpY2UuUnVuU2VydmljZS5Qb3N0U2ltdWxhdGlvbiwgQXV0b1BsYXlNb2R1bGUuZm9sbG93UGF0aCkKICAgICAgICBBdXRvUGxheU1vZHVsZS5zaWduYWwuY29ubmVjdCgic3luY2hyb25pemUiLCBBdXRvUGxheU1vZHVsZS5jdXN0b21TZXJ2aWNlLlJ1blNlcnZpY2UuUG9zdFNpbXVsYXRpb24sIEF1dG9QbGF5TW9kdWxlLmJhbGxVdGlscy5nZXRCYWxsKQogICAgZW5kCiAgICAKICAgIC0tW1sKICAgICAgICBUZWxlcG9ydFNlcnZpY2UgPSBjbG9uZXJlZihnYW1lOkdldFNlcnZpY2UoIlRlbGVwb3J0U2VydmljZSIpKQogICAgICAgIFBsYWNlSWQsIEpvYklkID0gZ2FtZS5QbGFjZUlkLCBnYW1lLkpvYklkCiAgICAgICAgaWYgI1BsYXllcnM6R2V0UGxheWVycygpIDwgNSB0aGVuCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvU2VydmVySG9wIHRoZW4KICAgICAgICAgICAgICAgIFBsYXllcnMuTG9jYWxQbGF5ZXI6S2ljaygiXG5SZWpvaW5pbmciKQogICAgICAgICAgICAgICAgd2FpdCgpCiAgICAgICAgICAgICAgICBUZWxlcG9ydFNlcnZpY2U6VGVsZXBvcnQoUGxhY2VJZCwgUGxheWVycy5Mb2NhbFBsYXllcikKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgVGVsZXBvcnRTZXJ2aWNlOlRlbGVwb3J0VG9QbGFjZUluc3RhbmNlKFBsYWNlSWQsIEpvYklkLCBQbGF5ZXJzLkxvY2FsUGxheWVyKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIF1dCgogICAgbG9jYWwgQXV0b1BsYXkgPSBtaXNjOmNyZWF0ZV9tb2R1bGUoewogICAgICAgIHRpdGxlID0gJ0F1dG8gUGxheScsCiAgICAgICAgZmxhZyA9ICdBdXRvUGxheScsCiAgICAgICAgZGVzY3JpcHRpb24gPSAnQXV0b21hdGljYWxseSBQbGF5cyBHYW1lJywKICAgICAgICBzZWN0aW9uID0gJ3JpZ2h0JywKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICBBdXRvUGxheU1vZHVsZS5ydW5UaHJlYWQoKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBBdXRvUGxheU1vZHVsZS5maW5pc2hUaHJlYWQoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCiAgICAKICAgIGxvY2FsIEFudGlBRksgPSBBdXRvUGxheTpjcmVhdGVfY2hlY2tib3goewogICAgICAgIHRpdGxlID0gIkFudGkgQUZLIiwKICAgICAgICBmbGFnID0gIkF1dG9QbGF5QW50aUFGSyIsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKICAgICAgICAgICAgaWYgdmFsdWUgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgR0MgPSBnZXRjb25uZWN0aW9ucyBvciBnZXRfc2lnbmFsX2NvbnMKICAgICAgICAgICAgICAgIGlmIEdDIHRoZW4KICAgICAgICAgICAgICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhHQyhQbGF5ZXJzLkxvY2FsUGxheWVyLklkbGVkKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdlsiRGlzYWJsZSJdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZbIkRpc2FibGUiXSh2KQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgdlsiRGlzY29ubmVjdCJdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZbIkRpc2Nvbm5lY3QiXSh2KQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBsb2NhbCBWaXJ0dWFsVXNlciA9IGNsb25lcmVmKGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKSkKICAgICAgICAgICAgICAgICAgICBQbGF5ZXJzLkxvY2FsUGxheWVyLklkbGVkOkNvbm5lY3QoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICBWaXJ0dWFsVXNlcjpDYXB0dXJlQ29udHJvbGxlcigpCiAgICAgICAgICAgICAgICAgICAgICAgIFZpcnR1YWxVc2VyOkNsaWNrQnV0dG9uMihWZWN0b3IyLm5ldygpKQogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCgogICAgQW50aUFGSzpjaGFuZ2Vfc3RhdGUodHJ1ZSkKCiAgICBBdXRvUGxheTpjcmVhdGVfY2hlY2tib3goewogICAgICAgIHRpdGxlID0gIkVuYWJsZSBKdW1waW5nIiwKICAgICAgICBmbGFnID0gImp1bXBpbmdfZW5hYmxlZCIsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgQXV0b1BsYXlNb2R1bGUuQ09ORklHLkpVTVBJTkdfRU5BQkxFRCA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQoKICAgIEF1dG9QbGF5OmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgdGl0bGUgPSAiQXV0byBWb3RlIiwKICAgICAgICBmbGFnID0gIkF1dG9Wb3RlIiwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBnZXRnZW52KCkuQXV0b1ZvdGUgPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCiAgICAtLVtbCiAgICAgICAgbG9jYWwgQXV0b1NlcnZlckhvcCA9IEF1dG9QbGF5OmNyZWF0ZV9jaGVja2JveCh7CiAgICAgICAgICAgIHRpdGxlID0gIkF1dG8gU2VydmVyIEhvcCIsCiAgICAgICAgICAgIGZsYWcgPSAiQXV0b1NlcnZlckhvcCIsCiAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgICAgICBnZXRnZW52KCkuQXV0b1NlcnZlckhvcCA9IHZhbHVlCiAgICAgICAgICAgIGVuZAogICAgICAgIH0pCgogICAgICAgIEF1dG9TZXJ2ZXJIb3A6Y2hhbmdlX3N0YXRlKGZhbHNlKQogICAgXV0KICAgIEF1dG9QbGF5OmNyZWF0ZV9kaXZpZGVyKHsKICAgIH0pCiAgICAKICAgIEF1dG9QbGF5OmNyZWF0ZV9zbGlkZXIoewogICAgICAgIHRpdGxlID0gJ0Rpc3RhbmNlIEZyb20gQmFsbCcsCiAgICAgICAgZmxhZyA9ICdkZWZhdWx0X2Rpc3RhbmNlJywKICAgICAgICBtYXhpbXVtX3ZhbHVlID0gMTAwLAogICAgICAgIG1pbmltdW1fdmFsdWUgPSA1LAogICAgICAgIHZhbHVlID0gQXV0b1BsYXlNb2R1bGUuQ09ORklHLkRFRkFVTFRfRElTVEFOQ0UsCiAgICAgICAgcm91bmRfbnVtYmVyID0gdHJ1ZSwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBBdXRvUGxheU1vZHVsZS5DT05GSUcuREVGQVVMVF9ESVNUQU5DRSA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQogICAgCiAgICBBdXRvUGxheTpjcmVhdGVfc2xpZGVyKHsKICAgICAgICB0aXRsZSA9ICdTcGVlZCBNdWx0aXBsaWVyJywKICAgICAgICBmbGFnID0gJ211bHRpcGxpZXJfdGhyZXNob2xkJywKICAgICAgICBtYXhpbXVtX3ZhbHVlID0gMjAwLAogICAgICAgIG1pbmltdW1fdmFsdWUgPSAxMCwKICAgICAgICB2YWx1ZSA9IEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5NVUxUSVBMSUVSX1RIUkVTSE9MRCwKICAgICAgICByb3VuZF9udW1iZXIgPSB0cnVlLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5NVUxUSVBMSUVSX1RIUkVTSE9MRCA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQogICAgCiAgICBBdXRvUGxheTpjcmVhdGVfc2xpZGVyKHsKICAgICAgICB0aXRsZSA9ICdUcmFuc3ZlcnNpbmcnLAogICAgICAgIGZsYWcgPSAndHJhdmVyc2luZycsCiAgICAgICAgbWF4aW11bV92YWx1ZSA9IDEwMCwKICAgICAgICBtaW5pbXVtX3ZhbHVlID0gMCwKICAgICAgICB2YWx1ZSA9IEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5UUkFWRVJTSU5HLAogICAgICAgIHJvdW5kX251bWJlciA9IHRydWUsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgQXV0b1BsYXlNb2R1bGUuQ09ORklHLlRSQVZFUlNJTkcgPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCiAgICBBdXRvUGxheTpjcmVhdGVfc2xpZGVyKHsKICAgICAgICB0aXRsZSA9ICdEaXJlY3Rpb24nLAogICAgICAgIGZsYWcgPSAnRGlyZWN0aW9uJywKICAgICAgICBtYXhpbXVtX3ZhbHVlID0gMSwKICAgICAgICBtaW5pbXVtX3ZhbHVlID0gLTEsCiAgICAgICAgdmFsdWUgPSBBdXRvUGxheU1vZHVsZS5DT05GSUcuRElSRUNUSU9OLAogICAgICAgIHJvdW5kX251bWJlciA9IGZhbHNlLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5ESVJFQ1RJT04gPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCiAgICBBdXRvUGxheTpjcmVhdGVfc2xpZGVyKHsKICAgICAgICB0aXRsZSA9ICdPZmZzZXQgRmFjdG9yJywKICAgICAgICBmbGFnID0gJ09mZnNldEZhY3RvcicsCiAgICAgICAgbWF4aW11bV92YWx1ZSA9IDEsCiAgICAgICAgbWluaW11bV92YWx1ZSA9IDAuMSwKICAgICAgICB2YWx1ZSA9IEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5PRkZTRVRfRkFDVE9SLAogICAgICAgIHJvdW5kX251bWJlciA9IGZhbHNlLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5PRkZTRVRfRkFDVE9SID0gdmFsdWUKICAgICAgICBlbmQKICAgIH0pCgogICAgQXV0b1BsYXk6Y3JlYXRlX3NsaWRlcih7CiAgICAgICAgdGl0bGUgPSAnTW92ZW1lbnQgRHVyYXRpb24nLAogICAgICAgIGZsYWcgPSAnTW92ZW1lbnREdXJhdGlvbicsCiAgICAgICAgbWF4aW11bV92YWx1ZSA9IDEsCiAgICAgICAgbWluaW11bV92YWx1ZSA9IDAuMSwKICAgICAgICB2YWx1ZSA9IEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5NT1ZFTUVOVF9EVVJBVElPTiwKICAgICAgICByb3VuZF9udW1iZXIgPSBmYWxzZSwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBBdXRvUGxheU1vZHVsZS5DT05GSUcuTU9WRU1FTlRfRFVSQVRJT04gPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKCiAgICBBdXRvUGxheTpjcmVhdGVfc2xpZGVyKHsKICAgICAgICB0aXRsZSA9ICdHZW5lcmF0aW9uIFRocmVzaG9sZCcsCiAgICAgICAgZmxhZyA9ICdHZW5lcmF0aW9uVGhyZXNob2xkJywKICAgICAgICBtYXhpbXVtX3ZhbHVlID0gMC41LAogICAgICAgIG1pbmltdW1fdmFsdWUgPSAwLjEsCiAgICAgICAgdmFsdWUgPSBBdXRvUGxheU1vZHVsZS5DT05GSUcuR0VORVJBVElPTl9USFJFU0hPTEQsCiAgICAgICAgcm91bmRfbnVtYmVyID0gZmFsc2UsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZSkKICAgICAgICAgICAgQXV0b1BsYXlNb2R1bGUuQ09ORklHLkdFTkVSQVRJT05fVEhSRVNIT0xEID0gdmFsdWUKICAgICAgICBlbmQKICAgIH0pCgogICAgQXV0b1BsYXk6Y3JlYXRlX3NsaWRlcih7CiAgICAgICAgdGl0bGUgPSAnSnVtcCBDaGFuY2UnLAogICAgICAgIGZsYWcgPSAnanVtcF9wZXJjZW50YWdlJywKICAgICAgICBtYXhpbXVtX3ZhbHVlID0gMTAwLAogICAgICAgIG1pbmltdW1fdmFsdWUgPSAwLAogICAgICAgIHZhbHVlID0gQXV0b1BsYXlNb2R1bGUuQ09ORklHLkpVTVBfUEVSQ0VOVEFHRSwKICAgICAgICByb3VuZF9udW1iZXIgPSB0cnVlLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5KVU1QX1BFUkNFTlRBR0UgPSB2YWx1ZQogICAgICAgIGVuZAogICAgfSkKICAgIAogICAgQXV0b1BsYXk6Y3JlYXRlX3NsaWRlcih7CiAgICAgICAgdGl0bGUgPSAnRG91YmxlIEp1bXAgQ2hhbmNlJywKICAgICAgICBmbGFnID0gJ2RvdWJsZV9qdW1wX3BlcmNlbnRhZ2UnLAogICAgICAgIG1heGltdW1fdmFsdWUgPSAxMDAsCiAgICAgICAgbWluaW11bV92YWx1ZSA9IDAsCiAgICAgICAgdmFsdWUgPSBBdXRvUGxheU1vZHVsZS5DT05GSUcuRE9VQkxFX0pVTVBfUEVSQ0VOVEFHRSwKICAgICAgICByb3VuZF9udW1iZXIgPSB0cnVlLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIEF1dG9QbGF5TW9kdWxlLkNPTkZJRy5ET1VCTEVfSlVNUF9QRVJDRU5UQUdFID0gdmFsdWUKICAgICAgICBlbmQKICAgIH0pCgogICAgbG9jYWwgYmFsbFN0YXRzVUkKICAgIGxvY2FsIGhlYXJ0YmVhdENvbm4KICAgIGxvY2FsIHBlYWtWZWxvY2l0eSA9IDAKICAgIAogICAgbG9jYWwgQmFsbFN0YXRzID0gbWlzYzpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICdCYWxsIFN0YXRzJywgCiAgICAgICAgZmxhZyA9ICdiYWxsU3RhdHMnLCAKICAgICAgICBkZXNjcmlwdGlvbiA9ICdUb2dnbGUgYmFsbCBzcGVlZCBzdGF0cyBkaXNwbGF5JywgCiAgICAgICAgc2VjdGlvbiA9ICdsZWZ0JywKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlKQogICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBiYWxsUGVha3MgPSB7fQoKICAgICAgICAgICAgICAgIGlmIG5vdCBiYWxsU3RhdHNVSSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyCiAgICAgICAgICAgICAgICAgICAgYmFsbFN0YXRzVUkgPSBJbnN0YW5jZS5uZXcoIlNjcmVlbkd1aSIpCiAgICAgICAgICAgICAgICAgICAgYmFsbFN0YXRzVUkuUmVzZXRPblNwYXduID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBiYWxsU3RhdHNVSS5QYXJlbnQgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJQbGF5ZXJHdWkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdGV4dExhYmVsID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKQogICAgICAgICAgICAgICAgICAgIHRleHRMYWJlbC5OYW1lID0gIkJhbGxTdGF0c0xhYmVsIgogICAgICAgICAgICAgICAgICAgIHRleHRMYWJlbC5TaXplID0gVURpbTIubmV3KDAuMiwgMCwgMC4wNSwgMCkKICAgICAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMCwgMC4xLCAwKQogICAgICAgICAgICAgICAgICAgIHRleHRMYWJlbC5UZXh0U2NhbGVkID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICB0ZXh0TGFiZWwuVGV4dFNpemUgPSAyNgogICAgICAgICAgICAgICAgICAgIHRleHRMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQogICAgICAgICAgICAgICAgICAgIHRleHRMYWJlbC5UZXh0Q29sb3IzID0gQ29sb3IzLm5ldygxLCAxLCAxKQogICAgICAgICAgICAgICAgICAgIHRleHRMYWJlbC5Gb250ID0gRW51bS5Gb250LkdvdGhhbQogICAgICAgICAgICAgICAgICAgIHRleHRMYWJlbC5aSW5kZXggPSAyCiAgICAgICAgICAgICAgICAgICAgdGV4dExhYmVsLlBhcmVudCA9IGJhbGxTdGF0c1VJCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzaGFkb3dMYWJlbCA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikKICAgICAgICAgICAgICAgICAgICBzaGFkb3dMYWJlbC5OYW1lID0gIkJhbGxTdGF0c1NoYWRvdyIKICAgICAgICAgICAgICAgICAgICBzaGFkb3dMYWJlbC5TaXplID0gdGV4dExhYmVsLlNpemUKICAgICAgICAgICAgICAgICAgICBzaGFkb3dMYWJlbC5Qb3NpdGlvbiA9IHRleHRMYWJlbC5Qb3NpdGlvbiArIFVEaW0yLm5ldygwLCAyLCAwLCAyKQogICAgICAgICAgICAgICAgICAgIHNoYWRvd0xhYmVsLlRleHRTY2FsZWQgPSB0ZXh0TGFiZWwuVGV4dFNjYWxlZAogICAgICAgICAgICAgICAgICAgIHNoYWRvd0xhYmVsLlRleHRTaXplID0gdGV4dExhYmVsLlRleHRTaXplCiAgICAgICAgICAgICAgICAgICAgc2hhZG93TGFiZWwuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgICAgICAgICBzaGFkb3dMYWJlbC5UZXh0Q29sb3IzID0gQ29sb3IzLm5ldygwLCAwLCAwKQogICAgICAgICAgICAgICAgICAgIHNoYWRvd0xhYmVsLkZvbnQgPSB0ZXh0TGFiZWwuRm9udAogICAgICAgICAgICAgICAgICAgIHNoYWRvd0xhYmVsLlpJbmRleCA9IDEKICAgICAgICAgICAgICAgICAgICBzaGFkb3dMYWJlbC5QYXJlbnQgPSBiYWxsU3RhdHNVSQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcGVha0xhYmVsID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKQogICAgICAgICAgICAgICAgICAgIHBlYWtMYWJlbC5OYW1lID0gIlBlYWtTdGF0c0xhYmVsIgogICAgICAgICAgICAgICAgICAgIHBlYWtMYWJlbC5TaXplID0gVURpbTIubmV3KDAuMiwgMCwgMC4wNSwgMCkKICAgICAgICAgICAgICAgICAgICBwZWFrTGFiZWwuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMCwgMC4xMzUsIDApCiAgICAgICAgICAgICAgICAgICAgcGVha0xhYmVsLlRleHRTY2FsZWQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIHBlYWtMYWJlbC5UZXh0U2l6ZSA9IDI2CiAgICAgICAgICAgICAgICAgICAgcGVha0xhYmVsLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICAgICAgcGVha0xhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMubmV3KDEsIDEsIDEpCiAgICAgICAgICAgICAgICAgICAgcGVha0xhYmVsLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtCiAgICAgICAgICAgICAgICAgICAgcGVha0xhYmVsLlpJbmRleCA9IDIKICAgICAgICAgICAgICAgICAgICBwZWFrTGFiZWwuUGFyZW50ID0gYmFsbFN0YXRzVUkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHBlYWtTaGFkb3cgPSBJbnN0YW5jZS5uZXcoIlRleHRMYWJlbCIpCiAgICAgICAgICAgICAgICAgICAgcGVha1NoYWRvdy5OYW1lID0gIlBlYWtTdGF0c1NoYWRvdyIKICAgICAgICAgICAgICAgICAgICBwZWFrU2hhZG93LlNpemUgPSBwZWFrTGFiZWwuU2l6ZQogICAgICAgICAgICAgICAgICAgIHBlYWtTaGFkb3cuUG9zaXRpb24gPSBwZWFrTGFiZWwuUG9zaXRpb24gKyBVRGltMi5uZXcoMCwgMiwgMCwgMikKICAgICAgICAgICAgICAgICAgICBwZWFrU2hhZG93LlRleHRTY2FsZWQgPSBwZWFrTGFiZWwuVGV4dFNjYWxlZAogICAgICAgICAgICAgICAgICAgIHBlYWtTaGFkb3cuVGV4dFNpemUgPSBwZWFrTGFiZWwuVGV4dFNpemUKICAgICAgICAgICAgICAgICAgICBwZWFrU2hhZG93LkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgICAgICAgICAgcGVha1NoYWRvdy5UZXh0Q29sb3IzID0gQ29sb3IzLm5ldygwLCAwLCAwKQogICAgICAgICAgICAgICAgICAgIHBlYWtTaGFkb3cuRm9udCA9IHBlYWtMYWJlbC5Gb250CiAgICAgICAgICAgICAgICAgICAgcGVha1NoYWRvdy5aSW5kZXggPSAxCiAgICAgICAgICAgICAgICAgICAgcGVha1NoYWRvdy5QYXJlbnQgPSBiYWxsU3RhdHNVSQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcGVha1ZlbG9jaXR5ID0gMAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQogICAgICAgICAgICAgICAgICAgIGhlYXJ0YmVhdENvbm4gPSBSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBCYWxscyA9IEF1dG9fUGFycnkuR2V0X0JhbGxzKCkgb3Ige30KCiAgICAgICAgICAgICAgICAgICAgZm9yIG9sZEJhbGwsXyBpbiBwYWlycyhiYWxsUGVha3MpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHN0aWxsQWxpdmUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgXywgYiBpbiBpcGFpcnMoQmFsbHMpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBiID09IG9sZEJhbGwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0aWxsQWxpdmUgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHN0aWxsQWxpdmUgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFsbFBlYWtzW29sZEJhbGxdID0gbmlsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBmb3IgXywgQmFsbCBpbiBpcGFpcnMoQmFsbHMpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHpvb21pZXMgPSBCYWxsOkZpbmRGaXJzdENoaWxkKCJ6b29taWVzIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgem9vbWllcyB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBzcGVlZCA9IHpvb21pZXMuVmVjdG9yVmVsb2NpdHkuTWFnbml0dWRlCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFsbFBlYWtzW0JhbGxdID0gYmFsbFBlYWtzW0JhbGxdIG9yIDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3BlZWQgPiBiYWxsUGVha3NbQmFsbF0gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbGxQZWFrc1tCYWxsXSA9IHNwZWVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjdXJUZXh0ID0gKCJWZWxvY2l0eTogJS4yZiIpOmZvcm1hdChzcGVlZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHRMYWJlbC5UZXh0ICAgICAgPSBjdXJUZXh0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaGFkb3dMYWJlbC5UZXh0ICAgID0gY3VyVGV4dAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHBlYWtUZXh0ID0gKCJQZWFrOiAlLjJmIik6Zm9ybWF0KGJhbGxQZWFrc1tCYWxsXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlYWtMYWJlbC5UZXh0ICAgICAgPSBwZWFrVGV4dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVha1NoYWRvdy5UZXh0ICAgICA9IHBlYWtUZXh0CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWYgaGVhcnRiZWF0Q29ubiB0aGVuCiAgICAgICAgICAgICAgICAgICAgaGVhcnRiZWF0Q29ubjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgICAgICAgICBoZWFydGJlYXRDb25uID0gbmlsCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIGJhbGxTdGF0c1VJIHRoZW4KICAgICAgICAgICAgICAgICAgICBiYWxsU3RhdHNVSTpEZXN0cm95KCkKICAgICAgICAgICAgICAgICAgICBiYWxsU3RhdHNVSSA9IG5pbAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBwZWFrVmVsb2NpdHkgPSAwCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCiAgICBsb2NhbCB2aXN1YWxQYXJ0CgogICAgbG9jYWwgVmlzdWFsaXNlciA9IG1pc2M6Y3JlYXRlX21vZHVsZSh7CiAgICAgICAgdGl0bGUgPSAnVmlzdWFsaXNlcicsCiAgICAgICAgZmxhZyA9ICdWaXN1YWxpc2VyJywKICAgICAgICBkZXNjcmlwdGlvbiA9ICdQYXJyeSBSYW5nZSBWaXN1YWxpc2VyJywKICAgICAgICBzZWN0aW9uID0gJ3JpZ2h0JywKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHZhbHVlOiBib29sZWFuKQogICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICBpZiBub3QgdmlzdWFsUGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgdmlzdWFsUGFydCA9IEluc3RhbmNlLm5ldygiUGFydCIpCiAgICAgICAgICAgICAgICAgICAgdmlzdWFsUGFydC5OYW1lID0gIlZpc3VhbGlzZXJQYXJ0IgogICAgICAgICAgICAgICAgICAgIHZpc3VhbFBhcnQuU2hhcGUgPSBFbnVtLlBhcnRUeXBlLkJhbGwKICAgICAgICAgICAgICAgICAgICB2aXN1YWxQYXJ0Lk1hdGVyaWFsID0gRW51bS5NYXRlcmlhbC5Gb3JjZUZpZWxkCiAgICAgICAgICAgICAgICAgICAgLS0gSW5pdGlhbCBjb2xvcjsgd2lsbCBiZSBvdmVycmlkZGVuIGJ5IHNsaWRlci9jaGVja2JveCBjYWxsYmFja3MKICAgICAgICAgICAgICAgICAgICB2aXN1YWxQYXJ0LkNvbG9yID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgICAgICB2aXN1YWxQYXJ0LlRyYW5zcGFyZW5jeSA9IDAgIAogICAgICAgICAgICAgICAgICAgIHZpc3VhbFBhcnQuQ2FzdFNoYWRvdyA9IGZhbHNlIAogICAgICAgICAgICAgICAgICAgIHZpc3VhbFBhcnQuQW5jaG9yZWQgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgdmlzdWFsUGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICB2aXN1YWxQYXJ0LlBhcmVudCA9IHdvcmtzcGFjZQogICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ1Zpc3VhbGlzZXInXSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgIGxvY2FsIEh1bWFub2lkUm9vdFBhcnQgPSBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgaWYgSHVtYW5vaWRSb290UGFydCBhbmQgdmlzdWFsUGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHZpc3VhbFBhcnQuQ0ZyYW1lID0gSHVtYW5vaWRSb290UGFydC5DRnJhbWUgIAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlZpc3VhbGlzZXJSYWluYm93IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgaHVlID0gKHRpY2soKSAlIDUpIC8gNQogICAgICAgICAgICAgICAgICAgICAgICB2aXN1YWxQYXJ0LkNvbG9yID0gQ29sb3IzLmZyb21IU1YoaHVlLCAxLCAxKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgaHVlVmFsID0gZ2V0Z2VudigpLlZpc3VhbGlzZXJIdWUgb3IgMAogICAgICAgICAgICAgICAgICAgICAgICB2aXN1YWxQYXJ0LkNvbG9yID0gQ29sb3IzLmZyb21IU1YoaHVlVmFsIC8gMzYwLCAxLCAxKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3BlZWQgPSAwCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgbWF4U3BlZWQgPSAzNTAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgQmFsbHMgPSBBdXRvX1BhcnJ5LkdldF9CYWxscygpCiAgICAKICAgICAgICAgICAgICAgICAgICBmb3IgXywgQmFsbCBpbiBwYWlycyhCYWxscykgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgQmFsbCBhbmQgQmFsbDpGaW5kRmlyc3RDaGlsZCgiem9vbWllcyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFZlbG9jaXR5ID0gQmFsbC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGVlZCA9IG1hdGgubWluKFZlbG9jaXR5Lk1hZ25pdHVkZSwgbWF4U3BlZWQpIC8gNi41ICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc2l6ZSA9IG1hdGgubWF4KHNwZWVkLCA2LjUpCiAgICAgICAgICAgICAgICAgICAgaWYgdmlzdWFsUGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHZpc3VhbFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KHNpemUsIHNpemUsIHNpemUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlmIENvbm5lY3Rpb25zX01hbmFnZXJbJ1Zpc3VhbGlzZXInXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgQ29ubmVjdGlvbnNfTWFuYWdlclsnVmlzdWFsaXNlciddOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ1Zpc3VhbGlzZXInXSA9IG5pbAogICAgICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgICAgIGlmIHZpc3VhbFBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgIHZpc3VhbFBhcnQ6RGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgdmlzdWFsUGFydCA9IG5pbAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKCgogICAgVmlzdWFsaXNlcjpjcmVhdGVfY2hlY2tib3goewogICAgICAgIHRpdGxlID0gJ1JhaW5ib3cnLAogICAgICAgIGZsYWcgPSAnVmlzdWFsaXNlclJhaW5ib3cnLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIGdldGdlbnYoKS5WaXN1YWxpc2VyUmFpbmJvdyA9IHZhbHVlCiAgICAgICAgZW5kCiAgICB9KQoKICAgIFZpc3VhbGlzZXI6Y3JlYXRlX3NsaWRlcih7CiAgICAgICAgdGl0bGUgPSAnQ29sb3IgSHVlJywKICAgICAgICBmbGFnID0gJ1Zpc3VhbGlzZXJIdWUnLAogICAgICAgIG1pbmltdW1fdmFsdWUgPSAwLAogICAgICAgIG1heGltdW1fdmFsdWUgPSAzNjAsCiAgICAgICAgdmFsdWUgPSAwLAogICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24odmFsdWUpCiAgICAgICAgICAgIGdldGdlbnYoKS5WaXN1YWxpc2VySHVlID0gdmFsdWUKICAgICAgICBlbmQKICAgIH0pCiAgICAKCiAgICBsb2NhbCBBdXRvQ2xhaW1SZXdhcmRzID0gbWlzYzpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICdBdXRvIENsYWltIFJld2FyZHMnLAogICAgICAgIGZsYWcgPSAnQXV0b0NsYWltUmV3YXJkcycsCiAgICAgICAgZGVzY3JpcHRpb24gPSAnQXV0b21hdGljYWxseSBjbGFpbXMgcmV3YXJkcy4nLAogICAgICAgIHNlY3Rpb24gPSAnbGVmdCcsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKICAgICAgICAgICAgZ2V0Z2VudigpLkF1dG9DbGFpbVJld2FyZHMgPSB2YWx1ZQogICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBycyA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQogICAgICAgICAgICAgICAgbG9jYWwgbmV0ID0gcnM6V2FpdEZvckNoaWxkKCJQYWNrYWdlcyIpCiAgICAgICAgICAgICAgICAgICAgOldhaXRGb3JDaGlsZCgiX0luZGV4IikKICAgICAgICAgICAgICAgICAgICA6V2FpdEZvckNoaWxkKCJzbGVpdG5pY2tfbmV0QDAuMS4wIikKICAgICAgICAgICAgICAgICAgICA6V2FpdEZvckNoaWxkKCJuZXQiKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgbmV0WyJSRi9SZWRlZW1RdWVzdHNUeXBlIl06SW52b2tlU2VydmVyKCJCYXR0bGVwYXNzIiwgIldlZWtseSIpCiAgICAgICAgICAgICAgICAgICAgbmV0WyJSRi9SZWRlZW1RdWVzdHNUeXBlIl06SW52b2tlU2VydmVyKCJCYXR0bGVwYXNzIiwgIkRhaWx5IikKICAgICAgICAgICAgICAgICAgICBuZXRbIlJGL0NsYWltQWxsRGFpbHlNaXNzaW9ucyJdOkludm9rZVNlcnZlcigiRGFpbHkiKQogICAgICAgICAgICAgICAgICAgIG5ldFsiUkYvQ2xhaW1BbGxEYWlseU1pc3Npb25zIl06SW52b2tlU2VydmVyKCJXZWVrbHkiKQogICAgICAgICAgICAgICAgICAgIG5ldFsiUkYvQ2xhaW1BbGxDbGFuQlBRdWVzdHMiXTpJbnZva2VTZXJ2ZXIoKQogICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGpvaW5UaW1lc3RhbXAgPSB0b251bWJlcihwbHI6R2V0QXR0cmlidXRlKCJKb2luZWRUaW1lc3RhbXAiKSkgKyAxMAogICAgICAgICAgICAgICAgICAgIGZvciBpID0gMSwgNiBkbwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSB3b3Jrc3BhY2U6R2V0U2VydmVyVGltZU5vdygpIDwgam9pblRpbWVzdGFtcCArIChpICogMzAwKSArIDEgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5BdXRvQ2xhaW1SZXdhcmRzIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBuZXRbIlJGL0NsYWltUGxheXRpbWVSZXdhcmQiXTpJbnZva2VTZXJ2ZXIoaSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KQoKICAgIGxvY2FsIERpc2FibGVRdWFudHVtRWZmZWN0cyA9IG1pc2M6Y3JlYXRlX21vZHVsZSh7CiAgICAgICAgdGl0bGUgPSAnRGlzYWJsZSBRdWFudHVtIEFyZW5hIEVmZmVjdHMnLAogICAgICAgIGZsYWcgPSAnTm9RdWFudHVtRWZmZWN0cycsCiAgICAgICAgZGVzY3JpcHRpb24gPSAnRGlzYWJsZXMgUXVhbnR1bSBBcmVuYSBlZmZlY3RzLicsCiAgICAgICAgc2VjdGlvbiA9ICdyaWdodCcsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKICAgICAgICAgICAgZ2V0Z2VudigpLk5vUXVhbnR1bUVmZmVjdHMgPSB2YWx1ZQogICAgICAgICAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBxdWFudHVtZngKICAgICAgICAgICAgICAgICAgICB3aGlsZSB0YXNrLndhaXQoKSBhbmQgZ2V0Z2VudigpLk5vUXVhbnR1bUVmZmVjdHMgYW5kIG5vdCBxdWFudHVtZnggZG8KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gZ2V0Y29ubmVjdGlvbnMoUmVwbGljYXRlZFN0b3JhZ2UuUmVtb3Rlcy5RdWFudHVtQXJlbmEuT25DbGllbnRFdmVudCkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1YW50dW1meCA9IHYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHY6RGlzYWJsZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIH0pCgogICAgbG9jYWwgTm9fUmVuZGVyID0gbWlzYzpjcmVhdGVfbW9kdWxlKHsKICAgICAgICB0aXRsZSA9ICdObyBSZW5kZXInLAogICAgICAgIGZsYWcgPSAnTm9fUmVuZGVyJywKICAgICAgICBkZXNjcmlwdGlvbiA9ICdEaXNhYmxlcyByZW5kZXJpbmcgb2YgZWZmZWN0cycsCiAgICAgICAgc2VjdGlvbiA9ICdsZWZ0JywKICAgICAgICAKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHN0YXRlKQogICAgICAgICAgICBQbGF5ZXIuUGxheWVyU2NyaXB0cy5FZmZlY3RTY3JpcHRzLkNsaWVudEZYLkRpc2FibGVkID0gc3RhdGUKICAgIAogICAgICAgICAgICBpZiBzdGF0ZSB0aGVuCiAgICAgICAgICAgICAgICBDb25uZWN0aW9uc19NYW5hZ2VyWydObyBSZW5kZXInXSA9IHdvcmtzcGFjZS5SdW50aW1lLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihWYWx1ZSkKICAgICAgICAgICAgICAgICAgICBEZWJyaXM6QWRkSXRlbShWYWx1ZSwgMCkKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWYgQ29ubmVjdGlvbnNfTWFuYWdlclsnTm8gUmVuZGVyJ10gdGhlbgogICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ05vIFJlbmRlciddOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICAgICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ05vIFJlbmRlciddID0gbmlsCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KQoKICAgIGxvY2FsIEN1c3RvbUFubm91bmNlciA9IG1pc2M6Y3JlYXRlX21vZHVsZSh7CiAgICAgICAgdGl0bGUgPSAnQ3VzdG9tIEFubm91bmNlcicsCiAgICAgICAgZmxhZyA9ICdDdXN0b21fQW5ub3VuY2VyJywKICAgICAgICBkZXNjcmlwdGlvbiA9ICdDdXN0b21pemUgdGhlIGdhbWUgYW5ub3VuY2VtZW50cycsCiAgICAgICAgc2VjdGlvbiA9ICdyaWdodCcsCiAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbih2YWx1ZTogYm9vbGVhbikKICAgICAgICAgICAgaWYgdmFsdWUgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgQW5ub3VuY2VyID0gUGxheWVyLlBsYXllckd1aTpXYWl0Rm9yQ2hpbGQoImFubm91bmNlciIpCiAgICAgICAgICAgICAgICBsb2NhbCBXaW5uZXIgPSBBbm5vdW5jZXI6RmluZEZpcnN0Q2hpbGQoIldpbm5lciIpCiAgICAgICAgICAgICAgICBpZiBXaW5uZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIFdpbm5lci5UZXh0ID0gTGlicmFyeS5fY29uZmlnLl9mbGFnc1siYW5ub3VuY2VyX3RleHQiXSBvciAiZGlzY29yZC5nZy9nR1RESDZmV2RFIgogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBBbm5vdW5jZXIuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKFZhbHVlKQogICAgICAgICAgICAgICAgICAgIGlmIFZhbHVlLk5hbWUgPT0gIldpbm5lciIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZS5DaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oUHJvcGVydHkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBQcm9wZXJ0eSA9PSAiVGV4dCIgYW5kIExpYnJhcnkuX2NvbmZpZy5fZmxhZ3NbIkN1c3RvbV9Bbm5vdW5jZXIiXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUuVGV4dCA9IExpYnJhcnkuX2NvbmZpZy5fZmxhZ3NbImFubm91bmNlcl90ZXh0Il0gb3IgImRpc2NvcmQuZ2cvZ0dUREg2ZldkRSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIExpYnJhcnkuX2NvbmZpZy5fZmxhZ3NbIkN1c3RvbV9Bbm5vdW5jZXIiXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZS5UZXh0ID0gTGlicmFyeS5fY29uZmlnLl9mbGFnc1siYW5ub3VuY2VyX3RleHQiXSBvciAiZGlzY29yZC5nZy9nR1RESDZmV2RFIgogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICB9KQoKICAgIEN1c3RvbUFubm91bmNlcjpjcmVhdGVfdGV4dGJveCh7CiAgICAgICAgdGl0bGUgPSAiQ3VzdG9tIEFubm91bmNlbWVudCBUZXh0IiwKICAgICAgICBwbGFjZWhvbGRlciA9ICJFbnRlciBjdXN0b20gYW5ub3VuY2VyIHRleHQuLi4gIiwKICAgICAgICBmbGFnID0gImFubm91bmNlcl90ZXh0IiwKICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uKHRleHQpCiAgICAgICAgICAgIExpYnJhcnkuX2NvbmZpZy5fZmxhZ3NbImFubm91bmNlcl90ZXh0Il0gPSB0ZXh0CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBMaWJyYXJ5Ll9jb25maWcuX2ZsYWdzWyJDdXN0b21fQW5ub3VuY2VyIl0gdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgQW5ub3VuY2VyID0gUGxheWVyLlBsYXllckd1aTpXYWl0Rm9yQ2hpbGQoImFubm91bmNlciIpCiAgICAgICAgICAgICAgICBsb2NhbCBXaW5uZXIgPSBBbm5vdW5jZXI6RmluZEZpcnN0Q2hpbGQoIldpbm5lciIpCiAgICAgICAgICAgICAgICBpZiBXaW5uZXIgdGhlbgogICAgICAgICAgICAgICAgICAgIFdpbm5lci5UZXh0ID0gdGV4dAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgfSkKZW5kCgpSZXBsaWNhdGVkU3RvcmFnZS5SZW1vdGVzLlBhcnJ5U3VjY2Vzc0FsbC5PbkNsaWVudEV2ZW50OkNvbm5lY3QoZnVuY3Rpb24oXywgcm9vdCkKICAgIGlmIHJvb3QuUGFyZW50IGFuZCByb290LlBhcmVudCB+PSBQbGF5ZXIuQ2hhcmFjdGVyIHRoZW4KICAgICAgICBpZiByb290LlBhcmVudC5QYXJlbnQgfj0gd29ya3NwYWNlLkFsaXZlIHRoZW4KICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBBdXRvX1BhcnJ5LkNsb3Nlc3RfUGxheWVyKCkKCiAgICBsb2NhbCBCYWxsID0gQXV0b19QYXJyeS5HZXRfQmFsbCgpCgogICAgaWYgbm90IEJhbGwgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgbG9jYWwgVGFyZ2V0X0Rpc3RhbmNlID0gKFBsYXllci5DaGFyYWN0ZXIuUHJpbWFyeVBhcnQuUG9zaXRpb24gLSBDbG9zZXN0X0VudGl0eS5QcmltYXJ5UGFydC5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICBsb2NhbCBEaXN0YW5jZSA9IChQbGF5ZXIuQ2hhcmFjdGVyLlByaW1hcnlQYXJ0LlBvc2l0aW9uIC0gQmFsbC5Qb3NpdGlvbikuTWFnbml0dWRlCiAgICBsb2NhbCBEaXJlY3Rpb24gPSAoUGxheWVyLkNoYXJhY3Rlci5QcmltYXJ5UGFydC5Qb3NpdGlvbiAtIEJhbGwuUG9zaXRpb24pLlVuaXQKICAgIGxvY2FsIERvdCA9IERpcmVjdGlvbjpEb3QoQmFsbC5Bc3NlbWJseUxpbmVhclZlbG9jaXR5LlVuaXQpCgogICAgbG9jYWwgQ3VydmVfRGV0ZWN0ZWQgPSBBdXRvX1BhcnJ5LklzX0N1cnZlZCgpCgogICAgaWYgVGFyZ2V0X0Rpc3RhbmNlIDwgMTUgYW5kIERpc3RhbmNlIDwgMTUgYW5kIERvdCA+IC0wLjI1IHRoZW4gLS0gd3RmID8/IG1heWJlIHRoZSBiaWcgaXNzdWUKICAgICAgICBpZiBDdXJ2ZV9EZXRlY3RlZCB0aGVuCiAgICAgICAgICAgIEF1dG9fUGFycnkuUGFycnkoU2VsZWN0ZWRfUGFycnlfVHlwZSkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGlmIG5vdCBHcmFiX1BhcnJ5IHRoZW4KICAgICAgICByZXR1cm4KICAgIGVuZAoKICAgIEdyYWJfUGFycnk6U3RvcCgpCmVuZCkKClJlcGxpY2F0ZWRTdG9yYWdlLlJlbW90ZXMuUGFycnlTdWNjZXNzLk9uQ2xpZW50RXZlbnQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICBpZiBQbGF5ZXIuQ2hhcmFjdGVyLlBhcmVudCB+PSB3b3Jrc3BhY2UuQWxpdmUgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgaWYgbm90IEdyYWJfUGFycnkgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgR3JhYl9QYXJyeTpTdG9wKCkKZW5kKQoKd29ya3NwYWNlLkJhbGxzLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICBQYXJyaWVkID0gZmFsc2UKZW5kKQoKd29ya3NwYWNlLkJhbGxzLkNoaWxkUmVtb3ZlZDpDb25uZWN0KGZ1bmN0aW9uKFZhbHVlKQogICAgUGFycmllcyA9IDAKICAgIFBhcnJpZWQgPSBmYWxzZQoKICAgIGlmIENvbm5lY3Rpb25zX01hbmFnZXJbJ1RhcmdldCBDaGFuZ2UnXSB0aGVuCiAgICAgICAgQ29ubmVjdGlvbnNfTWFuYWdlclsnVGFyZ2V0IENoYW5nZSddOkRpc2Nvbm5lY3QoKQogICAgICAgIENvbm5lY3Rpb25zX01hbmFnZXJbJ1RhcmdldCBDaGFuZ2UnXSA9IG5pbAogICAgZW5kCmVuZCkKCm1haW46bG9hZCgpCg==
]]))()
